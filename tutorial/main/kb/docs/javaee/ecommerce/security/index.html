<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>The NetBeans E-commerce Tutorial - Securing the Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The NetBeans E-commerce Tutorial - Securing the Application - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, The NetBeans E-commerce Tutorial - Securing the Application">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="../../../../../../../_/css/highlight-11.9.0.default.min.css">
    <link rel="stylesheet" href="../../../../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../../../../index.html"><img src='../../../../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 22</h1>
            <p><a class="button success" href="../../../../../../../front/main/download/nb22">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <article class="doc">
      <h1 class="sect0">The NetBeans E-commerce Tutorial - Securing the Application</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/security.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_tutorial_contents">Tutorial Contents</a></li>
<li><a href="#examineSnapshot">Examining the Project Snapshot</a></li>
<li><a href="#formBased">Setting up Form-Based Authentication</a>
<ul class="sectlevel2">
<li><a href="#declarativeSecurity">Declarative and Programmatic Security</a></li>
<li><a href="#authenticationMech">Choosing an Authentication Mechanism</a></li>
<li><a href="#createPages">Create Pages for Login and Login Failure</a></li>
<li><a href="#addSecurity">Add Security Entries to the Deployment Descriptor</a></li>
</ul>
</li>
<li><a href="#usersGroups">Setting up Users, Groups and Roles</a>
<ul class="sectlevel2">
<li><a href="#understandUsers">Understanding Users, Groups, and Roles</a></li>
<li><a href="#understandRealms">Understanding Realms on the GlassFish Server</a></li>
<li><a href="#createUsers">Create Users and/or Groups on the Server</a></li>
<li><a href="#defineRoles">Define Roles in the Application</a></li>
<li><a href="#mapApplication">Map Roles to Users and/or Groups</a></li>
</ul>
</li>
<li><a href="#secureTransport">Configuring Secure Data Transport</a>
<ul class="sectlevel2">
<li><a href="#verifyHTTPS">Verify HTTPS Support on the Server</a></li>
<li><a href="#configureSecure">Configure Secure Connection in the Application</a></li>
</ul>
</li>
<li><a href="#seeAlso">See Also</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_resources">NetBeans Resources</a></li>
<li><a href="#_external_resources">External Resources</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_tutorial_contents"><a class="anchor" href="#_tutorial_contents"></a>Tutorial Contents</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../intro/" class="xref page">Introduction</a></p>
</li>
<li>
<p><a href="../design/" class="xref page">Designing the Application</a></p>
</li>
<li>
<p><a href="../setup-dev-environ/" class="xref page">Setting up the Development Environment</a></p>
</li>
<li>
<p><a href="../data-model/" class="xref page">Designing the Data Model</a></p>
</li>
<li>
<p><a href="../page-views-controller/" class="xref page">Preparing the Page Views and Controller Servlet</a></p>
</li>
<li>
<p><a href="../connect-db/" class="xref page">Connecting the Application to the Database</a></p>
</li>
<li>
<p><a href="../entity-session/" class="xref page">Adding Entity Classes and Session Beans</a></p>
</li>
<li>
<p><a href="../manage-sessions/" class="xref page">Managing Sessions</a></p>
</li>
<li>
<p><a href="../transaction/" class="xref page">Integrating Transactional Business Logic</a></p>
</li>
<li>
<p><a href="../language/" class="xref page">Adding Language Support</a></p>
</li>
<li>
<p><strong>Securing the Application</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#examineSnapshot">Examining the Project Snapshot</a></p>
</li>
<li>
<p><a href="#formBased">Setting up Form-Based Authentication</a></p>
</li>
<li>
<p><a href="#usersGroups">Creating Users, Groups and Roles</a></p>
</li>
<li>
<p><a href="#secureTransport">Configuring Secure Data Transport</a></p>
</li>
<li>
<p><a href="#seeAlso">See Also</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p><a href="../test-profile/" class="xref page">Testing and Profiling</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p><a href="../conclusion/" class="xref page">Conclusion</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. Content on this page applies to NetBeans IDE, versions 6.8 and 6.9</div>
</div>
<div class="paragraph">
<p>This tutorial unit focuses on web application security. When securing web applications, there are two primary concerns that need to be addressed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Preventing unauthorized users from gaining access to protected content.</p>
</li>
<li>
<p>Preventing protected content from being read while it is being transmitted.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first concern, <em>access control</em>, is typically a two-step process that involves (1) determining whether a user is who he or she claims to be (i.e., <em>authentication</em>), and then (2) either granting or denying the user access to the requested resource (i.e., <em>authorization</em>). A simple and common way to implement access control for web applications is with a login form that enables the server to compare user credentials with a pre-existing list of authenticated users.</p>
</div>
<div class="paragraph">
<p>The second concern, protecting data while it is in transit, typically involves using Transport Layer Security (TLS), or its predecessor, Secure Sockets Layer (SSL), in order to encrypt any data communicated between the client and server.</p>
</div>
<div class="paragraph">
<p>Upon reviewing the Affable Bean staff&#8217;s <a href="../design/#requirements" class="xref page">list of requirements</a>, we&#8217;ll need to secure the application in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up a login form for the administration console that enables staff members access to the console&#8217;s services, and blocks unauthorized users.</p>
</li>
<li>
<p>Configure secure data transport for both the customer checkout process, and for any data transmitted to and from the administration console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to implement the above, we&#8217;ll take advantage of NetBeans' visual editor for the <code>web.xml</code> deployment descriptor. We&#8217;ll also work in the GlassFish Administration Console to configure a "user group" that corresponds to Affable Bean staff members, and verify SSL support.</p>
</div>
<div class="paragraph">
<p>You can view a live demo of the application that you build in this tutorial: <a href="http://services.netbeans.org/AffableBean/">NetBeans E-commerce Tutorial Demo Application</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software or Resource</th>
<th class="tableblock halign-left valign-top">Version Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../../../../../front/main/download/" class="xref page">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java bundle, 6.8 or 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">GlassFish server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 or Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQL database server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot10.zip">AffableBean project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot 10</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NetBeans IDE requires the Java Development Kit (JDK) to run properly. If you do not have any of the resources listed above, the JDK should be the first item that you download and install.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle includes Java Web and EE technologies, which are required for the application you build in this tutorial.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle also includes the GlassFish server, which you require for this tutorial. You could <a href="http://glassfish.dev.java.net/public/downloadsindex.html">download the GlassFish server independently</a>, but the version provided with the NetBeans download has the added benefit of being automatically registered with the IDE.</p>
</li>
<li>
<p>You can follow this tutorial unit without having completed previous units. To do so, see the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</li>
<li>
<p>Java EE security is an expansive topic that spans well beyond the scope of this tutorial unit. In order to fully appreciate the range of implementation options that are available to you, refer to the <a href="http://download.oracle.com/javaee/6/tutorial/doc/gijrp.html">Java EE 6 Tutorial, Part VII: Security</a>. This unit provides ample references to relevant sub-sections within the Java EE Tutorial.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examineSnapshot"><a class="anchor" href="#examineSnapshot"></a>Examining the Project Snapshot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The beginning state of the snapshot helps to illustrate the need for security in the application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot10.zip">project snapshot</a> for this tutorial unit in the IDE. Click the Open Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/open-project-btn.png" alt="open project btn"></span> ) button and use the wizard to navigate to the location on your computer where you downloaded the project.</p>
</li>
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to ensure that it is properly configured with your database and application server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you receive an error when running the project, revisit the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Test the application&#8217;s functionality in your browser. This snapshot provides an implementation of the administration console, as specified in the <a href="../design/#requirements" class="xref page">customer requirements</a>. To examine the administration console, enter the following URL in your browser:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http://localhost:8080/AffableBean*/admin/*</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/admin-console.png" alt="admin console">
</div>
<div class="title">Figure 2. Append the application&#8217;s default URL with '/admin' to view the administration console in a browser</div>
</div>
<div class="paragraph">
<p>The administration console enables you to view all customers and orders contained in the database. When you click either of the links in the left panel, the page will update to display a table listing customers or orders, depending on your choice. (The 'log out' link currently does not "log out" an authenticated user.)</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The customers and orders that you see displayed in the administration console are dependent on the data stored in your database. You can create new records by stepping through the checkout process in the website. Alternatively, you can run the <a href="https://netbeans.org/project_downloads/samples/Samples/JavaEE/ecommerce/affablebean_sample_data.sql">affablebean_sample_data.sql</a> script on your <code>affablebean</code> database to have your data correspond to the records displayed in the following screenshots. (If you need help with this task, refer to step 2 in the <a href="../setup/" class="xref page">setup instructions</a>.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/admin-console-customers.png" alt="admin console customers">
</div>
<div class="title">Figure 3. Click the 'view all customers' link to view all customer records in a table</div>
</div>
<div class="paragraph">
<p>You can view details for each customer record by hovering your mouse and selecting an individual record.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/customer-selected.png" alt="customer selected">
</div>
<div class="title">Figure 4. Hover your mouse over a customer record and click to view customer details</div>
</div>
<div class="paragraph">
<p>Likewise, you can view an order summary for each customer either by selecting an order from the administration console&#8217;s "orders" table, or by clicking the "view order summary" link in a "customer details" display.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/view-order-summary.png" alt="view order summary">
</div>
<div class="title">Figure 5. Click 'view order summary' from a customer details display in order to view a customer&#8217;s order details</div>
</div>
<div class="paragraph">
<p>Naturally, none of this information should be available to an anonymous site visitor. In the coming steps, you&#8217;ll create login and error pages, so that when an unauthenticated user attempts to access the administration console, he or she will be directed to the login page. Upon successful login, the user is then redirected to the administration console&#8217;s menu; upon login failure, the error page is displayed.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Examine the project snapshot in the Projects window.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/projects-window.png" alt="projects window" title="The AdminServlet forwards requests to resources within the web/admin folder"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This implementation of the administration console primarily relies on the following project resources:</p>
<p class="tableblock">* An <strong><code>admin</code></strong> directory within the project&#8217;s webroot, which contains all page view files.
* An <strong><code>AdminServlet</code></strong>, contained in the <code>controller</code> package, which forwards requests to page views within the <code>admin</code> directory.</p>
<p class="tableblock">Also, the following files have been modified from the previous snapshot:</p>
<p class="tableblock">* <strong><code>WEB-INF/web.xml</code>:</strong> Contains a new <code>&lt;jsp-property-group&gt;</code> that includes the header and footer fragments for page views contained in the <code>admin</code> directory.
* <strong><code>css/affablebean.css</code>:</strong> Includes new style definitions for elements in the administration console</p>
<p class="tableblock">If you have been following the NetBeans E-commerce Tutorial sequentially, you&#8217;ll find that there is nothing contained in the implementation for the administration console which hasn&#8217;t already been covered in previous units. Essentially, the <code>AdminServlet</code> processes requests from the <code>admin/index.jsp</code> page, EJBs and entity classes are employed to retrieve information from the database, and the information is then forwarded back to the <code>admin/index.jsp</code> page to be displayed.</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>In the browser, return to the customer website by clicking the Affable Bean logo in the upper left corner of the web page. Step through the entire <a href="../design/#business" class="xref page">business process flow</a> of the application and note that the checkout process is handled over a non-secure channel.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When customers reach the checkout page, they are expected to submit sensitive personal information in order to complete their orders. Part of your task in this tutorial unit is to ensure that this data is sent over a secure channel. Because the administration console also enables authenticated users to view customers' personal information, it too needs to be configured so that data is sent over the Internet securely.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="formBased"><a class="anchor" href="#formBased"></a>Setting up Form-Based Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you set up <em>form-based authentication</em> for the <code>AffableBean</code> administration console. Form-based authentication enables the server to authenticate users based on the credentials they enter into a login form. With these credentials, the server is able to make a decision on whether to grant the user access to protected resources. In order to implement this, you&#8217;ll create login and error pages, and will rely on <em>declarative security</em> by entering security settings in the application&#8217;s <code>web.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Before you begin implementing a form-based authentication mechanism for the <code>AffableBean</code> application, the following background information is provided to help clarify the security terms relevant to our scenario.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#declarativeSecurity">Declarative and Programmatic Security</a></p>
</li>
<li>
<p><a href="#authenticationMech">Choosing an Authentication Mechanism</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="declarativeSecurity"><a class="anchor" href="#declarativeSecurity"></a>Declarative and Programmatic Security</h3>
<div class="paragraph">
<p>With <em>declarative security</em>, you specify all security settings for your application, including authentication requirements, access control, and security roles, using annotations and/or deployment descriptors. In other words, the security for your application is in a form that is external to the application, and relies on the mechanisms provided by the Java EE container for its management.</p>
</div>
<div class="paragraph">
<p>With <em>programmatic security</em>, your classes, entities, servlets, and page views manage security themselves. In this case, security logic is integrated directly into your application, and is used to handle authentication and authorization, and ensure that data is sent over a secure network protocol when necessary.</p>
</div>
<div class="paragraph">
<p>For the <code>AffableBean</code> application, we&#8217;ll use declarative security by declaring all security information in the <code>web.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>For more information on declarative and programmatic security types, see the <a href="http://download.oracle.com/javaee/6/tutorial/doc/bncat.html">Java EE 6 Tutorial: Overview of Web Application Security</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="authenticationMech"><a class="anchor" href="#authenticationMech"></a>Choosing an Authentication Mechanism</h3>
<div class="paragraph">
<p>An <em>authentication mechanism</em> is used to determine how a user gains access to restricted content. The Java EE platform supports various authentication mechanisms, such as <em>HTTP basic authentication</em>, <em>form-based authentication</em>, and <em>client authentication</em>. The authentication mechanism behind our login form will be <em>form-based authentication</em>. You&#8217;ll learn what form-based authentication is when you begin <a href="#loginForm">setting up the login form</a> for the <code>AffableBean</code> administration console below.</p>
</div>
<div class="paragraph">
<p>See the Java EE 6 Tutorial: <a href="http://download.oracle.com/javaee/6/tutorial/doc/gkbaa.html#gkbsa">Specifying Authentication Mechanisms</a> for further information.</p>
</div>
<div class="paragraph">
<p>Form-based authentication has the advantage of enabling the developer to design the appearance of the login form so that it better suits the application which it belongs to. Our implementation for the form-based authentication mechanism can be divided into two steps. Begin by creating page views for the required login form and error message. Then add entries to the <code>web.xml</code> deployment descriptor to inform the servlet container that the application requires form-based authentication for access to the resources that comprise the administration console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#createPages">Create Pages for Login and Login Failure</a></p>
</li>
<li>
<p><a href="#addSecurity">Add Security Entries to the Deployment Descriptor</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="createPages"><a class="anchor" href="#createPages"></a>Create Pages for Login and Login Failure</h3>
<div class="paragraph">
<p>In form-based authentication, the process of authentication and authorization is shown in the following four steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client sends a request to the server for a protected resource.</p>
</li>
<li>
<p>The server recognizes that a protected resource has been requested, and returns the login page to the client.</p>
</li>
<li>
<p>The client sends username and password credentials using the provided form.</p>
</li>
<li>
<p>The server processes the credentials, and if an authorized user is identified the protected resource is returned, otherwise the error page is returned.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/form-based-authentication.png" alt="form based authentication">
</div>
<div class="title">Figure 6. Authentication and authorization take place in a four-step process using form-based authentication</div>
</div>
<div class="paragraph">
<p>For more information on form-based authentication, see the Java EE 6 Tutorial: <a href="http://download.oracle.com/javaee/6/tutorial/doc/gkbaa.html#bncbq">Form-Based Authentication</a>.</p>
</div>
<div class="paragraph">
<p>The <code>j_security_check</code> keyword represents the destination in the servlet container that handles authentication and authorization. When implementing the HTML login form, you apply it as the value for the form&#8217;s <code>action</code> attribute. You also apply the &#8220;j_username&#8221; and &#8220;j_password&#8221; keywords, as in the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;form action="*j_security_check*" method=post&gt;

    &lt;p&gt;username: &lt;input type="text" name="*j_username*"&gt;&lt;/p&gt;

    &lt;p&gt;password: &lt;input type="password" name="*j_password*"&gt;&lt;/p&gt;

    &lt;p&gt;&lt;input type="submit" value="submit"&gt;&lt;/p&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Perform the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Projects window, right-click the <code>admin</code> folder node and choose New &gt; JSP.</p>
</li>
<li>
<p>Name the file <code>login</code>, then click Finish. The new <code>login.jsp</code> file is created and opens in the editor.</p>
</li>
<li>
<p>Repeat the previous two steps to create a new <code>error.jsp</code> file. In the New JSP wizard, name the file <code>error</code>. When you finish, you&#8217;ll have two new files listed in the Projects window.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/projects-window-jsp.png" alt="projects window jsp">
</div>
<div class="title">Figure 7. New JSP file nodes displayed in Projects window</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Open the project&#8217;s web deployment descriptor. Press Alt-Shift-O (Ctrl-Shift-O on Mac) and in the Go to File dialog, type <code>web</code>, then click OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/go-to-file.png" alt="go to file">
</div>
<div class="title">Figure 8. Use the Go to File dialog to quickly open files in the editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>In the editor, scroll to the bottom of the <code>web.xml</code> file and note the <code>&lt;jsp-property-group&gt;</code> entry created for JSP pages in the administration console. Add the new login and error JSP pages as <code>&lt;url-pattern&gt;</code> entries. (Changes in <strong>bold</strong>.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;jsp-property-group&gt;
    &lt;description&gt;JSP configuration for the admin console&lt;/description&gt;
    &lt;url-pattern&gt;/admin/index.jsp&lt;/url-pattern&gt;
    *&lt;url-pattern&gt;/admin/login.jsp&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/admin/error.jsp&lt;/url-pattern&gt;*
    &lt;include-prelude&gt;/admin/jspf/header.jspf&lt;/include-prelude&gt;
    &lt;include-coda&gt;/admin/jspf/footer.jspf&lt;/include-coda&gt;
&lt;/jsp-property-group&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step ensures that when these two pages are returned to a client, they will be prepended and appended with the defined <code>header.jspf</code> and <code>footer.jspf</code> fragments, respectively.</p>
</div>
<div class="paragraph">
<p>You can equally configure the <code>&lt;jsp-property-group&gt;</code> entry from the `web.xml`s visual editor. Click the Pages tab along the top of the editor, and enter the URL patterns into the respective JSP Property Group.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Press Ctrl-Tab to switch to the <code>login.jsp</code> file in the editor. Delete the entire template contents for the file, then enter the following HTML form.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;form action="*j_security_check*" method=post&gt;
    &lt;div id="loginBox"&gt;
        &lt;p&gt;&lt;strong&gt;username:&lt;/strong&gt;
            &lt;input type="text" size="20" name="*j_username*"&gt;&lt;/p&gt;

        &lt;p&gt;&lt;strong&gt;password:&lt;/strong&gt;
            &lt;input type="password" size="20" name="*j_password*"&gt;&lt;/p&gt;

        &lt;p&gt;&lt;input type="submit" value="submit"&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the HTML form is based on the <a href="#template">template provided above</a>. Here, you use the &#8220;j_security_check&#8221; keyword as the value for the form&#8217;s <code>action</code> attribute, and the &#8220;j_username&#8221; and &#8220;j_password&#8221; keywords as the values for the <code>name</code> attribute of the username and password text fields. The style of the form is implemented by encapsulating the form widgets within a <code>&lt;div&gt;</code> element, then defining a set of rules for the <code>loginBox</code> ID in <code>affablebean.css</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Press Ctrl-Tab and switch to the <code>error.jsp</code> file in the editor. Delete the entire template contents for the file, then enter the following.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div id="loginBox"&gt;

    &lt;p class="error"&gt;Invalid username or password.&lt;/p&gt;

    &lt;p&gt;Return to &lt;strong&gt;&lt;a href="login.jsp"&gt;admin login&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above content includes a simple message indicating that login has failed, and provides a link that allows the user to return to the login form.</p>
</div>
</div>
<div class="sect2">
<h3 id="addSecurity"><a class="anchor" href="#addSecurity"></a>Add Security Entries to the Deployment Descriptor</h3>
<div class="paragraph">
<p>In order to instruct the servlet container that form-based authentication is to be used, you add entries to the <code>web.xml</code> deployment descriptor. This is essentially a three-step process, which can be followed by specifying settings under the three headings in the <code>web.xml</code> file&#8217;s Security tab. These are: (1) Login Configuration, (2) Security Roles, and (3) Security Constraints.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project&#8217;s <code>web.xml</code> file in the editor. (If it is already opened, you can press Ctrl-Tab and select it.)</p>
</li>
<li>
<p>Click the Security tab along the top of the editor. The IDE&#8217;s visual editor enables you to specify security settings under the Security tab.</p>
</li>
<li>
<p>Expand the Login Configuration heading, select Form, then enter the following details:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Form Login Page:</strong> <code>/admin/login.jsp</code></p>
</li>
<li>
<p><strong>Form Error Page:</strong> <code>/admin/error.jsp</code></p>
</li>
<li>
<p><strong>Realm Name:</strong> <code>file</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/login-configuration.png" alt="login configuration">
</div>
<div class="title">Figure 9. Specify security settings for the application using the IDE&#8217;s web.xml visual editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the XML tab along the top of the editor and verify the changes made to the deployment descriptor. The following entry has been added to the bottom of the file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
    &lt;realm-name&gt;file&lt;/realm-name&gt;
    &lt;form-login-config&gt;
        &lt;form-login-page&gt;/admin/login.jsp&lt;/form-login-page&gt;
        &lt;form-error-page&gt;/admin/error.jsp&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This entry informs the servlet container that form-based authentication is used, the realm named <code>file</code> should be checked for user credentials, and specifies the whereabouts of the login and error pages.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click the Security tab again, then expand the Security Roles heading and click Add.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>In the Add Security Role dialog, type in <code>affableBeanAdmin</code> for the role name, then click OK. The new role entry is added beneath Security Roles.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Click the XML tab to examine how the file has been affected. Note that the following entry has been added:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-role&gt;
    &lt;description/&gt;
    &lt;role-name&gt;affableBeanAdmin&lt;/role-name&gt;
&lt;/security-role&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;ve specified the name of a security role used with the application. We&#8217;ll need to associate this role with the protected resources that define the administration console (under the Security Constraints heading below), and later we&#8217;ll <a href="#defineRoles">create this role on the GlassFish server</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click the Security tab again, then click the Add Security Constraint button.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Type in <code>Admin</code> for the Display Name, then under Web Resource Collection click the Add button. Enter the following details, then when you are finished, click OK.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Name:</strong> <code>Affable Bean Administration</code></p>
</li>
<li>
<p><strong>URL Pattern(s):</strong> <code>/admin/*</code></p>
</li>
<li>
<p><strong>HTTP Method(s):</strong> <code>All HTTP Methods</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/add-web-resource.png" alt="add web resource">
</div>
<div class="title">Figure 10. Specify which resources need to be protected using the Add Web Resource dialog</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Under the new Admin security constraint, select the Enable Authentication Constraint option and click the Edit button next to the Role Name(s) text field.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>In the dialog that displays, select the <code>affableBeanAdmin</code> role in the left column, then click Add. The role is moved to the right column.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/edit-role-names.png" alt="edit role names">
</div>
<div class="title">Figure 11. Specify roles to be associated with an authentication constraint</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Click OK. The role is added to the Role Name(s) text field.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/security-tab.png" alt="security tab">
</div>
<div class="title">Figure 12. Security constraints include specifying the web resource collection, and role(s) that are granted access to the collection</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Click the XML tab to examine how the file has been affected. Note that the following entry has been added:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
    &lt;display-name&gt;Admin&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Affable Bean Administration&lt;/web-resource-name&gt;
        &lt;description/&gt;
        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;description/&gt;
        &lt;role-name&gt;affableBeanAdmin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In these previous six steps, you&#8217;ve created a security constraint that specifies which resources need to be protected, and identifies the role(s) that are granted access to them. Since the administration console implementation is essentially everything contained within the application&#8217;s <code>admin</code> folder, you use a wildcard (<code>*</code>). Although you&#8217;ve specified that all HTTP methods should be protected, you could have equally selected just GET and POST, since these are the only two that are handled by the <code>AdminServlet</code>. As previously mentioned, the <code>affableBeanAdmin</code> role that we declared still needs to be created on the GlassFish server.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to examine how the application now handles access to the administration console.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>When the application opens in the browser, attempt to access the administration console by entering the following URL into the browser&#8217;s address bar:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http://localhost:8080/AffableBean*/admin/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you attempt to access the administration console, the login page is now presented.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/login-form.png" alt="login form">
</div>
<div class="title">Figure 13. Unauthenticated attempts to access the administration console are redirected to the login page</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Click the 'submit' button to attempt login. You see the error page displayed.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/error-page.png" alt="error page">
</div>
<div class="title">Figure 14. Error page is displayed when the server is unable to authenticate a user</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usersGroups"><a class="anchor" href="#usersGroups"></a>Setting up Users, Groups and Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Much of our security implementation is dependent on configuration between the application and the GlassFish server we are using. This involves setting up <em>users</em>, <em>groups</em>, and <em>roles</em> between the two, and using one of the preconfigured security policy domains, or <em>realms</em>, on the server. Start by reading some background information relevant to our scenario, then proceed by configuring users, groups and roles between the application and the GlassFish server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#understandUsers">Understanding Users, Groups, and Roles</a></p>
</li>
<li>
<p><a href="#understandRealms">Understanding Realms on the GlassFish Server</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="understandUsers"><a class="anchor" href="#understandUsers"></a>Understanding Users, Groups, and Roles</h3>
<div class="paragraph">
<p>A <em>user</em> is a unique identity recognized by the server. You define users on the server so that it can be able to determine who should have access to protected resources. You can optionally cluster users together into a <em>group</em>, which can be understood as a set of authenticated users. In order to specify which users and/or groups have access to protected resources, you create <em>roles</em>. As stated in the Java EE 6 Tutorial,</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>A role is an abstract name for the permission to access a particular set of resources in an application. A role can be compared to a key that can open a lock. Many people might have a copy of the key. The lock doesn’t care who you are, only that you have the right key.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The role that a user or group is assigned to is what specifically allows the server to determine whether protected resources can be accessed. Users and groups can be assigned to multiple roles. As will be demonstrated below, you accomplish this by defining the role in the application, then mapping it to users and groups on the server.</p>
</div>
<div class="paragraph">
<p>The relationship between users, groups, and roles, and the process in which you establish them in the application and on the server, is presented in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/groups-users-roles.png" alt="groups users roles">
</div>
<div class="title">Figure 15. Users, groups, and roles need to be set up and mapped between the application and server</div>
</div>
<div class="paragraph">
<p>For more information on groups, users, and roles, see <a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbxj.html">Working with Realms, Users, Groups, and Roles</a> in the Java EE 6 Tutorial.</p>
</div>
</div>
<div class="sect2">
<h3 id="understandRealms"><a class="anchor" href="#understandRealms"></a>Understanding Realms on the GlassFish Server</h3>
<div class="paragraph">
<p>When you define users and groups on the server, you do so by entering details into a security policy domain, otherwise known as a <em>realm</em>. A realm protects user credentials (e.g., user names and passwords) through an authentication scheme. For example, user credentials can be stored in a local text file, or maintained in a certificate database.</p>
</div>
<div class="paragraph">
<p>The GlassFish server provides three preconfigured realms by default. These are the <code>file</code>, <code>admin-realm</code>, and <code>certificate</code> realms. Briefly, the <code>file</code> realm stores user credentials in a local text file named <code>keyfile</code>. The <code>admin-realm</code> also stores credentials in a local text file, and is reserved for server administrator users. The <code>certificate</code> realm, the server stores user credentials in a certificate database.</p>
</div>
<div class="paragraph">
<p>When defining users, groups and roles for the <code>AffableBean</code> administration console, we&#8217;ll use the server&#8217;s preconfigured <code>file</code> realm.</p>
</div>
<div class="paragraph">
<p>In order to set up users, groups and roles to satisfy the form-based authentication mechanism we&#8217;ve created, perform the following three steps corresponding to the <a href="#usersRolesGroupsDiagram">diagram above</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#createUsers">Create Users and/or Groups on the Server</a></p>
</li>
<li>
<p><a href="#defineRoles">Define Roles in the Application</a></p>
</li>
<li>
<p><a href="#mapApplication">Map Roles to Users and/or Groups</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="createUsers"><a class="anchor" href="#createUsers"></a>Create Users and/or Groups on the Server</h3>
<div class="paragraph">
<p>In this step, we&#8217;ll use the GlassFish Administration Console to create a user named <code>nbuser</code> within the preexisting <code>file</code> security realm. We&#8217;ll also assign the new <code>nbuser</code> to a <em>group</em> that we&#8217;ll create called <code>affableBeanAdmin</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Services window (Ctrl-5; ⌘-5 on Mac) and expand the Servers node so that the GlassFish server node is visible.</p>
</li>
<li>
<p>Ensure that the GlassFish server is running. If the server is running, a small green arrow is displayed next to the GlassFish icon ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-running-node.png" alt="gf server running node"></span> ). If you need to start it, right-click the server node and choose Start.</p>
</li>
<li>
<p>Right-click the GlassFish server node and choose View Admin Console. The login form for the GlassFish Administration Console opens in a browser.</p>
</li>
<li>
<p>Log into the Administration Console by typing <code>admin</code> / <code>adminadmin</code> for the username / password.</p>
</li>
<li>
<p>In the Tree which displays in the left column of the Administration Console, expand the Configuration &gt; Security &gt; Realms nodes, then click the <code>file</code> realm.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/file-realm.png" alt="file realm">
</div>
<div class="title">Figure 16. Expand the Configuration &gt; Security &gt; Realms nodes to view existing security realms</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>In the main panel of the GlassFish Administration Console, under Edit Realm, click the Manage Users button.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Under File Users, click the New button.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Under New File Realm User, enter the following details:</p>
<div class="ulist">
<ul>
<li>
<p><strong>User ID:</strong> <code>nbuser</code></p>
</li>
<li>
<p><strong>Group List:</strong> <code>affableBeanAdmin</code></p>
</li>
<li>
<p><strong>New Password:</strong> <code>secret</code></p>
</li>
<li>
<p><strong>Confirm New Password:</strong> <code>secret</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/new-file-realm-user.png" alt="new file realm user">
</div>
<div class="title">Figure 17. Enter new user and group details in the New File Realm User panel</div>
</div>
<div class="paragraph">
<p>Here, we are creating a user for the <code>file</code> security realm, which we&#8217;ve randomly named <code>nbuser</code>. We have also assigned the new user to a randomly named <code>affableBeanAdmin</code> group. Remember the <code>secret</code> password you set, as you will require it to later log into the <code>AffableBean</code> administration console.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Click OK. The new <code>nbuser</code> user is now listed under File Users in the GlassFish Administration Console.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/nbuser-file-realm.png" alt="nbuser file realm">
</div>
<div class="title">Figure 18. All users and groups pertaining to the 'file' realm are displayed under File Users</div>
</div>
<div class="paragraph">
<p>Optionally close the browser window for the GlassFish Administration Console, or leave it open for the time being. You will need to return to the Administration Console in the <a href="#mapApplication">Map Roles to Users and/or Groups</a> step below.</p>
</div>
</div>
<div class="sect2">
<h3 id="defineRoles"><a class="anchor" href="#defineRoles"></a>Define Roles in the Application</h3>
<div class="paragraph">
<p>By "defining roles in the application," you specify which roles have access to EJB session beans, servlets, and/or specific methods that they contain. You can accomplish this declaratively by creating entries in the deployment descriptor, or using annotations. For the <code>AffableBean</code> administration console, we&#8217;ve actually already completed this step when we <a href="#enableAuthConstraint">added the <code>affableBeanAdmin</code> role to the security constraint</a> that we created when implementing form-based authentication. However, in more complicated scenarios you may have multiple roles, each with varying degrees of access. In such cases, implementation requires a more fine-grained access control.</p>
</div>
<div class="paragraph">
<p>The Java EE 6 API includes various security annotations that you can use in place of the XML entries you add to deployment descriptors. The availability of annotations primarily aims to offer ease of development and flexibility when coding. One common method is to use annotations within classes, but override them when necessary using deployment descriptors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#secureServlet">Using Security Annotations in Servlets</a></p>
</li>
<li>
<p><a href="#secureEJB">Using Security Annotations in EJBs</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="secureServlet"><a class="anchor" href="#secureServlet"></a>Using Security Annotations in Servlets</h4>
<div class="paragraph">
<p>The following table lists some of the annotations available to you when applying roles to servlets.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Servlet 3.0 Security Annotations (specified in <a href="http://www.jcp.org/en/jsr/detail?id=315">JSR 315</a>)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://download.oracle.com/javaee/6/api/javax/servlet/annotation/ServletSecurity.html">@ServletSecurity</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to specify security constraints to be enforced by a Servlet container on HTTP protocol messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://download.oracle.com/javaee/6/api/javax/servlet/annotation/HttpConstraint.html">@HttpConstraint</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used within the <code>ServletSecurity</code> annotation to represent the security constraints to be applied to all HTTP protocol methods.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If we wanted to apply the Servlet 3.0 annotations to declare the <code>affableBeanAdmin</code> role on the <code>AdminServlet</code>, we could do so as follows. (Changes in <strong>bold</strong>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebServlet(name = "AdminServlet",
            urlPatterns = {"/admin/",
                           "/admin/viewOrders",
                           "/admin/viewCustomers",
                           "/admin/customerRecord",
                           "/admin/orderRecord",
                           "/admin/logout"})
*@ServletSecurity( @HttpConstraint(rolesAllowed = {"affableBeanAdmin"}) )*
public class AdminServlet extends HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, we could then remove the corresponding entry in the <code>web.xml</code> deployment descriptor. (Removed content displayed as <span class="line-through"><strong>strike-through</strong></span> text.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
    &lt;realm-name&gt;file&lt;/realm-name&gt;
    &lt;form-login-config&gt;
        &lt;form-login-page&gt;/admin/login.jsp&lt;/form-login-page&gt;
        &lt;form-error-page&gt;/admin/error.jsp&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;

[.line-through]#*&lt;security-constraint&gt;*#
    [.line-through]#*&lt;display-name&gt;Admin&lt;/display-name&gt;*#
    [.line-through]#*&lt;web-resource-collection&gt;*#
        [.line-through]#*&lt;web-resource-name&gt;Affable Bean Administration&lt;/web-resource-name&gt;*#
        [.line-through]#*&lt;description/&gt;*#
        [.line-through]#*&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;*#
    [.line-through]#*&lt;/web-resource-collection&gt;*#
    [.line-through]#*&lt;auth-constraint&gt;*#
        [.line-through]#*&lt;description/&gt;*#
        [.line-through]#*&lt;role-name&gt;affableBeanAdmin&lt;/role-name&gt;*#
    [.line-through]#*&lt;/auth-constraint&gt;*#
[.line-through]#*&lt;/security-constraint&gt;*#

[.line-through]#*&lt;security-role&gt;*#
    [.line-through]#*&lt;description/&gt;*#
    [.line-through]#*&lt;role-name&gt;affableBeanAdmin&lt;/role-name&gt;*#
[.line-through]#*&lt;/security-role&gt;*#</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="secureEJB"><a class="anchor" href="#secureEJB"></a>Using Security Annotations in EJBs</h4>
<div class="paragraph">
<p>The following table lists some of the annotations available to you when applying roles to EJBs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EJB Security Annotations (specified in <a href="http://www.jcp.org/en/jsr/detail?id=250">JSR 250</a>)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://download.oracle.com/javaee/6/api/javax/annotation/security/DeclareRoles.html">@DeclareRoles</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by application to declare roles. It can be specified on a class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://download.oracle.com/javaee/6/api/javax/annotation/security/RolesAllowed.html">@RolesAllowed</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the list of roles permitted to access method(s) in an application.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To demonstrate the use of EJB security annotations, we&#8217;ll apply the <code>@RolesAllowed</code> annotation to a method that should only be called when a user has been identified as belonging to the <code>affableBeanAdmin</code> role.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reexamine the <a href="#adminConsole">snapshot implementation for the <code>AffableBean</code> administration console</a>. Note that in the <code>CustomerOrderFacade</code> session bean, a new <code>findByCustomer</code> method enables the <code>AdminServlet</code> to access a specified <code>Customer</code>.</p>
</li>
<li>
<p>Open the <code>CustomerOrderFacade</code> bean in the editor, then add the <code>@RolesAllowed</code> annotation to the <code>findByCustomer</code> method.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">*@RolesAllowed("affableBeanAdmin")*
public CustomerOrder findByCustomer(Object customer) { ... }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Press Ctrl-Shift-I (⌘-Shift-I on Mac) to fix imports. An import statement for <code>javax.annotation.security.RolesAllowed</code> is added to the top of the class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>findByCustomer</code> method is only called by the <code>AdminServlet</code>, which is previously authenticated into the <code>affableBeanAdmin</code> role using our implementation of form-based authentication. The use of the <code>@RolesAllowed</code> annotation here is not strictly necessary - its application simply guarantees that the method can only be called by a user who has been authenticated in the <code>affableBeanAdmin</code> role.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapApplication"><a class="anchor" href="#mapApplication"></a>Map Roles to Users and/or Groups</h3>
<div class="paragraph">
<p>We have so far accomplished the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defined the <code>affableBeanAdmin</code> role for our form-based authentication mechanism (either in the <code>web.xml</code> deployment descriptor, or as an annotation in the <code>AdminServlet</code>).</p>
</li>
<li>
<p>Created a user named <code>nbuser</code> on the GlassFish server, and associated it with a group named <code>affableBeanAdmin</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is no coincidence that the group and role names are the same. While it is not necessary that these names be identical, this makes sense if we are only creating one-to-one matching between roles and groups. In more complicated scenarios, you can map users and groups to multiple roles providing access to different resources. In such cases, you would give unique names to groups and roles.</p>
</div>
<div class="paragraph">
<p>In order to map the <code>affableBeanAdmin</code> role to the <code>affableBeanAdmin</code> group, you have a choice of performing one of two actions. You can either create a <code>&lt;security-role-mapping&gt;</code> entry in GlassFish' <code>sun-web.xml</code> deployment descriptor. (In the Projects window, <code>sun-web.xml</code> is located within the project&#8217;s Configuration Files). This would look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-role-mapping&gt;
    &lt;role-name&gt;affableBeanAdmin&lt;/role-name&gt;
    &lt;group-name&gt;affableBeanAdmin&lt;/group-name&gt;
&lt;/security-role-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This action explicitly maps the <code>affableBeanAdmin</code> role to the <code>affableBeanAdmin</code> group. Otherwise, you can enable GlassFish' Default Principal To Role Mapping service so that roles are automatically assigned to groups of the same name.</p>
</div>
<div class="paragraph">
<p>The following steps demonstrate how to enable the Default Principal To Role Mapping service in the GlassFish Administration Console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Services window (Ctrl-5; ⌘-5 on Mac) and expand the Servers node so that the GlassFish server node is visible.</p>
</li>
<li>
<p>Ensure that the GlassFish server is running. If the server is running, a small green arrow is displayed next to the GlassFish icon ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-running-node.png" alt="gf server running node"></span> ). If you need to start it, right-click the server node and choose Start.</p>
</li>
<li>
<p>Right-click the GlassFish server node and choose View Admin Console. The login form for the GlassFish Administration Console opens in a browser.</p>
</li>
<li>
<p>Log into the Administration Console by typing <code>admin</code> / <code>adminadmin</code> for the username / password.</p>
</li>
<li>
<p>In the Tree which displays in the left column of the Administration Console, expand the Configuration node, then click the Security node.</p>
</li>
<li>
<p>In the main panel of the Administration Console, select the Default Principal To Role Mapping option.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/gf-admin-console-security.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-admin-console-security.png" alt="gf admin console security"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Java EE 6 Tutorial defines the term <em>principal</em> as, "An entity that can be authenticated by an authentication protocol in a security service that is deployed in an enterprise. A principal is identified by using a principal name and authenticated by using authentication data." See <a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbxj.html#bnbxq">Working with Realms, Users, Groups, and Roles: Some Other Terminology</a> for more information.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Click the Save button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this stage, you have taken the necessary steps to enable you to log into the <code>AffableBean</code> administration console using the <code>nbuser</code> / <code>secret</code> username / password combination that you set earlier.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ). When the application opens in the browser, attempt the access the administration console by entering the following URL into the browser&#8217;s address bar:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http://localhost:8080/AffableBean*/admin/*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>When the login page displays, enter the username and password you set earlier in the GlassFish Administration Console (<code>nbuser</code> / <code>secret</code>), then click 'submit'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using form-based authentication, the server authenticates the client using the username and password credentials sent from the form. Because the <code>nbuser</code> belongs to the <code>affableBeanAdmin</code> group, and that group is associated with the <code>affableBeanAdmin</code> role, access is granted to the administration console.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Click the 'log out' link provided in the administration console. The <code>nbuser</code> is logged out of the administration console, and you are returned to the login page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>AdminServlet</code> handles the <code>/logout</code> URL pattern by invalidating the user session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if logout is requested
if (userPath.equals("/admin/logout")) {
    session = request.getSession();
    *session.invalidate();*   // terminate session
    response.sendRedirect("/AffableBean/admin/");
    return;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling <code>invalidate()</code> terminates the user session. As a consequence, the authenticated user is dissociated from the active session and would need to login in again in order to access protected resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="secureTransport"><a class="anchor" href="#secureTransport"></a>Configuring Secure Data Transport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two instances in the <code>AffableBean</code> application that require a secure connection when data is transmitted over the Internet. The first is when a user initiates the checkout process. On the checkout page, a user must fill in his or her personal details to complete an order. This sensitive data must be protected while it is sent to the server. The second instance occurs when a user logs into the administration console, as the console is used to access sensitive data, i.e., customer and order details.</p>
</div>
<div class="paragraph">
<p>Secure data transport is typically implemented using Transport Layer Security (TLS) or Secure Sockets Layer (SSL). HTTP is applied on top of the TLS/SSL protocol to provide both encrypted communication and secure identification of the server. The combination of HTTP with TLS or SSL results in an HTTPS connection, which can readily be identified in a browser&#8217;s address bar (e.g., <code><strong>https</strong>://</code>).</p>
</div>
<div class="paragraph">
<p>The GlassFish server has a secure (HTTPS) service enabled by default. This service uses a self-signed digital certificate, which is adequate for development purposes. Your production server however would require a certificate signed by a trusted third-party Certificate Authority (CA), such as <a href="http://www.verisign.com">VeriSign</a> or <a href="http://www.thawte.com/">Thawte</a>.</p>
</div>
<div class="paragraph">
<p>You can find the generated certificate in: <code><em>&lt;gf-install-dir&gt;</em>/glassfish/domains/domain1/config/keystore.jks</code></p>
</div>
<div class="paragraph">
<p>Begin this section by verifying that GlassFish' HTTPS service is enabled. Then configure the application so that a secure HTTPS connection is applied to the checkout process and administration console.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#verifyHTTPS">Verify HTTPS Support on the Server</a></p>
</li>
<li>
<p><a href="#configureSecure">Configure Secure Connection in the Application</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="verifyHTTPS"><a class="anchor" href="#verifyHTTPS"></a>Verify HTTPS Support on the Server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Services window (Ctrl-5; ⌘-5 on Mac) and expand the Servers node so that the GlassFish server node is visible.</p>
</li>
<li>
<p>Ensure that the GlassFish server is running. If the server is running, a small green arrow is displayed next to the GlassFish icon ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-running-node.png" alt="gf server running node"></span> ). If you need to start it, right-click the server node and choose Start.</p>
</li>
<li>
<p>Switch to your browser and type the following URL into the browser&#8217;s address bar:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">https://localhost:8181/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The browser displays a warning, indicating that the server is presenting you with a self-signed certificate. In Firefox for example, the warning looks as follows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/ff-untrusted-connection.png" alt="ff untrusted connection">
</div>
<div class="title">Figure 19. Firefox provides warnings for self-signed certificates</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Enable your browser to accept the self-signed certificate. With Firefox, click the Add Exception button displayed in the warning. The following pane displays, allowing you to view the certificate.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/ff-confirm-security-exception.png" alt="ff confirm security exception">
</div>
<div class="title">Figure 20. Firefox enables you to view the digital certificate before confirming the security exception</div>
</div>
<div class="paragraph">
<p>Click Confirm Security Exception. A secure connection is established on port 8181, and your local development server, GlassFish, is then able to display the following page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-https.png" alt="gf https">
</div>
<div class="title">Figure 21. GlassFish provides a secure connection by default on port 8181</div>
</div>
<div class="paragraph">
<p>Aside from the HTTPS protocol displayed in the browser&#8217;s address bar, Firefox indicates that a secure connection is established with the blue background behind <code>localhost</code> in the address bar. Also, a lock ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox-lock-icon.png" alt="firefox lock icon"></span> ) icon displays in the lower right corner of the browser. You can click the lock icon for secure pages to review certificate details.</p>
</div>
<div class="paragraph">
<p>The following optional steps demonstrate how you can identify this security support in the GlassFish Administration Console.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Open the GlassFish Administration Console in the browser. (Either type <code><a href="http://localhost:4848/" class="bare">http://localhost:4848/</a></code> in your browser, or click the <code>go to the Administration Console</code> link in the GlassFish server&#8217;s welcome page, as displayed in the <a href="#serverWelcomePage">image above</a>.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>In the Tree which displays in the left column of the Administration Console, expand the Configuration &gt; Network Config nodes, then click the Network Listeners node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The main panel displays the three network listeners enabled by default on the GlassFish server. <code>http-listener-2</code>, which has been configured to listen over port 8181, is the network listener used for secure connections.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/network-listeners.png" alt="network listeners">
</div>
<div class="title">Figure 22. View all HTTP listeners from the Network Listeners panel</div>
</div>
<div class="paragraph">
<p>For more information on network listeners, see the Oracle GlassFish Server 3.0.1 Administration Guide: <a href="http://docs.sun.com/app/docs/doc/821-1751/giuri?l=en&amp;a=view">About HTTP Network Listeners</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Under the Name column, click the link for <code>http-listener-2</code>. In the main panel, note that the Security checkbox is selected.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/edit-network-listener.png" alt="edit network listener">
</div>
<div class="title">Figure 23. Security is enabled for the 'http-listener-2' network listener</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click the SSL tab. Note that TLS is selected. In the lower portion of the SSL panel, you see the Cipher Suites that are available for the connection. As stated in the Oracle GlassFish Server 3.0.1 Administration Guide, <a href="http://docs.sun.com/app/docs/doc/821-1751/ablnk">Chapter 11: Administering System Security</a>,</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>A cipher is a cryptographic algorithm used for encryption or decryption. SSL and TLS protocols support a variety of ciphers used to authenticate the server and client to each other, transmit certificates, and establish session keys. Some ciphers are stronger and more secure than others. Clients and servers can support different cipher suites. During a secure connection, the client and the server agree to use the strongest cipher that they both have enabled for communication, so it is usually sufficient to enable all ciphers.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this stage, you have an understanding of how the GlassFish server supports secure connections out-of-the-box. Naturally, you could set up your own network listener, have it listen on a port other than 8181, enable SSL 3 instead of TLS (or both), or generate and sign your own digital certificates using Java&#8217;s <a href="http://download.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html">`keytool`</a> management utility. You can find instructions on how to accomplish all of these tasks from the following resources:
* The Java EE 6 Tutorial, <a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbxw.html">Establishing a Secure Connection Using SSL</a>
* Oracle GlassFish Server 3.0.1 Administration Guide, <a href="http://docs.sun.com/app/docs/doc/821-1751/ablnk">Chapter 11: Administering System Security</a>
* Oracle GlassFish Server 3.0.1 Administration Guide, <a href="http://docs.sun.com/app/docs/doc/821-1751/ablsw">Chapter 16: Administering Internet Connectivity</a></p>
</div>
</div>
<div class="sect2">
<h3 id="configureSecure"><a class="anchor" href="#configureSecure"></a>Configure Secure Connection in the Application</h3>
<div class="paragraph">
<p>This example demonstrates how to specify a secure connection using both XML in the web deployment descriptor, as well as Servlet 3.0 annotations directly in a servlet. You begin by creating an <code>&lt;security-constraint&gt;</code> entry in <code>web.xml</code> for the customer checkout process. Then, to create a secure connection for access to the administration console, you specify a <code>TransportGuarantee</code> constraint for the <code>@HttpConstraint</code> annotation in the <code>AdminServlet</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project&#8217;s <code>web.xml</code> file in the editor. (If it is already opened, you can press Ctrl-Tab and select it.)</p>
</li>
<li>
<p>Click the Security tab along the top of the editor, then click the Add Security Constraint button.</p>
</li>
<li>
<p>Type in <code>Checkout</code> for the Display Name, then under Web Resource Collection click the Add button. Enter the following details, then when you are finished, click OK.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Name:</strong> <code>Checkout</code></p>
</li>
<li>
<p><strong>URL Pattern(s):</strong> <code>/checkout</code></p>
</li>
<li>
<p><strong>HTTP Method(s):</strong> <code>Selected HTTP Methods</code> (<code>GET</code>)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/add-web-resource2.png" alt="add web resource2">
</div>
<div class="title">Figure 24. Specify which resources need to be protected using the Add Web Resource dialog</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Recall that the <code>/checkout</code> URL pattern is handled by the <code>ControllerServlet`s `doGet</code> method, and forwards the user to the checkout page.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Under the new Checkout security constraint, select the Enable User Data Constraint option, then in the Transport Guarantee drop-down, select <code>CONFIDENTIAL</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/checkout-security-constraint.png" alt="checkout security constraint">
</div>
<div class="title">Figure 25. Use the web.xml visual editor to specify security settings for the application</div>
</div>
<div class="paragraph">
<p>When you choose <code>CONFIDENTIAL</code> as a security constraint, you are instructing the server to encrypt data using TLS/SSL so that it cannot be read while in transit. For more information, see the Java EE 6 Tutorial, <a href="http://download.oracle.com/javaee/6/tutorial/doc/gkbaa.html#bncbm">Specifying a Secure Connection</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click the XML tab along the top of the editor. Note that the following <code>&lt;security-constraint&gt;</code> entry has been added.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
    &lt;display-name&gt;Checkout&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Checkout&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/checkout&lt;/url-pattern&gt;
        &lt;http-method&gt;GET&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
        &lt;description/&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration for the customer checkout process is now complete. To ensure that a secure connection is applied for access to the administration console, simply specify that any requests handled by the <code>AdminServlet</code> are transmitted over a secure channel.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Open the <code>AdminServlet</code>. Press Alt-Shift-O (Ctrl-Shift-O on Mac) and in the Go to File dialog, type <code>admin</code>, then click OK.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Use the <a href="http://download.oracle.com/javaee/6/api/javax/servlet/annotation/HttpConstraint.html">`@HttpConstraint`</a> annotation&#8217;s <code>transportGuarantee</code> element to specify a <code>CONFIDENTIAL</code> security constraint. Make the following change (in <strong>bold</strong>).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebServlet(name = "AdminServlet",
            urlPatterns = {"/admin/",
                           "/admin/viewOrders",
                           "/admin/viewCustomers",
                           "/admin/customerRecord",
                           "/admin/orderRecord",
                           "/admin/logout"})
@ServletSecurity(
    @HttpConstraint(*transportGuarantee = TransportGuarantee.CONFIDENTIAL,*
                    rolesAllowed = {"affableBeanAdmin"})
)
public class AdminServlet extends HttpServlet { ... }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Press Ctrl-Shift-I (⌘-Shift-I on Mac) to fix imports. An import statement for <code>javax.servlet.annotation.ServletSecurity.TransportGuarantee</code> is added to the top of the class.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to examine the application&#8217;s behavior in a browser.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the browser, step through the <code>AffableBean</code> website by selecting a product category and adding several items to your shopping cart. Then click the 'proceed to checkout' button. The website now automatically switches to a secure channel when presenting the checkout page. You see the HTTPS protocol displayed in the browser&#8217;s address bar, and the port is changed to 8181.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/secure-checkout.png" alt="secure checkout">
</div>
<div class="title">Figure 26. The browser address bar indicates that a secure connection is established for customer checkout</div>
</div>
<div class="paragraph">
<p>Also, in Firefox, note the lock ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox-lock-icon.png" alt="firefox lock icon"></span> ) icon displayed in the lower right corner of the browser.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Investigate security for the administration console. Type in the following URL into the browser&#8217;s address bar:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http://localhost:8080/AffableBean/admin/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The website now automatically switches to a secure channel when presenting the checkout page. You see the HTTPS protocol displayed in the browser&#8217;s address bar, and the port is changed to 8181.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/secure-admin.png" alt="secure admin">
</div>
<div class="title">Figure 27. The browser address bar indicates that a secure connection is established for customer checkout</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> You way wonder at this point how it is possible to switch from a secure connection back to a normal, unsecured one. This practice however is not recommended. The <a href="http://download.oracle.com/javaee/6/tutorial/doc/gkbaa.html#bncbm">Java EE 6 Tutorial</a> explains as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>If you are using sessions, after you switch to SSL you should never accept any further requests for that session that are non-SSL. For example, a shopping site might not use SSL until the checkout page, and then it might switch to using SSL to accept your card number. After switching to SSL, you should stop listening to non-SSL requests for this session. The reason for this practice is that the session ID itself was not encrypted on the earlier communications. This is not so bad when you’re only doing your shopping, but after the credit card information is stored in the session, you don’t want a bad guy trying to fake the purchase transaction against your credit card. This practice could be easily implemented using a filter.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have now successfully secured the <code>AffableBean</code> application according to the defined customer requirements. You&#8217;ve set up a login form for the administration console to authorize or deny access based on user credentials, and you configured the application and server to create a secure connection for access to the administration console, as well as the customer checkout process.</p>
</div>
<div class="paragraph">
<p>You can compare your work with the <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_complete.zip">completed `AffableBean` project</a>. The completed project includes the security implementation demonstrated in this unit, and also provides a basic implementation for web page error customization, such as when a request for a nonexistent resource is made, and the server returns an HTTP 404 'Not Found' error message.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/http-404.png" alt="http 404">
</div>
<div class="title">Figure 28. The browser address bar indicates that a secure connection is established for customer checkout</div>
</div>
<div class="paragraph">
<p><a href="../../../../../../../front/main/community/mailing-lists/" class="xref page">Send Feedback on This Tutorial</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso"><a class="anchor" href="#seeAlso"></a>See Also</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_netbeans_resources"><a class="anchor" href="#_netbeans_resources"></a>NetBeans Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../../../web/security-webapps/" class="xref page">Securing a Web Application</a></p>
</li>
<li>
<p><a href="../../javaee-intro/" class="xref page">Introduction to Java EE Technology</a></p>
</li>
<li>
<p><a href="../../javaee-gettingstarted/" class="xref page">Getting Started with Java EE Applications</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">Keyboard Shortcuts &amp;amp; Code Templates Card</a></p>
</li>
<li>
<p><a href="../../../java-ee/" class="xref page">Java EE &amp;amp; Java Web Learning Trail</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_external_resources"><a class="anchor" href="#_external_resources"></a>External Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbwj.html">The Java EE 6 Tutorial, Chapter 24: Introduction to Security in the Java EE Platform</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/bncas.html">The Java EE 6 Tutorial, Chapter 25: Getting Started Securing Web Applications</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbyk.html">The Java EE 6 Tutorial, Chapter 26: Getting Started Securing Enterprise Applications</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1751">Oracle GlassFish Server 3.0.1 Administration Guide</a></p>
</li>
<li>
<p><a href="http://java.sun.com/developer/technicalArticles/J2EE/security_annotation/">Security Annotations and Authorization in GlassFish and the Java EE 5 SDK</a></p>
</li>
<li>
<p><a href="http://www.infoq.com/news/2010/07/javaee6-security">Java EE 6: Application Security Enhancements</a></p>
</li>
<li>
<p><a href="http://refcardz.dzone.com/refcardz/getting-started-java-ee">Getting Started with Java EE Security</a> [RefCard]</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Https">HTTP Secure</a> [Wikipedia]</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Digital_certificate">Public key certificate</a> [Wikipedia]</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/security.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2024 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../../_/css/search.css"></script>
<script async src="../../../../../../../search-index.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="../../../../../../../_/js/vendor/highlight-11.9.0.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
         document.querySelectorAll('pre code').forEach((el) => {
         hljs.highlightElement(el);
        });
      });
    </script>
  </body>
</html>
