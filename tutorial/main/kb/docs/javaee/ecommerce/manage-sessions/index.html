<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>The NetBeans E-commerce Tutorial - Managing Sessions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The NetBeans E-commerce Tutorial - Managing Sessions - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="description" content="The NetBeans E-commerce Tutorial - Managing Sessions - Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, The NetBeans E-commerce Tutorial - Managing Sessions">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="../../../../../../../_/css/highlight-11.9.0.default.min.css">
    <link rel="stylesheet" href="../../../../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../../../../index.html"><img src='../../../../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 23</h1>
            <p><a class="button success" href="../../../../../../../front/main/download/nb23">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <article class="doc">
      <h1 class="sect0">The NetBeans E-commerce Tutorial - Managing Sessions</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/manage-sessions.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_tutorial_contents">Tutorial Contents</a></li>
<li><a href="#session-data">Handling Session Data</a>
<ul class="sectlevel2">
<li><a href="#httpSession">Working with an HttpSession Object</a></li>
<li><a href="#scopedVariables">Working with Scoped Variables in Web Applications</a></li>
</ul>
</li>
<li><a href="#debug">Examining Session Data with the Java Debugger</a>
<ul class="sectlevel2">
<li><a href="#_category_page">category page</a></li>
<li><a href="#cartPage">cart page</a></li>
<li><a href="#_checkout_page">checkout page</a></li>
<li><a href="#_taking_advantage_of_the_ides_javadoc_support">Taking Advantage of the IDE&#8217;s Javadoc Support</a></li>
</ul>
</li>
<li><a href="#session-track">Examining Session Tracking Options</a>
<ul class="sectlevel2">
<li><a href="#http-monitor">Examining Client-Server Communication with the HTTP Monitor</a></li>
<li><a href="#url-rewrite">Maintaining Sessions with URL Rewriting</a></li>
</ul>
</li>
<li><a href="#time-out">Handling Session Time-Outs</a>
<ul class="sectlevel2">
<li><a href="#time-interval">Setting Session Time Intervals</a></li>
<li><a href="#programmatically">Programmatically Handling Session Time-Outs</a></li>
</ul>
</li>
<li><a href="#seeAlso">See Also</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_resources">NetBeans Resources</a></li>
<li><a href="#_glassfish_resources">GlassFish Resources</a></li>
<li><a href="#_technical_articles_miscellaneous_resources">Technical Articles &amp; Miscellaneous Resources</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_tutorial_contents"><a class="anchor" href="#_tutorial_contents"></a>Tutorial Contents</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../intro/" class="xref page">Introduction</a></p>
</li>
<li>
<p><a href="../design/" class="xref page">Designing the Application</a></p>
</li>
<li>
<p><a href="../setup-dev-environ/" class="xref page">Setting up the Development Environment</a></p>
</li>
<li>
<p><a href="../data-model/" class="xref page">Designing the Data Model</a></p>
</li>
<li>
<p><a href="../page-views-controller/" class="xref page">Preparing the Page Views and Controller Servlet</a></p>
</li>
<li>
<p><a href="../connect-db/" class="xref page">Connecting the Application to the Database</a></p>
</li>
<li>
<p><a href="../entity-session/" class="xref page">Adding Entity Classes and Session Beans</a></p>
</li>
<li>
<p><strong>Managing Sessions</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#session-data">Handling Session Data</a></p>
</li>
<li>
<p><a href="#debug">Examining Session Data with the Java Debugger</a></p>
</li>
<li>
<p><a href="#session-track">Examining Session Tracking Options</a></p>
</li>
<li>
<p><a href="#time-out">Handling Session Time-Outs</a></p>
</li>
<li>
<p><a href="#seeAlso">See Also</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p><a href="../transaction/" class="xref page">Integrating Transactional Business Logic</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p><a href="../language/" class="xref page">Adding Language Support</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p><a href="../security/" class="xref page">Securing the Application</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p><a href="../test-profile/" class="xref page">Testing and Profiling</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p><a href="../conclusion/" class="xref page">Conclusion</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. Content on this page applies to NetBeans IDE, versions 6.8 and 6.9</div>
</div>
<div class="paragraph">
<p>Every e-commerce application that offers some form of shopping cart functionality needs to be able to remember user-specific data as users click through the website. Unfortunately for you the developer, the HTTP protocol, over which communication on the Internet takes place, is a <em>stateless</em> protocol. Each request received by your server is an independent piece of information that has no relation to previously received requests. Therefore, if a customer clicks a button to add an item to his or her shopping cart, your application must take measures to ensure not only that the state of the user&#8217;s cart is updated, but that the action doesn&#8217;t affect the cart of another user who happens to be browsing the site at the same time.</p>
</div>
<div class="paragraph">
<p>In order to properly handle the above-described scenario, you need to implement functionality so that a <em>session</em> can be created and maintained for the duration of a user&#8217;s visit to the site. Servlet technology, which is the foundation of all Java-based web applications, provides for this with its <a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">`HttpSession`</a> interface. You also need to define several classes, namely <code>ShoppingCart</code> and <code>ShoppingCartItem</code>, that allow the application to temporarily store user data while the session is being maintained.</p>
</div>
<div class="paragraph">
<p>This tutorial unit takes a different approach from others in the NetBeans E-commerce Tutorial. Instead of having you create project files and providing steps with code snippets for you to copy and paste into your own project, you open the completed project snapshot for this unit, and examine the code using the IDE&#8217;s debugger and other tools. In the process, you&#8217;ll learn how to apply an <code>HttpSession</code> object to your code so that each visit to the website results in a dedicated session. You also learn about <em>scoped variables</em>, and their usage in both Java classes and JSP pages. This unit also discusses `HttpSession&#8217;s default mechanism for maintaining sessions (i.e., cookies) and shows what steps need to be taken in the event that cookies are deactivated in a user&#8217;s browser. Finally, session time-outs are covered, and the unit demonstrates how to handle them by creating a simple filter that intercepts requests to check whether a session exists.</p>
</div>
<div class="paragraph">
<p>You can view a live demo of the application that you build in this tutorial: <a href="http://services.netbeans.org/AffableBean/">NetBeans E-commerce Tutorial Demo Application</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software or Resource</th>
<th class="tableblock halign-left valign-top">Version Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../../../../../front/main/download/" class="xref page">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java bundle, 6.8 or 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">GlassFish server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 or Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQL database server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">AffableBean project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot 5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NetBeans IDE requires the Java Development Kit (JDK) to run properly. If you do not have any of the resources listed above, the JDK should be the first item that you download and install.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle includes Java Web and EE technologies, which are required for the application you build in this tutorial.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle also includes the GlassFish server, which you require for this tutorial. You could <a href="http://glassfish.dev.java.net/public/downloadsindex.html">download the GlassFish server independently</a>, but the version provided with the NetBeans download has the added benefit of being automatically registered with the IDE.</p>
</li>
<li>
<p>You can follow this tutorial unit without having completed previous units. To do so, see the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-data"><a class="anchor" href="#session-data"></a>Handling Session Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications can manage user sessions with the <code>HttpSession</code> object. You can bind user-specific data to the <code>HttpSession</code> object, then access this data at a later stage. Both bind and access actions can be done from Java classes, as well as from session-scoped variables in EL expressions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#httpSession">Working with an HttpSession Object</a></p>
</li>
<li>
<p><a href="#scopedVariables">Working with Scoped Variables in Web Applications</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="httpSession"><a class="anchor" href="#httpSession"></a>Working with an HttpSession Object</h3>
<div class="paragraph">
<p>The <code>AffableBean</code> application uses the <code>HttpSession</code> object to identify users over multiple requests. An <code>HttpSession</code> object is obtained using <code>getSession()</code> on a given request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpSession session = request.getSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a session object doesn&#8217;t yet exist for the request, the method creates and returns a new session object.</p>
</div>
<div class="paragraph">
<p>You can use the session object as a vehicle for passing data between requests. You use the <code>setAttribute</code> method to bind objects to the session. Likewise, you use <code>getAttribute</code> to retrieve objects from the session. In the <code>AffableBean</code> application for example, the user&#8217;s shopping cart is created and bound to the user session in the following manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ShoppingCart cart = new ShoppingCart();
session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to retrieve the cart from the session, the <code>getAttribute</code> method is applied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">cart = (ShoppingCart) session.getAttribute("cart");</code></pre>
</div>
</div>
<div class="paragraph">
<p>In JSP pages, you can access objects bound to the session using EL expressions. Continuing with the above example, if a <code>ShoppingCart</code> object named &#8216;cart&#8217; is bound to the session, you can access the object using the following EL expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">${cart}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessing the <code>ShoppingCart</code> object on its own is of little value however. What you really want is a way to access values stored in the object. If you explore the new <code>ShoppingCart</code> class in the project snapshot, you&#8217;ll note that it contains the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>double total</code></p>
</li>
<li>
<p><code>int numberOfItems</code></p>
</li>
<li>
<p><code>List&lt;String, ShoppingCartItem&gt; items</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provided that properties have matching getter methods, you can access values for singular properties using simple dot notation in an EL expression. If you examine the <code>cart.jsp</code> page, you&#8217;ll see that this is exactly how the value for <code>numberOfItems</code> is accessed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;p&gt;Your shopping cart contains ${cart.numberOfItems} items.&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to extract data from properties that contain multiple values, such as the above <code>items</code> list, the <code>cart.jsp</code> page uses a <code>&lt;c:forEach&gt;</code> loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;c:forEach var="cartItem" items="${cart.items}" varStatus="iter"&gt;

  &lt;c:set var="product" value="${cartItem.product}"/&gt;

    &lt;tr class="${((iter.index % 2) == 0) ? 'lightBlue' : 'white'}"&gt;
        &lt;td&gt;
            &lt;img src="${initParam.productImagePath}${product.name}.png"
                 alt="${product.name}"&gt;
        &lt;/td&gt;

        &lt;td&gt;${product.name}&lt;/td&gt;

        &lt;td&gt;
            &amp;amp;euro; ${cartItem.total}
            &lt;br&gt;
            &lt;span class="smallText"&gt;( &amp;amp;euro; ${product.price} / unit )&lt;/span&gt;
        &lt;/td&gt;
        ...
    &lt;/tr&gt;

&lt;/c:forEach&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ShoppingCartItem&#8217;s `product</code> property identifies the product type for a cart item. The above loop takes advantage of this by first setting a <code>product</code> variable to the expression <code>${cartItem.product}</code>. It then uses the variable to obtain information about that product (e.g., name, price).</p>
</div>
</div>
<div class="sect2">
<h3 id="scopedVariables"><a class="anchor" href="#scopedVariables"></a>Working with Scoped Variables in Web Applications</h3>
<div class="paragraph">
<p>When working with JSP/Servlet technology, there are four scope objects available to you within the realm of the application. JSP technology implements <em>implicit objects</em> that allows you to access classes defined by the Servlet API.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">Servlet Class</th>
<th class="tableblock halign-left valign-top">JSP Implicit Object</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Application</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global memory for a web application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/ServletContext.html">javax.servlet.ServletContext</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>applicationScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Session</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data specific to a user session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">javax.servlet.http.HttpSession</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Request</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data specific to an individual server request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpServletRequest.html">javax.servlet.HttpServletRequest</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Page</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data that is only valid in the context of a single page (JSPs only)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[n/a]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pageScope</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you open your project&#8217;s <code>category.jsp</code> file in the editor, you&#8217;ll see that EL expressions include various scoped variables, including <code>${categories}</code>, <code>${selectedCategory}</code> and <code>${categoryProducts}</code>. The <code>${categories}</code> variable is application-scoped, which is set in the <code>ControllerServlet&#8217;s `init</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// store category list in servlet context
getServletContext().setAttribute("categories", categoryFacade.findAll());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other two, <code>${selectedCategory}</code> and <code>${categoryProducts}</code>, are placed in the application&#8217;s session scope from the <code>ControllerServlet</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// place selected category in session scope
session.setAttribute("selectedCategory", selectedCategory);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If you are continuing from the previous tutorial units, you&#8217;ll likely note that <code>${selectedCategory}</code> and <code>${categoryProducts}</code> were originally placed in the request scope. In previous units this was fine, but consider now what happens if a user clicks the 'add to cart' button in a category page. The server responds to an <code>addToCart</code> request by returning the currently viewed category page. It therefore needs to know the <code>selectedCategory</code> and the <code>categoryProducts</code> pertaining to the selected category. Rather than establishing this information for each request, you place it in the session scope from a <code>category</code> request so that it is maintained across multiple requests, and can be accessed when you need it. Also, examine the functionality provided by the cart page. (A functional description is <a href="#cartPage">provided below</a>.) The 'continue shopping' button returns the user to the previously viewed category. Again, the <code>selectedCategory</code> and the <code>categoryProducts</code> variables are required.</p>
</div>
<div class="paragraph">
<p>When referencing scoped variables in an EL expression, you do not need to specify the variable&#8217;s scope (provided that you do not have two variables of the same name in different scopes). The JSP engine checks all four scopes and returns the first variable match it finds. In <code>category.jsp</code> for example, you can use the following expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">${categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This expression is shorthand for the following expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">${sessionScope.categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">For more information, see the following resources:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/blueprints/guidelines/designing_enterprise_applications_2e/web-tier/web-tier5.html#1079198">Designing Enterprise Applications with the J2EE Platform: State Scopes</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnafo.html">Sharing Information &gt; Using Scoped Objects</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnahq.html#bnaij">Unified Expression Language &gt; Implicit Objects</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debug"><a class="anchor" href="#debug"></a>Examining Session Data with the Java Debugger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Begin exploring how the application behaves during runtime. Use the IDE&#8217;s debugger to step through code and examine how the <code>HttpSession</code> is created, and how other objects can be placed in the session scope to be retrieved at a later point.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">project snapshot</a> for this tutorial unit in the IDE. Click the Open Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/open-project-btn.png" alt="open project btn"></span> ) button and use the wizard to navigate to the location on your computer where you downloaded the project. If you are proceeding from the <a href="../entity-session/" class="xref page">previous tutorial unit</a>, note that this project snapshot includes a new <code>cart</code> package, containing <code>ShoppingCart</code> and <code>ShoppingCartItem</code> classes. Also, the following files have been modified:</p>
<div class="ulist">
<ul>
<li>
<p><code>WEB-INF/web.xml</code></p>
</li>
<li>
<p><code>css/affablebean.css</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/header.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/footer.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/view/cart.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/category.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/checkout.jsp</code></p>
</li>
<li>
<p><code>controller/ControllerServlet</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to ensure that it is properly configured with your database and application server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you receive an error when running the project, revisit the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Test the application&#8217;s functionality in your browser. If you are continuing directly from the <a href="../entity-session/" class="xref page">previous tutorial unit</a>, you&#8217;ll note the following enhancements.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_category_page"><a class="anchor" href="#_category_page"></a>category page</h3>
<div class="ulist">
<ul>
<li>
<p>Clicking 'add to cart' for the first time enables the shopping cart and 'proceed to checkout' widgets to display in the header.</p>
</li>
<li>
<p>Clicking 'add to cart' results in an update to the number of cart items in the header&#8217;s shopping cart widget.</p>
</li>
<li>
<p>Clicking 'view cart' results in the cart page displaying.</p>
</li>
<li>
<p>Clicking 'proceed to checkout' results in the checkout page displaying.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/category-page.png" alt="category page">
</div>
<div class="title">Figure 2. Category page includes shopping cart functionality</div>
</div>
</div>
<div class="sect2">
<h3 id="cartPage"><a class="anchor" href="#cartPage"></a>cart page</h3>
<div class="ulist">
<ul>
<li>
<p>Clicking 'clear cart' results in shopping cart being emptied of items.</p>
</li>
<li>
<p>Clicking 'continue shopping' results in a return to the previously viewed category.</p>
</li>
<li>
<p>Clicking 'proceed to checkout' results in the checkout page displaying.</p>
</li>
<li>
<p>Entering a number (1 - 99) in an item&#8217;s quantity field then clicking 'update' results in a recalculation of the total price for the item, and of the subtotal.</p>
</li>
<li>
<p>Entering zero in an item&#8217;s quantity field then clicking 'update' results in the item being removed from the displayed table.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/cart-page.png" alt="cart page">
</div>
<div class="title">Figure 3. Cart page includes shopping cart functionality</div>
</div>
</div>
<div class="sect2">
<h3 id="_checkout_page"><a class="anchor" href="#_checkout_page"></a>checkout page</h3>
<div class="ulist">
<ul>
<li>
<p>Clicking 'view cart' results in the cart page displaying.</p>
</li>
<li>
<p>Clicking 'submit purchase' results in the confirmation page displaying (without user-specific data).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/checkout-page.png" alt="checkout page">
</div>
<div class="title">Figure 4. Checkout page includes shopping cart functionality</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Use the Go to File dialog to open the <code>ControllerServlet</code> in the editor. Press Alt-Shift-O (Ctrl-Shift-O on Mac), then type &#8216;Controller&#8217; in the dialog and click OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/go-to-file-dialog.png" alt="go to file dialog">
</div>
<div class="title">Figure 5. Use the Go to File dialog to quickly open project resources in the editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Set a breakpoint in the <code>doPost</code> method on the line that creates an <code>HttpSession</code> object (line 150). To set a breakpoint, click in the left margin of the editor.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoint.png" alt="breakpoint">
</div>
<div class="title">Figure 6. Click in editor&#8217;s left margin to set breakpoints</div>
</div>
<div class="paragraph">
<p>To toggle line numbers for the editor, right-click in the left margin and choose Show Line Numbers.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Run the debugger. Click the Debug Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/debug-project-btn.png" alt="debug project btn"></span> ) button in the IDE&#8217;s main toolbar. The GlassFish server starts (or restarts, if it is already running) and opens a socket on its debug port number. The application welcome page opens in your browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view and modify the debug port number from the Servers window (Tools &gt; Servers). Select the Java tab for the server you are using. Specify the port number in the 'Address to use' field under Debug Settings.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>When the application&#8217;s welcome page displays in the browser, click any category image to navigate to the category page. Recall that clicking the 'add to cart' button sends an <code>addToCart</code> request to the server:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may recall from <a href="../page-views-controller/#controller" class="xref page">Preparing the Page Views and Controller Servlet</a>, the <code>ControllerServlet&#8217;s `doPost</code> method handles requests for the <code>/addToCart</code> URL pattern. You can therefore expect that when a user clicks an 'add to cart' button, the <code>doPost</code> method is called.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click 'add to cart' for any product in the category page. Switch back to the IDE and note that the debugger suspends on the breakpoint.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoint-suspended.png" alt="breakpoint suspended">
</div>
<div class="title">Figure 7. Debugger suspends on breakpoints in editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Place your cursor on the call to <code>getSession()</code> and press Ctrl-Space to invoke the Javadoc documentation.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/javadoc-getsession.png" alt="javadoc getsession">
</div>
<div class="title">Figure 8. Press Ctrl-Space to invoke Javadoc documentation</div>
</div>
<div class="paragraph">
<p>According to the documentation, <code>getSession()</code> returns the <code>HttpSession</code> currently associated with the request, and if no session exists, the method creates a new session object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_taking_advantage_of_the_ides_javadoc_support"><a class="anchor" href="#_taking_advantage_of_the_ides_javadoc_support"></a>Taking Advantage of the IDE&#8217;s Javadoc Support</h3>
<div class="paragraph">
<p>The IDE provides built-in Javadoc support for Java EE development. The IDE bundles with the Java EE 6 API Specification, which you can open in an external browser by choosing Help &gt; Javadoc References &gt; Java EE 6.</p>
</div>
<div class="paragraph">
<p>The IDE also includes various other features that enable easy access to API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Javadoc window:</strong> Choose Window &gt; Other &gt; Javadoc. The Javadoc window opens in the bottom region of the IDE, and displays API documentation relevant to your cursor&#8217;s location in the editor.</p>
</li>
<li>
<p><strong>Javadoc Index Search:</strong> Choose Help &gt; Javadoc Index Search (Shift-F1; fn-Shift-F1 on Mac). Type in the name of the class you are looking for, then select a class from the listed results. The complete class description from the API Specification displays in the bottom pane of the window.</p>
</li>
<li>
<p><strong>Documentation popup in the editor:</strong> Javadoc documentation displays in a popup window when you press Ctrl-Space on a given element in the editor. You can click the External Browser ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/external-browser-btn.png" alt="external browser btn"></span> ) button to have the documentation open in your browser. If you want to use Ctrl-Space for code completion only, you can deactivate the documentation popup by opening the Options window (Tools &gt; Options; NetBeans &gt; Preferences on Mac), then selecting Editor &gt; Code Completion. Deselect the 'Auto Popup Documentation Window' option.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you document your own work, consider adding Javadoc comments to your classes and methods. Open the <code>ShoppingCart</code> class and examine the Javadoc comments added to the class methods. Javadoc comments are marked by the <code>/** &#8230;&#8203; */</code> delimiters. For example, the <code>addItem</code> method has the following comment before its signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">/**
 * Adds a &lt;code&gt;ShoppingCartItem&lt;/code&gt; to the &lt;code&gt;ShoppingCart&lt;/code&gt;'s
 * &lt;code&gt;items&lt;/code&gt; list. If item of the specified &lt;code&gt;product&lt;/code&gt;
 * already exists in shopping cart list, the quantity of that item is
 * incremented.
 *
 * @param product the &lt;code&gt;Product&lt;/code&gt; that defines the type of shopping cart item
 * @see ShoppingCartItem
 */
public synchronized void addItem(Product product) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>This enables you (and others working on the project) to view Javadoc documentation on the method. To demonstrate, open the Navigator (Ctrl-7; ⌘-7 on Mac) and hover your mouse over the <code>addItem</code> method.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/javadoc-additem.png" alt="javadoc additem">
</div>
<div class="title">Figure 9. Hover over methods in Navigator to view Javadoc documentation</div>
</div>
<div class="paragraph">
<p>You can also use the IDE to generate a set of Javadoc HTML pages. In the Projects window, right-click your project node and choose Generate Javadoc. The IDE generates the Javadoc in the <code>dist/javadoc</code> folder of your project&#8217;s directory and opens the index page in the browser.</p>
</div>
<div class="paragraph">
<p>For more information on Javadoc, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Javadoc Tool Official Home Page</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">How to Write Doc Comments for the Javadoc Tool</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Hover your mouse over the <code>session</code> variable. Note that the debugger suspends on the line <em>it is about to execute.</em> The value returned by <code>getSession()</code> has not yet been saved into the <code>session</code> variable, and you see a popup stating that "`session` is not a known variable in the current context."</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-variable.png" alt="session variable">
</div>
<div class="title">Figure 10. Hover your mouse over variables and expressions to determine their current values</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Click the Step Over ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-btn.png" alt="step over btn"></span> ) button in the debugger toolbar located above the editor. The line is executed, and the debugger steps to the next line in the file.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Hover your mouse over the <code>session</code> variable again. Now you see the value currently set to the <code>session</code> variable.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/session-variable-set.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/session-variable-set.png" alt="session variable set"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In NetBeans 6.9, you can click the grey pointer ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/grey-pointer.png" alt="grey pointer"></span> ) in the popup to expand a list of variable values contained in the highlighted element.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Click the Step Over ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-btn.png" alt="step over btn"></span> ) button (F8; fn-F8 on Mac) to arrive at the <code>if</code> statement (line 154). Because you just clicked the 'add to cart' button in the browser, you know that the expression <code>userPath.equals("/addToCart")</code> should evaluate to <code>true</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Highlight the <code>userPath.equals("/addToCart")</code> expression (by control-clicking with your mouse). This time you see a popup indicating the value of the expression you highlighted.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/expression.png" alt="expression">
</div>
<div class="title">Figure 11. Highlight expressions to determine their current values</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Press F8 (fn-F8 on Mac) to step to the next line (line 158). The application has been designed so that the <code>ShoppingCart</code> object for the user session is only created when the user adds an item to the cart for the first time. Since this is the first time the <code>addToCart</code> request has been received in this debug session, you can expect the <code>cart</code> object to equal <code>null</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/cart-null.png" alt="cart null">
</div>
<div class="title">Figure 12. Cart object doesn&#8217;t exist until user adds item to shopping cart</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Press F8 (fn-F8 on Mac) to step to the next line (line 160). Then, on line 160, where the <code>ShoppingCart</code> object is created, click the Step Into ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-into-btn.png" alt="step into btn"></span> ) button. The debugger steps into the method being called. In this case, you are taken directly to the `ShoppingCart&#8217;s constructor.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/cart-constructor.png" alt="cart constructor">
</div>
<div class="title">Figure 13. Step into methods to follow runtime execution to other classes</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Press Ctrl-Tab to switch back to the <code>ControllerServlet</code>. Note that the IDE provides a Call Stack ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/call-stack-badge.png" alt="call stack badge"></span> ) badge on line 160, indicating that the debugger is currently suspended somewhere on a method higher up in the call stack.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Press Alt-Shift-3 (Ctrl-Shift-3 on Mac) to open the IDE&#8217;s Call Stack window.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Press F8 (fn-F8 on Mac) to continue stepping through code. When the debugger completes the <code>ShoppingCart</code> constructor, you are taken back to the <code>ControllerServlet</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Line 161 of the <code>ControllerServlet</code> binds the newly-created <code>cart</code> object to the session.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To witness this, open the debugger&#8217;s Variables window. Choose Window &gt; Debugging &gt; Variables, or press Alt-Shift-1 (Ctrl-Shift-1 on Mac).</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/variables-win-session.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/variables-win-session.png" alt="variables win session"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you expand the session &gt; session &gt; attributes node, you are able to view the objects that are bound to the session. In the above image, there are two items currently bound to the session (highlighted). These are <code>selectedCategory</code> and <code>categoryProducts</code>, instantiated in the <code>ControllerServlet</code> at lines 83 and 89, respectively. Both of these items were bound earlier, when you clicked a category image, and the <code>ControllerServlet</code> processed the category page request.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Press F8 (fn-F8 on Mac) to execute line 161. The <code>cart</code> object is bound to the session, and the Variables window updates to reflect changes. In the Variables window, note that the session now contains three attributes, the third being the newly initialized <code>ShoppingCart</code> object (highlighted below).</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/variables-win-session-cart.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/variables-win-session-cart.png" alt="variables win session cart"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So far, we have not "proven" that the session, as listed in the Variables window, represents an <code>HttpSession</code>. As previously mentioned, <code>HttpSession</code> is actually an interface, so when we talk about an <code>HttpSession</code> object, or session object, we are in fact referring to any object that implements the <code>HttpSession</code> interface. In the Variables window, if you hover your cursor over &#8216;session&#8217;, a popup displays indicating that the variable represents an <code>HttpSession</code> object. The <code>StandardSessionFacade</code> type, as displayed, is the internal class that GlassFish uses to implement the <code>HttpSession</code> interface. If you are familiar with Tomcat and are puzzled by the &#8216;org.apache.catalina&#8217; paths that appear in the Value column, this is because the GlassFish web/servlet container is in fact a derivative of the Apache Tomcat container.</p>
</div>
<div class="paragraph">
<p>A new <code>ShoppingCart</code> is added to the session, and the request continues to be processed. In order to complete implementation of the 'add to cart' functionality, the following actions are taken:
* the ID of the selected product is retrieved from the request (line 165)
* a <code>Product</code> object is created using the ID (line 169)
* a new <code>ShoppingCartItem</code> is created using the <code>product</code> (line 170)
* the <code>ShoppingCartItem</code> is added to <code>ShoppingCart&#8217;s `items</code> list (line 170)</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Press F8 (fn-F8 on Mac) to continue stepping through code while being mindful of the above-listed four actions. Pause when the debugger suspends on line 170.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Create a watch on the session. This will allow you to view values contained in the session when you step into the <code>addItem</code> method in the next step. Right-click the session in the Variables window and choose Create Fixed Watch.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/create-watch.png" alt="create watch">
</div>
<div class="title">Figure 14. Create watches on variables as you step through code in a debug session</div>
</div>
<div class="paragraph">
<p>Alternatively, you can place your cursor on the <code>session</code> variable in the editor, then right-click and choose New Watch. The New Watch dialog enables you to specify variables or expressions to watch continuously when debugging an application. (In the case of expressions, highlight the expression first, then right-click and choose New Watch.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/new-watch-dialog.png" alt="new watch dialog">
</div>
<div class="title">Figure 15. Right-click variables and expressions in the editor and choose New Watch</div>
</div>
<div class="paragraph">
<p>A new watch is created on the <code>session</code> variable and all variables it contains. The watch is visible from the Watches window (Window &gt; Debugging &gt; Watches) or, if you toggle the Watches ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/watch-btn.png" alt="watch btn"></span> ) button in the left margin of the Variables window, it displays in the top row of the Variables window.</p>
</div>
<div class="paragraph">
<p>The debugger enables you to keep an eye on variables as it steps through code. This can be helpful, for example if you&#8217;d like to follow changes to specific variable values (and don&#8217;t want to need to sift through the full list presented in the Variables window with each step), or if you temporarily step into a class that doesn&#8217;t contain the variables you are interested in.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Click the Step Into ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-into-btn.png" alt="step into btn"></span> ) button to step into <code>ShoppingCart&#8217;s `addItem</code> method.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Step through the <code>addItem</code> method until you reach line 53. As the Javadoc states, <code>addItem</code> <em>"adds a <code>ShoppingCartItem</code> to the <code>ShoppingCart&#8217;s `items</code> list. If item of the specified <code>product</code> already exists in shopping cart list, the quantity of that item is incremented."</em></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Examine the <code>session</code> variable which you created a watch on (<a href="#step21">step 21</a> above). The <code>items.add(scItem)</code> statement in line 51 added the new <code>ShoppingCartItem</code> to the <code>items</code> list in the <code>ShoppingCart</code>. This is evident by drilling into the third attribute (i.e., the <code>cart</code> variable) contained in the session.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/variables-window-add-item.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/variables-window-add-item.png" alt="variables window add item"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this stage, you can see how an <code>HttpSession</code> is created for the request, how a <code>ShoppingCart</code> object is created and attached to the session, and how a <code>ShoppingCartItem</code> is created based on the user&#8217;s product choice, then added to the <code>ShoppingCart&#8217;s list of `items</code>. The only remaining action is to forward the request to the <code>category.jsp</code> view.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Open the header JSP fragment (<code>header.jspf</code>) in the editor and place a breakpoint on line 86. This line contains the EL statement within the shopping cart widget that displays the number of cart items.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoint-jsp.png" alt="breakpoint jsp">
</div>
<div class="title">Figure 16. You can suspend the debugger in JSP pages</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Click the Continue ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/continue-btn.png" alt="continue btn"></span> ) button in the debugger toolbar. The debugger continues until execution completes, or until it reaches another breakpoint. In this case, the debugger suspends on line 86 in the header JSP fragment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note:</strong> In order to suspend the debugger in a JSP page, you need to set a breakpoint. For example, when the <code>ControllerServlet</code> forwards the request to the appropriate view, the debugger will not automatically suspend within the JSP page.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Open the Variables window (Alt-Shift-1; Ctrl-Shift-1 on Mac) if it is not already open. Unlike with Java classes, the debugger <em>does not</em> provide tooltips when you hover your mouse over variables or expressions in a JSP page. However, the Variables window does enable you to determine variable values as you step through code. So, where can you find the value for <code>${cart.numberOfItems}</code>?</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="28">
<li>
<p>In the Variables window, expand the Implicit Objects &gt; pageContext &gt; session &gt; session &gt; attributes node. This provides access to the session object, just as you saw earlier when working in the <code>ControllerServlet</code>. In fact, you may note that the session which you created a watch on in step 21 above points to the very same object. Here you can verify that the value of <code>${cart.numberOfItems}</code> equals &#8216;1&#8217;.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/variables-window-number-of-items.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/variables-window-number-of-items.png" alt="variables window number of items"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Maximize the Variables window, or any window in the IDE, by right-clicking the window header, then choosing Maximize Window (Shift-Esc).</p>
</div>
<div class="paragraph">
<p>The debugger gives you access to the <code>pageContext</code> implicit object. <code>pageContext</code> represents the context of the JSP page, and offers direct access to various objects including the <code>HttpServletRequest</code>, <code>HttpSession</code>, and <code>ServletContext</code> objects. For more information, see the <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bnahq.html#bnaij">Java EE 5 Tutorial: Implicit Objects</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="29">
<li>
<p>Click the Finish Session ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/finish-session-btn.png" alt="finish session btn"></span> ) button. The runtime finishes executing, and the debug session terminates. The browser displays a fully-rendered category page, and you can see that the shopping cart widget in the page header contains one item.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Hopefully you now feel comfortable using the IDE&#8217;s debugger not only to examine your project when it behaves unexpectedly, but also as a tool to become more familiar with code. Other useful buttons in the debugger toolbar include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-out.png" alt="step out"></span> ) <strong>Step Out:</strong> Steps you out of the current method call. Executes and removes the topmost method call in your call stack.</p>
</li>
<li>
<p>( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-to-cursor.png" alt="run to cursor"></span> ) <strong>Run to Cursor:</strong> Executes up to the line on which your cursor is placed.</p>
</li>
<li>
<p>( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/apply-code-changes.png" alt="apply code changes"></span> ) <strong>Apply Code Changes:</strong> After editing a file, you can press this button so that the file is recompiled and changes are taken into account in the debug session.</p>
</li>
<li>
<p>( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-expression.png" alt="step over expression"></span> ) <strong>Step Over Expression:</strong> Enables you to view the input parameters and resulting output values of each method call within an expression. You can inspect the output values for the previous method and the input parameters for the next method in the Local Variables window. When there are no further method calls, Step Over Expression behaves like the Step Over ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-btn.png" alt="step over btn"></span> ) command.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-track"><a class="anchor" href="#session-track"></a>Examining Session Tracking Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three conventional ways of tracking sessions between client and server. By far the most common is with cookies. URL rewriting can be applied in the event that cookies are not supported or disabled. Hidden form fields can also be used as a means of "maintaining state" over multiple requests, but these are limited to usage within forms.</p>
</div>
<div class="paragraph">
<p>The <code>AffableBean</code> project includes an example of the hidden field method in both the category and cart pages. The 'add to cart' and 'update' buttons that display for product items contain a hidden field which relays the product ID to the server when the button is clicked. If you open the <code>cart.jsp</code> page in the editor, you&#8217;ll see that the <code>&lt;form&gt;</code> tags contain a hidden field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;form action="updateCart" method="post"&gt;
    *&lt;input type="hidden"
           name="productId"
           value="${product.id}"&gt;*
    ...
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this manner, the product ID is sent as a request parameter which the server uses to identify the item within the user&#8217;s cart whose quantity needs to be modified.</p>
</div>
<div class="paragraph">
<p>The Servlet API provides a high-level mechanism for managing sessions. Essentially, it creates and passes a cookie between the client and server with each request-response cycle. If the client browser doesn&#8217;t accept cookies, the servlet engine automatically reverts to URL rewriting. The following two exercises demonstrate this functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-monitor">Examining Client-Server Communication with the HTTP Monitor</a></p>
</li>
<li>
<p><a href="#url-rewrite">Maintaining Sessions with URL Rewriting</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="http-monitor"><a class="anchor" href="#http-monitor"></a>Examining Client-Server Communication with the HTTP Monitor</h3>
<div class="paragraph">
<p>By default, the servlet engine uses cookies to maintain and identify sessions between requests. A random, alphanumeric number is generated for each session object, which serves as a unique identifier. This identifier is passed as a &#8216;JSESSIONID&#8217; cookie to the client. When the client makes a request, the servlet engine reads the value of the <code>JSESSIONID</code> cookie to determine the session which the request belongs to.</p>
</div>
<div class="paragraph">
<p>To demonstrate this, we&#8217;ll use the debugger in tandem with the IDE&#8217;s HTTP Monitor.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Begin by activating the HTTP Monitor for the server you are using. Choose Tools &gt; Servers. In the left column of the Servers window, select the server you are using (GlassFish). Then, in the main column, select the Enable HTTP Monitor option.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/servers-win-http-monitor.png" alt="servers win http monitor">
</div>
<div class="title">Figure 17. Select the Enable HTTP Monitor option to activate the HTTP Monitor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>If your server is already running, you need to restart it. However, since we plan to use the debugger, and running the debugger restarts the server to communicate on a different port, just click the Debug Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/debug-project-btn.png" alt="debug project btn"></span> ) button in the IDE&#8217;s main toolbar. The server restarts, a debug session begins and the application&#8217;s welcome page opens in your browser. The HTTP Monitor displays in the bottom region of the IDE.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/http-monitor.png" alt="http monitor">
</div>
<div class="title">Figure 18. HTTP Monitor displays by default in bottom region of the IDE</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click the AffableBean record in the left column (as shown in the above image). When you select records in the left column, the right (i.e., main) column refreshes to display corresponding data. In the above image, the Request tab displays the requested URI (<code>/AffableBean/</code>), the HTTP method (<code>GET</code>), and points out that there was no query string sent with the request.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Select the Session tab. Note that there is a statement, "The session was created as a result of this request." This is due to the fact that the server has sent a <code>Set-Cookie</code> header for the <code>JSESSIONID</code> cookie in its response. Also note that the new session ID is listed under 'Session properties'. As will later be shown, the session ID is the value of the <code>JSESSIONID</code> cookie.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-tab.png" alt="session tab">
</div>
<div class="title">Figure 19. Session details are displayed under the Session tab in the HTTP Monitor</div>
</div>
<div class="paragraph">
<p>You may wonder how a session object was created from a request for the site welcome page. After all, the <code>ControllerServlet</code> does not handle the initial request for <code>/AffableBean/</code>, and nowhere does this request encounter <code>getSession()</code>. Or does it? Recall that JSP pages are compiled into servlets upon deployment. Once you&#8217;ve deployed your project to the server, you can actually use the IDE to view the JSP&#8217;s compiled servlet on your server.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>In the Projects window, right-click the <code>index.jsp</code> file and choose View Servlet. An <code>index_jsp.java</code> file opens in the editor. This is the servlet that was automatically compiled from the <code>index.jsp</code> page.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Perform a search in the file for <code>getSession</code>. Press Ctrl-F (⌘-F on Mac), type &#8216;getSession&#8217; in the search bar, then press Enter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ctrl-F (⌘-F on Mac) is a keyboard shortcut for Edit &gt; Find.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/get-session.png" alt="get session">
</div>
<div class="title">Figure 20. The getSession method exists in the JSP page&#8217;s compiled servlet</div>
</div>
<div class="paragraph">
<p>The <code>getSession</code> method is in fact called. The reason this occurs is because JSP pages include the <code>pageContext.session</code> implicit object by default. If you wanted to deactivate this behavior, you could add the following directive to the top of a JSP file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%@page session="false" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you add the directive the <code>getSession</code> method will be removed in the compiled servlet.</p>
</div>
<div class="paragraph">
<p>To find out the location of the compiled servlet on your server, you can hover your mouse over the servlet&#8217;s name tab above the editor. A popup displays the path to the file on your computer.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>In the browser, select a category then add an item to your cart. Switch back to the IDE. Note that the debugger suspends on the breakpoint in the <code>ControllerServlet</code> you set earlier (line 150). All breakpoints are remembered between sessions. To remove the breakpoint, you could click the breakpoint ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoint-badge.png" alt="breakpoint badge"></span> ) badge in the editor&#8217;s left margin. However, since there are multiple breakpoints already set in the project, open the debugger&#8217;s Breakpoints window (Window &gt; Debugging &gt; Breakpoints).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoints-window.png" alt="breakpoints window">
</div>
<div class="title">Figure 21. View all breakpoints in your project from the Breakpoints window</div>
</div>
<div class="paragraph">
<p>From the Breakpoints window, you can view and call actions on all breakpoints set in projects opened in the IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Right-click the breakpoint set in <code>header.jspf</code> and choose Delete. Then right-click the breakpoint set in the <code>ControllerServlet</code> and choose Disable. (You&#8217;ll re-enable it later in this exercise.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Click the Continue ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/continue-btn.png" alt="continue btn"></span> ) button. The request finishes executing, and the category page displays in the browser with one item added to the cart.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the HTTP Monitor, search for the <code>addToCart</code> request in the left column, then select it to display details in the main column.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Click the Ascending Sort ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/ascending-sort-btn.png" alt="ascending sort btn"></span> ) button so that the most recent records are listed at the top.</p>
</div>
<div class="paragraph">
<p>Under the Request tab, note the requested URI (<code>/AffableBean/addToCart</code>), the HTTP method (<code>POST</code>), and the request parameters (<code>productId</code> and <code>submit</code>).</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/http-monitor-add-to-cart.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/http-monitor-add-to-cart.png" alt="http monitor add to cart"></a>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Select the Cookies tab. Here you see that a cookie named <code>JSESSIONID</code> exists, and was sent from the client to the server. Note that the value for the cookie is the same as the Session ID displayed under the Session tab.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/cookies-tab.png" alt="cookies tab">
</div>
<div class="title">Figure 22. Cookies are displayed under the Cookies tab in the HTTP Monitor</div>
</div>
<div class="paragraph">
<p>Likewise, if you click the Header tab, you see the cookie listed, since &#8216;Cookie&#8217; is a request header that was sent by the client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/headers-tab.png" alt="headers tab">
</div>
<div class="title">Figure 23. Cookies are displayed under the Cookies tab in the HTTP Monitor</div>
</div>
<div class="paragraph">
<p>See Wikipedia&#8217;s <a href="https://en.wikipedia.org/wiki/List_of_HTTP_headers">List of HTTP headers</a> for more information on request and response headers.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Select the Session tab. There is a statement which indicates, "The session existed before this request." Also note that the <code>cart</code> attribute is listed under 'Session attributes after the request'. This makes sense, since we know that the <code>cart</code> object is bound to the session when the <code>addToCart</code> request is processed for the first time.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-tab-add-to-cart.png" alt="session tab add to cart">
</div>
<div class="title">Figure 24. Session attributes are displayed under the Session tab in the HTTP Monitor</div>
</div>
<div class="paragraph">
<p>In the next few steps, locate the session ID and <code>JSESSIONID</code> cookie in the Variables window.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Re-enable the breakpoint you set earlier in the <code>ControllerServlet</code>. Press Alt-Shift-5 (Ctrl-Shift-5 on Mac) to open the Breakpoints window, then click in the checkbox next to the breakpoint entry to re-enable it.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>In the browser, click the 'add to cart' button for one of the listed products.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Switch to the IDE and note that the debugger is suspended on the breakpoint set in the <code>ControllerServlet</code>. Click the Step Over ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-btn.png" alt="step over btn"></span> ) button so that the <code>session</code> variable is assigned to the session object.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Open the Variables window (Alt-Shift-1; Ctrl-Shift-1 on Mac) and expand session &gt; session. You&#8217;ll find the session ID listed as the value for the <code>id</code> variable.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>To locate the <code>JSESSIONID</code> cookie, recall that you can normally access cookies from a servlet by calling the <a href="http://java.sun.com/webservices/docs/1.6/api/javax/servlet/http/HttpServletRequest.html#getCookies%28%29">`getCookies`</a> method on the <code>HttpServletRequest</code>. Therefore, drill into the request object: request &gt; Inherited &gt; request &gt; request &gt; Inherited &gt; cookies. Here you see the <code>cookies</code> ArrayList. If you expand the list, you&#8217;ll find the <code>JSESSIONID</code> cookie, the value of which is the session ID.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Click the Finish Session ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/finish-session-btn.png" alt="finish session btn"></span> ) button to terminate the debug session.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="url-rewrite"><a class="anchor" href="#url-rewrite"></a>Maintaining Sessions with URL Rewriting</h3>
<div class="paragraph">
<p>As mentioned, the servlet engine detects whether cookies are supported for the client browser, and if not, it switches to URL rewriting as a means of maintaining sessions. This all happens transparently for the client. For you, the developer, the process isn&#8217;t entirely transparent.</p>
</div>
<div class="paragraph">
<p>You need to ensure that the application is capable of rewriting URLs whenever cookies are disabled. You do this by calling the response’s <code>encodeURL</code> method on all URLs returned by servlets in your application. Doing so enables the session ID to be appended to the URL in the event that the use of cookies is not an option; otherwise, it returns the URL unchanged.</p>
</div>
<div class="paragraph">
<p>For example, the browser sends a request for <code>AffableBean&#8217;s third category (bakery): `category?3</code>. The server responds with session ID included in the URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/AffableBean/category*;jsessionid=364b636d75d90a6e4d0085119990*?3</code></pre>
</div>
</div>
<div class="paragraph">
<p>As stated above, <em>all URLs returned by your application&#8217;s servlets must be encoded</em>. Keep in mind that JSP pages are compiled into servlets. How can you encode URLs in JSP pages? JSTL&#8217;s <a href="http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/c/url.html">`&lt;c:url&gt;`</a> tag serves this purpose. The following exercise demonstrates the problem and illustrates a solution.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Temporarily disable cookies in your browser. If you are using Firefox, you can choose Tools &gt; Options (Firefox &gt; Preferences on Mac). In the window that displays, select the Privacy tab, then under History, select 'Use custom settings for history' in the provided drop-down. Deselect the 'Accept cookies from sites' option.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox.png" alt="firefox">
</div>
<div class="title">Figure 25. Temporarily disable cookies in your browser</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Run the <code>AffableBean</code> project. When the welcome page displays, click into a category, then try adding an item to your cart. You&#8217;ll see that the application&#8217;s functionality is severely compromised in its present state.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/compromised.png" alt="compromised">
</div>
<div class="title">Figure 26. The application&#8217;s functionality is compromised when the client doesn&#8217;t accept cookies</div>
</div>
<div class="paragraph">
<p>As before, the server generates a session and binds objects to it. This is how the category page is able to display the selected category and products. However, the server has failed in its attempt to set a <code>JSESSIONID</code> cookie. Therefore, when the client makes a second request (when user clicks 'add to cart'), the server has no way of identifying the session which the request belongs to. It therefore cannot locate any of the attributes previously set in the session, such as <code>selectedCategory</code> and <code>categoryProducts</code>. This why the rendered response lacks the information specified by these attributes.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Open the project&#8217;s <code>category.jsp</code> page in the editor. Locate the line that implements the 'add to cart' button (line 58). The <code>&lt;form&gt;</code> element&#8217;s <code>action</code> attribute determines the request sent to the server.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Modify the request so that it is passed through the <code>&lt;c:url&gt;</code> tag.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;form action="*&lt;c:url value='addToCart'/&gt;*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Press Ctrl-S (⌘-S on Mac) to save changes to the file. Recall that the IDE provides the Deploy on Save feature, which is enabled by default. This means that any saved changes are automatically deployed to your server.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>In the browser, select a different category so that the application renders the newly modified category page.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Examine the source code for the page. In Firefox, you can press Ctrl-U (⌘-U on Mac). The 'add to cart' button for each product displays with the session ID appended to the URL.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;form action="addToCart*;jsessionid=4188657e21d72f364e0782136dde*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Click the 'add to cart' button for any item. You see that the server is now able to determine the session which the request belongs to, and renders the response appropriately.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Before proceeding, make sure to re-enable cookies for your browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Again, every link that a user is able to click on within the application, whose response requires some form of session-related data, needs to be properly encoded. Sometimes implementation is not as straight-forward as the example shown above. For example, the 'clear cart' widget used in <code>cart.jsp</code> currently sets a <code>clear</code> parameter to <code>true</code> when the link is clicked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;
    &lt;a href="viewCart*?clear=true*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;c:url&gt;</code> tag can be applied to the URL in the following manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;

    *&lt;c:url var="url" value="viewCart"&gt;
        &lt;c:param name="clear" value="true"/&gt;
    &lt;/c:url&gt;*

    &lt;a href="*${url}*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>clear=true</code> parameter is set by adding a <code>&lt;c:param</code> tag between the <code>&lt;c:url&gt;</code> tags. A variable named &#8216;url&#8217; is set using &lt;c:url&gt;'s <code>var</code> attribute, and <code>var</code> is then accessed in the HTML anchor tag using the <code>${url}</code> expression.</p>
</div>
<div class="paragraph">
<p>You can download and examine <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">snapshot 6</a> to see how all links in the project have been encoded.</p>
</div>
<div class="paragraph">
<p>URL rewriting should only be used in the event that cookies are not an available tracking method. URL rewriting is generally considered a suboptimal solution because it exposes the session ID in logs, bookmarks, referer headers, and cached HTML, in addition to the browser&#8217;s address bar. It also requires more server-side resources, as the server needs to perform additional steps for each incoming request in order to extract the session ID from the URL and pair it with an existing session.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="time-out"><a class="anchor" href="#time-out"></a>Handling Session Time-Outs</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#time-interval">Setting Session Time Intervals</a></p>
</li>
<li>
<p><a href="#programmatically">Programmatically Handling Session Time-Outs</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="time-interval"><a class="anchor" href="#time-interval"></a>Setting Session Time Intervals</h3>
<div class="paragraph">
<p>You should consider the maximum time interval which your server maintains sessions for. If your website receives heavy traffic, a large number of sessions could expend your server&#8217;s memory capacity. You might therefore shorten the interval in hopes of removing unused sessions. On the other hand, you certainly wouldn&#8217;t want to cut sessions too short, as this could become a usability issue that might have a negative impact on the business behind the website. Taking the <code>AffableBean</code> application as an example, a user proceeds to checkout after filling her shopping cart with items. She then realizes she needs to enter her credit card details and goes off to find her purse. After returning to her computer with credit card in hand, she fills in the checkout form and clicks submit. During this time however, her session has expired on the server. The user sees that her shopping cart is empty and is redirected to the homepage. Will she really take the time to step through the process again?</p>
</div>
<div class="paragraph">
<p>The following steps demonstrate how to set the session time-out interval in the <code>AffableBean</code> project to 10 minutes. Of course, the actual duration ultimately depends on your server resources, the business objectives of the application, and the popularity of your website.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the application&#8217;s deployment descriptor in the editor. Press Alt-Shift-O (Ctrl-Shift-O on Mac) to use the IDE&#8217;s Go to File dialog. Type in &#8216;web&#8217;, then click OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/go-to-file.png" alt="go to file">
</div>
<div class="title">Figure 27. The Go to File dialog enables quick navigation to project files</div>
</div>
<div class="paragraph">
<p>The editor displays the <code>web.xml</code> file in the XML view. The template that NetBeans provides for the <code>web.xml</code> file includes a default setting for 30 minutes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;
        30
    &lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Click the General tab, and type in &#8216;10&#8217; in the Session Timeout field.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-timeout.png" alt="session timeout">
</div>
<div class="title">Figure 28. Specify session time-out for the application under the web.xml&#8217;s General tab</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Save the file (Ctrl-S; ⌘-S on Mac).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you switch back to the XML view, you&#8217;ll see that the <code>&lt;session-timeout&gt;</code> element has been updated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;10&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Alternatively, you could remove the <code>&lt;session-timeout&gt;</code> element altogether, and edit the <code>session-properties</code> element in the GlassFish-specific deployment descriptor (<code>sun-web.xml</code>). This would set the global time-out for all applications in the server&#8217;s web module. See the <a href="http://docs.sun.com/app/docs/doc/821-1752/beaha">Oracle GlassFish Server 3.0.1 Application Development Guide: Creating and Managing Sessions</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatically"><a class="anchor" href="#programmatically"></a>Programmatically Handling Session Time-Outs</h3>
<div class="paragraph">
<p>If your application relies on sessions, you need to take measures to ensure that it can gracefully handle situations in which a request is received for a session that has timed out or cannot be identified. You can accomplish this in the <code>AffableBean</code> application by creating a simple filter that intercepts requests heading to the <code>ControllerServlet</code>. The filter checks if a session exists, and if not, it forwards the request to the site&#8217;s welcome page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by examining the problem that arises when a session times out midway through a user&#8217;s visit to the site. Temporarily reset the session time-out interval to one minute. Open the web deployment descriptor (<code>web.xml</code>) and enter &#8216;1&#8217; between the <code>&lt;session-timeout&gt;</code> tags.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*1*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Run the <code>AffableBean</code> project. In the browser, click into a category page, add several items to your cart, then click 'view cart'.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/cart-page-session-intact.png" alt="cart page session intact">
</div>
<div class="title">Figure 29. The cart page relies on a session object to display items in shopping cart</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Wait at least one full minute.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Update the quantity for one of the items displayed in the cart page. (Any number between 1 and 99 is acceptable.) Click 'update'. The server returns an HTTP Status 500 message.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/glassfish-error-report.png" alt="glassfish error report">
</div>
<div class="title">Figure 30. NullPointerException occurs when request for expired session is received</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Examine the GlassFish server log in the IDE. Open the Output window (Ctrl-4; ⌘-4 on Mac) and select the GlassFish Server tab. Scroll to the bottom of the log to examine the error&#8217;s stack trace.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-output.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-output.png" alt="gf server output"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The server log indicates that a <code>NullPointerException</code> occurred at line 184 in the <code>ControllerServlet</code>. The Output window forms a link to the line where the exception occurred.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click the link. You navigate directly to line 184 in the <code>ControllerServlet</code>. Hovering your mouse over the error badge in the editor&#8217;s left margin provides a tooltip describing the exception.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/nullpointer-exception.png" alt="nullpointer exception">
</div>
<div class="title">Figure 31. Error badge and tooltip indicate the location and cause of the problem</div>
</div>
<div class="paragraph">
<p>Because the session had already expired before the request was received, the servlet engine was unable to associate the request with its corresponding session. It was therefore unable to locate the <code>cart</code> object (line 151). The exception finally occurred in line 184 when the engine attempted to call a method on a variable equating to <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve identified the problem, let&#8217;s fix it by implementing a filter.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Click the New File ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/new-file-btn.png" alt="new file btn"></span> ) button in the IDE&#8217;s toolbar. (Alternatively, press Ctrl-N; ⌘-N on Mac.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Select the <strong>Web</strong> category, then select <strong>Filter</strong> and click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Name the filter <code>SessionTimeoutFilter</code>. Type <code>filter</code> into the Packages field so that the filter class is placed in a new package when created.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Click Next. Accept default settings and click Finish. A template for the <code>SessionTimeoutFilter</code> is generated and opens in the editor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Currently, in NetBeans 6.9, it isn&#8217;t possible to use the wizard to set a mapping to a servlet that isn&#8217;t registered in the web deployment descriptor. (<code>ControllerServlet</code> was registered using the <code>@WebServlet</code> annotation.) We&#8217;ll therefore modify the generated code in the next step.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Modify the <code>@WebFilter</code> annotation signature so that it appears as follows.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebFilter(*servletNames = {"Controller"}*)
public class SessionTimeoutFilter implements Filter {</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the filter to intercept any requests that are handled by the <code>ControllerServlet</code>. (Alternatively, you could have kept the <code>urlPatterns</code> attribute, and listed all patterns that the <code>ControllerServlet</code> handles.)</p>
</div>
<div class="paragraph">
<p>Note that &#8216;Controller&#8217; is the name of the <code>ControllerServlet</code>, as specified in the servlet&#8217;s <code>@WebServlet</code> annotation signature. Also note that you&#8217;ve removed the <code>filterName</code> attribute, since the name of the filter class is used by default.</p>
</div>
<div class="paragraph">
<p>The IDE&#8217;s filter template provides a lot of interesting code which is worth inspecting in its own right. However, most of it is not needed for our purposes here. Any filter class must implement the <code>Filter</code> interface, which defines three methods:
* <strong><code>init</code>:</strong> performs any actions after the filter is initialized but before it is put into service
* <strong><code>destroy</code>:</strong> removes the filter from service. This method can also be used to perform any cleanup operations.
* <strong><code>doFilter</code>:</strong> used to perform operations for each request the filter intercepts</p>
</div>
<div class="paragraph">
<p>Use the Javadoc Index Search to pull up documentation on the <code>Filter</code> interface. Press Shift-F1 (fn-Shift-F1 on Mac), then type &#8216;Filter&#8217; into the search field and hit Enter. Select the 'Interface in javax.servlet' entry. The Javadoc documentation displays in the lower pane of the index search tool.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Replace the body of the <code>SessionTimeoutFilter</code> with the following contents.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebFilter(servletNames = {"Controller"})
public class SessionTimeoutFilter implements Filter {

    *public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;

        HttpSession session = req.getSession(false);

        // if session doesn't exist, forward user to welcome page
        if (session == null) {
            try {
                req.getRequestDispatcher("/index.jsp").forward(request, response);
            } catch (Exception ex) {
                ex.printStackTrace();
            }
            return;
        }

        chain.doFilter(request, response);
    }

    public void init(FilterConfig filterConfig) throws ServletException {}

    public void destroy() {}*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Press Ctrl-Shift-I (⌘-Shift-I on Mac) to fix import statements. (Imports need to be added for <code>HttpServletRequest</code> and <code>HttpSession</code>.) Also, use the editor hints to add the <code>@Override</code> annotation to the <code>init</code>, <code>destroy</code>, and <code>doFilter</code> methods.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the coming steps, you run the debugger on the project and step through the <code>doFilter</code> method to see how it determines whether the request is bound to an existing session.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Open the Breakpoints window (Alt-Shift-5; Ctrl-Shift-5 on Mac) and ensure that you do not have any existing breakpoints set. To delete a breakpoint, right-click the breakpoint and choose Delete. (If you completed the above exercise, <a href="#http-monitor">Examining Client-Server Communication with the HTTP Monitor</a>, you may have an outstanding breakpoint set in the <code>ControllerServlet</code>.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Run the debugger. Click the Debug Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/debug-project-btn.png" alt="debug project btn"></span> ) button in the IDE&#8217;s main toolbar.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>When the welcome page displays in the browser, select a category, then add several items to your shopping cart.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Set a breakpoint on the line in <code>SessionTimeoutFilter&#8217;s `doFilter</code> method that tries to access the session (line 32).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/filter-breakpoint.png" alt="filter breakpoint">
</div>
<div class="title">Figure 32. Set a breakpoint on the getSession method</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>In the browser, click the 'view cart' button. Switch to the IDE and note that the debugger has suspended on the breakpoint.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Recall that <code>getSession()</code> creates a new session object if the current one doesn&#8217;t exist. Here, we use <code>getSession(false)</code>, which refrains from creating a new object if none is found. In other words, the method returns <code>null</code> if the session doesn&#8217;t exist.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Click the Step Over ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/step-over-btn.png" alt="step over btn"></span> ) button, then hover your mouse over the <code>session</code> variable. Provided that a minute hasn&#8217;t passed since the previous request was sent, you&#8217;ll see that the variable has been assigned to a <code>StandardSessionFacade</code>. This represents the session object for the request.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-exists.png" alt="session exists">
</div>
<div class="title">Figure 33. Hover your mouse over variables to determine their current value</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Continue stepping through the method until the request is processed. Since <code>session</code> doesn&#8217;t equal <code>null</code>, you skip the <code>if</code> statement and <code>chain.doFilter</code> then forwards the request to the <code>ControllerServlet</code> (line 44).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>In the browser, make sure a full minute has passed, then update a quantity for one of the product items in your cart. This is the same procedure we went through earlier in the exercise when the status 500 message was returned. Now that the filter intercepts requests heading to the <code>ControllerServlet</code>, let&#8217;s see what happens when a session time-out occurs.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>After clicking 'update', switch to the IDE and note that the debugger is again suspended on the breakpoint set in the filter.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Highlight the <code>req.getSession(false)</code> expression, then hover your mouse over it. Here you see the expression equates to <code>null</code>, as the session has already expired.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/session-null.png" alt="session null">
</div>
<div class="title">Figure 34. Highlight expressions and hover your mouse over them to determine their current value</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Continue stepping through the code. Now that the <code>session</code> variable equals <code>null</code>, the <code>if</code> statement on line 35 is processed, and the request is forwarded to <code>/index.jsp</code>. When the debugger finishes executing, you&#8217;ll see that the browser displays the site&#8217;s welcome page.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Click the Finish Session ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/finish-session-btn.png" alt="finish session btn"></span> ) button to terminate the debug session.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Open the project&#8217;s <code>web.xml</code> file and change the session time-out interval back to 10 minutes.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*10*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Save (Ctrl-S; ⌘-S on Mac) the file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">Snapshot 6</a> provides you with the completed project version for this tutorial unit. One final topic concerning session management should be mentioned. You can explicitly terminate a session by calling the <code>invalidate</code> method on the session object. If the session is no longer needed, it should be removed in order to conserve the memory available to your server. After you complete the next unit, <a href="../transaction/" class="xref page">Integrating Transactional Business Logic</a>, you will see how the <code>ControllerServlet</code>, upon successfully processing a customer order, destroys the user&#8217;s <code>cart</code> object and terminates the session using the <code>invalidate</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if order processed successfully send user to confirmation page
if (orderId != 0) {

    // dissociate shopping cart from session
    cart = null;

    // end session
    session.invalidate();

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is demonstrated in <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">project snapshot 8</a> (and later snapshots).</p>
</div>
<div class="paragraph">
<p><a href="../../../../../../../front/main/community/mailing-lists/" class="xref page">Send Feedback on This Tutorial</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso"><a class="anchor" href="#seeAlso"></a>See Also</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_netbeans_resources"><a class="anchor" href="#_netbeans_resources"></a>NetBeans Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../../../java/debug-multithreaded/" class="xref page">Debugging Multithreaded Applications</a></p>
</li>
<li>
<p><a href="../../../java/debug-multithreaded-screencast/" class="xref page">Video of the Multithreaded Debugging with the NetBeans IDE</a></p>
</li>
<li>
<p><a href="../../../java/debug-evaluator-screencast/" class="xref page">Video of Using the Code Snippet Evaluator in the NetBeans Debugger</a></p>
</li>
<li>
<p><a href="../../../../../../../front/main/community/media/" class="xref page">Video Tutorials and Demos for NetBeans IDE</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">Keyboard Shortcuts &amp;amp; Code Templates Card</a></p>
</li>
<li>
<p><a href="../../javaee-gettingstarted/" class="xref page">Getting Started with Java EE Applications</a></p>
</li>
<li>
<p><a href="../../javaee-intro/" class="xref page">Introduction to Java EE Technology</a></p>
</li>
<li>
<p><a href="../../../java-ee/" class="xref page">Java EE &amp;amp; Java Web Learning Trail</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_glassfish_resources"><a class="anchor" href="#_glassfish_resources"></a>GlassFish Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.glassfish.java.net/Wiki.jsp?page=Screencasts">GlassFish Screencasts</a></p>
</li>
<li>
<p><a href="http://glassfish.dev.java.net/docs/index.html">GlassFish v3 Documentation</a></p>
</li>
<li>
<p><a href="http://www.sun.com/offers/details/GlassFish_Tomcat.html">Learning GlassFish for Tomcat Users</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1751">Oracle GlassFish Server 3.0.1 Administration Guide</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1750">Oracle GlassFish Server 3.0.1 Application Deployment Guide</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1752">Oracle GlassFish Server 3.0.1 Application Development Guide</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_technical_articles_miscellaneous_resources"><a class="anchor" href="#_technical_articles_miscellaneous_resources"></a>Technical Articles &amp; Miscellaneous Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/javaee/reference/code/">Java EE Code Samples &amp;amp; Apps</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Javadoc Tool</a> [product homepage]</p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">How to Write Doc Comments for the Javadoc Tool</a></p>
</li>
<li>
<p><a href="http://java.sun.com/products/servlet/Filters.html">The Essentials of Filters</a></p>
</li>
<li>
<p><a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html">Core J2EE Patterns - Intercepting Filter</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/csajsp2.html">Beginning and Intermediate-Level Servlet, JSP, and JDBC Tutorials</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/msajsp.html">Advanced Servlet and JSP Tutorials</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/java5.html">Java 5 &amp;amp; Java 6 Tutorials</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0211.html">A JSTL primer, Part 1: The expression language</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0318/index.html">A JSTL primer, Part 2: Getting down to the core</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/manage-sessions.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2024 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../../_/css/search.css"></script>
<script async src="../../../../../../../search-index.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="../../../../../../../_/js/vendor/highlight-11.9.0.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
         document.querySelectorAll('pre code').forEach((el) => {
         hljs.highlightElement(el);
        });
      });
    </script>
  </body>
</html>
