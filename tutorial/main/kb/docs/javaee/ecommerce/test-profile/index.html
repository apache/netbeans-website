<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>The NetBeans E-commerce Tutorial - Testing and Profiling</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The NetBeans E-commerce Tutorial - Testing and Profiling - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, The NetBeans E-commerce Tutorial - Testing and Profiling">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../../../../index.html"><img src='../../../../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <article class="doc">
      <h1 class="sect0">The NetBeans E-commerce Tutorial - Testing and Profiling</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/test-profile.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_tutorial_contents">Tutorial Contents</a></li>
<li><a href="#test">Testing with JMeter</a>
<ul class="sectlevel2">
<li><a href="#install">Install the JMeter Kit Plugin</a></li>
<li><a href="#createTestPlan">Create a Test Plan</a></li>
<li><a href="#loadTest">Load Testing</a></li>
<li><a href="#stressTest">Stress Testing</a></li>
</ul>
</li>
<li><a href="#profile">Using the NetBeans Profiler</a>
<ul class="sectlevel2">
<li><a href="#memoryLeaks">About Memory Leaks</a></li>
<li><a href="#monitoring">Monitoring your Application</a></li>
<li><a href="#heapWalker">Evaluating Heap Contents with the HeapWalker</a></li>
</ul>
</li>
<li><a href="#glassFishTune">Tuning the GlassFish Server</a>
<ul class="sectlevel2">
<li><a href="#tip3">Tip 3: Java Heap Size</a></li>
<li><a href="#tip6">Tip 6: HTTP Request Processing Threads</a></li>
<li><a href="#tip10">Tip 10: JDBC Tuning</a></li>
</ul>
</li>
<li><a href="#seeAlso">See Also</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_resources">NetBeans Resources</a></li>
<li><a href="#_jmeter">JMeter</a></li>
<li><a href="#_glassfish_performance">GlassFish Performance</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_tutorial_contents"><a class="anchor" href="#_tutorial_contents"></a>Tutorial Contents</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../intro/" class="xref page">Introduction</a></p>
</li>
<li>
<p><a href="../design/" class="xref page">Designing the Application</a></p>
</li>
<li>
<p><a href="../setup-dev-environ/" class="xref page">Setting up the Development Environment</a></p>
</li>
<li>
<p><a href="../data-model/" class="xref page">Designing the Data Model</a></p>
</li>
<li>
<p><a href="../page-views-controller/" class="xref page">Preparing the Page Views and Controller Servlet</a></p>
</li>
<li>
<p><a href="../connect-db/" class="xref page">Connecting the Application to the Database</a></p>
</li>
<li>
<p><a href="../entity-session/" class="xref page">Adding Entity Classes and Session Beans</a></p>
</li>
<li>
<p><a href="../manage-sessions/" class="xref page">Managing Sessions</a></p>
</li>
<li>
<p><a href="../transaction/" class="xref page">Integrating Transactional Business Logic</a></p>
</li>
<li>
<p><a href="../language/" class="xref page">Adding Language Support</a></p>
</li>
<li>
<p><a href="../security/" class="xref page">Securing the Application</a></p>
</li>
<li>
<p><strong>Testing and Profiling</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#test">Testing with JMeter</a></p>
</li>
<li>
<p><a href="#profile">Using the NetBeans Profiler</a></p>
</li>
<li>
<p><a href="#glassFishTune">Tuning the GlassFish Server</a></p>
</li>
<li>
<p><a href="#seeAlso">See Also</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p><a href="../conclusion/" class="xref page">Conclusion</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. Content on this page applies to NetBeans IDE, versions 6.8 and 6.9</div>
</div>
<div class="paragraph">
<p>Before delivering any application, it is important to ensure that it functions properly, and that it can perform acceptably for the demands expected of it. Web applications, especially e-commerce applications, by their very nature provide concurrent access to shared resources. In other words, the servers on which they are hosted must be able to respond to multiple users requesting the same resources over the same period of time. Be mindful of this fact when during development your application appears to behave correctly as you click through web pages in your browser. How will the application perform when handling 100 users simultaneously? Are there memory leaks that will degrade the server&#8217;s performance after the application has been running for long periods of time? What steps can you take to ensure that your production server best handles traffic to your application?</p>
</div>
<div class="paragraph">
<p>This tutorial unit is designed to introduce you to the IDE&#8217;s support for testing and profiling. You begin by installing the JMeter Kit plugin, which enables you to create test plans and open them in <a href="http://jakarta.apache.org/jmeter/">Apache JMeter</a> from the IDE. You then create a basic test plan in JMeter, and proceed by exploring the tool&#8217;s capacity for functional and performance testing. Finally, you explore the IDE&#8217;s Profiler, and use it to examine GlassFish' memory consumption while you run the JMeter test plan against the <code>AffableBean</code> application over an extended period of time. This unit concludes by presenting various tips that enable you to tune the GlassFish server for your application in a production environment.</p>
</div>
<div class="paragraph">
<p>You can view a live demo of the application that you build in this tutorial: <a href="http://services.netbeans.org/AffableBean/">NetBeans E-commerce Tutorial Demo Application</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software or Resource</th>
<th class="tableblock halign-left valign-top">Version Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../../../../../front/main/download/" class="xref page">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java bundle, 6.8 or 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">GlassFish server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 or Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jmeter">JMeter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2 or more recent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQL database server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_complete.zip">AffableBean project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">complete version</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NetBeans IDE requires the Java Development Kit (JDK) to run properly. If you do not have any of the resources listed above, the JDK should be the first item that you download and install.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle includes Java Web and EE technologies, which are required for the application you build in this tutorial.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle also includes the GlassFish server, which you require for this tutorial. You could <a href="http://glassfish.dev.java.net/public/downloadsindex.html">download the GlassFish server independently</a>, but the version provided with the NetBeans download has the added benefit of being automatically registered with the IDE.</p>
</li>
<li>
<p>You can follow this tutorial unit without having completed previous units. To do so, see the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</li>
<li>
<p><strong>You do not need to download JMeter for its use in this tutorial.</strong> Instead, you install the NetBeans JMeter Kit plugin, which includes the JMeter distribution. You will therefore require an Internet connection at the point when you install the plugin in the tutorial. JMeter can be downloaded independently from <a href="http://jakarta.apache.org/site/downloads/downloads_jmeter.cgi">http://jakarta.apache.org/site/downloads/downloads_jmeter.cgi</a>.</p>
</li>
<li>
<p>The JMeter Kit plugin for NetBeans 6.8 installs JMeter version 2.2 (released June 2006). The plugin for NetBeans 6.9 installs JMeter version 2.4 (released July 2010). There is a significant difference between these two versions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test"><a class="anchor" href="#test"></a>Testing with JMeter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Begin by examining the <code>AffableBean</code> tutorial application. Then install the JMeter Kit plugin using the IDE&#8217;s Plugins Manager. Launch JMeter from the IDE, and proceed by creating a test plan based on the tutorial <a href="../design/#mockups" class="xref page">use-case</a>. Finally, explore some of JMeter&#8217;s facilities for functional and load testing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#install">Install the JMeter Kit Plugin</a></p>
</li>
<li>
<p><a href="#createTestPlan">Create a Test Plan</a></p>
</li>
<li>
<p><a href="#loadTest">Load Testing</a></p>
</li>
<li>
<p><a href="#stressTest">Stress Testing</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="install"><a class="anchor" href="#install"></a>Install the JMeter Kit Plugin</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_complete.zip">`AffableBean` project</a> in the IDE. Click the Open Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/open-project-btn.png" alt="open project btn"></span> ) button and use the wizard to navigate to the location on your computer where you downloaded the project.</p>
</li>
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to ensure that it is properly configured with your database and application server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you receive an error when running the project, revisit the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL. If you want to log into the project&#8217;s administration console (not required in this tutorial unit), you&#8217;ll need to create a user named <code>nbuser</code> on the GlassFish server. This task is described in Unit 11, <a href="../security/#createUsers" class="xref page">Securing the Application: Create Users and/or Groups on the Server</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Open the IDE&#8217;s Plugins Manager by choosing Tools &gt; Plugins from the main menu. Select the Available Plugins tab, then type in &#8216;jmeter&#8217; into the Search field. When you see JMeter Kit displayed from the filtered results, select it by clicking the checkbox under the Install column.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/plugins-manager.png" alt="plugins manager">
</div>
<div class="title">Figure 2. JMeter Kit is a NetBeans certified plugin available in the Plugins Manager</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click Install. The IDE&#8217;s installer informs you that two plugins will be installed: The JMeter Kit and the Load Generator, which provides a generic infrastructure for load generator engines registered in the IDE.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/ide-installer.png" alt="ide installer">
</div>
<div class="title">Figure 3. Plugins dependencies are automatically included during installation</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click Next. Accept the license agreement, then click Install.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You require an Internet connection to download the selected plugins.</p>
</div>
<div class="paragraph">
<p>The installer downloads, verifies, and installs the plugins. When installation has successfully completed, click Finish to exit the installer, then click Close to close the Plugins Manager.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>In the Projects window, note that a new Load Generator Scripts node displays in your project.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/load-generator-scripts.png" alt="load generator scripts">
</div>
<div class="title">Figure 4. The Load Generator plugin enables you to access scripts from the Projects window</div>
</div>
<div class="paragraph">
<p>If you open the Files window (Ctrl-2; ⌘-2 on Mac), you&#8217;ll see a new <code>jmeter</code> folder added to the project. (Recall that the Files window provides a directory-based view of projects, i.e., it displays the folder structure of projects as they exist on your computer&#8217;s file system.) The <code>jmeter</code> folder corresponds to the Project window&#8217;s Load Generator Scripts node, and will contain any load scripts that you later add to the project.</p>
</div>
</div>
<div class="sect2">
<h3 id="createTestPlan"><a class="anchor" href="#createTestPlan"></a>Create a Test Plan</h3>
<div class="paragraph">
<p>To demonstrate how to create a test plan in JMeter, we&#8217;ll base our plan on the tutorial use-case, which was presented in <a href="../design/#mockups" class="xref page">Designing the Application</a>. A list of user-initiated requests to the server, based on the given use-case, might look something like the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Use-Case</th>
<th class="tableblock halign-left valign-top">Server Request</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer visits the welcome page&#8230;&#8203;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&#8230;&#8203;and selects a product category.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer browses products within the selected category page, then adds a product to his or her shopping cart.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/addToCart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer continues shopping and selects a different category.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer adds several products from this category to shopping cart.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/addToCart</code>
<code>/AffableBean/addToCart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer selects 'view cart' option&#8230;&#8203;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/viewCart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&#8230;&#8203;and updates quantities for cart products in the cart page.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/updateCart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Customer verifies shopping cart contents and proceeds to checkout.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/checkout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>In the checkout page, customer views the cost of the order and other information, fills in personal data, then submits his or her details.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/AffableBean/purchase</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The order is processed and customer is taken to a confirmation page. The confirmation page provides a unique reference number for tracking the customer order, as well as a summary of the order.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(n/a)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s proceed by creating a JMeter test plan that follows the above list of requests.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the New File ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/new-file-btn.png" alt="new file btn"></span> ) button in the IDE&#8217;s toolbar. (Alternatively, press Ctrl-N; ⌘-N on Mac.)</p>
</li>
<li>
<p>Under Categories, select <strong>Load Testing Scripts</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Instead of scrolling to the bottom of the list, simply begin typing &#8216;load&#8217;. As shown in the image below, the Load Testing Scripts category displays.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/file-wizard-load.png" alt="file wizard load">
</div>
<div class="title">Figure 5. You can filter category entries by typing the category you are searching for</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Expand the Load Testing Scripts category and select <strong>JMeter Plans</strong>. Under File Types, select <strong>New JMeter Plan</strong>, then click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Name the plan <code>useCaseTest</code>, then click Finish. The new test plan displays in the Projects window.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/use-case-test.png" alt="use case test">
</div>
<div class="title">Figure 6. JMeter test plans display under Load Testing Scripts in the Projects window</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>To begin customizing the plan in JMeter, right-click the <code>useCaseTest.jmx</code> node and choose External Edit. JMeter opens.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/jmeter.png" alt="jmeter">
</div>
<div class="title">Figure 7. NetBeans template plan is provided when opening JMeter</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The NetBeans template plan includes various user-defined variables, as shown in the above image. Usage of several of these variables will become clear as we work with the test plan. For more information, see the Apache JMeter User&#8217;s Manual: <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#User_Defined_Variables">18.4.13 User Defined Variables</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click the HTTP Request Defaults node in the left column. The <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#HTTP_Request_Defaults">HTTP Request Defaults</a> panel enables you to set default values for all HTTP requests invoked from your test plan. Note that the entries for Server Name and Port Number are <code>${nb.server}</code> and <code>${nb.port}</code>, respectively. From the image above, you see that these equate to <code>localhost</code> and <code>8080</code>, which you typically use when deploying NetBeans projects to GlassFish.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Click the Thread Group node in the left column. In JMeter, a "thread" refers to a user. Let&#8217;s rename the Thread Group to <code>AffableBean</code> <code>Users</code>. Type &#8216;AffableBean` `Users&#8217; into the Name field under Thread Group.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let&#8217;s begin recording requests for the test plan. To do so, we&#8217;ll use JMeter&#8217;s <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#HTTP_Proxy_Server">HTTP Proxy Server</a>. Instead of entering test plan requests manually, we&#8217;ll run the proxy server and have it record requests sent from the browser. For large test plans this technique is invaluable.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>In the left column, right-click WorkBench and choose Add &gt; Non-Test Elements &gt; HTTP Proxy Server.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>In the HTTP Proxy Server panel, change the port number from <code>8080</code> to another, random number, for example <code>9090</code>. JMeter provides <code>8080</code> as its default port number for the proxy server. However, the GlassFish server also occupies the <code>8080</code> port, so we&#8217;re modifying the proxy server&#8217;s port number to avoid a port conflict.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the Grouping drop-down list, select 'Put each group in a new controller'. Also, deselect the 'Capture HTTP Headers' option. We do not require header information for each recorded request.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/http-proxy-server.png" alt="http proxy server">
</div>
<div class="title">Figure 8. Configure the proxy server</div>
</div>
<div class="paragraph">
<p>Note that the 'Use Recording Controller' option is selected by default for the Target Controller field. When you begin recording requests, they will be stored in the Recording Controller that is listed in the left column.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Switch to your browser and temporarily change its port number to <code>9090</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have previously configured your browser&#8217;s proxy, remember your settings so that you may be able to reenter them after completing this exercise.</p>
</div>
<div class="paragraph">
<p>In Firefox, you can do this from the Options window (Preferences window on Mac).
* Choose Tools &gt; Options (Firefox &gt; Preferences on Mac).
* Select the Advanced &gt; Network tabs.
* Under the Connection heading, click Settings.
* Select the 'Manual proxy configuration' option, then type in <code>localhost</code> and <code>9090</code> for the HTTP Proxy and Port fields, respectively.
* Remove the <code>127.0.0.1</code> and <code>localhost</code> entries in the 'No Proxy for' field.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox-proxy.png" alt="firefox proxy">
</div>
<div class="title">Figure 9. Specify 'localhost:9090' and remove entries in the 'No Proxy for' field</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click OK.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Clear your browser&#8217;s cache before you begin recording requests. You want to make sure that the HTTP Proxy Server is able to record all resources required for displaying pages in the Affable Bean website, including images, JavaScript scripts and CSS stylesheets.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In Firefox, you can do this by pressing Ctrl-Shift-Del (⌘-Shift-Del on Mac) to open the Clear Recent History dialog. Under 'Time range to clear', ensure that you&#8217;ve selected a range that extends to the first time the browser accessed the Affable Bean website. Select Cache, then click Clear Now.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/ff-clear-recent-history.png" alt="ff clear recent history">
</div>
<div class="title">Figure 10. Clear your browser&#8217;s cache before proceeding with recording</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Return to the JMeter Test Plan panel (<a href="#testPlanPanel">shown above</a>) and change the values for <code>nb.users</code> and <code>nb.rampup</code> to <code>99</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/user-defined-variables.png" alt="user defined variables">
</div>
<div class="title">Figure 11. Double-click into User Defined Variables table to modify variables</div>
</div>
<div class="paragraph">
<p>The reason this is recommended is that JMeter automatically inserts user-defined variables throughout the test plan, wherever their values occur. So, for example, when the URL for <code>/AffableBean/js/jquery-1.4.2.js</code> is encountered, it will be recorded as: <code>AffableBean/js/jquery-1.4.<strong>${nb.users}</strong>.js</code>. Later, when we modify the value and rerun the test plan, URLs such as this will also change, which is not desired behavior. Here, we enter a random value (<code>99</code>), since we don&#8217;t expect it to occur in the URLs that we are about to record.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Return to the HTTP Proxy Server panel, then at the bottom of the panel, click the Start button. JMeter&#8217;s proxy server is now listening on port 9090.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) from the IDE. The project is deployed to GlassFish, and the welcome page opens in the browser.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Switch to JMeter and inspect the Recording Controller in the left column. All of the requests generated for accessing the welcome page are listed under the Recording Controller in a node named after the first request (i.e., <code>/AffableBean/</code>).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/recording-controller.png" alt="recording controller">
</div>
<div class="title">Figure 12. Request grouping for welcome page displayed under Recording Controller</div>
</div>
<div class="paragraph">
<p>If you inspect the <code>/AffableBean/</code> node, you&#8217;ll note that it is a <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Simple_Controller">Simple Controller</a>. Although dubbed a "Controller", the Simple Controller doesn&#8217;t offer any functionality beyond enabling you to group elements together - as demonstrated here.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Return to the browser and continue clicking through the website according to the use-case <a href="#useCase">outlined above</a>. You can select any of the categories and products. Stop when you reach the checkout page - the proxy server will not be able to record requests sent over HTTPS.<sup><a href="#footnote1">[1]</a></sup></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The elements within the Recording Controller will look as follows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/recording-controller2.png" alt="recording controller2">
</div>
<div class="title">Figure 13. Requests according to use-case listed under Recording Controller</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Stop the proxy server. Click the Stop button in JMeter&#8217;s HTTP Proxy Server panel.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>In your browser, change the proxy configuration so that it no longer uses port 9090. In Firefox for example, return to the proxy configuration window (<a href="#ff-proxy-config">displayed above</a>) and select No Proxy.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Manually create the request for <code>/AffableBean/purchase</code>. Perform the following steps:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the Simple Controller in JMeter&#8217;s left column, then press Ctrl-X (⌘-X on Mac) to cut the element.</p>
</li>
<li>
<p>Click the Recording Controller, then press press Ctrl-V (⌘-V on Mac) to paste the element. The Simple Controller now displays beneath the <code>/AffableBean/checkout</code> request.</p>
</li>
<li>
<p>Click the Simple Controller node, then in its main panel rename the controller to <code>/AffableBean/purchase</code>.</p>
</li>
<li>
<p>Right-click the new <code>/AffableBean/purchase</code> node and choose Add &gt; Sampler &gt; <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#HTTP_Request">HTTP Request</a>.</p>
</li>
<li>
<p>Click the new HTTP Request node, then in its main panel configure it as follows:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> <code>/AffableBean/purchase</code></p>
</li>
<li>
<p><strong>Server Name or IP:</strong> <code>${nb.server}</code></p>
</li>
<li>
<p><strong>Port Number:</strong> <code>8181</code></p>
</li>
<li>
<p><strong>Protocol:</strong> <code>https</code></p>
</li>
<li>
<p><strong>Method:</strong> <code>POST</code></p>
</li>
<li>
<p><strong>Path:</strong> <code>/AffableBean/purchase</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Under 'Send Parameters With the Request', click the Add button and create the following entries:</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encode?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include Equals?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Benjamin Linus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>email</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>b.linus@lost.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>222756448</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Družstevní 77</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cityRegion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creditcard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4444222233331111</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/http-request.png" alt="http request">
</div>
<div class="title">Figure 14. Configure an HTTP Request for HTTPS connection</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Now, add an <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#HTTP_Cookie_Manager">HTTP Cookie Manager</a> to the test plan. Right-click the <code>AffableBean</code> <code>Users</code> thread group node in JMeter&#8217;s left column, then choose Add &gt; Config Element &gt; HTTP Cookie Manager.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Recall that the <code>AffableBean</code> application relies on a session-tracking mechanism (i.e., cookies or URL-rewriting) to remember which shopping cart belongs to which request. Therefore, we need to account for this in the test plan. JMeter acts as the client when sending requests to the server, however unlike a browser, it doesn&#8217;t have cookies "enabled by default." We apply the HTTP Cookie Manager to the thread group so that the <code>JSESSIONID</code> cookie can be passed between client and server.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If you want to employ URL rewriting as the session-tracking mechanism, you would need to add the <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#HTTP_URL_Re-writing_Modifier">HTTP URL Re-writing Modifier</a> to the thread group.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Finally, add an element to the test plan that simulates a delay between user-initiated requests.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click the <code>/AffableBean/</code> Simple Controller in the left column and choose Add &gt; Sampler &gt; Test Action.</p>
</li>
<li>
<p>In the main panel, specify the following:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> <code>user delay</code></p>
</li>
<li>
<p><strong>Duration (milliseconds):</strong> <code>${nb.interleave}</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/test-action.png" alt="test action">
</div>
<div class="title">Figure 15. Use a Test Action element to simulate a delay between user-initiated requests</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In JMeter&#8217;s left column, copy (Ctrl-C; ⌘-C on Mac) the new <code>user</code> <code>delay</code> Test Action node, then paste it (Ctrl-V; ⌘-V on Mac) into each of the other Simple Controllers ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/simple-controller-node.png" alt="simple controller node"></span> ) that form the test plan, except for the final one (<code>/AffableBean/purchase</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you finish, the final six Simple Controllers and their contents will look as follows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/user-delay.png" alt="user delay">
</div>
<div class="title">Figure 16. Use copy and paste functionality to place existing elements elsewhere in your test plan</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>(<em>Optional</em>.) Clean up the test plan. You can remove the Loop Controller and Constant Timer. (Right-click and choose Remove.) Also, move all of the Recording Controller&#8217;s child elements directly into the <code>AffableBean</code> <code>Users</code> thread group, then remove the Recording Controller. When you finish, the test plan will look as follows.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/test-plan.png" alt="test plan">
</div>
<div class="title">Figure 17. Remove unnecessary items from test plan</div>
</div>
</div>
<div class="sect2">
<h3 id="loadTest"><a class="anchor" href="#loadTest"></a>Load Testing</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Load_testing">Load testing</a> a web application involves making concurrent requests for resources, typically by simulating multiple users, and then examining the server&#8217;s behavior. We can use the test plan we created for this purpose, and make adjustments to the number of users and other settings to determine how the server behaves under the given work load.</p>
</div>
<div class="paragraph">
<p>Load testing should be performed with specific goals in mind, such as determining the <a href="https://en.wikipedia.org/wiki/Throughput">throughput</a> for the anticipated average and peak numbers of users. It is also worthwhile to assess the <em>response time</em> for requests, to ensure that site customers are not having to wait too long to be served. In order to measure the response time, you need to take into account the time during which data spends traveling over the Internet. One way to do this is to compare test results between a local server, where network travel time is nearly non-existent, and results from testing the production server remotely. The following example demonstrates how you can perform tests using your local development server. Once you migrate an application to the production server, you can simply change the value for the server variable set under the test plan&#8217;s User Defined Variables.</p>
</div>
<div class="paragraph">
<p>The results recorded in this and the following sections were arrived at by running tests on a computer with a 2.4 GHz Intel Core 2 Duo processor and 4 GB of memory. Naturally, the results you get depend on your computer&#8217;s performance, and will likely not match those displayed here.</p>
</div>
<div class="paragraph">
<p>When you run load tests, you should be careful not to overload your computer. If you set too many threads (i.e., users), do not place adequate delay between individual requests, or continuously loop through the test plan, there is a chance that JMeter will expend your computer’s processing capacity or memory. JMeter will then become unresponsive and you may need to "force quit" the tool using your computer&#8217;s task manager. It is therefore recommended that you open the task manager in order to monitor the computer&#8217;s CPU and memory levels while the test is running. This will allow you to gauge the limits of your computer in terms of running the test plan.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open JMeter if it is not already opened. (In the IDE&#8217;s Projects window, right-click <code>useCaseTest.jmx</code> and choose External Edit.)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If you did not create the JMeter test plan in the <a href="#createTestPlan">previous sub-section</a>, you can download the complete <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FuseCaseTest.jmx">`useCaseTest.jmx`</a> file and add it to your project. To add it to the <code>AffableBean</code> project, copy it from your computer&#8217;s file system (Ctrl-C; ⌘-C on Mac), then in the IDE, open the Files window (Ctrl-2; ⌘-2 on Mac), right-click the <code>jmeter</code> folder and choose Paste.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Add several <em>listeners</em> to the test plan:</p>
<div class="ulist">
<ul>
<li>
<p>Right-click <code>AffableBean</code> <code>Users</code> and choose Add &gt; Listener &gt; <strong>Summary Report</strong>.</p>
</li>
<li>
<p>Right-click <code>AffableBean</code> <code>Users</code> and choose Add &gt; Listener &gt; <strong>View Results Tree</strong>.</p>
</li>
<li>
<p>Right-click <code>AffableBean</code> <code>Users</code> and choose Add &gt; Listener &gt; <strong>Graph Results</strong>.
In JMeter, you require a <em>listener</em> to record and display the results of your test plan. The <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Summary_Report">Summary Report</a> displays a table, with each row corresponding to each differently named request in your test. The <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#View_Results_Tree">View Results Tree</a> shows a tree of all sample responses, allowing you to view response details for any sample. The <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Graph_Results">Graph Results</a> listener displays a simple graph that plots all sample times.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click the JMeter Template Plan node, then make the following changes to User Defined Variables:</p>
<div class="ulist">
<ul>
<li>
<p><strong><code>nb.users</code>:</strong> <code>1</code></p>
</li>
<li>
<p><strong><code>nb.interleave</code>:</strong> <code>5000</code>
We begin the test by simulating just one user. The value for <code>nb.interleave</code> is used in the <code>user</code> <code>delay</code> Test Action that we created, and represents the duration of a pause in milliseconds. Therefore, the test will pause for 5 seconds between each user-initiated request.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the Summary Report node so that you are able to view the test results while the test is running.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Run the test plan. Choose Run &gt; Start (Ctrl-R; ⌘-R on Mac) from the main menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The test plan runs for approximately 50 seconds. Note that request samples are taken every three seconds, during which you can watch as results are added and updated. Note that values for the <code>Average</code>, <code>Min</code>, and <code>Max</code> columns are represented in milliseconds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/summary-report.png" alt="summary report">
</div>
<div class="title">Figure 18. Summary Report displays results from the completed test plan</div>
</div>
<div class="paragraph">
<p>From the results displayed in the above image, we can observe that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The server, when loaded with a single user, provides a total <em>throughput</em> of approximately 41 per minute. In other words, the server is capable of serving all requests within the test plan 41 times within a minute. According to the <a href="http://jakarta.apache.org/jmeter/usermanual/glossary.html#Throughput">JMeter User's Manual</a>, the throughput is calculated as: <code>(number</code> <code>of</code> <code>requests)/(total</code> <code>time)</code>, and includes any delay inserted between samples, as it is supposed to represent the load on the server. When we consider that the <code>user</code> <code>delay</code> occurs for 5 seconds between each request (9 times in total, 9 * 5 seconds = 45 seconds), we see that with the server would theoretically be utilized for only approximately 15 seconds.</p>
</li>
<li>
<p>The <code>AffableBean/checkout</code> request, recorded at 33 milliseconds, takes much longer to process than most other requests. This is likely due to the fact that the initial request is redirected to the HTTP + SSL protocol on port 8181. So there are essentially two requests taking place.</p>
</li>
<li>
<p>The <code>AffableBean/purchase</code> request, recorded at 147 milliseconds, takes the most time to be served. This is likely due to both the write operations required on the database, and the fact that client-server communication takes place over an encrypted channel (i.e., using HTTPS).</p>
</li>
<li>
<p>According to the <code>Error</code> <code>%</code> column, no errors occurred from running the test. In other words, all server responses included an HTTP 200 status.</p>
</li>
<li>
<p>The <code>Avg.</code> <code>Bytes</code> column represents the average size of the sample response. We see that the JQuery core library (<code>jquery-1.4.2.js</code>) is the largest file that is served in the test plan, at nearly 164 KB. Because the file is served each time a new user accesses the site, it may be worth linking to this file on a public <a href="https://en.wikipedia.org/wiki/Content_delivery_network">content delivery network</a> (CDN) instead of maintaining it on the server. "Unburdening" the server in this manner could have a notable effect on its overall performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further information, see the official jQuery documentation: <a href="http://docs.jquery.com/Downloading_jQuery#CDN_Hosted_jQuery">CDN Hosted jQuery</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click the View Results Tree node. Here you see the individual results from each of the sample requests, listed in the order in which they occurred.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/view-results-tree.png" alt="view results tree">
</div>
<div class="title">Figure 19. View Results Tree displays a tree of all sample responses listed in the order in which they occurred</div>
</div>
<div class="paragraph">
<p>The green ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/jmeter-ok-icon.png" alt="jmeter ok icon"></span> ) icons indicate an HTTP status response of 200. In the above image, under 'Sampler result' in the right panel, note that the Thread Name for the selected sample is 'AffableBean Users 1-1'. The second '1' represents the thread (i.e., user) number. When testing multiple threads, you can use View Results Tree listener to pinpoint exactly when each thread makes a request within the test. Finally, in the image above, note that the 'HTML (download embedded resources)' option is selected in the lower left corner. When you select the 'Response data' tab in the right panel, JMeter attempts to render the response as it would display in a browser.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Red warning ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/jmeter-warning-icon.png" alt="jmeter warning icon"></span> ) icons indicate that requests are not being handled properly (i.e., HTTP 404 status messages are being sent). While this begins to happen when a server reaches its performance capacity, 404 status messages under a normal load suggest that the application is not functionally stable. You should then check the server log to determine why requests are failing, and make changes to your application.</p>
</div>
<div class="paragraph">
<p>In the coming steps, we&#8217;ll add an increasing number of users to the test, and examine the server&#8217;s overall throughput.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Click the JMeter Template Plan node, then make the following changes to User Defined Variables:</p>
<div class="ulist">
<ul>
<li>
<p><strong><code>nb.users</code>:</strong> <code>20</code></p>
</li>
<li>
<p><strong><code>nb.rampup</code>:</strong> <code>20</code>
The <code>nb.rampup</code> variable is used in the <code>AffableBean</code> <code>Users</code> Thread Group panel, and specifies the ramp-up period in seconds. In this case, if we test 20 users and the ramp-up period is 20 seconds, then a new user will begin sending requests every second.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Clear the results from the previous test by choosing Run &gt; Clear All (Ctrl-E; ⌘-E on Mac).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Click the Graph Results node so that you are able to view the test results while the test is running.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Run the test plan. Choose Run &gt; Start (Ctrl-R; ⌘-R on Mac) from the main menu. When the test plan runs, make the following observations:</p>
<div class="ulist">
<ul>
<li>
<p>A green square displays in the upper right corner of the interface, indicating that the test plan is running. Adjacent to the square is a ratio listing the number of active threads against the total number of threads being tested. For example, <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/jmeter-active-threads.png" alt="jmeter active threads"></span> demonstrates that the test is running, and that there are currently 15 active threads of a total of 20. Because of the ramp-up period, you should notice that the number of active threads increases each second to 20, remains at 20 for some time, then gradually decreases to zero, at which the square becomes gray indicating that the test has terminated.</p>
</li>
<li>
<p>You can filter the graphs you wish to display by selecting the checkboxes above the graph. For an explanation of Median and Deviation, refer to the <a href="http://jakarta.apache.org/jmeter/usermanual/glossary.html">JMeter User's Manual Glossary</a>. The image below displays graphs for Average and Throughput only. The metric values provided at the bottom of the graph apply to the most recent sample.</p>
</li>
<li>
<p>From the green line designating throughput, we see that the server was able to maintain a nearly consistent value as the load increased to 20 users. Toward the end of the test, as user number decreases, we see that the throughput slightly lessens. We can assume that this is simply due to the fact that there are fewer requests per unit of time.</p>
</li>
<li>
<p>While the vertical line of the graph represents time (in milliseconds), this doesn&#8217;t apply to the throughput measurement (nor the measurement for standard deviation, for that matter). The throughput represents the number of requests the server processes during the total time which the test plan runs. In the image below, note that the throughput value listed at the bottom of the graph is: <code>577.496/minute</code>. Switching to the Summary Report, the total throughput value is listed as: <code>9.6/second</code>. The two values equate: <code>577.496/60 = 9.6</code>.</p>
</li>
<li>
<p>The blue line, designating the average time (in milliseconds), increases dramatically at the end of the test. If you examine the final request samples in the View Results Tree, you can get an idea why. The final samples taken are all <code>/checkout</code> and <code>/purchase</code> requests, which as we&#8217;ve already seen, take much longer than the other requests in the test plan.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/graph-results.png" alt="graph results">
</div>
<div class="title">Figure 20. Graph Results shows a graph that plots all sample times</div>
</div>
</div>
<div class="sect2">
<h3 id="stressTest"><a class="anchor" href="#stressTest"></a>Stress Testing</h3>
<div class="paragraph">
<p>In the tests we&#8217;ve so far conducted, the throughput for a single user was calculated at 41/min, and for 20 users it was 577/min. You can continue to increase the demand on the server to see if it&#8217;s possible to determine what the maximum throughput value can be, given your local setup. This is an example of <a href="https://en.wikipedia.org/wiki/Stress_testing">stress testing</a>, in which the system resources are purposely worked to their limits in order to arrive at a maximum capacity value.</p>
</div>
<div class="paragraph">
<p>You can adjust the User Defined Variables, then run the test plan and examine the results. For example, experiment by increasing the number of users, or decreasing the ramp-up period or delay between requests.</p>
</div>
<div class="paragraph">
<p><strong>Important:</strong> When stress testing, you should monitor your computer&#8217;s CPU and memory levels. If you see that JMeter is not able to record results under a specific load and becomes unresponsive, you can try to stop the test by choosing Run &gt; Stop (Ctrl-.; ⌘-. on Mac). Otherwise, if JMeter does not respond, you may need to kill the JMeter process from your computer&#8217;s task manager.</p>
</div>
<div class="paragraph">
<p>The following table lists results recorded in JMeter&#8217;s <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Summary_Report">Summary Report</a>, from increasing the number of users with each test run.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">===</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ramp-up
(seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average
(milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throughput</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error %</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(n/a)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">41/min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">577/min</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22.2/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.3/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">44.1/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">52.9/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">66.0/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">87.5/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">109.5/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">130.1/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">350</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">150.4/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">164.3/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">450</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">394</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">158.4/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">355</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">182.9/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">550</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">369</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">198.4/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">446</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">206.4/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">650</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">492</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">219.9/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">599</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">225.9/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">750</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">668</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">231.9/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">875</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">225.6/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">850</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">976</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">230.5/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">900</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1258</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">220.9/sec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">950</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1474</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">215.8/sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.00%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1966</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">190.8/sec</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes and observations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maximum throughput was recorded at 231.9/sec for 750 users. Throughput is generally much quicker for requests in the first part of the test plan, and then decreases as <code>/checkout</code> and <code>/purchase</code> requests are served. Because the elapsed time for these requests begins to dramatically increase beyond 750 users, the overall throughput begins to decrease beyond this number.</p>
</li>
<li>
<p>When testing for 500 users, JMeter became unresponsive and it was necessary to shut it down from the task manager. It is likely that JMeter was running out of memory to record and display results for the <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Graph_Results">Graph Results</a> and <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#View_Results_Tree">View Results Tree</a> listeners. These two listeners were removed from the test plan, and results for 500 - 1000 users were then recorded using the <a href="http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Summary_Report">Summary Report</a> listener only.</p>
</li>
<li>
<p>In all tests, the <code>Error</code> <code>%</code> column remained at <code>0.00%</code>. The server was able to successfully respond to all requests, even when the computer&#8217;s CPU levels were at a maximum, and JMeter was lagging in its ability to display results. This would indicate that the bottleneck in these tests was the computer&#8217;s processing resources. (The computer had available memory for all tests.)</p>
</li>
<li>
<p>The Average represents the average elapsed time (in milliseconds) for all requests serviced in the test plan. While the average values for the most demanding tests were still under 2 seconds, the Summary Report&#8217;s Maximum values recorded for elapsed time were much higher, reaching nearly 70 seconds for the <code>/purchase</code> request. When determining what resources are required for a normal load, consider that these results do not include network time, and that most users are willing to wait at most 4 - 8 seconds for a response.<sup><a href="#footnote2">[2]</a></sup></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the production server is on a machine that has resources similar to those of your development environment, and assuming your computer is not running other CPU-intensive processes while tests are conducted, you can get a rough idea of how many users can be served by examining your computer&#8217;s CPU usage during tests. For example, if it has been decided that CPU levels for normal and peak loads will be approximately 30% and 70%, respectively, you can watch the CPU monitor as you increase the number of users with each run of the test plan. The following images suggest 150 users could be served during a normal load, and 400 during a peak load.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>CPU levels for 150 users</strong></th>
<th class="tableblock halign-left valign-top"><strong>CPU levels for 400 users</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/150-users.png" alt="150 users" title="CPU levels when running the test with 150 users"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/400-users.png" alt="400 users" title="CPU levels when running the test with 400 users"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Keep in mind that when running tests in this manner, your local server is competing with JMeter for the computer&#8217;s resources. Eventually, you&#8217;ll want to test your production server remotely to get more accurate results. See the following resources for more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://jakarta.apache.org/jmeter/usermanual/remote-test.html">JMeter User's Manual: 15. Remote Testing</a></p>
</li>
<li>
<p><a href="http://jakarta.apache.org/jmeter/usermanual/jmeter_distributed_testing_step_by_step.pdf">JMeter Distributed Testing Step-by-Step</a> [pdf]</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profile"><a class="anchor" href="#profile"></a>Using the NetBeans Profiler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NetBeans Profiler is an <a href="http://www.developer.com/java/other/article.php/3795991/Winners-of-the-Developercom-Product-of-the-Year-2009-Are-Announced.htm">award winning</a> development utility that enables you to profile and monitor your application&#8217;s CPU and memory usage, and thread status. The Profiler is an integral component of the IDE, and offers a click-of-the-button profiling environment that aids you when handling memory and performance-related issues. For an overview of the Profiler&#8217;s features, see <a href="#front::features/java/profiler.adoc" class="xref unresolved">NetBeans IDE 6.9 Features: Profiler</a>.</p>
</div>
<div class="paragraph">
<p>When profiling web applications, you can use the Profiler to work in tandem with a load script, such as a test plan created in JMeter. Often, problems start to arise only after your application has been running in a host environment for a certain period of time, and has begun serving multiple concurrent requests. In order to get an idea of how the application will perform before it is migrated to a production environment, you can launch the Profiler, run a test script on the application, and examine the results in the Profiler&#8217;s interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#memoryLeaks">About Memory Leaks</a></p>
</li>
<li>
<p><a href="#monitoring">Monitoring your Application</a></p>
</li>
<li>
<p><a href="#heapWalker">Evaluating Heap Contents with the HeapWalker</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="memoryLeaks"><a class="anchor" href="#memoryLeaks"></a>About Memory Leaks</h3>
<div class="paragraph">
<p>In Java, memory leaks occur when objects continue to be referenced even after they are no longer needed. This prevents Java&#8217;s built-in garbage collection mechanism from destroying these objects, and consequently they remain in existence throughout the life of your application. When these objects are regularly created, the Java Virtual Machine (JVM) <em>heap</em> will continue to grow over time, ultimately resulting in an <code>OutOfMemoryError</code> when the heap is eventually exhausted.</p>
</div>
<div class="paragraph">
<p>The JVM heap represents memory that is dynamically allocated by the Virtual Machine during runtime. Because the GlassFish server runs on Java, it relies on the JVM heap for memory resources during execution. All applications that are deployed to the server can be perceived as extensions to this rule; in other words when your web application runs, it consumes resources from the JVM heap.</p>
</div>
<div class="paragraph">
<p>When building web applications, you need to be mindful of memory allocation. Aside from avoiding memory leaks in your code, you must ensure that the JVM heap is large enough to accommodate all user sessions at a given time, and that your system is able to support the maximum heap size set by your server.</p>
</div>
</div>
<div class="sect2">
<h3 id="monitoring"><a class="anchor" href="#monitoring"></a>Monitoring your Application</h3>
<div class="paragraph">
<p>The following example aims to familiarize you with the Profiler&#8217;s interface, and demonstrates how you can utilize its functionality to ensure that the <code>AffableBean</code> application will continue to perform efficiently after it has been serving client requests for some time. In this example, you download and add a new JMeter test plan, <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FuseCaseTestRandom.jmx">`useCaseTestRandom.jmx`</a>, to the project. The new test plan is an advanced version of the one you created earlier in this unit. It makes use of JMeter&#8217;s conditional and random controllers to adapt a slightly more realistic simulation of the tutorial&#8217;s use-case.</p>
</div>
<div class="paragraph">
<p>Consider that only a small fraction of visits to an e-commerce site will result in a completed order. If you recall from units 8 and 9, <a href="../manage-sessions/" class="xref page">Managing Sessions</a> and <a href="../transaction/" class="xref page">Integrating Transactional Business Logic</a>, the application terminates the user session upon a successfully completed order. In other words, with each completed order, the server is able to free up any resources that were previously tied to the session. Now, consider the far more common scenario of a user not completing an order, but simply navigating away from the site. Based on the session time-out which you specified in the application&#8217;s web deployment descriptor, the server will need to wait a period of time before it can free any resources tied to the session. The new load script, <code>useCaseTestRandom.jmx</code>, is configured so that on average one in ten user threads completes an order. Our goal by running this load script is to determine whether the application&#8217;s host environment (i.e., the GlassFish server running locally on your computer) has enough memory capacity to provide continuous, fast service for an extended period of time.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Recall that in <a href="../manage-sessions/#time-out" class="xref page">Managing Sessions: Handling Session Time-Outs</a>, you set the <code>AffableBean</code> session time-out to 10 minutes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FuseCaseTestRandom.jmx">`useCaseTestRandom.jmx`</a> and add it to the <code>AffableBean</code> project. To add it to the project, copy it from your computer&#8217;s file system (Ctrl-C; ⌘-C on Mac), then in the IDE, open the Files window (Ctrl-2; ⌘-2 on Mac), right-click the <code>jmeter</code> folder and choose Paste.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/files-window.png" alt="files window">
</div>
<div class="title">Figure 21. JMeter test plans contained in 'jmeter' folder within project</div>
</div>
<div class="paragraph">
<p><strong>NetBeans 6.8 note:</strong> The <code>useCaseTestRandom.jmx</code> script is not compatible with the JMeter Kit plugin for NetBeans 6.8. Because the script utilizes various logic controllers which unfortunately are not available in JMeter version 2.2, it will not run on the JMeter implementation in NetBeans 6.8. In order to become familiar with the Profiler, use <code>useCaseTest.jmx</code> in this exercise instead. If you use <code>useCaseTest.jmx</code>, you need to set the load script to run continuously. To do so, open the script in JMeter, select the <code>AffableBeanUsers</code> thread group, then in the main panel, select the 'Forever' checkbox for the Loop Count field.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>If you are running the Profiler for the first time, you need to perform a calibration step on the JDK. To do so, choose Profile &gt; Advanced Commands &gt; Run Profiler Calibration. For more information, refer to the NetBeans User FAQ wiki: <a href="#wiki::wiki/FaqProfilerCalibration.adoc" class="xref unresolved">What exactly does the Profiler Calibration mean?</a>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click the Profile Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/profile-btn.png" alt="profile btn"></span> ) button. When a project is profiled for the first time, its build script must be modified to enable profiling. The IDE warns you that it will modify the project&#8217;s build script.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/enable-profiling.png" alt="enable profiling">
</div>
<div class="title">Figure 22. The project build script must be modified to enable profiling</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> You can undo this action at a later point by choosing Profile &gt; Advanced Commands &gt; Unintegrate Profiler from the main menu. Alternatively, you can switch to the Files window, delete your project&#8217;s <code>build.xml</code> file, then rename the <code>build-before-profiler.xml</code> file to <code>build.xml</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click OK. The project&#8217;s build file is modified, and the Profiler window opens for the project. The window enables you to select from one of three profiling tasks:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Monitor Application:</strong> Provides obtain high-level information about properties of the target JVM, including thread activity and memory allocations.</p>
</li>
<li>
<p><strong>Analyze Performance:</strong> Provides detailed data on application performance, including the time to execute methods and the number of times the method is invoked.</p>
</li>
<li>
<p><strong>Analyze Memory:</strong> Provides detailed data on object allocation and garbage collection.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click the Monitor button in the left column. Select the 'LoadGenerator Script' option, then choose <code>useTestCaseRandom.jmx</code> from the drop-down list.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/monitor-application.png" alt="monitor application">
</div>
<div class="title">Figure 23. Profiler window opens, enabling task selection and configuration</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click Run. The IDE takes the following actions:</p>
<div class="ulist">
<ul>
<li>
<p>Starts the GlassFish server in profile mode. (If the server is already running, it is first stopped.)</p>
</li>
<li>
<p>Deploys the web application to GlassFish.</p>
</li>
<li>
<p>Starts a profiling session, attaches the profiler to the server, and opens the Profiler Control Panel in the IDE.</p>
</li>
<li>
<p>Runs the associated load script (<code>useTestCaseRandom.jmx</code>).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If the profiler does not run the load script after starting the application in profile mode, you can invoke it yourself. From the Projects window, right-click the script and choose External Edit. Then, in JMeter, press Ctrl-R (⌘-R on Mac) to run the script. If the left-hand graph displayed by the VM Telemetry Overview depicts the purple area as remaining horizontal (shown below), you can be fairly certain that the load script is not running.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/vm-telemetry-overview-heap.png" alt="vm telemetry overview heap">
</div>
<div class="title">Figure 24. The server is loaded, but the load script is not running</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>In the Profiler Control Panel, click the Threads ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/threads-btn.png" alt="threads btn"></span> ) button. The Threads window opens to display all threads maintained by the server while the application is running. You can select Live Threads Only, or Finished Threads Only in drop-down at the top of the window in order to filter the display according to live or finished threads.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/live-threads.png" alt="live threads">
</div>
<div class="title">Figure 25. View live threads maintained by the server at runtime</div>
</div>
<div class="paragraph">
<p>You can select the Enable Threads Monitoring option in the Profiler window (displayed <a href="#profilerWindow">above</a>). This will trigger the Threads window to open by default when running the Profiler.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>In the Profiler Control Panel, click the VM Telemetry ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/vm-telemetry-btn.png" alt="vm telemetry btn"></span> ) button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Similar to the VM Telemetry Overview, the VM Telemetry window provides views on the JVM heap, garbage collection (GC), as well as threads and loaded classes.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Ensure that the Memory (Heap) tab is selected at the bottom of the window, then allow the Profiler to monitor the heap while the load script runs against the application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can hover your cursor over the graph to view real-time measurements of the heap size versus the used heap.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/heap-popup.png" alt="heap popup">
</div>
<div class="title">Figure 26. Hover your cursor over the graph for a real-time display of heap measurements</div>
</div>
<div class="paragraph">
<p>Click the Scale to Fit ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/scale-to-fit-btn.png" alt="scale to fit btn"></span> ) button above the graph to maintain a continuous view of the entire monitoring session.</p>
</div>
<div class="paragraph">
<p>The image below shows the state of the heap after monitoring the server for approximately three hours while running the <code>useTestCaseRandom.jmx</code> script continuously with 150 simultaneous users. The <code>AffableBean</code> application running on the GlassFish server uses under 175 MB of the JVM heap.</p>
</div>
</div>
<div class="sect2">
<h3 id="heapWalker"><a class="anchor" href="#heapWalker"></a>Evaluating Heap Contents with the HeapWalker</h3>
<div class="paragraph">
<p>The HeapWalker is a tool that is built into the NetBeans Profiler, which allows you to examine JVM heap contents. You can use it to browse classes and instances of classes on the heap, fields of each instance or class, and references to each instance.</p>
</div>
<div class="paragraph">
<p>The HeapWalker is particularly useful when locating the cause of memory leaks in your code. You can set the Profiler to automatically take a heap dump if an <code>OutOfMemoryError</code> occurs when you are profiling an application. You can then use the HeapWalker to inspect the heap dump and determine which objects were consuming the most memory.</p>
</div>
<div class="paragraph">
<p>This functionality is enabled by default, but you can view and modify Profiler settings from the IDE&#8217;s Options window (Tools &gt; Options; NetBeans &gt; Preferences on Mac). From the Options window, select Miscellaneous, then select the Profiler tab. In the On OutOfMemoryError field, note that 'Save heap dump to profiled project' option is selected.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/profiler-options.png" alt="profiler options">
</div>
<div class="title">Figure 27. A heap dump is taken by default if the JVM runs out of memory for the profiled application</div>
</div>
<div class="paragraph">
<p>For example, if the GlassFish server utilizes 512 MB of memory, and the JVM attempts to allocate more than 512 MB of memory to the JVM heap (represented by the pink area in the heap size graph of the VM Telemetry monitor, <a href="#vmTelemetryMonitor">shown above</a>), an <code>OutOfMemoryError</code> will occur, and the IDE will ask you if you would like to view the heap in the HeapWalker.</p>
</div>
<div class="paragraph">
<p>To take a heap dump while your application is being profiled, choose Profile &gt; Take Heap Dump from the main menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/take-heap-dump.png" alt="take heap dump">
</div>
<div class="title">Figure 28. To take a heap dump, choose Profile &gt; Take Heap Dump from the main menu</div>
</div>
<div class="paragraph">
<p>The following example depicts a heap dump from running the <code>useCaseTestRandom.jmx</code> script at 500 users, ramp-up period at 100 seconds, and with a loop count of 5. The HeapWalker&#8217;s Summary provides an Inspect panel which enables you to locate the largest objects in the heap. Specify the number of objects you want to search for, then click Find.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/inspect-heap.png" alt="inspect heap">
</div>
<div class="title">Figure 29. Use the Inspect panel to determine the largest objects in the heap</div>
</div>
<div class="paragraph">
<p>In the above image, you can see that for the <code>AffableBean</code> application, the largest object in the heap dump is an instance of the <code>org.apache.catalina.session.StandardManager</code> class, with a retained size of nearly 79 MB.</p>
</div>
<div class="paragraph">
<p>Clicking the object name enables you to open the Instances view on the object. When you do so, you can see the instances of the class that exist on the heap (left column), the fields contained in the class, and their values (right column, top), and other objects on the heap referring to the instance (right column, bottom).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/instances-view.png" alt="instances view">
</div>
<div class="title">Figure 30. Use the Instances view to examine class instances, their fields and references</div>
</div>
<div class="paragraph">
<p>In the above image, it appears that 706 <code>StandardSession</code> objects were active on the heap, a result of the load script simulating multiple user sessions. The server must have sufficient memory resources to maintain session objects during periods of high traffic.</p>
</div>
<div class="paragraph">
<p>You can save (Ctrl-S; ⌘-S on Mac) heap dumps. When you do so, they become listed in the Profiler Control Panel under Saved Snapshots.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/saved-snapshots.png" alt="saved snapshots">
</div>
<div class="title">Figure 31. Saved heap dumps can be loaded from the Profiler Control Panel</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glassFishTune"><a class="anchor" href="#glassFishTune"></a>Tuning the GlassFish Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to gain optimum performance for your application when it is deployed to GlassFish, you should become acquainted with various tuning parameters which can be adjusted from the Administration Console. The following tips are taken directly from the white paper, <a href="https://www.sun.com/offers/details/OptimizeGlassFishPerformance.xml">Optimize GlassFish Performance in a Production Environment</a>. Although the paper focuses on GlassFish v2, the tuning tips can be directly applied to GlassFish v3 or Open Source Edition 3.0.1.</p>
</div>
<div class="paragraph">
<p>There are various mapping changes that occurred between GlassFish v2 and v3. Tables listing changes are provided on the GlassFish wiki: <a href="http://wikis.sun.com/display/GlassFish/GrizzlyConfigOnePager">GrizzlyConfig One Pager</a>.</p>
</div>
<div class="paragraph">
<p>The GlassFish Administration Console can be accessed from the IDE&#8217;s Services window:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Services window (Ctrl-5; ⌘-5 on Mac) and expand the Servers node so that the GlassFish server node is visible.</p>
</li>
<li>
<p>Ensure that the GlassFish server is running. If the server is running, a small green arrow is displayed next to the GlassFish icon ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/gf-server-running-node.png" alt="gf server running node"></span> ). If you need to start it, right-click the server node and choose Start.</p>
</li>
<li>
<p>Right-click the GlassFish server node and choose View Admin Console. The login form for the GlassFish Administration Console opens in a browser.</p>
</li>
<li>
<p>Log into the Administration Console by typing <code>admin</code> / <code>adminadmin</code> for the username / password.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From the GlassFish Administration Console, you can view and make adjustments to the following parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#tip3">Tip 3: Java Heap Size</a></p>
</li>
<li>
<p><a href="#tip6">Tip 6: HTTP Request Processing Threads</a></p>
</li>
<li>
<p><a href="#tip10">Tip 10: JDBC Tuning</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="tip3"><a class="anchor" href="#tip3"></a>Tip 3: Java Heap Size</h3>
<div class="paragraph">
<p>From <a href="https://www.sun.com/offers/details/OptimizeGlassFishPerformance.xml">Optimize GlassFish Performance in a Production Environment</a>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The size of the heap is determined by the Java options -Xmx (maximum) and -Xms (minimum). While a larger heap can contain more objects and reduce the frequency of garbage collection, it may result in longer garbage collection times especially for a full GC cycle. The recommendation is to tune the heap based on the size of total available memory in your system, process data model (32-bit or 64-bit) and operating system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Tree which displays in the left column of the Administration Console, expand the Configuration node, then click JVM Settings.</p>
</li>
<li>
<p>In the main panel, select the JVM Options tab.</p>
</li>
<li>
<p>Scroll the list of options and note the <code>-Xmx</code> option:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">-Xmx512m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The GlassFish server (v3 and Open Source Edition 3.0.1) sets the heap to 512 MB by default. If you wanted to increase the heap size to 1 GB, you would enter &#8216;-Xmx1024m&#8217;, click the Save button in the upper right corner, and then restart the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="tip6"><a class="anchor" href="#tip6"></a>Tip 6: HTTP Request Processing Threads</h3>
<div class="paragraph">
<p>From the <a href="http://docs.sun.com/app/docs/doc/819-3681/abefm">Sun Java System Application Server 9.1 Performance Tuning Guide</a>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The [Max Thread Pool Size] parameter specifies the maximum number of simultaneous requests the server can handle. The default value is 5. When the server has reached the limit or request threads, it defers processing new requests until the number of active requests drops below the maximum amount. Increasing this value will reduce HTTP response latency times.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In practice, clients frequently connect to the server and then do not complete their requests. In these cases, the server waits a length of time specified by the Idle Thread Timeout parameter._ [900 seconds, i.e., 15 minutes, is the default entry for GlassFish v3 and Open Source Edition 3.0.1.]</p>
</div>
<div class="paragraph">
<p>_Also, some sites do heavyweight transactions that take minutes to complete. Both of these factors add to the maximum simultaneous requests that are required. If your site is processing many requests that take many seconds, you might need to increase the number of maximum simultaneous requests.</p>
</div>
<div class="paragraph">
<p>Adjust the thread count value based on your load and the length of time for an average request. In general, increase this number if you have idle CPU time and requests that are pending; decrease it if the CPU becomes overloaded. If you have many HTTP 1.0 clients (or HTTP 1.1 clients that disconnect frequently), adjust the timeout value to reduce the time a connection is kept open.</p>
</div>
<div class="paragraph">
<p>Suitable Request Thread Count values range from 100 to 500, depending on the load. If your system has extra CPU cycles, keep incrementally increasing thread count and monitor performance after each incremental increase. When performance saturates (stops improving), then stop increasing thread count._</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Console Tree, expand the Configuration node, then click Thread Pools.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The GlassFish server provides two thread pools by default. The <code>http-thread-pool</code> thread pool is configured for use by network listeners, while <code>thread-pool-1</code> is configured for use by the ORB (object request broker) for RMI/IIOP requests. (A stand-alone web application deployed over a non-distributed environment, such as the <code>AffableBean</code> application, relies on the <code>http-thread-pool</code> by default.)</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Under the Thread Pool ID column, click <code>http-thread-pool</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In the <strong>Max Thread Pool Size</strong> field, adjust the maximum number of threads available to the thread pool.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the Save button in the upper right corner, and then restart the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="tip10"><a class="anchor" href="#tip10"></a>Tip 10: JDBC Tuning</h3>
<div class="paragraph">
<p>From <a href="https://www.sun.com/offers/details/OptimizeGlassFishPerformance.xml">Optimize GlassFish Performance in a Production Environment</a>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application uses Java DataBase Connectivity (JDBC) software for database access, it may be beneficial to tune your database connection pool. A general rule of thumb is to tune the value for <code>max-pool-size</code> and <code>steady-pool-size</code> to the same number of HTTP request processing threads. If your JDBC driver supports this feature, it is advisable to use JDBC drivers that use statement caching to re-use prepared statements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Console Tree, expand the Resources &gt; JDBC &gt; Connection Pools node, then click the <code>AffableBeanPool</code> node.</p>
</li>
<li>
<p>In the General tab under Pool Settings, specify values for the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Initial and Minimum Pool Size:</strong> (<code>steady-pool-size</code>) Minimum and initial number of connections maintained in the pool.</p>
</li>
<li>
<p><strong>Maximum Pool Size:</strong> (<code>max-pool-size</code>) Maximum number of connections that can be created to satisfy client requests.</p>
</li>
<li>
<p><strong>Pool Resize Quantity:</strong> (<code>pool-resize-quantity</code>) Number of connections to be removed when pool idle timeout expires.</p>
</li>
<li>
<p><strong>Idle Timeout:</strong> (<code>idle-timeout-in-seconds</code>) Maximum time that connection can remain idle in the pool.</p>
</li>
<li>
<p><strong>Max Wait Time:</strong> (<code>max-wait-time-in-millis</code>) Amount of time caller waits before connection timeout is sent.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click the Save button in the upper right corner, and then restart the server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Connection pool settings can also be specified in the <code>sun-resources.xml</code> descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;jdbc-connection-pool *max-pool-size*="32"
                      *steady-pool-size*="8"
                      *pool-resize-quantity*="2"
                      *idle-timeout-in-seconds*="300"
                      *max-wait-time-in-millis*="60000"&gt;
    ...
&lt;/jdbc-connection-pool&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso"><a class="anchor" href="#seeAlso"></a>See Also</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_netbeans_resources"><a class="anchor" href="#_netbeans_resources"></a>NetBeans Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://profiler.netbeans.org/">NetBeans Profiler</a> [product page]</p>
</li>
<li>
<p><a href="#front::features/java/profiler.adoc" class="xref unresolved">NetBeans Profiler Features</a></p>
</li>
<li>
<p><a href="../../../java/profiler-profilingpoints/" class="xref page">Using Profiling Points</a></p>
</li>
<li>
<p><a href="http://profiler.netbeans.org/docs/help/6.0/heapwalker.html">Using HeapWalker</a></p>
</li>
<li>
<p><a href="#wiki::wiki/HeapWalkerDemo.adoc" class="xref unresolved">HeapWalker Demo</a></p>
</li>
<li>
<p><a href="../../../java/profile-loadgenerator/" class="xref page">Using a Load Generator</a></p>
</li>
<li>
<p><a href="../../profiler-javaee/" class="xref page">Profiling an Enterprise Application</a></p>
</li>
<li>
<p><a href="../../../java/profiler-intro/" class="xref page">Introduction to Profiling Java Applications</a></p>
</li>
<li>
<p><a href="#front::articles/nb-profiler-uncoveringleaks_pt1.adoc" class="xref unresolved">Uncovering Memory Leaks Using NetBeans Profiler</a></p>
</li>
<li>
<p><a href="#front::community/magazine/html/04/profiler.adoc" class="xref unresolved">Advanced Profiling: Theory in Practice with NetBeans</a></p>
</li>
<li>
<p><a href="https://netbeans.org/download/magazine/01/nb01_profiler.pdf">Exploring the NetBeans Profiler</a> [pdf]</p>
</li>
<li>
<p><a href="https://channelsun.sun.com/media/show/14757?n=playlist&amp;nid=81">The New NetBeans IDE 6 Profiler</a> [screencast]</p>
</li>
<li>
<p><a href="https://netbeans.org/project_downloads/www/flashdemo/profiler-demo1.swf">Getting Started with NetBeans Profiler 5.0</a> [screencast]</p>
</li>
<li>
<p><a href="https://netbeans.org/project_downloads/www/flashdemo/profiler-demo2.swf">Performance Profiling with NetBeans Profiler 5.0</a> [screencast]</p>
</li>
<li>
<p><a href="http://www.javapassion.com/handsonlabs/javatestjmeter/index.html">JavaPassion LAB 5116: Finding Memory Leaks Using the NetBeans Profiler</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jmeter"><a class="anchor" href="#_jmeter"></a>JMeter</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://jakarta.apache.org/jmeter/">Apache JMeter</a> [product homepage]</p>
</li>
<li>
<p><a href="http://jakarta.apache.org/jmeter/usermanual/index.html">Apache JMeter: User's Manual</a></p>
</li>
<li>
<p><a href="http://jakarta.apache.org/jmeter/usermanual/jmeter_distributed_testing_step_by_step.pdf">jMeter Distributed Testing</a> [pdf]</p>
</li>
<li>
<p><a href="http://www.javapassion.com/handsonlabs/javatestjmeter/index.html">JavaPassion LAB 1077: JMeter Load Testing</a></p>
</li>
<li>
<p><a href="http://vimeo.com/3453772">Apache JMeter Getting Started Tutorial</a> [screencast]</p>
</li>
<li>
<p><a href="https://www.packtpub.com/beginning-apache-jmeter/book">Apache JMeter</a> [book]</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_glassfish_performance"><a class="anchor" href="#_glassfish_performance"></a>GlassFish Performance</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/performance/reference/whitepapers/tuning.html">Java Tuning White Paper</a></p>
</li>
<li>
<p><a href="http://www.google.co.uk/url?sa=t&amp;source=web&amp;cd=3&amp;ved=0CCMQFjAC&amp;url=http%3A%2F%2Fdeveloper.connectopensource.org%2Fdownload%2Fattachments%2F29851654%2FGlassFishDay2008PerfPreso.pdf&amp;rct=j&amp;q=Tuning%20GlassFish%20Performance%20Tips%20Deep%20Singh&amp;ei=ru7WTNjUPIWUjAenyZTHCQ&amp;usg=AFQjCNHLz1wnaG7h-ey6wsPOOIxV-xoDzA&amp;sig2=aNoCg9O132PgIQ0eWmHx6g&amp;cad=rja">Tuning Your GlassFish - Performance Tips</a> [pdf]</p>
</li>
<li>
<p><a href="https://www.sun.com/offers/details/OptimizeGlassFishPerformance.xml">Optimize GlassFish Performance in a Production Environment</a> [pdf]</p>
</li>
<li>
<p><a href="http://dlc.sun.com/pdf/819-3681/819-3681.pdf">Sun Java System Application Server 9.1 Performance Tuning Guide</a> [pdf]</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#1">^</a> Actually, in JMeter version 2.4, using the HTTP Proxy Server to record HTTPS requests should be possible. See the JMeter User&#8217;s Manual, <a href="http://jakarta.apache.org/jmeter/usermanual/get-started.html#opt_ssl">2.2.4 SSL Encryption</a> for more details.</p>
</li>
<li>
<p><a href="#2">^</a> The acceptable response time for retail web page response times is debatable, but general concensus seems to waver between 4 and 8 seconds. For example, see:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://answers.google.com/answers/threadview/id/716510.html">Google Answers: E-Commerce Site Speed Industry Standards</a></p>
</li>
<li>
<p><a href="http://www.conversionchronicles.com/The_Billion-Dollar_Question_-_What_is_the_Impact_of_Web_Site_Performance_on_E-commerce.html">Conversion Chronicles: What is the Impact of Web Site Performance on E-commerce?</a></p>
</li>
<li>
<p><a href="http://www.akamai.com/html/about/press/releases/2006/press_110606.html">Akamai and JupiterResearch Identify '4 Seconds' as the New Threshold of Acceptability for Retail Web Page Response Times</a></p>
</li>
<li>
<p><a href="http://www.websiteoptimization.com/speed/1/">Response Time: Eight Seconds, Plus or Minus Two</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/test-profile.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../../_/css/search.css"></script>
<script async src="../../../../../../../search-index.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
