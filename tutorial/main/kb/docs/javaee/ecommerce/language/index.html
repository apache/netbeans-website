<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>The NetBeans E-commerce Tutorial - Adding Language Support</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The NetBeans E-commerce Tutorial - Adding Language Support - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, The NetBeans E-commerce Tutorial - Adding Language Support">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../../../../index.html"><img src='../../../../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <article class="doc">
      <h1 class="sect0">The NetBeans E-commerce Tutorial - Adding Language Support</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/language.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#resourceBundles">Understanding Resource Bundles</a></li>
<li><a href="#multilingual">Making Pages Multilingual</a>
<ul class="sectlevel2">
<li><a href="#createResource">Create Resource Bundles</a></li>
<li><a href="#register">Register the Resource Bundle with the Application</a></li>
<li><a href="#replace">Replace Hard-Coded Text with <code>&lt;fmt:message&gt;</code> Tags</a></li>
<li><a href="#test">Test Supported Languages</a></li>
</ul>
</li>
<li><a href="#toggle">Implementing a Language Toggle</a>
<ul class="sectlevel2">
<li><a href="#toggleDisplay">Create Toggle Display and Synchronize with the Browser&#8217;s Preferred Language</a></li>
<li><a href="#handleRequest">Implement Functionality to Handle a Request from the Language Toggle</a></li>
<li><a href="#keepTrack">Enable the Application to Keep Track of the Originating Page View</a></li>
</ul>
</li>
<li><a href="#seeAlso">See Also</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_resources">NetBeans Resources</a></li>
<li><a href="#_external_resources">External Resources</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The goal of this tutorial unit is to demonstrate how to enable language support for a web application. "Language support" here refers to the ability to display page views according to the customer-specified languages. Within the context of the <code>AffableBean</code> application, we have agreed to provide support for both English and Czech, as per the previously outlined <a href="../design/#requirements" class="xref page">customer requirements</a>.</p>
</div>
<div class="paragraph">
<p>In order to accomplish this, you rely on Java&#8217;s support for internationalization. You create a <em>resource bundle</em> for each language and let the Java runtime environment determine the appropriate language for incoming client requests. You also implement a 'language toggle' to enable users to switch the languages manually.</p>
</div>
<div class="paragraph">
<p>The NetBeans IDE provides special support for localizing application content. This includes a Customizer dialog that enables you to add new locales to an existing resource bundle base name, as well as a special Properties editor that lets you view and edit key-value pairs for all locales in a table layout. These are both utilized in this tutorial.</p>
</div>
<div class="paragraph">
<p>You can view a live demo of the application that you build in this tutorial: <a href="http://services.netbeans.org/AffableBean/">NetBeans E-commerce Tutorial Demo Application</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software or Resource</th>
<th class="tableblock halign-left valign-top">Version Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../../../../../../../front/main/download/" class="xref page">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java bundle, 6.8 or 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">GlassFish server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 or Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQL database server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">AffableBean project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot9.zip">AffableBean project</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot 9</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NetBeans IDE requires the Java Development Kit (JDK) to run properly. If you do not have any of the resources listed above, the JDK should be the first item that you download and install.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle includes Java Web and EE technologies, which are required for the application you build in this tutorial.</p>
</li>
<li>
<p>The NetBeans IDE Java Bundle also includes the GlassFish server, which you require for this tutorial. You could <a href="http://glassfish.dev.java.net/public/downloadsindex.html">download the GlassFish server independently</a>, but the version provided with the NetBeans download has the added benefit of being automatically registered with the IDE.</p>
</li>
<li>
<p>You can follow this tutorial unit without having completed previous units. To do so, see the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resourceBundles"><a class="anchor" href="#resourceBundles"></a>Understanding Resource Bundles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Java, a resource bundle is a representation of the <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/util/ResourceBundle.html">`java.util.ResourceBundle`</a> class. As stated in the Javadoc,</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>_Resource bundles contain locale-specific objects. When your program needs a locale-specific resource, a String for example, your program can load it from the resource bundle that is appropriate for the current user&#8217;s locale. In this way, you can write program code that is largely independent of the user&#8217;s locale isolating most, if not all, of the locale-specific information in resource bundles.</p>
</div>
<div class="paragraph">
<p>This allows you to write programs that can:_</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>be easily localized, or translated, into different languages</em></p>
</li>
<li>
<p><em>handle multiple locales at once</em></p>
</li>
<li>
<p><em>be easily modified later to support even more locales</em></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the Javadoc, you can also note that the <code>ResourceBundle</code> is parent to both <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/util/ListResourceBundle.html">`ListResourceBundle`</a> and <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/util/PropertyResourceBundle.html">`PropertyResourceBundle`</a>. In this tutorial we utilize the <code>PropertyResourceBundle</code>, which manages resources as text files that use the <code>.properties</code> extension and contain locale-specific information in the form of key-value pairs. With new each translation, a new version of the resource bundle is created by appending the locale identifier to the base name using an underscore (&#8216;_&#8217;). For example, snippets from two of the resource bundles you create in this tutorial look as follows:</p>
</div>
<div class="paragraph">
<p><strong>messages_en.properties</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">meats=meats
bakery=bakery</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>messages_cs.properties</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">meats=maso
bakery=pečivo</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, &#8216;messages&#8217; represents the base name, and the locale identifier is the two-letter code which is appended using an underscore. (i.e., &#8216;en&#8217; for English, &#8216;cs&#8217; for Czech). The two-letter codes are derived from the international <a href="https://en.wikipedia.org/wiki/ISO_639">ISO 639</a> standard, which lists codes that represent the names of languages. The ISO 639 standard is adopted by the <a href="http://www.w3.org/International/">W3C Internationalization Activity</a> and is used by all major browsers (these are the codes understood in the <code>Accept-Language</code> HTTP header). It is also internalized in the <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/util/Locale.html">`java.util.Locale`</a> class.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multilingual"><a class="anchor" href="#multilingual"></a>Making Pages Multilingual</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Returning to the <code>AffableBean</code> application, after continued discussions with the customer you&#8217;ve agreed on the following implementation details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The website initially displays based on the preferred language of the user&#8217;s browser.</p>
</li>
<li>
<p>If the browser&#8217;s preferred language is neither English nor Czech, the site displays text in English.</p>
</li>
<li>
<p>The user has the option of changing the language by means of a 'language toggle' in the page header.</p>
</li>
<li>
<p>When using the language toggle to change the language, the user remains in the same page view.</p>
</li>
<li>
<p>The language toggle should not appear for the confirmation page, as a user will already have selected his or her language prior to checkout.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to implement the above points, divide the task into two parts. Start by creating basic bilingual support for page views. Once bilingual support is in place, implement the language toggle that enables users to manually switch languages.</p>
</div>
<div class="paragraph">
<p>There are three basic steps that you need to follow to incorporate multilingual support into your web pages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a resource bundle for each language you plan to support.</p>
</li>
<li>
<p>Register the resource bundle with the application by setting a context parameter in the <code>web.xml</code> deployment descriptor.</p>
</li>
<li>
<p>In page views, replace 'hard-coded' text with <code>&lt;fmt:message&gt;</code> tags that reference keys in the resource bundles.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following exercise demonstrates how to integrate English and Czech language support into the <code>AffableBean</code> welcome page by applying the above three steps, and finishes by showing how to test for browser language support using Firefox.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#createResource">Create Resource Bundles</a></p>
</li>
<li>
<p><a href="#register">Register the Resource Bundle with the Application</a></p>
</li>
<li>
<p><a href="#replace">Replace 'Hard-Coded' Text with <code>&lt;fmt:message&gt;</code> Tags</a></p>
</li>
<li>
<p><a href="#test">Test Supported Languages</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="createResource"><a class="anchor" href="#createResource"></a>Create Resource Bundles</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>AffableBean</code> project <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">snapshot 8</a> in the IDE. Click the Open Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/open-project-btn.png" alt="open project btn"></span> ) button and use the wizard to navigate to the location on your computer where you downloaded the project.</p>
</li>
<li>
<p>Click the Run Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) button to run the project and ensure that it is properly configured with your database and application server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you receive an error when running the project, revisit the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Begin by creating a default resource bundle to contain text used in page views. Click the New File ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/new-file-btn.png" alt="new file btn"></span> ) button in the IDE&#8217;s toolbar. (Alternatively, press Ctrl-N; ⌘-N on Mac.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Under Categories select Other, then under File Types select Properties File.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/new-file-wzd.png" alt="new file wzd">
</div>
<div class="title">Figure 1. Create a new resource bundle using the File wizard</div>
</div>
<div class="paragraph">
<p>Note that the wizard provides a description for the selected file type:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Creates a resource bundle (<code>.properties</code>) file suitable for internationalizing applications by separating out all human-visible text strings from your code. Resource bundle files can also be used to collect other types of strings, such as properties for Ant scripts. The created resource bundle contains only one locale, but you can add additional locales from the created file&#8217;s contextual menu. The bundle can be edited in a text file (property-file format) for a specific locale or in a table that displays information for all locales.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click Next. In the Name and Location step, name the file <code>messages</code> and type in <code>src/java/resources</code> in the Folder field. This will instruct the wizard to place the resource bundle in a new package named <code>resources</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/new-properties-file-wzd.png" alt="new properties file wzd">
</div>
<div class="title">Figure 2. Specify the name and location of the resource bundle</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Click Finish. The <code>messages.properties</code> resource bundle is generated and opens in the editor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the new <code>messages.properties</code> file name does not have a language code appended to it, as was previously described. This is because this file will be used as the <em>default</em> resource bundle. The default resource bundle is applied when the Java runtime environment does not find a direct match for the requested locale.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Open the project&#8217;s <code>index.jsp</code> file in the editor and note that the following text is currently used:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Greeting:</strong> <code>Welcome to the online home of the Affable Bean Green Grocer.</code></p>
</li>
<li>
<p><strong>Introductory Message:</strong> <code>Enjoy browsing and learning more about our unique home delivery service bringing you fresh organic produce, dairy, meats, breads and other delicious and healthy items to your doorstep.</code>
Also, note that we&#8217;ll need language-specific names for the four categories that display when <code>index.jsp</code> renders in the browser. Since these names are currently taken from the database, we can use them as keys in the resource bundle.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Recall that one of the <a href="#impDeets">implementation details</a> outlined above states that "<em>if the browser&#8217;s preferred language is neither English nor Czech, the site displays text in English.</em>" Therefore, the values that we apply to the <code>messages.properties</code> file will be in English.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>In the <code>messages.properties</code> file, begin adding key-value pairs for the text used in the welcome page. Add the following content.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"># welcome page
greeting=Welcome to the online home of the Affable Bean Green Grocer.
introText=Our unique home delivery service brings you fresh organic produce, dairy, meats, breads and other delicious and healthy items direct to your doorstep.

# categories
dairy=dairy
meats=meats
bakery=bakery
fruit\ &amp;amp;\ veg=fruit &amp;amp; veg</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comments are added using a number sign (&#8216;#&#8217;). Also, because the <code>fruit &amp; veg</code> category name contains spaces, it is necessary to escape the space characters using a backslash (&#8216;\&#8217;) in order to apply the name as a resource bundle key.</p>
</div>
<div class="paragraph">
<p>We are now finished with the default resource bundle for the application&#8217;s welcome page. Let&#8217;s continue by creating resource bundles for the customer-specified languages.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>In the Projects window, expand the Source Packages node, then right-click the <code>resources</code> &gt; <code>messages.properties</code> file node and choose Customize. The Customizer dialog opens.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the Customizer dialog, click the Add Locale button. In the New Locale dialog that displays, enter &#8216;en&#8217; in the Language Code combo box, then click OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/new-locale-dialog.png" alt="new locale dialog">
</div>
<div class="title">Figure 3. The New Locale dialog enables you to add a new locale to an existing resource bundle base name</div>
</div>
<div class="paragraph">
<p>A <em>locale</em> can be defined by both a language and a geographic region. The optional country code which can be used to specify the region can be applied to define formatting for dates, time, numbers, and currency. For more information, see the technical article, <a href="http://java.sun.com/developer/technicalArticles/J2SE/locale/">Understanding Locale in the Java Platform</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Click the Add Locale button again, then enter &#8216;cs&#8217; in the Language Code combo box and click OK. The Customizer dialog displays as follows.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/customizer-dialog.png" alt="customizer dialog">
</div>
<div class="title">Figure 4. The New Locale dialog enables you to add a new locale to an existing resource bundle base name</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Click Close. In the Projects window, note that your resource bundles look as follows. You can expand a resource bundle to view the keys it contains.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/projects-window.png" alt="projects window">
</div>
<div class="title">Figure 5. View resource bundles and the keys they contain in the Projects window</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Right-click any of the three resource bundles and choose Open. The Properties editor opens, enabling you to view and edit key-value pairs for all locales in a table layout.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/properties-editor.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/properties-editor.png" alt="properties editor"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Press Shift-Esc to maximize the window in the IDE.</p>
</div>
<div class="paragraph">
<p>Note that when you add a new locale using the Customizer dialog, as you did for English and Czech in the previous steps, the keys and values of the default resource bundle are copied to the new locale.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Modify the values for the Czech resource bundle. You can do this by <em>either</em> clicking into the table cells for each row and typing your entries directly <em>or</em> selecting the cell you want to edit and typing into the <strong>Value</strong> field located at the bottom of the Properties editor.</p>
<div class="ulist">
<ul>
<li>
<p><strong>greeting:</strong> <code>Vítejte v našem domácím on-line obchodě Affable Bean Green Grocer.</code></p>
</li>
<li>
<p><strong>introText:</strong> <code>Naše jedinečná dodávková služba Vám zajistí dopravu čerstvých organických produktů, mléčných výrobků, uzenin, pečiva a dalších delikates a zdravých výroků až ke dveřím.</code></p>
</li>
<li>
<p><strong>dairy:</strong> <code>mléčné výrobky</code></p>
</li>
<li>
<p><strong>meats:</strong> <code>maso</code></p>
</li>
<li>
<p><strong>bakery:</strong> <code>pečivo</code></p>
</li>
<li>
<p><strong>fruit &amp; veg:</strong> <code>ovoce a zeleniny</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also add a comment to each key-value pair. Any text you enter into the <strong>Comment</strong> field in the Properties editor is added to the resource bundle text file above the key-value pair as a comment (i.e., following a &#8216;#&#8217; sign).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Double-click the <code>messages_cs.properties</code> file node in the Projects window. Note that the text file has been updated according to your changes in the Properties editor.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"># welcome page
greeting=Vítejte v našem domácím on-line obchodě Affable Bean Green Grocer.
introText=Naše jedinečná dodávková služba Vám zajistí dopravu čerstvých organických produktů, mléčných výrobků, uzenin, pečiva a dalších delikates a zdravých výroků až ke dveřím.

# categories
dairy=mléčné výrobky
meats=maso
bakery=pečivo
fruit\ &amp;amp;\ veg=ovoce a zeleniny</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have the following resource bundles defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>default (English)</p>
</li>
<li>
<p>Czech</p>
</li>
<li>
<p>English</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You might assume that if the default bundle is in English, then there is no need to create a resource bundle explicitly for English. However, consider the following scenario: a client browser&#8217;s list of preferred languages includes both Czech and English, with English taking precedence over Czech. If the application doesn&#8217;t provide a resource bundle for English but does for Czech, pages sent to that browser will be in Czech (since a Czech bundle was defined). This is clearly not the desired behavior for that browser.</p>
</div>
</div>
<div class="sect2">
<h3 id="register"><a class="anchor" href="#register"></a>Register the Resource Bundle with the Application</h3>
<div class="paragraph">
<p>The purpose of this step is to inform JSTL&#8217;s format (i.e., <a href="http://download.oracle.com/docs/cd/E17802_01/products/products/jsp/jstl/1.1/docs/tlddocs/fmt/tld-summary.html">`fmt`</a>) tag library where it can locate any resource bundles existing in the application. You accomplish this by instructing the application to create a <a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/jstl/1.1/docs/api/javax/servlet/jsp/jstl/fmt/LocalizationContext.html">`LocalizationContext`</a> using the existing resource bundles. This can be done by setting a context parameter in the application&#8217;s <code>web.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The topic of setting context parameters is also covered in <a href="../connect-db/#param" class="xref page">Connecting the Application to the Database</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Projects window, expand the Configuration Files node, then double-click <code>web.xml</code> to open it in the editor.</p>
</li>
<li>
<p>Under the deployment descriptor&#8217;s General tab, expand the Context Parameters category.</p>
</li>
<li>
<p>Click the Add button, then in the Add Context Parameter dialog enter the following values.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Parameter Name:</strong> <code>javax.servlet.jsp.jstl.fmt.localizationContext</code></p>
</li>
<li>
<p><strong>Parameter Value:</strong> <code>resources.messages</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/add-context-parameter.png" alt="add context parameter">
</div>
<div class="title">Figure 6. Add context parameters under the General tab for web.xml</div>
</div>
<div class="paragraph">
<p>The <code>LocalizationContext</code> class belongs to the <code>javax.servlet.jsp.jstl.fmt</code> package. You can verify this by viewing the <a href="http://java.sun.com/products/jsp/jstl/1.1/docs/api/index.html">JSTL 1.1 API Reference</a> online.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click OK. The new context parameter is added to the table of existing context parameters under the General tab.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click the deployment descriptor&#8217;s XML tab. Note that the following entry has been added to the file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context-param&gt;
    &lt;param-name&gt;javax.servlet.jsp.jstl.fmt.localizationContext&lt;/param-name&gt;
    &lt;param-value&gt;resources.messages&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replace"><a class="anchor" href="#replace"></a>Replace Hard-Coded Text with <code>&lt;fmt:message&gt;</code> Tags</h3>
<div class="paragraph">
<p>In order to apply the localized text of resource bundles to your web pages, you reference the keys from the key-value pairs you created. You can reference the keys using JSTL&#8217;s <code>&lt;fmt:message&gt;</code> tags.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project&#8217;s <code>index.jsp</code> page in the editor. (If already opened, press Ctrl-Tab to switch to the file.)</p>
</li>
<li>
<p>Delete instances of hard-coded text that display in the page&#8217;s left column, and in their place enter <code>&lt;fmt:message&gt;</code> tags using the <code>key</code> attribute to specify the resource bundle key. The page&#8217;s left column will look as follows.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div id="indexLeftColumn"&gt;
    &lt;div id="welcomeText"&gt;
        &lt;p style="font-size: larger"&gt;*&lt;fmt:message key='greeting'/&gt;*&lt;/p&gt;

        &lt;p&gt;*&lt;fmt:message key='introText'/&gt;*&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Add <code>&lt;fmt:message&gt;</code> tags for the four category names, but use the <code>${category.name}</code> expression as the value for the <code>key</code> attribute. Since the category name is also used as the value for the <code>&lt;img&gt;</code> tag&#8217;s <code>alt</code> attribute, follow the same procedure. The page&#8217;s right column will look as follows.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div id="indexRightColumn"&gt;
    &lt;c:forEach var="category" items="${categories}"&gt;
        &lt;div class="categoryBox"&gt;
            &lt;a href="&lt;c:url value='category?${category.id}'/&gt;"&gt;
                &lt;span class="categoryLabel"&gt;&lt;/span&gt;
                &lt;span class="categoryLabelText"&gt;*&lt;fmt:message key='${category.name}'/&gt;*&lt;/span&gt;

                &lt;img src="${initParam.categoryImagePath}${category.name}.jpg"
                     alt="*&lt;fmt:message key='${category.name}'/&gt;*" class="categoryImage"&gt;
            &lt;/a&gt;
        &lt;/div&gt;
    &lt;/c:forEach&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Finally, ensure that you have the <code>fmt</code> tag library declared in the web page. Enter the following at the top of the file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Here you add the tag library declaration to the top of the <code>index.jsp</code> file. However, when you begin using <code>&lt;fmt&gt;</code> tags elsewhere in the project, it may make more sense to remove the tag library declaration from individual page views, and add it to the header (<code>header.jspf</code>) file. This practice is adopted in <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot9.zip">snapshot 9</a> (and later snapshots).</p>
</div>
<div class="paragraph">
<p>You&#8217;ve now completed the tasks necessary for providing bilingual support for the application&#8217;s welcome page. The following step demonstrates how to test the language support in your browser.</p>
</div>
</div>
<div class="sect2">
<h3 id="test"><a class="anchor" href="#test"></a>Test Supported Languages</h3>
<div class="paragraph">
<p>You could theoretically test for the following scenarios involving the application&#8217;s supported languages, as well as an unsupported language (e.g., Korean):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Use-case</th>
<th class="tableblock halign-left valign-top">Outcome</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1. Browser has no preferred language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2. Browser prefers only English</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3. Browser prefers only Czech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4. Browser prefers only Korean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5. Browser prefers Korean and English; Korean takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6. Browser prefers Korean and English; English takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7. Browser prefers Korean and Czech; Korean takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8. Browser prefers Korean and Czech; Czech takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9. Browser prefers English and Czech; English takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10. Browser prefers English and Czech; Czech takes precedence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11. Browser prefers, in the following order, English, Czech, Korean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12. Browser prefers, in the following order, English, Korean, Czech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13. Browser prefers, in the following order, Czech, English, Korean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14. Browser prefers, in the following order, Czech, Korean, English</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15. Browser prefers, in the following order, Korean, English, Czech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English displays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16. Browser prefers, in the following order, Korean, Czech, English</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Czech displays</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Rather than stepping through all 16 scenarios, we&#8217;ll demonstrate how to examine scenario 3 above, in which the browser&#8217;s preferred language is Czech, using the Firefox browser.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Firefox, choose Tools &gt; Options (Firefox &gt; Preferences on Mac). In the window that displays, click the Content tab.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox-content.png" alt="firefox content">
</div>
<div class="title">Figure 7. Examine your browser&#8217;s preferred languages</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Under the Languages heading, click Choose.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Select any language that is currently listed in the provided text area, then click Remove. (You should remember your language list and reinstate languages after completing this tutorial.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click the 'Select Language to Add' drop-down and select <code>Czech [cs]</code>. Then click the Add button. The Czech language is added to the text area.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/firefox-languages.png" alt="firefox languages">
</div>
<div class="title">Figure 8. Specify your browser&#8217;s preferred languages</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click OK, then press Esc to close Firefox' Options window.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ). When the welcome page opens in your browser, note that text is displayed in Czech.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/czech-text.png" alt="czech text">
</div>
<div class="title">Figure 9. The displayed language is determined by your browser&#8217;s language preferences</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="toggle"><a class="anchor" href="#toggle"></a>Implementing a Language Toggle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that basic Czech-English language support is in place, continue by implementing the language toggle in the application&#8217;s page views. We can divide this task into three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#toggleDisplay">Create Toggle Display and Synchronize with the Browser&#8217;s Preferred Language</a></p>
</li>
<li>
<p><a href="#handleRequest">Implement Functionality to Handle a Request from the Language Toggle</a></p>
</li>
<li>
<p><a href="#keepTrack">Enable the Application to Keep Track of the Originating Page View</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="toggleDisplay"><a class="anchor" href="#toggleDisplay"></a>Create Toggle Display and Synchronize with the Browser&#8217;s Preferred Language</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the Go to File dialog to open the <code>header</code> JSP fragment in the editor. Press Alt-Shift-O (Ctrl-Shift-O on Mac), then type &#8216;h&#8217; in the dialog and click OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/go-to-file-dialog.png" alt="go to file dialog">
</div>
<div class="title">Figure 10. Use the Go to File dialog to quickly open project resources in the editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>In the <code>header.jspf</code> file, locate the first <code>&lt;div class="headerWidget"&gt;</code> tag (line 56), and replace the <code>[ language toggle ]</code> placeholder text with the following HTML markup.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div class="headerWidget"&gt;

    *&lt;%-- language selection widget --%&gt;
    english | &lt;div class="bubble"&gt;&lt;a href="chooseLanguage?language=cs"&gt;česky&lt;/a&gt;&lt;/div&gt;*
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This markup implements the language toggle&#8217;s appearance when English is the displayed language. In other words, the toggle provides a link allowing the user to select the Czech (i.e., &#8216;česky&#8217;) option. The link is used to send a request for <code>chooseLanguage</code>, and creates a query string (<code>?language=cs</code>) that specifies the requested language code.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Recall that in Unit 5, <a href="../page-views-controller/#controller" class="xref page">Preparing the Page Views and Controller Servlet</a>, you set the <code>ControllerServlet</code> to handle the <code>/chooseLanguage</code> URL pattern.</p>
</div>
<div class="paragraph">
<p>Snapshot 8 includes the <a href="http://jquery.com/">jQuery</a> JavaScript library and takes advantage of various UI effects to enhance the appearance and behavior of the website. Aside from a <a href="http://plugins.jquery.com/project/validate">jQuery plugin for client-side validation</a> (discussed in the <a href="../transaction/#client" class="xref page">previous tutorial unit</a>), the snapshot implements an easing effect for category headings in the welcome page, as well as for category buttons in the category page. Configuration is included in <code>header.jspf</code> of the project snapshot. Rounded corners are implemented using CSS3&#8217;s <a href="http://www.w3.org/TR/css3-background/#corners">border-radius</a> property (applied in <code>affablebean.css</code>).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to see what the toggle looks like in the browser.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/language-toggle.png" alt="language toggle">
</div>
<div class="title">Figure 11. Run the project to view the language toggle</div>
</div>
<div class="paragraph">
<p>Currently, the language toggle appears as in the above image regardless of what language the page displays in. In the next step, you integrate JSTL logic into the toggle so that it renders according to the language displayed on the page.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Modify the toggle implementation as follows.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div class="headerWidget"&gt;

    &lt;%-- language selection widget --%&gt;
    *&lt;c:choose&gt;
      &lt;c:when test="${pageContext.request.locale.language ne 'cs'}"&gt;
        english
      &lt;/c:when&gt;
      &lt;c:otherwise&gt;
        &lt;c:url var="url" value="chooseLanguage"&gt;
          &lt;c:param name="language" value="en"/&gt;
        &lt;/c:url&gt;
        &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;english&lt;/a&gt;&lt;/div&gt;
      &lt;/c:otherwise&gt;
    &lt;/c:choose&gt; |

    &lt;c:choose&gt;
      &lt;c:when test="${pageContext.request.locale.language eq 'cs'}"&gt;
        česky
      &lt;/c:when&gt;
      &lt;c:otherwise&gt;
        &lt;c:url var="url" value="chooseLanguage"&gt;
          &lt;c:param name="language" value="cs"/&gt;
        &lt;/c:url&gt;
        &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;česky&lt;/a&gt;&lt;/div&gt;
      &lt;/c:otherwise&gt;
    &lt;/c:choose&gt;*
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above implementation, you rely on conditional tags from JSTL&#8217;s <code>core</code> tag library to display the left and right portions of the toggle according to the language used by the request locale. What is the "language used by the request locale"? When a request is made, the browser passes a list of preferred locales in the <code>Accept-Language</code> HTTP header. The Java runtime environment on the server reads the list and determines the best match based on the locales defined by the application&#8217;s resource bundles. This match is then recorded in the <code>ServletRequest</code> object, and can be accessed using the <code>getLocale</code> method. For example, you could access the preferred locale from a servlet with the following statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">request.getLocale();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the IDE&#8217;s HTTP Monitor (Window &gt; Debugging &gt; HTTP Server Monitor) to examine HTTP headers for client requests. In order to use the HTTP Monitor, you need to first activate it for the server you are using. Unit 8, <a href="../manage-sessions/" class="xref page">Managing Sessions</a> provides a demonstration under the sub-section, <a href="../manage-sessions/#http-monitor" class="xref page">Examining Client-Server Communication with the HTTP Monitor</a>.</p>
</div>
<div class="paragraph">
<p>To determine the language of the preferred locale, you use the <code>Locale</code> class' <code>getLanguage</code> method. Again, from a servlet you could access the language of the client request&#8217;s preferred locale with the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">request.getLocale().getLanguage();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returning to the code you just added to the <code>header.jspf</code> fragment, you utilize the <code>pageContext.request</code> implicit object to access the <code>ServletRequest</code> for the given client request. Using dot notation, you then proceed to call the same methods as you would from a servlet. In the above example, accessing the "language used by the request locale" is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">${pageContext.request.locale.language}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The above implementation uses <code>&lt;c:url&gt;</code> tags to set up the toggle link. This is done in order to properly encode the request URL in the event that URL rewriting is used as a means for session tracking. Unit 8, <a href="../manage-sessions/#encodeUrl" class="xref page">Managing Sessions</a> provides a brief explanation of how the <code>&lt;c:url&gt;</code> tags can be used.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Add a basic language test to the <code>header.jspf</code> file. This will enable us to check whether the toggle is properly rendering according to the client request&#8217;s preferred language. Enter the following after the page&#8217;s <code>&lt;body&gt;</code> tag.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;body&gt;

    *&lt;%-- Language test --%&gt;
    &lt;p style="text-align: left;"&gt;&lt;strong&gt;tests:&lt;/strong&gt;
        &lt;br&gt;
        &lt;code&gt;\${pageContext.request.locale.language}&lt;/code&gt;: ${pageContext.request.locale.language}
    &lt;/p&gt;*

    &lt;div id="main"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Ensure that you have set Czech as your browser&#8217;s preferred language. (If you are following this tutorial unit sequentially, you&#8217;ve already done this. If not, refer to the steps outlined above in <a href="#test">Test Supported Languages</a>.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) and examine the application welcome page in the browser.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/language-test.png" alt="language test">
</div>
<div class="title">Figure 12. Language toggle displays according to request&#8217;s preferred language</div>
</div>
<div class="paragraph">
<p>If your browser&#8217;s preferred language is set to Czech, you can note the following:
* The test that we introduced in the previous step indicates that &#8216;cs&#8217; is the preferred language.
* Czech text is displayed in the page.
* The language toggle provides a link enabling the user to select English.</p>
</div>
</div>
<div class="sect2">
<h3 id="handleRequest"><a class="anchor" href="#handleRequest"></a>Implement Functionality to Handle a Request from the Language Toggle</h3>
<div class="paragraph">
<p>Now that the toggle is in place and it appears according to the language displayed in the page, let&#8217;s continue by adding code to the <code>ControllerServlet</code> that handles the request sent when a user clicks the link in the language toggle.</p>
</div>
<div class="paragraph">
<p>As indicated in the current language toggle implementation from <a href="#step4">step 4</a> above, the requested URL with query string looks as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>English:</strong> <code>chooseLanguage?language=en</code></p>
</li>
<li>
<p><strong>Czech:</strong> <code>chooseLanguage?language=cs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Our goal is to register the language choice, and then display both the page view and language toggle based on the chosen language. We can accomplish this by extracting the <code>language</code> parameter from the query string and creating a session-scoped <code>language</code> attribute that remembers the language selected by the user. Then we&#8217;ll return to the <code>header.jspf</code> fragment and apply the <a href="http://download-llnw.oracle.com/javaee/5/jstl/1.1/docs/tlddocs/fmt/setLocale.html">`&lt;fmt:setLocale&gt;`</a> tag to set the page language based on the user&#8217;s choice. With the <code>&lt;fmt:setLocale&gt;</code> tag we can manually switch the language used in the page display. We&#8217;ll also modify the language toggle so that if the <code>language</code> attribute has been set, the toggle&#8217;s appearance is determined according to the <code>language</code> attribute&#8217;s value.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>ControllerServlet</code> in the editor. Use the Go To File dialog - press Alt-Shift-O (Ctrl-Shift-O on Mac), then type &#8216;controller&#8217; and click OK. In the opened file, locate the portion of the <code>doGet</code> method that handles the <code>chooseLanguage</code> request (line 126).</p>
</li>
<li>
<p>Delete the <code>// TODO: Implement language request</code> comment and enter code to extract the <code>language</code> parameter from the request query string.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if user switches language
} else if (userPath.equals("/chooseLanguage")) {

    *// get language choice
    String language = request.getParameter("language");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Place the <code>language</code> parameter in the request scope. Add the following.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if user switches language
} else if (userPath.equals("/chooseLanguage")) {

    // get language choice
    String language = request.getParameter("language");

    *// place in request scope
    request.setAttribute("language", language);*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>As a temporary measure, have the application forward the response to the <code>index.jsp</code> welcome page when the language toggle link is clicked. Add the following code.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if user switches language
} else if (userPath.equals("/chooseLanguage")) {

    // get language choice
    String language = request.getParameter("language");

    // place in request scope
    request.setAttribute("language", language);

    *// forward request to welcome page
    try {
        request.getRequestDispatcher("/index.jsp").forward(request, response);
    } catch (Exception ex) {
        ex.printStackTrace();
    }
    return;*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Naturally, forwarding the user to the welcome page regardless of what page he or she is on is not an ideal way to handle the language toggle&#8217;s behavior. We&#8217;ll return to this matter in the next sub-section, <a href="#keepTrack">Enable the Application to Keep Track of the Originating Page View</a>. For the meantime however, this will allow us to examine the results of the current language toggle implementation when running the project.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Switch to the <code>header.jspf</code> fragment (If the file is already opened in the editor, press Ctrl-Tab and choose the file.) and apply the <a href="http://download-llnw.oracle.com/javaee/5/jstl/1.1/docs/tlddocs/fmt/setLocale.html">`&lt;fmt:setLocale&gt;`</a> tag to set the page language based on the new <code>language</code> variable. Add the following.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
*&lt;%@taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;

&lt;%-- Set language based on user's choice --%&gt;
&lt;c:if test="${!empty language}"&gt;
    &lt;fmt:setLocale value="${language}" scope="session" /&gt;
&lt;/c:if&gt;*


&lt;%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>language</code> variable is only created when the user clicks the link in the language toggle, you perform a test using <a href="http://download-llnw.oracle.com/javaee/5/jstl/1.1/docs/tlddocs/c/if.html">`&lt;c:if&gt;`</a> tags to determine whether the variable exists before attempting to set the language. When applying the <code>&lt;fmt:setLocale&gt;</code> tag, you set its scope to <code>session</code> as you want the user-selected language to take precedence for the remainder of his or her session on the website. Also, since this is the first time the <code>fmt</code> library is used in the header, you declare the tag library.</p>
</div>
<div class="paragraph">
<p>You can read the EL expression <code>${!empty language}</code> as, "False if the <code>language</code> variable is null or an empty string." See the <a href="http://download-llnw.oracle.com/javaee/5/tutorial/doc/bnahq.html#bnaim">Java EE 5 Tutorial: Examples of EL Expressions</a> for other available examples.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Modify the language toggle implementation so that if a value has been set by the <code>&lt;fmt:setLocale&gt;</code> tag, the toggle displays according to the language specified by that value. (You can determine this value using the <code>${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}</code> expression.)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enclose the current implementation within <code>&lt;c:choose&gt;</code> tags, and create logic similar to the current implementation in the event that the locale has been manually set. (Changes are displayed in <strong>bold</strong>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div class="headerWidget"&gt;

  &lt;%-- language selection widget --%&gt;
  *&lt;c:choose&gt;
    &lt;%-- When user hasn't explicitly set language,
         render toggle according to browser's preferred locale --%&gt;
    &lt;c:when test="${empty sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}"&gt;*
      &lt;c:choose&gt;
        &lt;c:when test="${pageContext.request.locale.language ne 'cs'}"&gt;
          english
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
          &lt;c:url var="url" value="chooseLanguage"&gt;
            &lt;c:param name="language" value="en"/&gt;
          &lt;/c:url&gt;
          &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;english&lt;/a&gt;&lt;/div&gt;
        &lt;/c:otherwise&gt;
      &lt;/c:choose&gt; |

      &lt;c:choose&gt;
        &lt;c:when test="${pageContext.request.locale.language eq 'cs'}"&gt;
          česky
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
          &lt;c:url var="url" value="chooseLanguage"&gt;
            &lt;c:param name="language" value="cs"/&gt;
          &lt;/c:url&gt;
          &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;česky&lt;/a&gt;&lt;/div&gt;
        &lt;/c:otherwise&gt;
      &lt;/c:choose&gt;
    *&lt;/c:when&gt;

    &lt;%-- Otherwise, render widget according to the set locale --%&gt;
    &lt;c:otherwise&gt;
      &lt;c:choose&gt;
        &lt;c:when test="${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session'] ne 'cs'}"&gt;
          english
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
          &lt;c:url var="url" value="chooseLanguage"&gt;
            &lt;c:param name="language" value="en"/&gt;
          &lt;/c:url&gt;
          &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;english&lt;/a&gt;&lt;/div&gt;
        &lt;/c:otherwise&gt;
      &lt;/c:choose&gt; |

      &lt;c:choose&gt;
        &lt;c:when test="${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session'] eq 'cs'}"&gt;
          česky
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
          &lt;c:url var="url" value="chooseLanguage"&gt;
            &lt;c:param name="language" value="cs"/&gt;
          &lt;/c:url&gt;
          &lt;div class="bubble"&gt;&lt;a href="${url}"&gt;česky&lt;/a&gt;&lt;/div&gt;
        &lt;/c:otherwise&gt;
      &lt;/c:choose&gt;
    &lt;/c:otherwise&gt;
  &lt;/c:choose&gt;*

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Before examining the project in a browser, add another test that displays the value set by the <code>&lt;fmt:setLocale&gt;</code> tag. Add the following code beneath the test you created earlier.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;p style="text-align: left;"&gt;&lt;strong&gt;tests:&lt;/strong&gt;
    &lt;br&gt;
    &lt;code&gt;\${pageContext.request.locale.language}&lt;/code&gt;: ${pageContext.request.locale.language}
    *&lt;br&gt;
    &lt;code&gt;\${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}&lt;/code&gt;: ${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}*
&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>javax.servlet.jsp.jstl.fmt.locale.session</code> is the <em>string literal</em> key for the <code>Locale</code> set by the <code>&lt;fmt:setLocale&gt;</code> tag. You can verify this by clicking in the editor&#8217;s left margin to set a breakpoint ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/breakpoint-badge.png" alt="breakpoint badge"></span> ) on the new test, then running the debugger ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/debug-project-btn.png" alt="debug project btn"></span> ) on the project. When you click the toggle link to change languages in the browser, examine the Variables window (Alt-Shift-1; Ctrl-Shift-1 on Mac) when the debugger suspends on the breakpoint.</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock xref-image left">
<div class="content">
<a class="image" href="../../../../../_images/kb/docs/javaee/ecommerce/variables-window.png"><img src="../../../../../_images/kb/docs/javaee/ecommerce/variables-window.png" alt="variables window"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>EL expressions presented in this tutorial primarily use dot (<code>.</code>) notation. The format depicted in the expression above is known as <em>bracket</em> (<code>[]</code>) notation whereby you enter the string literal key within quotes in order to extract the object&#8217;s value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Numerous EL resolver classes exist for the purpose of resolving expressions. For example, when the above expression is encountered at runtime, the <a href="http://download-llnw.oracle.com/javaee/6/api/javax/servlet/jsp/el/ImplicitObjectELResolver.html">`ImplicitObjectResolver`</a> first returns a <code>Map</code> that maps session-scoped attribute names to their values. (In the above image of the Variables window, you can verify that session attributes are maintained in a <a href="http://download-llnw.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html">`ConcurrentHashMap`</a>.) In order to resolve the remainder of the expression, the <a href="http://download-llnw.oracle.com/javaee/6/api/javax/el/MapELResolver.html">`MapELResolver`</a> is used to get the value of the key named &#8216;javax.servlet.jsp.jstl.fmt.locale.session&#8217;.</p>
</div>
<div class="paragraph">
<p>For more information, refer to the Java EE 5 Tutorial: <a href="http://download-llnw.oracle.com/javaee/5/tutorial/doc/bnahq.html#bnaif">Unified Expression Language: Resolving Expressions</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) and examine the application welcome page in the browser.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/toggle-page1.png" alt="toggle page1">
</div>
<div class="title">Figure 13. Welcome page displays according to browser&#8217;s preferred language</div>
</div>
<div class="paragraph">
<p>In the above image, the server identifies Czech (<code>cs</code>) as the browser&#8217;s preferred language from the <code>Accept-Language</code> HTTP header. This is indicated from the first test. The page displays in Czech, and the language toggle enables the user to choose English. The second test remains blank as the <code>&lt;fmt:setLocale&gt;</code> tag has not yet been called.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Click the toggle link for English.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/toggle-page2.png" alt="toggle page2">
</div>
<div class="title">Figure 14. Welcome page displays in English, according to toggle selection</div>
</div>
<div class="paragraph">
<p>When clicking the toggle link, the default Czech language is overridden by means of the <code>&lt;fmt:setLocale&gt;</code> tag implemented in the <code>header.jspf</code> file. Although the browser&#8217;s preferred language remains Czech, you see that the page now displays according to the new language made available by the language toggle.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Click the toggle link for Czech.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/toggle-page3.png" alt="toggle page3">
</div>
<div class="title">Figure 15. Welcome page displays in Czech, according to toggle selection</div>
</div>
<div class="paragraph">
<p>Changing the language back to the browser&#8217;s preferred language works as expected, however note that the deciding factor is no longer the language detected from the <code>Accept-Language</code> HTTP header, but is the language specified from the <code>&lt;fmt:setLocale&gt;</code> tag.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Before continuing, remove the tests you added to the <code>header.jspf</code> file. (Deleted code in <strong><span class="line-through">strike-through</span></strong> text.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;body&gt;

    *[.line-through]#&lt;%-- Language tests --%&gt;#
    [.line-through]#&lt;p style="text-align: left;"&gt;&lt;strong&gt;tests:&lt;/strong&gt;#
        [.line-through]#&lt;br&gt;#
        [.line-through]#&lt;code&gt;\${pageContext.request.locale.language}&lt;/code&gt;: ${pageContext.request.locale.language}#
        [.line-through]#&lt;br&gt;#
        [.line-through]#&lt;code&gt;\${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}&lt;/code&gt;: ${sessionScope['javax.servlet.jsp.jstl.fmt.locale.session']}#
    [.line-through]#&lt;/p&gt;#*

    &lt;div id="main"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="keepTrack"><a class="anchor" href="#keepTrack"></a>Enable the Application to Keep Track of the Originating Page View</h3>
<div class="paragraph">
<p>One of the <a href="#impDeets">implementation details</a> which you have agreed on with the Affable Bean staff is that when the language toggle is used to change the language, the user remains in the same page view. In our current implementation, the welcome page is returned whenever the language toggle is clicked. A more user-friendly approach would be to provide the application with a means of tracking the request page view, and forwarding the request to that page view when the language toggle link is clicked.</p>
</div>
<div class="paragraph">
<p>We can accomplish this by setting a session-scoped <code>view</code> attribute within each of the page views, then referencing this attribute in the <code>ControllerServlet</code> in order to determine where to forward the request. There are however several caveats to consider when dealing with the language toggle in the confirmation page. These are discussed and dealt with in steps 7-11 below.</p>
</div>
<div class="paragraph">
<p>Begin this exercise with <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot9.zip">snapshot 9</a> of the <code>AffableBean</code> project. This snapshot includes completed English and Czech resource bundles for all page views, all page views have been modified to use text from the resource bundles, and the language toggle is presented in a state corresponding to this point in the tutorial.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot9.zip">snapshot 9</a> in the IDE. Click the Open Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/open-project-btn.png" alt="open project btn"></span> ) button and use the wizard to navigate to the location on your computer where you downloaded the project.</p>
</li>
<li>
<p>Click the Run Project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) button to run the project. When navigating through the site, note that when you click the language toggle from any of the page views, you are returned to the application&#8217;s welcome page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you receive an error when running the project, revisit the <a href="../setup/" class="xref page">setup instructions</a>, which describe how to prepare the database and establish connectivity between the IDE, GlassFish, and MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Use <a href="http://download.oracle.com/docs/cd/E17802_01/products/products/jsp/jstl/1.1/docs/tlddocs/c/set.html">`&lt;c:set&gt;`</a> tags to set a session-scoped <code>view</code> attribute for each of the page views. Open each of the page views in the editor and add the following code to the top of each file.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_index_jsp"><a class="anchor" href="#_index_jsp"></a>index.jsp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%-- Set session-scoped variable to track the view user is coming from.
     This is used by the language mechanism in the Controller so that
     users view the same page when switching between English and Czech. --%&gt;
&lt;c:set var='view' value='/index' scope='session' /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_category_jsp"><a class="anchor" href="#_category_jsp"></a>category.jsp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%-- Set session-scoped variable to track the view user is coming from.
     This is used by the language mechanism in the Controller so that
     users view the same page when switching between English and Czech. --%&gt;
&lt;c:set var='view' value='/category' scope='session' /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cart_jsp"><a class="anchor" href="#_cart_jsp"></a>cart.jsp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%-- Set session-scoped variable to track the view user is coming from.
     This is used by the language mechanism in the Controller so that
     users view the same page when switching between English and Czech. --%&gt;
&lt;c:set var='view' value='/cart' scope='session' /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checkout_jsp"><a class="anchor" href="#_checkout_jsp"></a>checkout.jsp</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%-- Set session-scoped variable to track the view user is coming from.
     This is used by the language mechanism in the Controller so that
     users view the same page when switching between English and Czech. --%&gt;
&lt;c:set var='view' value='/checkout' scope='session' /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on customer-agreed <a href="#impDeets">implementation details</a>, we do not need to provide a means of switching languages on the confirmation page view. From a usability perspective, a user will have already selected his or her preferred language prior to checkout. From an implementation perspective, recall that we destroy the user session upon a successfully completed order. (Refer back to the final paragraph in <a href="../manage-sessions/" class="xref page">Managing Sessions</a>, which describes how to apply the <code>invalidate</code> method to explicitly terminate a user session.) If the Affable Bean staff were to insist on allowing customers to view their orders bilingually, you would need to consider the following scenarios, dependent on whether you destroy the user session upon displaying the confirmation page:
1. <strong>Session destroyed:</strong> Would be necessary to take extra measures to ensure that a <code>chooseLanguage</code> request from the confirmation page refers to the appropriate order, and can display customer-sensitive details in a secure fashion.
2. <strong>Session maintained:</strong> Would risk enabling users to mistakenly place double orders on their shopping cart. Also, by not terminating user sessions when they are no longer needed, an unnecessary load may be placed on the server.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Open the <code>ControllerServlet</code> in the editor. (If already opened, press Ctrl-Tab and choose the file.) In the opened file, locate the portion of the <code>doGet</code> method that handles the <code>chooseLanguage</code> request (line 126).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that currently <code>chooseLanguage</code> requests are forwarded to the <code>index.jsp</code> welcome page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if user switches language
} else if (userPath.equals("/chooseLanguage")) {

    // get language choice
    String language = request.getParameter("language");

    // place in session scope
    session.setAttribute("language", language);

    *// forward request to welcome page
    try {
        request.getRequestDispatcher("/index.jsp").forward(request, response);
    } catch (Exception ex) {
        ex.printStackTrace();
    }
    return;*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Use the <code>view</code> session attribute to forward the request back to the originating page view. Make the following changes (in <strong>bold</strong>).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if user switches language
} else if (userPath.equals("/chooseLanguage")) {

    // get language choice
    String language = request.getParameter("language");

    // place in request scope
    request.setAttribute("language", language);

    *String userView = (String) session.getAttribute("view");

    if ((userView != null) &amp;amp;&amp;amp;
        (!userView.equals("/index"))) {     // index.jsp exists outside 'view' folder
                                            // so must be forwarded separately
        userPath = userView;
    } else {

        // if previous view is index or cannot be determined, send user to welcome page*
        try {
            request.getRequestDispatcher("/index.jsp").forward(request, response);
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return;
    *}*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above implementation, you extract the value of the <code>view</code> attribute and, provided that the view:
* can be identified (i.e., the value is not null),
* does not originate from the welcome page (<code>index.jsp</code> does not reside in the same location as other page views, and therefore cannot be resolved using the <code>doGet</code> method&#8217;s way of forwarding requests)
<span class="indent">&#8230;&#8203;you set it to the <code>doGet</code> method&#8217;s <code>userPath</code> variable, and forward the request using the method&#8217;s existing <code>RequestDispatcher</code>:</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// use RequestDispatcher to forward request internally
String url = "/WEB-INF/view" + userPath + ".jsp";

try {
    request.getRequestDispatcher(url).forward(request, response);
} catch (Exception ex) {
    ex.printStackTrace();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Run the project ( <span class="image"><img src="../../../../../_images/kb/docs/javaee/ecommerce/run-project-btn.png" alt="run project btn"></span> ) to test it in the browser. When you navigate to the category, cart or checkout pages, switch languages using the language toggle. When you do so, you now remain within the same page view.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>In the browser, complete an order so that the application forwards you to the confirmation page. When you click the language toggle from the confirmation page, note that you are sent back to the website&#8217;s welcome page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Implementation-wise, you may consider this to be sufficient. However, the Affable Bean staff have explicitly asked you to remove the language toggle from this page view. One way to accomplish this is to perform a test to determine whether the request <em>servlet path</em> contains &#8216;/confirmation&#8217;.</p>
</div>
<div class="paragraph">
<p>Switch to the <code>header.jspf</code> file in the editor and surround the language toggle with the following test. You can use JSTL&#8217;s functions (i.e., <a href="http://download.oracle.com/docs/cd/E17802_01/products/products/jsp/jstl/1.1/docs/tlddocs/fn/tld-summary.html">`fn`</a>) library to perform string operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div class="headerWidget"&gt;

  *&lt;%-- If servlet path contains '/confirmation', do not display language toggle --%&gt;
  &lt;c:if test="${!fn:contains(pageContext.request.servletPath,'/confirmation')}"&gt;*

    &lt;%-- language selection widget --%&gt;
    &lt;c:choose&gt;

        ...
    &lt;/c:choose&gt;

  *&lt;/c:if&gt;*
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examine the above code snippet and note the following points:
* The servlet path can be accessed from the <code>HttpServletRequest</code> using the <a href="http://download.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getServletPath%28%29">`getServletPath`</a> method. Because we use a <code>RequestDispatcher</code> to forward the request to the confirmation page (<code>ControllerServlet</code>, line 158), the servlet path becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/WEB-INF/view/confirmation.jsp</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>pageContext.request.servletPath</code> EL expression is comparable to calling <code>request.getServletPath()</code> from a servlet.</p>
</li>
<li>
<p>The <a href="http://download.oracle.com/docs/cd/E17802_01/products/products/jsp/jstl/1.1/docs/tlddocs/fn/contains.fn.html">`fn:contains()`</a> function allows you to test if an input string contains the specified substring.</p>
</li>
<li>
<p>The <code>fn</code> tag library has already been declared for you at the top of in the <code>header.jspf</code> file in snapshot 9:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Run the project again and step through to the confirmation page. Note that the page no longer displays the language toggle.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../../_images/kb/docs/javaee/ecommerce/confirmation-page.png" alt="confirmation page">
</div>
<div class="title">Figure 16. Language toggle no longer displays in confirmation page</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>In the browser, step through to the confirmation page but switch languages once along the way using the language toggle. Note that when you complete an order, the confirmation page inadvertently switches back to the originally displayed language. You may rightly identify the cause: upon a successfully completed order, the <code>ControllerServlet</code> destroys the user session and consequently the session-scoped locale that was set using the <code>&lt;fmt:setLocale&gt;</code> tag is also lost.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To remedy this, open the <code>ControllerServlet</code> and locate the <code>invalidate()</code> method which is used to destroy user sessions (approximately line 259).</p>
</div>
<div class="paragraph">
<p>Use the editor&#8217;s quick search facility: press Ctrl-F (⌘-F on Mac) and type in &#8216;invalidate&#8217;.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Add code that extracts the session-scoped locale value prior to destroying the user session and resets the request-scoped <code>language</code> attribute to the locale value after the session has been destroyed. (Changes in <strong>bold</strong>.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if order processed successfully send user to confirmation page
if (orderId != 0) {

    *// in case language was set using toggle, get language choice before destroying session
    Locale locale = (Locale) session.getAttribute("javax.servlet.jsp.jstl.fmt.locale.session");
    String language = "";

    if (locale != null) {

        language = (String) locale.getLanguage();
    }*

    // dissociate shopping cart from session
    cart = null;

    // end session
    session.invalidate();

    *if (!language.isEmpty()) {                       // if user changed language using the toggle,
                                                     // reset the language attribute - otherwise
        request.setAttribute("language", language);  // language will be switched on confirmation page!
    }*

    // get order details
    Map orderMap = orderManager.getOrderDetails(orderId);

    ...
    userPath = "/confirmation";
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Run the project and again, step through to the confirmation page but switch languages once along the way using the language toggle. Note that when you complete an order, the confirmation page now displays in the language you selected.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have now successfully integrated language support into the <code>AffableBean</code> application according to customer specification. You&#8217;ve factored out all text from page views, placed it into resource bundles, and have applied JSTL&#8217;s <code>fmt</code> tag library to use resource bundle content based on the user&#8217;s preferred language. You also implemented a language toggle that enables users to switch between English and Czech, and override their browser&#8217;s default language choice. Download and examine <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot10.zip">snapshot 10</a> to compare your work with the state of the project at the end of this tutorial unit.</p>
</div>
<div class="paragraph">
<p>link:/about/contact_form.html?to=3&amp;subject=Feedback: NetBeans E-commerce Tutorial - Adding Language Support[Send Us Your Feedback]</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso"><a class="anchor" href="#seeAlso"></a>See Also</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_netbeans_resources"><a class="anchor" href="#_netbeans_resources"></a>NetBeans Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../../javaee-intro/" class="xref page">Introduction to Java EE Technology</a></p>
</li>
<li>
<p><a href="../../javaee-gettingstarted/" class="xref page">Getting Started with Java EE Applications</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">Keyboard Shortcuts &amp;amp; Code Templates Card</a></p>
</li>
<li>
<p><a href="../../../java-ee/" class="xref page">Java EE &amp;amp; Java Web Learning Trail</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_external_resources"><a class="anchor" href="#_external_resources"></a>External Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17409_01/javase/tutorial/i18n/index.html">The Java Tutorials: Internationalization</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnaxu.html">Java EE 5 Tutorial: Internationalizing and Localizing Web Applications</a></p>
</li>
<li>
<p><a href="http://java.sun.com/developer/technicalArticles/Intl/MultilingualJSP/index.html">Developing Multilingual Web Applications Using JavaServer Pages Technology</a></p>
</li>
<li>
<p><a href="http://java.sun.com/developer/technicalArticles/J2SE/locale/">Internationalization: Understanding Locale in the Java Platform</a></p>
</li>
<li>
<p><a href="http://java.sun.com/developer/technicalArticles/Intl/ResourceBundles/">Java Internationalization: Localization with ResourceBundles</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0415/">A JSTL primer, Part 3: Presentation is everything</a></p>
</li>
<li>
<p><a href="http://java.sun.com/javase/technologies/core/basic/intl/">Java Internationalization</a> [Technology Homepage]</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Internationalization_and_localization">Internationalization and localization</a> [Wikipedia]</p>
</li>
<li>
<p><a href="http://www.loc.gov/standards/iso639-2/php/code_list.php">ISO 639-2 Language Code List</a> [Library of Congress]</p>
</li>
<li>
<p><a href="http://www.w3.org/International/articlelist#language">W3C Internationalization Activity: Articles, best practices &amp;amp; tutorials: Language</a></p>
</li>
<li>
<p><a href="http://jquery.com/">jQuery</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/javaee/ecommerce/language.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../../_/css/search.css"></script>
<script async src="../../../../../../../search-index.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
