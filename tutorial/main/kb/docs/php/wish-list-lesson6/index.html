<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Lesson 6: Adding a New Wish to the Database</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lesson 6: Adding a New Wish to the Database - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Lesson 6: Adding a New Wish to the Database">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../../../index.html"><img src='../../../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <article class="doc">
      <h1 class="sect0">Lesson 6: Adding a New Wish to the Database</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/php/wish-list-lesson6.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_application_source_code_from_the_previous_lesson">Application Source Code from the Previous Lesson</a></li>
<li><a href="#_submitting_a_new_wish">Submitting a New Wish</a>
<ul class="sectlevel2">
<li><a href="#add-wish-ui-elements">Adding the User Interface Components</a></li>
<li><a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">Redisplaying the Due Date After an Unsuccessful Submission</a></li>
</ul>
</li>
<li><a href="#_verifying_the_wisher_s_logon">Verifying the Wisher&#8217;s Logon</a></li>
<li><a href="#insert-new-wish">Inserting the New Wish to the Database</a>
<ul class="sectlevel2">
<li><a href="#add-insert-wish">Adding the insert_wish Function to WishDB</a></li>
<li><a href="#add-format-date-for-sql">Adding the format_date_for_sql Function to WishDB</a></li>
<li><a href="#validateAndEnterWishToDatabase">Entering the New Wish Record in the Database</a></li>
<li><a href="#_displaying_error_messages">Displaying Error Messages</a></li>
</ul>
</li>
<li><a href="#_returning_to_the_front_index_php_page">Returning to the Front index.php Page</a></li>
<li><a href="#_testing_the_add_wish_functionality">Testing the Add Wish Functionality</a></li>
<li><a href="#_application_source_code_after_the_current_lesson_is_completed">Application Source Code after the Current Lesson Is Completed</a></li>
<li><a href="#_next_steps">Next Steps</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lesson you expand the application functionality with two features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_submitting_a_new_wish">Adding a new wish</a></p>
</li>
<li>
<p><a href="#_returning_to_the_front_index_php_page">Returning to the front index.php page</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To implement this functionality, you edit the  <code>editWishList.php</code>  file and create the new file  <code>editWish.php</code> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../_images/kb/docs/php/page-flow-diagram-l6.png" alt="page flow diagram l6">
</div>
</div>
<div class="paragraph">
<p>The current document is a part of the <a href="../wish-list-tutorial-main-page/" class="xref page">Creating a CRUD Application in the NetBeans IDE for PHP</a> tutorial.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_from_the_previous_lesson"><a class="anchor" href="#_application_source_code_from_the_previous_lesson"></a>Application Source Code from the Previous Lesson</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL users: Click <a href="https://netbeans.org/files/documents/4/1931/lesson5.zip">here</a> to download the source code that reflects the project state after the previous lesson is completed.</p>
</div>
<div class="paragraph">
<p>Oracle Database users: Click <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson5.zip">here</a> to download the source code that reflects the project state after the previous lesson is completed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_submitting_a_new_wish"><a class="anchor" href="#_submitting_a_new_wish"></a>Submitting a New Wish</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The user submits a new wish in the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The user logs in, switches to the  <code>editWishList.php</code>  page, and presses the Add Wish button. The  <code>editWish.php</code>  page opens, displaying an HTML form.</p>
</li>
<li>
<p>In the HTML form, the user enters a description of a wish and possibly the date by when he/she wants it and presses the Save Changes button.</p>
</li>
<li>
<p>If a form is submitted without a description of the wish, the user is returned to the form to try again. If the user submitted a due date but no description, that date is redisplayed when the form reloads.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable this procedure for the user, you add the following functionality to the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#add-wish-ui-elements">User interface components</a>, consisting of an HTML form for adding wishes and a button in  `editWishList.php ` that redirects the user to the form.</p>
</li>
<li>
<p>Code for <a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">redisplaying the due date</a> if an incomplete form is submitted.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-wish-ui-elements"><a class="anchor" href="#add-wish-ui-elements"></a>Adding the User Interface Components</h3>
<div class="paragraph">
<p><strong>To add functionality for adding a new wish:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement the Add Wish button. In the  <code>editWishList.php</code>  file, add the following HTML code beneath the PHP block:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="addNewWish" action="editWish.php"&gt;
            &lt;input type="submit" value="Add Wish"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> You can ignore warnings from the HTML validator.</p>
</div>
<div class="paragraph">
<p>The form contains an "Add Wish" input field of the  <code>submit</code>  type. This field implements the "Add Wish" button. When the user clicks Add Wish, they are redirected to the  <code>editWish.php</code>  page. Because no data is transferred through this form, no Server Request method is used.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a table above the addNewWish form that displays the existing wishes for the wisher. The code is similar to  <code>wishlist.php</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>For the MySQL database</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For the Oracle database:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['DESCRIPTION']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['DUE_DATE']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    oci_free_statement($stid);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the  <code>editWish.php</code>  PHP file in the Source Files folder.</p>
</li>
<li>
<p>In  <code>editWish.php</code> , implement the Add Wish form. Type or paste the following code below the &lt;? php ?&gt; block:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;

&lt;html&gt;
    &lt;head&gt;

        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="editWish" action="editWish.php" method="POST"&gt;
            Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
            When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;
            &lt;input type="submit" name="saveWish" value="Save Changes"/&gt;
            &lt;input type="submit" name="back" value="Back to the List"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Add Wish form contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two empty text fields for entering the wish description and due date.</p>
</li>
<li>
<p>The texts to be printed next to the input fields.</p>
</li>
<li>
<p>A  <code>submit</code>  field that represents a Save Changes button</p>
</li>
<li>
<p>A  <code>submit</code>  field that represents a Back to the List button for returning to the  <code>editWishList.php</code>  page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon pressing the Add Wish button, the form submits the entered data to the same page,  <code>editWish.php</code> , through the Request method POST.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redisplaying_the_due_date_after_an_unsuccessful_submission"><a class="anchor" href="#_redisplaying_the_due_date_after_an_unsuccessful_submission"></a>Redisplaying the Due Date After an Unsuccessful Submission</h3>
<div class="paragraph">
<p>If the user does not fill in a description in the Add Wish form, an error message is displayed and the user returns to the  <code>editWish.php</code>  page. When the user returns to  <code>editWish.php</code> , the Add Wish form should show the value of  <code>dueDate</code>  if it was entered. In the current implementation of the form, both fields are always empty. To keep entered values, you need to save the data of the new wish in an array. The array will consist of two elements named  <code>description</code>  and  <code>due_date</code> . You then need to change the Add Wish form so it retrieves the value of the  <code>dueDate</code>  field from the array.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The code that reloads the input form if no description is entered is included in the <a href="#_verifying_the_wisher_s_logon">code that validates the data and enters it to the database</a>. This code is not described in this section. The code in this section only preserves the value of  <code>dueDate</code>  so that it is displayed if the form is reloaded .</p>
</div>
<div class="paragraph">
<p><strong>To redisplay the input form after the user submits it unsuccessfully:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Type or paste the following code block inside the HTML &lt;body&gt; element of  <code>editWish.php</code> , directly above the input form:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;?php
if ($_SERVER['REQUEST_METHOD'] == "POST")
    $wish = array("description" =&gt; $_POST['wish'],
                        "due_date" =&gt; $_POST['dueDate']);
else
    $wish = array("description" =&gt; "",
                        "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code checks which Request Server method was used for transferring the data and creates an array named $wish. If the method is POST, which means that the input form is displayed after an unsuccessful attempt to save a wish with an empty description, the elements  <code>description</code>  and  <code>due_date</code>  accept the values transferred through POST.</p>
</div>
<div class="paragraph">
<p>If the method is not POST, which means that the input form is displayed for the first time after redirection form the  <code>editWishList.php</code>  page, the elements  <code>description</code>  and  <code>due_date</code>  are empty.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In either case the description is empty. The difference is only in the  <code>dueDate</code> .
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the Add Wish form so that the values of its input fields are retrieved from the  <code>$wish</code>  array. Replace the lines in the Add Wish form:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="&lt;?php echo $wish['description'];?&gt;" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value="&lt;?php echo $wish['due_date']; ?&gt;"/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_wisher_s_logon"><a class="anchor" href="#_verifying_the_wisher_s_logon"></a>Verifying the Wisher&#8217;s Logon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the  <code>editWish.php</code>  file, enter the following session handling code inside the &lt;? php ?&gt; block at the top of the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">session_start();
if (!array_key_exists("user", $_SESSION)) {
    header('Location: index.php');
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Opens the $_SESSION array for retrieving data..</p>
</li>
<li>
<p>Verifies that the array $_SESSION contains an element with the identifier "user".</p>
</li>
<li>
<p>If the check fails, which means that the user is not logged on, redirects the application to the front index.php page and cancels the PHP processing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To check that session handling works correctly, run the editWish.php file from the IDE. The index.php page opens, because no user has been transferred to the editWish.page through a session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="insert-new-wish"><a class="anchor" href="#insert-new-wish"></a>Inserting the New Wish to the Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After the user submits a new wish, the application needs to add the wish to the "wishes" database. To enable this functionality, add the following code to the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add two more auxiliary functions to the  <code>WishDB</code>  class in  <code>db.php</code> .</p>
</li>
<li>
<p>One function adds a new record to the wishes table.</p>
</li>
<li>
<p>The other function converts dates into the format that the MySQL databases server supports.</p>
</li>
<li>
<p>Add code to  <code>editWish.php</code>  that will use the new auxilliary functions in  <code>WishDB</code>  to enter the new wish into the database.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-insert-wish"><a class="anchor" href="#add-insert-wish"></a>Adding the insert_wish Function to WishDB</h3>
<div class="paragraph">
<p>This function requires the wisher&#8217;s id, a description of the new wish, and the due date of the wish as the input parameters and enters this data to the database in a new record. The function does not return any values.</p>
</div>
<div class="paragraph">
<p>Open  <code>db.php `  and add the function  `insert_wish</code>  into the  `WishDB ` class:</p>
</div>
<div class="paragraph">
<p><strong>For the MySQL database</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($this-&gt;format_date_for_sql($duedate)==null){
       $this-&gt;query("INSERT INTO wishes (wisher_id, description)" .
            " VALUES (" . $wisherID . ", '" . $description . "')");
    } else
        $this-&gt;query("INSERT INTO wishes (wisher_id, description, due_date)" .
            " VALUES (" . $wisherID . ", '" . $description . "', "
            . $this-&gt;format_date_for_sql($duedate) . ")");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For the Oracle database:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $query = "INSERT INTO wishes (wisher_id, description, due_date) VALUES (:wisher_id_bv, :desc_bv, to_date(:due_date_bv, 'YYYY-MM-DD'))";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wisher_id_bv', $wisherID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);
    oci_free_statement($stid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code calls the function format_date_for_sql to convert the entered due date into a format that can be processed by the database server. Then the query INSERT INTO wishes (wisher_id, description, due_date) is executed to enter the new wish to the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="add-format-date-for-sql"><a class="anchor" href="#add-format-date-for-sql"></a>Adding the format_date_for_sql Function to WishDB</h3>
<div class="paragraph">
<p>Add the function  <code>format_date_for_sql</code>  to the  <code>WishDB</code>  class in  <code>db.php</code> . The function requires a string with a date as the input parameter. The function returns a date in the format that can be processed by the database server or  <code>null</code>  if the input string is empty.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The function in this example uses the PHP  <code>date_parse</code>  function. This function works only with English-language dates, such as December 25, 2010, and only Arabic numerals. A professional web site would use a date picker.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>For the MySQL database:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts["year"] * 10000 + $dateParts["month"] * 100 + $dateParts["day"];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For the Oracle database:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts['year'] * 10000 + '-' + $dateParts['month'] * 100 + '-' + $dateParts['day'];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the input string is empty, the code returns NULL. Otherwise, the internal  <code>date_parse</code>  function is called with the  <code>$date</code>  as the input parameter. The  <code>date_parse</code>  function returns an array that consists of three elements named  <code>$dateParts["year"]</code> ,  <code>$dateParts["month"]</code> , and  <code>$dateParts["day"]</code> . The final output string is constructed of the elements of the  <code>$dateParts</code>  array.</p>
</div>
<div class="paragraph">
<p><strong>Important:</strong> The  <code>date_parse</code>  function recognizes only English dates. For example, it parses "February 2, 2016" but not "2 Unora, 2016".</p>
</div>
<div class="paragraph">
<p><strong>Note to Oracle Database users:</strong> The only format requirement is that the format of the date in the  <code>return $dateParts&#8230;&#8203;</code>  statement matches the date format in the  <code>to_date</code>  SQL function in the  <code>insert_wish</code>  query.</p>
</div>
</div>
<div class="sect2">
<h3 id="validateAndEnterWishToDatabase"><a class="anchor" href="#validateAndEnterWishToDatabase"></a>Entering the New Wish Record in the Database</h3>
<div class="paragraph">
<p>Now that you have developed the auxiliary functions, add code to validate the new wish data and enter the data to the database if it is valid. If the data is not valid, the code must reload the Add Wish form. If the data is invalid because no description has been entered but there is a due date, the due date is saved and redisplayed when the form reloads, thanks to code you <a href="#_returning_to_the_front_index_php_page">developed earlier</a>.</p>
</div>
<div class="paragraph">
<p>Enter the following code inside the top &lt;? php?&gt; block of  <code>editWish.php</code> , below the session handling code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">require_once("Includes/db.php");
$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION['user']);

$wishDescriptionIsEmpty = false;
if ($_SERVER['REQUEST_METHOD'] == "POST"){
    if (array_key_exists("back", $_POST)) {
        header('Location: editWishList.php' );
        exit;
    } else
    if ($_POST['wish'] == "") {
        $wishDescriptionIsEmpty =  true;
    } else {
        WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST['wish'], $_POST['dueDate']);
        header('Location: editWishList.php' );
        exit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code performs the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enables the use of the  <code>db.php</code>  file</p>
</li>
<li>
<p>Gets or creates an instance of the class  <code>WishDB</code></p>
</li>
<li>
<p>Retrieves the id of the wisher who is attempting to add a wish by calling the function  <code>get_wisher_id_by_name</code></p>
</li>
<li>
<p>Initializes the  <code>$wishDescriptionIsEmpty</code>  flag, which will be used later for showing error messages.</p>
</li>
<li>
<p>Checks that the Request method is POST, which means that the data was submitted from the form for entering the wish data on the  <code>editWish.php</code>  page itself.</p>
</li>
<li>
<p>Checks whether the  <code>$_POST</code>  array contains an element with the "back" key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the  <code>$_POST</code>  array contains an element with the "back" key, the Back to the List button was pressed before submitting the form. In this case the code redirects the user to the  <code>editWishList.php</code>  without saving any data that was entered in the fields and stops PHP processing.</p>
</div>
<div class="paragraph">
<p>If the $<em>POST array _does not</em> contain an element with the "back" key, the data was submitted by pressing the Save Changes button. In this case the code validates whether the wish description is filled in. The code does it by checking whether the element with the "wish" key in the $_POST array is empty and, if the key is empty, changes the $wishDescriptionIsEmpty flag to true. Note that with no further code executed in the PHP block, the Add Wish form reloads.</p>
</div>
<div class="paragraph">
<p>If the Back to the List button was not pressed and the wish description is filled in, the code calls the function  <code>insert_wish</code>  with the wisher&#8217;s id, the description, and the due date for the wish as the input parameters. The code then redirects the user to the  <code>editWishList.php</code>  page and stops the PHP processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_error_messages"><a class="anchor" href="#_displaying_error_messages"></a>Displaying Error Messages</h3>
<div class="paragraph">
<p>If the user attempts to save a wish but has not entered a description for it, an error message must be displayed.
Enter the following &lt;? php?&gt; block inside the HTML input form, below the "Describe your wish" input field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">&lt;?php
if ($wishDescriptionIsEmpty)
    echo "Please enter description&lt;br/&gt;";
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error message is displayed if the  <code>$wishDescriptionIsEmpty</code>  flag is true. The flag is processed during the input form validation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_returning_to_the_front_index_php_page"><a class="anchor" href="#_returning_to_the_front_index_php_page"></a>Returning to the Front index.php Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The user should be able to return to the front page of the application at any time by pressing a button.
To implement this functionality, enter the following HTML input form in the  <code>editWishList.php</code>  file, before the closing &lt;/body&gt; tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;form name="backToMainPage" action="index.php"&gt;&lt;input type="submit" value="Back To Main Page"/&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The form redirects the user to the front index.php page upon pressing the Back to Main Page button.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_add_wish_functionality"><a class="anchor" href="#_testing_the_add_wish_functionality"></a>Testing the Add Wish Functionality</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the application. On the  <code>index.php</code>  page, fill in the fields: in the Username field, enter "Tom", in the Password field, enter "tomcat".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../_images/kb/docs/php/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Press the Edit My Wish List button. The  <code>editWishList.php</code>  page opens.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../_images/kb/docs/php/edit-wish-list-add-wish.png" alt="edit wish list add wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Press the Back to Main Page button. The  <code>index.php</code>  page opens.</p>
</li>
<li>
<p>Logon as Tom and press the Edit My Wish List button again. The  <code>editWishList.php</code>  page opens.</p>
</li>
<li>
<p>Press the Add Wish button. The  <code>editWish.php</code>  page opens. Fill in the form.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../_images/kb/docs/php/new-wish.png" alt="new wish">
</div>
</div>
<div class="paragraph">
<p>Press the Back to the List button. The  <code>editWishList.php</code>  page opens but the entered wish is not added.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Press the Add Wish button again. The  <code>editWish.php</code>  page opens. Fill in the due date and leave the description empty. Press the Save Changes button. The  <code>editWish.php</code>  page displays the input form with an error message and filled in due date.</p>
</li>
<li>
<p>Press the Add Wish button again. The  <code>editWish.php</code>  page opens. Fill in the form and press the Save Changes button. The  <code>editWishList.php</code>  page shows an updated list of wishes.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../_images/kb/docs/php/edit-wish-list-updated.png" alt="edit wish list updated">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_after_the_current_lesson_is_completed"><a class="anchor" href="#_application_source_code_after_the_current_lesson_is_completed"></a>Application Source Code after the Current Lesson Is Completed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL users: Click <a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">here</a> to download the source code that reflects the project state after the lesson is completed.</p>
</div>
<div class="paragraph">
<p>Oracle Database users: Click <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">here</a> to download the source code that reflects the project state after the lesson is completed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../wish-list-lesson5/" class="xref page">&lt;&lt; Previous lesson</a></p>
</div>
<div class="paragraph">
<p><a href="../wish-list-lesson7/" class="xref page">Next lesson &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="../wish-list-tutorial-main-page/" class="xref page">Back to the Tutorial main page</a></p>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/kb/docs/php/wish-list-lesson6.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../_/css/search.css"></script>
<script async src="../../../../../../search-index.js"></script>
    <script src="../../../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
