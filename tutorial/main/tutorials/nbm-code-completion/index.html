<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans Code Completion Tutorial</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans Code Completion Tutorial - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, NetBeans Code Completion Tutorial">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 20</h1>
            <p><a class="button success" href="../../../../front/main/download/nb20">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans Code Completion Tutorial</h1>
            <div class="sectionbody">
              <div class="paragraph">
                <p class='reviewed'><i class="fa fa-check-circle"></i> Last reviewed on 2022-02-02</p>
              </div>
            </div>
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_code_completion_integration">Introduction to Code Completion Integration</a></li>
<li><a href="#_creating_the_module_project">Creating the Module Project</a></li>
<li><a href="#_implementing_the_completion_provider_class">Implementing the Completion Provider Class</a>
<ul class="sectlevel2">
<li><a href="#_implementing_the_createtask_method">Implementing the createTask Method</a></li>
<li><a href="#_implementing_the_getautoquerytypes_method">Implementing the getAutoQueryTypes Method</a></li>
</ul>
</li>
<li><a href="#_implementing_the_completion_item_class">Implementing the Completion Item Class</a>
<ul class="sectlevel2">
<li><a href="#_implementing_the_action">Implementing the Action</a></li>
<li><a href="#_implementing_the_filter">Implementing the Filter</a></li>
<li><a href="#_implementing_the_tooltip_and_documentation_task">Implementing the Tooltip and Documentation Task</a></li>
</ul>
</li>
<li><a href="#_see_also">See Also</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial shows you how to implement the
<a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/overview-summary.html">Editor
Code Completion API</a>. You will be shown how to implement the API in the context
of HTML files. When the user invokes the code completion feature, a code
completion box will appear, displaying words that can complete the text typed
in the editor. At the end of this tutorial, HTML files will have a code
completion box as follows:</p>
</div>
<div class="paragraph">
<p>The content of the code completion box will come from country names retrieved
from the JDK&#8217;s  <code>java.util.Locale</code>  package.</p>
</div>
<div class="paragraph">
<p>For troubleshooting purposes, you are welcome to download the  <a href="http://web.archive.org/web/20150927111721/https://java.net/projects/nb-api-samples/sources/api-samples/show/versions/8.0/tutorials/CountryCodeCompleter">completed tutorial source code</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_code_completion_integration"><a class="anchor" href="#_introduction_to_code_completion_integration"></a>Introduction to Code Completion Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Two classes apply to code completion and these will be developed in this tutorial:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html">CompletionItem</a></code></p>
</li>
<li>
<p><code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html">CompletionProvider</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of these come from the  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/overview-summary.html">Editor Code Completion API</a> and are implemented in this tutorial&#8217;s module as CountriesCompletionItem and CountriesCompletionProvider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_module_project"><a class="anchor" href="#_creating_the_module_project"></a>Creating the Module Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we use a wizard to create the source structure that every NetBeans module requires. The source structure consists of certain folders in specific places and a set of files that are always needed. For example, every Ant-based NetBeans module requires a  <code>nbproject</code>  folder, which holds the project&#8217;s metadata.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Choose File &gt; New Project (Ctrl-Shift-N). Under Categories, select NetBeans Modules. Under Projects, select Module. Click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>In the Name and Location panel, type  <code>CountryCodeCompleter</code>  in Project Name. Change the Project Location to any directory on your computer. Click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In the Basic Module Configuration panel, type  <code>org.netbeans.modules.countries</code>  as the Code Name Base. Click Finish.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The IDE creates the  <code>CountryCodeCompleter</code>  project. The project contains all of your sources and project metadata, such as the project&#8217;s Ant build script. The project opens in the IDE. You can view its logical structure in the Projects window (Ctrl-1) and its file structure in the Files window (Ctrl-2).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_the_completion_provider_class"><a class="anchor" href="#_implementing_the_completion_provider_class"></a>Implementing the Completion Provider Class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first class we will deal with when creating a code completion feature for HTML files is the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html">CompletionProvider</a></code> . As the user types in an editor, the code completion infrastructure asks all code completion providers registered in the XML layer file to create  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionTask.html">CompletionTasks</a></code> . The tasks are created by the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html#createTask(int,%20javax.swing.text.JTextComponent)">CompletionProvider.createTask</a></code>  method. What <em>happens</em> when the method is invoked is up to the implementation. In <em>our</em> implementation, we will create a  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html">CompletionItem</a></code>  for a list of countries.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Right-click the LIbraries node of the  <code>CountryCodeCompleter</code>  project and choose Add Module Dependency:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_72_deps.png" alt="cc 72 deps">
</div>
</div>
<div class="paragraph">
<p>Set dependencies on the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Editor Code Completion", which provides the API classes that we need in this tutorial.</p>
</li>
<li>
<p>"MIME Lookup API", which provides the Java annotation for registering completion providers.</p>
</li>
<li>
<p>"Utilities API".</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Right-click the  <code>CountryCodeCompleter</code>  project and choose New &gt; Java Class. In Class Name, type  <code>CountriesCompletionProvider</code> . In Package, choose  <code>org.netbeans.modules.countries</code> . Click Finish.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>1.
In the  <code>CountriesCompletionProvider</code>  class, change the signature so that the class  <code>implements CompletionProvider</code> . Place the cursor on the line that defines the signature. A lightbulb appears. Click it and the IDE adds an import statement for  <code>org.netbeans.spi.editor.completion.CompletionProvider</code> . The lightbulb appears again. Click it again and the IDE creates skeleton methods for the two methods required by the CompletionProvider class. You should now see this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.netbeans.modules.countries;

import javax.swing.text.JTextComponent;
import org.netbeans.spi.editor.completion.CompletionProvider;
import org.netbeans.spi.editor.completion.CompletionTask;

public class CountriesCompletionProvider implements  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html">CompletionProvider</a> {

    public CountriesCompletionProvider() {
    }

    @Override
    public  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionTask.html">CompletionTask</a>  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html#createTask(int,%20javax.swing.text.JTextComponent)">createTask(int queryType, JTextComponent jtc)</a> {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public int  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html#getAutoQueryTypes(javax.swing.text.JTextComponent,%20java.lang.String)">getAutoQueryTypes(JTextComponent component, String typedText)</a> {
        throw new UnsupportedOperationException("Not supported yet.");
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Before coding the  <code>CompletionProvider</code>  class, let&#8217;s register it in the XML layer file, via a NetBeans Platform annotation:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.netbeans.modules.countries;

import javax.swing.text.JTextComponent;
import org.netbeans.api.editor.mimelookup.MimeRegistration;
import org.netbeans.spi.editor.completion.CompletionProvider;
import org.netbeans.spi.editor.completion.CompletionTask;

@MimeRegistration(mimeType = "text/html", service = CompletionProvider.class)
public class CountriesCompletionProvider implements CompletionProvider {

    @Override
    public CompletionTask createTask(int queryType, JTextComponent jtc) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public int getAutoQueryTypes(JTextComponent component, String typedText) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read  <a href="http://netbeans.dzone.com/news/mimelocation-mimeregistration">@MimeLocation, @MimeRegistration and @MimeRegistrations added</a> for details on the annotation above.</p>
</div>
<div class="sect2">
<h3 id="_implementing_the_createtask_method"><a class="anchor" href="#_implementing_the_createtask_method"></a>Implementing the createTask Method</h3>
<div class="paragraph">
<p>In this section we create a skeleton implementation of  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/support/AsyncCompletionTask.html">AsyncCompletionTask</a></code> . In the next sections, we will fill this skeleton method out.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>In the createTask method, below the code from the previous section, add the following lines:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">return new AsyncCompletionTask(new AsyncCompletionQuery() {
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we&#8217;re returning  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/support/AsyncCompletionTask.html">AsyncCompletionTask</a></code> , which will allow for the asynchronous creation of our task. The class comes from the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/support/package-summary.html">org.netbeans.spi.editor.completion.support</a></code>  package, which provides several useful supporting classes for code completion implementations. We will use several of them in this tutorial.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Place the cursor on the line. Click the lightbulb that appears and let the IDE add import statements. Also let it create a skeleton method for the  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/support/AsyncCompletionTask.html#query(org.netbeans.spi.editor.completion.CompletionResultSet)">query</a> method.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Next, we need to specify which code completion type we are working with. When the user clicks Ctrl-Space, or an alternative key combination defined by the user, our code completion entries should appear. This is the COMPLETION_QUERY_TYPE. Alternative query types exist, such as DOCUMENTATION_QUERY_TYPE and TOOLTIP_QUERY_TYPE. We need to test whether the user pressed the keys applicable to the COMPLETION_QUERY_TYPE. Therefore add the following test to the start of the  <code>createTask</code>  method:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">if (queryType != CompletionProvider.COMPLETION_QUERY_TYPE)
   return null;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage, the  <code>createTask</code>  method should look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public CompletionTask createTask(int queryType, JTextComponent jtc) {

    if (queryType != CompletionProvider.COMPLETION_QUERY_TYPE)
        return null;

    return new AsyncCompletionTask(new AsyncCompletionQuery() {
        protected void query(CompletionResultSet completionResultSet, Document document, int caretOffset) {
        }
    });

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_the_getautoquerytypes_method"><a class="anchor" href="#_implementing_the_getautoquerytypes_method"></a>Implementing the getAutoQueryTypes Method</h3>
<div class="paragraph">
<p>In this section we return 0 as our  <code>AutoQueryType</code> , so that the code completion box does not appear automatically, but only when requested by the user.</p>
</div>
<div class="paragraph">
<p>Before filling out the  <code>query</code>  method, let&#8217;s look at the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionProvider.html#getAutoQueryTypes(javax.swing.text.JTextComponent,%20java.lang.String)">getAutoQueryTypes(JTextComponent jTextComponent, String string)</a></code>  method. This method determines whether the code completion box appears <em>automatically</em> or not. For now, let&#8217;s return 0. This means that the code completion box will never appear unless the user explicitly asks for it. So, this method should now look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public int getAutoQueryTypes(JTextComponent component, String string) {
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the user would press Ctrl-Space to make the code completion box appear. Later, we can add a new option to our Options window extension, such as a checkbox which will change the int returned in this method from 0 to 1, so that the code completion box appears automatically. (There are also other types of queries, as shown  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/constant-values.html#org.netbeans.spi.editor.completion.CompletionProvider.COMPLETION_QUERY_TYPE">here</a>.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_the_completion_item_class"><a class="anchor" href="#_implementing_the_completion_item_class"></a>Implementing the Completion Item Class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will create a class that implements  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html">CompletionItem</a></code> . Once we have defined this class, we will fill out the query method in the  <code>CompletionProvider</code>  class. The  <code>CompletionProvider</code>  will create instances of our  <code>CompletionItem</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Right-click the  <code>CountryCodeCompleter</code>  project and choose New &gt; Java Class. In Class Name, type  <code>CountriesCompletionItem</code> . In Package, choose  <code>org.netbeans.modules.countries</code> . Click Finish.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>We will return to this class in later steps. For now, we will fill out the query method that we defined in the CompletionProvider class. Fill out the AsyncCompletionTask as follows, and note the explanatory comments in the code:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">return new  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/support/AsyncCompletionTask.html">AsyncCompletionTask</a>(new AsyncCompletionQuery() {

    @Override
    protected void query(CompletionResultSet completionResultSet, Document document, int caretOffset) {

        //Iterate through the available locales
        //and assign each country display name
        //to a CompletionResultSet:
        Locale[] locales = Locale.getAvailableLocales();
        for (int i = 0; i &lt; locales.length; i++) {
            final Locale locale = locales[i];
            final String country = locale.getDisplayCountry();
            if (!country.equals("")) {
                completionResultSet.addItem(new CountriesCompletionItem(country, caretOffset));
            }
        }

        completionResultSet.finish();
    }

}, jtc);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A red underline remains, after you let the IDE add various import statements. The error underline tells you that the CompletionItem&#8217;s constructor does not expect the values that you are passing to it. In the next step, we will fill out the CompletionItem so that it meets the requirements of the CompletionProvider.</p>
</div>
<div class="paragraph">
<p>Read  <a href="../../../../front/main/blogs/geertjan/java_classes_in_code_completion/" class="xref page">Java Classes in Code Completion</a> to learn how to put Java classes in the code completion box, instead of the locales that are used above.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In the  <code>CountriesCompletionItem</code>  class, change the signature so that the class  <code>implements CompletionItem</code> . Let the IDE create import statements and skeleton implementations for the class&#8217;s required methods. Read the entry in the NetBeans Javadoc for  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html">CompletionItem</a></code>  to begin to understand what each of the methods is for. For now, we will implement a minimal completion item, just enough to be able to compile the module and see the code completion box.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>In the CountriesCompletionItem class, define the constructor as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private String text;
private static ImageIcon fieldIcon =
        new ImageIcon(ImageUtilities.loadImage("org/netbeans/modules/countries/icon.png"));
private static Color fieldColor = Color.decode("0x0000B2");
private int caretOffset;

public CountriesCompletionItem(String text, int caretOffset) {
    this.text = text;
    this.caretOffset = caretOffset;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that here we&#8217;re referencing an icon. This is the icon that will appear next to each entry represented by the CompletionItem in the code completion box. The icon can be any icon with a dimension of 16x16 pixels. For example, you could make use of this icon: <span class="image"><img src="../../_images/tutorials/cc_icon.png" alt="cc icon"></span></p>
</div>
<div class="paragraph">
<p>If you like, you can right-click the image above and save it to the location specified in the ImageIcon definition above.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Next define the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html#getPreferredWidth(java.awt.Graphics,%20java.awt.Font)">getPreferredWidth()</a></code>  and  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html#render(java.awt.Graphics,%20java.awt.Font,%20java.awt.Color,%20java.awt.Color,%20int,%20int,%20boolean)">render()</a></code>  methods as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public int getPreferredWidth(Graphics graphics, Font font) {
    return CompletionUtilities.getPreferredWidth(text, null, graphics, font);
}

@Override
public void render(Graphics g, Font defaultFont, Color defaultColor,
        Color backgroundColor, int width, int height, boolean selected) {
    CompletionUtilities.renderHtml(fieldIcon, text, null, g, defaultFont,
            (selected ? Color.white : fieldColor), width, height, selected);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html#getSortText()">getSortText()</a></code>  method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public CharSequence getSortText() {
    return text;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, define the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html#getInsertPrefix()">getInsertPrefix()</a></code>  method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public CharSequence getInsertPrefix() {
    return text;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, create dummy implementations of the remaining methods. So, return  <code>null</code>  for  <code>createDocumentationTask()</code>  and  <code>createToolTipTask()</code> . Then return  <code>false</code>  for  <code>instantSubstitution()</code>  and return  <code>0</code>  for  <code>getSortPriority()</code> . Finally, empty the methods  <code>defaultAction</code>  and  <code>processKeyEvent</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Right-click the module and choose Run. A new instance of the IDE starts up and installs your module. Open an HTML file in the IDE. Type something and press Ctrl-Space. You should now see the following:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_72_result-1.png" alt="cc 72 result 1">
</div>
</div>
<div class="paragraph">
<p>When you press Enter in the list above, nothing happens. That is because we have not defined the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-editor-completion/org/netbeans/spi/editor/completion/CompletionItem.html#defaultAction(javax.swing.text.JTextComponent)">defaultAction()</a></code>  method yet. We will do so in the next section. Also note that the list does not narrow while you are typing. That is because we have not created a filter yet. The filter will detect what we are typing and adjust the entries in the list accordingly. We will create a filter in a later section.</p>
</div>
<div class="sect2">
<h3 id="_implementing_the_action"><a class="anchor" href="#_implementing_the_action"></a>Implementing the Action</h3>
<div class="paragraph">
<p>In this section we specify what happens when the user presses the Enter key or clicks the mouse over an entry in the code completion box.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Fill out the  <code>defaultAction()</code>  method as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public void defaultAction(JTextComponent jtc) {
    try {
        StyledDocument doc = (StyledDocument) jtc.getDocument();
        doc.insertString(caretOffset, text, null);
        //This statement will close the code completion box:
        Completion.get().hideAll();
    } catch (BadLocationException ex) {
        Exceptions.printStackTrace(ex);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Install the module again. Notice that when you press Enter or click the mouse over an entry in the code completion box, the selected text is added at the cursor in your HTML file. However, the text that you typed prior to calling up the code completion box is not removed. Below, the "V" should be removed, because "Vietnam" was selected from the code completion box:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_65-result-of-cc2.png" alt="cc 65 result of cc2">
</div>
</div>
<div class="paragraph">
<p>In the next section, we will add functionality to detect the number of characters that have been typed and remove them when the selected country is inserted into the document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_the_filter"><a class="anchor" href="#_implementing_the_filter"></a>Implementing the Filter</h3>
<div class="paragraph">
<p>In this section we enable the code completion box to narrow while the user is typing. In this way, when the user types 'hel', only words that begin with those letters are shown in the code completion box. The filter is defined in the  <code>CountriesCompletionProvider</code>  class.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>In the CountriesCompletionProvider class, rewrite the  <code>AsyncCompletionTask()</code>  method by adding the statements highlighted in bold below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">return new AsyncCompletionTask(new AsyncCompletionQuery() {

    @Override
    protected void query(CompletionResultSet completionResultSet, Document document, int caretOffset) {

        String filter = null;
        int startOffset = caretOffset - 1;

        try {
            final StyledDocument bDoc = (StyledDocument) document;
            final int lineStartOffset = getRowFirstNonWhite(bDoc, caretOffset);
            final char[] line = bDoc.getText(lineStartOffset, caretOffset - lineStartOffset).toCharArray();
            final int whiteOffset = indexOfWhite(line);
            filter = new String(line, whiteOffset + 1, line.length - whiteOffset - 1);
            if (whiteOffset &gt; 0) {
                startOffset = lineStartOffset + whiteOffset + 1;
            } else {
                startOffset = lineStartOffset;
            }
        } catch (BadLocationException ex) {
            Exceptions.printStackTrace(ex);
        }

        //Iterate through the available locales
        //and assign each country display name
        //to a CompletionResultSet:
        Locale[] locales = Locale.getAvailableLocales();
        for (int i = 0; i &lt; locales.length; i++) {
            final Locale locale = locales[i];
            final String country = locale.getDisplayCountry();
            //Here we test whether the country starts with the filter defined above:
            if (!country.equals("") &amp;&amp; country.startsWith(filter)) {
                //Here we include the start offset, so that we'll be able to figure out
                //the number of characters that we'll need to remove:
                completionResultSet.addItem(new CountriesCompletionItem(country, startOffset, caretOffset));
            }
        }
        completionResultSet.finish();

    }

}, jtc);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Right at the end of the CountriesCompletionProvider, add the following two methods:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static int getRowFirstNonWhite(StyledDocument doc, int offset)
throws BadLocationException {
    Element lineElement = doc.getParagraphElement(offset);
    int start = lineElement.getStartOffset();
    while (start + 1 &lt; lineElement.getEndOffset()) {
        try {
            if (doc.getText(start, 1).charAt(0) != ' ') {
                break;
            }
        } catch (BadLocationException ex) {
            throw (BadLocationException)new BadLocationException(
                    "calling getText(" + start + ", " + (start + 1) +
                    ") on doc of length: " + doc.getLength(), start
                    ).initCause(ex);
        }
        start++;
    }
    return start;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static int indexOfWhite(char[] line){
    int i = line.length;
    while(--i > -1){
        final char c = line[i];
        if(Character.isWhitespace(c)){
            return i;
        }
    }
    return -1;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Change the constructor of the  <code>CountriesCompletionItem</code>  to receive the start offset. Then change the  <code>defaultAction</code>  so that the start offset will be used in determining the characters that will be removed when the selected country is inserted.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Below, the statements that should be added: <code>private int dotOffset;</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public CountriesCompletionItem(String text, int dotOffset, int caretOffset) {
    this.text = text;
    this.dotOffset = dotOffset;
    this.caretOffset = caretOffset;
}

@Override
public void defaultAction(JTextComponent component) {
    try {
        StyledDocument doc = (StyledDocument) component.getDocument();
        //Here we remove the characters starting at the start offset
        //and ending at the point where the caret is currently found:
        doc.remove(dotOffset, caretOffset-dotOffset);
        doc.insertString(dotOffset, text, null);
        Completion.get().hideAll();
    } catch (BadLocationException ex) {
        Exceptions.printStackTrace(ex);
    }
}

...
...
...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Install the module again and notice that this time the list of words narrows while you are typing&#8230;&#8203;</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_65-result-of-cc.png" alt="cc 65 result of cc">
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and that when you press Enter, the characters that you typed are removed and replaced by the country selected from the code completion box.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_the_tooltip_and_documentation_task"><a class="anchor" href="#_implementing_the_tooltip_and_documentation_task"></a>Implementing the Tooltip and Documentation Task</h3>
<div class="paragraph">
<p>Some optional features can also be added, as described below.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Optionally, you can implement the  <code>createToolTipTask</code>  method in the  <code>CountriesCompletionItem</code> , with this result when Ctrl-P is pressed:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_65-result-of-cc3.png" alt="cc 65 result of cc3">
</div>
</div>
<div class="paragraph">
<p>Here is the code that will achieve the result shown in the screenshot above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public CompletionTask createToolTipTask() {
    return new AsyncCompletionTask(new AsyncCompletionQuery() {
        @Override
        protected void query(CompletionResultSet completionResultSet, Document document, int i) {
            JToolTip toolTip = new JToolTip();
            toolTip.setTipText("Press Enter to insert \"" + text + "\"");
            completionResultSet.setToolTip(toolTip);
            completionResultSet.finish();
        }
    });
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Optionally, you can provide documentation for the entries in the code completion box:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_65-result-of-cc4.png" alt="cc 65 result of cc4">
</div>
</div>
<div class="paragraph">
<p>Make use of the documentation box like this, by implementing the  <code>createDocumentationTask</code>  method in the  <code>CountriesCompletionItem</code>  class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public CompletionTask createDocumentationTask() {
    return new AsyncCompletionTask(new AsyncCompletionQuery() {
        @Override
        protected void query(CompletionResultSet completionResultSet, Document document, int i) {
            completionResultSet.setDocumentation(new CountriesCompletionDocumentation(CountriesCompletionItem.this));
            completionResultSet.finish();
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, the reference to the CountriesCompletionDocumentation class could be implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CountriesCompletionDocumentation implements CompletionDocumentation {

    private CountriesCompletionItem item;

    public CountriesCompletionDocumentation(CountriesCompletionItem item) {
        this.item = item;
    }

    @Override
    public String getText() {
        return "Information about " + item.text;
    }

    @Override
    public URL getURL() {
        return null;
    }

    @Override
    public CompletionDocumentation resolveLink(String string) {
        return null;
    }

    @Override
    public Action getGotoSourceAction() {
        return null;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By implementing the  <code>getURL()</code>  in the code above, you can enable the URL button, as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/cc_65-result-of-cc5.png" alt="cc 65 result of cc5">
</div>
</div>
<div class="paragraph">
<p>When the user clicks the URL button, the browser set in the IDE will open, displaying the content provided by the specified URL.</p>
</div>
<div class="paragraph">
<p>Congratulations, you have now completed a simple implementation of a code completion integration module.</p>
</div>
<div class="paragraph">
<p><a href="../../../../front/main/community/mailing-lists/" class="xref page">Send Us Your Feedback</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also"><a class="anchor" href="#_see_also"></a>See Also</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about creating and developing plugins, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../kb/docs/platform/" class="xref page">NetBeans Platform Learning Trail</a></p>
</li>
<li>
<p><a href="https://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
</div>
</div>
        <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/tutorials/nbm-code-completion.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
