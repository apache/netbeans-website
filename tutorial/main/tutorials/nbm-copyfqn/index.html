<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans Java Language Infrastructure Tutorial</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans Java Language Infrastructure Tutorial - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, NetBeans Java Language Infrastructure Tutorial">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans Java Language Infrastructure Tutorial</h1>
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/tutorials/nbm-copyfqn.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="../../../../tutorial/main/kb/docs/contributing">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_the_java_language_infrastructure">Introduction to the Java Language Infrastructure</a></li>
<li><a href="#_setting_up_the_module">Setting Up the Module</a></li>
<li><a href="#_creating_a_context_sensitive_toolbar_button">Creating a Context-Sensitive Toolbar Button</a></li>
<li><a href="#_identifying_java_source_files">Identifying Java Source Files</a></li>
<li><a href="#_determining_open_state">Determining Open State</a></li>
<li><a href="#_detecting_the_element_under_the_caret">Detecting the Element Under the Caret</a></li>
<li><a href="#_doing_something_useful">Doing Something Useful</a></li>
<li><a href="#_see_also">See Also</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you will be introduced to aspects of the NetBeans "Retouche" APIs, which give you access to the NetBeans Java editor.</p>
</div>
<div class="paragraph">
<p>For troubleshooting purposes, you are welcome to download the  <a href="http://web.archive.org/web/20170409072842/http://java.net/projects/nb-api-samples/show/versions/8.0/tutorials/CopyFQN">completed tutorial source code</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_the_java_language_infrastructure"><a class="anchor" href="#_introduction_to_the_java_language_infrastructure"></a>Introduction to the Java Language Infrastructure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prior to NetBeans IDE 6, the Java language infrastructure that supported the Java editor, including Java code generation and Java refactoring, was based on something called "JMI for Java" (also known as "MDR"). JMI for Java had a few architectural issues such as single-read lock. In other words, a lock had to be acquired just to read information from its model, while this is normally required when doing write actions only. Over a period of a few years, JMI was debugged and improved in terms of performance. But another issue was that it used its own internal copy of the Java parser, which meant it had its own approach to interpreting Java source, which differed from the JDK&#8217;s Java compiler. With the introduction of generics in JDK 5, which introduced a lot more complicated and subtle Java constructs, that divergence became harder to manage. Therefore, because of JMI&#8217;s performance issues and because a formal language model was developed to make the JDK Java compiler a programmatically accessible tool, the JMI for Java was replaced with a new approach, based on the JDK Java compiler.</p>
</div>
<div class="paragraph">
<p>That is when Retouche, a French word meaning "touch up", was born. Retouche is the new and fast Java language infrastructure in NetBeans IDE, capable of supporting all the cool Java editor features that have been realised in NetBeans 6.0. At the heart of it, Retouche wraps an instance of the JDK Java compiler and consumes its artifacts, such as the abstract syntax tree (also known as "AST") and the symbolic resolutions that are emitted in various phases of parsing. When working with Retouche, you need to deal with some of these artifacts. The  <a href="http://java.sun.com/javase/6/docs/jdk/api/javac/tree/index.html">Compiler Tree API</a> is one of these, for example. The package naming of classes in the Compiler Tree API is  <code>com.sun.<strong></code> . Therefore, technically, this is a non-JDK API, but it does come from the JDK Java compiler. Another example of the JDK Java compiler&#8217;s artifacts that you work with in relation to Retouche is the formal language model in the JDK APIs, provided by the  <code>javax.language.model.</strong></code>  packages.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_the_module"><a class="anchor" href="#_setting_up_the_module"></a>Setting Up the Module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we use wizards and dialogs in NetBeans IDE to create a module project and to set dependencies on relevant NetBeans modules.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Choose File &gt; New Project. In the New Project wizard, choose NetBeans Modules under Categories and Module under Projects. Click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Type  <code>CopyFQN</code>  in Project Name and set Project Location to an appropriate folder on your disk. Click Next.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Type  <code>org.netbeans.modules.copyfqn</code>  in Code Name Base and  <code>CopyFQN</code>  in Module Display Name. Click Finish.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Right-click the project&#8217;s Libraries node, choose Add Module Dependency, and declare dependencies on the following APIs:</p>
<div class="ulist">
<ul>
<li>
<p>Datasystems API</p>
</li>
<li>
<p>Editor Library 2</p>
</li>
<li>
<p>File System API</p>
</li>
<li>
<p>Javac API Wrapper</p>
</li>
<li>
<p>Java Source</p>
</li>
<li>
<p>Lookup API</p>
</li>
<li>
<p>Nodes API</p>
</li>
<li>
<p>Text API</p>
</li>
<li>
<p>UI Utilities API</p>
</li>
<li>
<p>Utilities API</p>
</li>
<li>
<p>Window System API</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You should now see this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_pic1.png" alt="copyfqn 72 pic1">
</div>
</div>
<div class="paragraph">
<p>Click OK.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_context_sensitive_toolbar_button"><a class="anchor" href="#_creating_a_context_sensitive_toolbar_button"></a>Creating a Context-Sensitive Toolbar Button</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we create a context-aware button in the toolbar. This has nothing to do with the Retouche APIs discussed in the introduction of this tutorial, but gives us a user interface element for interacting with our implementation of the Retouche APIs, later in this tutorial.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Right-click the CopyFQN module project, choose New &gt; Other and choose Action from the Module Development category.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_pic2.png" alt="copyfqn 72 pic2">
</div>
</div>
<div class="paragraph">
<p>Click Next.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Choose Conditionally Enabled, choose DataObject, and keep all the defaults, as shown below, so that the action will be sensitive to  <code>DataObjects</code>  and so that it will only be enabled when one  <code>DataObject</code>  is selected.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_pic3.png" alt="copyfqn 72 pic3">
</div>
</div>
<div class="paragraph">
<p>Click Next.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Choose "File" in Category and "File" in Toolbar. You should now see the following:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_pic4.png" alt="copyfqn 72 pic4">
</div>
</div>
<div class="paragraph">
<p>Click Next.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Type  <code>CopyFQNAction</code>  in Class Name and  <code>CopyFQN</code>  in Display Name. Browse to an icon that will be displayed in the toolbar button. For example, use the one that will be used throughout this tutorial:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_icon.png" alt="copyfqn icon">
</div>
</div>
<div class="paragraph">
<p>You should now see the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_pic5.png" alt="copyfqn 72 pic5">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click Finish. You should now see the following code in your new  <code>CopyFQNAction.java</code>  class:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.netbeans.modules.copyfqn;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import org.openide.awt.ActionID;
import org.openide.awt.ActionReference;
import org.openide.awt.ActionRegistration;
import org.openide.loaders.DataObject;
import org.openide.util.NbBundle.Messages;

@ActionID(
        category = "File",
        id = "org.netbeans.modules.copyfqn.CopyFQNAction")
@ActionRegistration(
        iconBase = "org/netbeans/modules/copyfqn/icon.png",
displayName = "#CTL_CopyFQNAction")
@ActionReference(
        path = "Toolbars/File",
        position = 0)
@Messages("CTL_CopyFQNAction=CopyFQN")
public final class CopyFQNAction implements ActionListener {

    private final DataObject context;

    public CopyFQNAction(DataObject context) {
        this.context = context;
    }

    @Override
    public void actionPerformed(ActionEvent ev) {
        // TODO use context
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All the work we will do in the remainder of this tutorial will focus on the  <code>actionPerformed</code>  method above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have now created an action that is sensitive to data objects. Let&#8217;s see what that means right away.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Right-click the module and choose Run. Once the new instance of the IDE is started up and the module is installed, you should see a new button in the toolbar:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_first1.png" alt="copyfqn 72 first1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Select a node in the Projects window and then look at the button in the toolbar. If you select a node representing a file or folder (including a package) the button is enabled, as shown here:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_first2.png" alt="copyfqn 72 first2">
</div>
</div>
<div class="paragraph">
<p>However, if you select a node representing a project, the button is disabled, as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_first3.png" alt="copyfqn 72 first3">
</div>
</div>
<div class="paragraph">
<p>In the next section, we will go further than distinguishing between project nodes and file/folder nodes, which is what we&#8217;re able to do so farâ€”we will distinguish between file nodes for Java classes versus all other kinds of file nodes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_identifying_java_source_files"><a class="anchor" href="#_identifying_java_source_files"></a>Identifying Java Source Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we begin using one of the new "Retouche" APIs, called  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/overview-summary.html">Java Source</a>. Here we use the  <code> <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html">JavaSource</a></code>  class, which represents a Java source file. We return an instance of this class for the file object associated with our data object. If null is returned, the file object is not a Java source file. We display the result in the status bar, when the button is clicked while a file is selected.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Fill out the  <code>actionPerformed</code>  method by adding the lines highlighted below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void actionPerformed(ActionEvent ev) {

    <strong>FileObject fileObject = context.getPrimaryFile();

    <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html">JavaSource</a> javaSource =  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#forFileObject-org.openide.filesystems.FileObject-">JavaSource.forFileObject(fileObject)</a>;
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
    } else {
        StatusDisplayer.getDefault().setStatusText("Hurray! A Java file: " + fileObject.getPath());
    }</strong>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that your import statements are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import org.netbeans.api.java.source.JavaSource;
import org.openide.awt.*;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.util.NbBundle.Messages;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Run the module again. Select a file node and press the button. Notice that the "Hurray!" message only appears when you select a Java file, as shown below:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_second1.png" alt="copyfqn 72 second1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_second2.png" alt="copyfqn 72 second2">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_determining_open_state"><a class="anchor" href="#_determining_open_state"></a>Determining Open State</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we are introduced to our first explicitly invoked "Retouche" task. Such a task is provided by the JavaSource class&#8217;s  <code>runUserActionTask</code>  method. A task of this kind lets you control the phases of a parsing process, which is applicable when you want to respond immediately to the user&#8217;s input. Everything done within the task is done as a single unit. In our case, we want the invocation of our action, represented by a button in the toolbar, to be immediately followed by the display of a text in the status bar.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Replace the "Hurray!" message in the  <code>actionPerformed</code>  method with this line: <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#runUserActionTask(org.netbeans.api.java.source.Task,%20boolean)">javaSource.runUserActionTask</a></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">(new <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/Task.html">Task</a>&lt; <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html">CompilationController</a>&gt;());</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should now see a lightbulb in the editor&#8217;s left sidebar, as shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_71_runuserasactiontask.png" alt="copyfqn 71 runuserasactiontask">
</div>
</div>
<div class="paragraph">
<p>Press Ctrl-Shift-I to import the necessary classes, choose  <code>org.netbeans.api.java.source.Task</code> , shown below, and click OK in the dialog box.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_second3.png" alt="copyfqn 72 second3">
</div>
</div>
<div class="paragraph">
<p>Click the lightbulb in the editor. Alternatively, put the caret in the line and press Alt-Enter. Then let the IDE implement the method.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Tweak the generated method slightly, by adding a  <code>true</code>  boolean to the end of the method, and letting the IDE wrap the snippet in a try/catch block. At the end, the result should be as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void actionPerformed(ActionEvent ev) {

    FileObject fileObject = context.getPrimaryFile();

    JavaSource javaSource = JavaSource.forFileObject(fileObject);
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
     } else {

            <strong>try {
                javaSource.runUserActionTask(new Task&lt;CompilationController&gt;() {
                    public void run(CompilationController arg0) throws Exception {
                        throw new UnsupportedOperationException("Not supported yet.");
                    }
                }, true);
            } catch (IOException ex) {
                Exceptions.printStackTrace(ex);
            }</strong>

     }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Implement the  <code>run()</code>  method as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public void run(CompilationController compilationController) throws Exception {

      <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#toPhase(org.netbeans.api.java.source.JavaSource.Phase)">compilationController.toPhase(Phase.ELEMENTS_RESOLVED)</a>;

      <a href="https://docs.oracle.com/javase/1.5.0/docs/api/javax/swing/text/Document.html">Document</a> document =  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#getDocument()">compilationController.getDocument()</a>;
      if (document != null) {
         StatusDisplayer.getDefault().setStatusText("Hurray, the Java file is open!");
      } else {
         StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
      }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure that your import statements are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.IOException;
import javax.swing.text.Document;
import org.netbeans.api.java.source.CompilationController;
import org.netbeans.api.java.source.JavaSource;
import org.netbeans.api.java.source.JavaSource.Phase;
import org.netbeans.api.java.source.Task;
import org.openide.awt.*;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.util.Exceptions;
import org.openide.util.NbBundle.Messages;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Run the module again. Select a file node and press the button. Notice that the "Hurray!" message only appears when you select a Java file that is open in the Java editor, as shown here:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_third1.png" alt="copyfqn 72 third1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_third2.png" alt="copyfqn 72 third2">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detecting_the_element_under_the_caret"><a class="anchor" href="#_detecting_the_element_under_the_caret"></a>Detecting the Element Under the Caret</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, now that we know that we are dealing with a Java file and that it is open, we can begin detecting the type of element that is under the caret at any given time.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Begin by declaring a dependency on the I/O APIs, so that we can print our results to the Output window.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Replace the "Hurray!" message in the  <code>run()</code>  method with the lines highlighted below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void run(CompilationController compilationController) throws Exception {

    compilationController.toPhase(Phase.ELEMENTS_RESOLVED);
    Document document = compilationController.getDocument();

    if (document != null) {
        <strong>new MemberVisitor(compilationController).scan(compilationController.getCompilationUnit(), null);</strong>
    } else {
        StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>And here is the  <code>MemberVisitor</code>  class, which is defined as an inner class of our  <code>CopyFQNAction</code>  class:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    @Override
    public Void visitClass(ClassTree t, Void v) {
        Element el = info.getTrees().getElement(getCurrentPath());
        if (el == null) {
            StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
        } else {
            TypeElement te = (TypeElement) el;
            List&lt;? extends Element&gt; enclosedElements = te.getEnclosedElements();
            InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                        + info.getFileObject().getName(), true);
            for (int i = 0; i &lt; enclosedElements.size(); i++) {
            Element enclosedElement = (Element) enclosedElements.get(i);
                if (enclosedElement.getKind() == ElementKind.CONSTRUCTOR) {
                    io.getOut().println("Constructor: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.METHOD) {
                    io.getOut().println("Method: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.FIELD) {
                    io.getOut().println("Field: "
                        + enclosedElement.getSimpleName());
                } else {
                    io.getOut().println("Other: "
                        + enclosedElement.getSimpleName());
                }
            }
            io.getOut().close();
        }
        return null;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use the "InputOutput" class above, you need a new dependency, on the "I/O APIs".
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Run the module again, and open a Java class. Then click the button and notice that the constructors, methods, and fields are written to the Output window, as shown below:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_four1.png" alt="copyfqn 72 four1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Next, instead of printing all the elements to the Output window, we will only print the element under the caret. Only replace the  <code>visitClass</code>  method, with the code highlighted below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    <strong>@Override
    public Void visitClass(ClassTree t, Void v) {
        try {
            JTextComponent editor = EditorRegistry.lastFocusedComponent();
            if (editor.getDocument() == info.getDocument()) {
                int dot = editor.getCaret().getDot();
                TreePath tp = info.getTreeUtilities().pathFor(dot);
                Element el = info.getTrees().getElement(tp);
                if (el == null) {
                    StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
                } else {
                    InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                            + info.getFileObject().getName(), true);
                    if (el.getKind() == ElementKind.CONSTRUCTOR) {
                        io.getOut().println("Hurray, this is a constructor: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.METHOD) {
                        io.getOut().println("Hurray, this is a method: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.FIELD) {
                        io.getOut().println("Hurray, this is a field: "
                            + el.getSimpleName());
                    } else {
                        io.getOut().println("Hurray, this is something else: "
                            + el.getSimpleName());
                    }
                    io.getOut().close();
                }
            }
        } catch (IOException ex) {
            Exceptions.printStackTrace(ex);
        }
        return null;
    }</strong>

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Run the module. Put the caret somewhere within your Java code and press the button. The Output window displays information about the code under the caret, if applicable. For example, if you press the button after you put the caret in a method, as shown below, the Output window tells you that the caret is in a method:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_four2.png" alt="copyfqn 72 four2">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>But we can detect a lot more than just the name of the element under the caret. In the  <code>visitClass</code>  method, replace the lines in bold below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public Void visitClass(ClassTree t, Void v) {
    try {
        JTextComponent editor = EditorRegistry.lastFocusedComponent();
        if (editor.getDocument() == info.getDocument()) {
            int dot = editor.getCaret().getDot();
            TreePath tp = info.getTreeUtilities().pathFor(dot);
            Element el = info.getTrees().getElement(tp);
            if (el == null) {
                StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
            } else {
                InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                    + info.getFileObject().getName(), true);
                <strong>String te = null;
                if (el.getKind() == ElementKind.CONSTRUCTOR) {
                    te = ((TypeElement) ((ExecutableElement) el).getEnclosingElement()).getQualifiedName().toString();
                    io.getOut().println("Hurray, this is a constructor's qualified name: " + te);
                } else if (el.getKind() == ElementKind.METHOD) {
                    te = ((ExecutableElement) el).getReturnType().toString();
                    io.getOut().println("Hurray, this is a method's return type: " + te);
                } else if (el.getKind() == ElementKind.FIELD) {
                    te = ((VariableElement) el).asType().toString();
                    io.getOut().println("Hurray, this is a field's type: " + te);
                }</strong> else {
                    io.getOut().println("Hurray, this is something else: "
                        + el.getSimpleName());
                }
                io.getOut().close();
            }
        }
    } catch (IOException ex) {
        Exceptions.printStackTrace(ex);
    }
    return null;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Run the module again. This time, when you click the button while the caret is over a constructor, method, or field, more detailed information about the element is printed to the Output window.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/tutorials/copyfqn_72_four3.png" alt="copyfqn 72 four3">
</div>
</div>
<div class="paragraph">
<p>At this stage, we are able to detect whether we are dealing with a Java file, whether the document is open, and the type of element that is under the caret. But what can we do with this information? In the next section, a simple scenario is presented where our newly acquired knowledge will prove useful.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_doing_something_useful"><a class="anchor" href="#_doing_something_useful"></a>Doing Something Useful</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we set the contents of the clipboard, provided by  <code>java.awt.datatransfer.Clipboard</code> , based on the element under the caret. When you press the button, the element under the caret will be put in the clipboard, so that you can paste the content elsewhere in your code.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Begin by changing the constructor to declare the clipboard:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private Clipboard clipboard;

public CopyFQNAction(DataObject context) {
    this.context = context;
    clipboard = Lookup.getDefault().lookup(ExClipboard.class);
    if (clipboard == null) {
        clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Next, replace each "Hurray!" line in your code, with a line that sends the element as a string to a method that we will define in the next step. We will call our method  <code>setClipboardContents</code> . Therefore, for example, replace the first "Hurray!" line with the following:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">setClipboardContents(te);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do the same for the other "Hurray!" lines, making sure to pass the correct string to the method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because you have not defined the  <code>setClipboardContents</code>  method yet, each of the lines you add in this step is underlined in red. In the next step, we add the new method.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Finally, add the following to the end of the class. This method receives the string and puts it in the clipboard:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private void setClipboardContents(String content) {
    if (clipboard != null) {
        if (content == null) {
            StatusDisplayer.getDefault().setStatusText("");
            clipboard.setContents(null, null);
        } else {
            StatusDisplayer.getDefault().setStatusText("Clipboard: " + content);
            clipboard.setContents(new StringSelection(content), null);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="../../../../front/main/community/mailing-lists/" class="xref page">Send Us Your Feedback</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also"><a class="anchor" href="#_see_also"></a>See Also</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about creating and developing NetBeans Module, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../../../wiki/main/wiki/Java_DevelopersGuide/" class="xref page">Java Developer&#8217;s Guide</a></p>
</li>
<li>
<p><a href="#wiki::wiki/RetoucheDeveloperFAQ.adoc" class="xref unresolved">Retouche Developer FAQ</a></p>
</li>
<li>
<p><a href="../../kb/docs/platform/" class="xref page">Other Related Tutorials</a></p>
</li>
<li>
<p><a href="https://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
</div>
</div>
        <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-tutorials/edit/main/modules/ROOT/pages/tutorials/nbm-copyfqn.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
