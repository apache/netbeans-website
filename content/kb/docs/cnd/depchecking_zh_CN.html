
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>执行依赖关系检查</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="执行依赖关系检查 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 执行依赖关系检查">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">执行依赖关系检查</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/cnd/depchecking_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_要求">要求</a></li>
<li><a href="#_简介">简介</a>
<ul class="sectlevel2">
<li><a href="#_为项目启用依赖关系检查">为项目启用依赖关系检查</a></li>
<li><a href="#_默认情况下为新项目启用依赖关系检查">默认情况下为新项目启用依赖关系检查</a></li>
<li><a href="#_注">注</a></li>
</ul>
</li>
<li><a href="#_构建过程make_和_makefile">构建过程（make 和 makefile）</a></li>
<li><a href="#_依赖关系生成基础知识">依赖关系生成基础知识</a></li>
<li><a href="#_实现">实现</a></li>
<li><a href="#_参考">参考</a></li>
<li><a href="#_另请参见">另请参见</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>撰稿人：Alexey Vladykin
2014 年 3 月 [修订版本号：V8.0-1]</p>
</div>
<div class="paragraph">
<p>本教程将向您演示如何允许 NetBeans IDE 在构建时检查项目中的文件依赖关系。由  <code>make</code>  实用程序通过  <code>Makefile</code>  中的指令执行依赖关系检查。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. 此页上的内容适用于 NetBeans IDE 7.3、7.4 和 8.0</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_要求">要求</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>要学习本教程，您需要具备以下软件和资源。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">软件</th>
<th class="tableblock halign-left valign-top">要求的版本</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetBeans IDE（支持 C/C++）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">带有 NetBeans C/C+ 插件的版本 7.3、7.4 或 8.0+</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java 开发工具包 (JDK)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">版本 7 或 8</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有关下载并安装所需软件的信息，请参见 <a href="../../../community/releases/80/install.html">NetBeans IDE 安装说明</a>和<a href="../../../community/releases/80/cpp-setup-instructions.html">配置 NetBeans IDE 以使用 C/C+/Fortran+</a>
。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_简介">简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p>大的 C/C++ 项目包含数千个文件。例如，Linux 内核大约有 20,000 个文件。如果您开发的是这样一个项目并且希望在进行小的更改（例如，一行修复）之后重新构建该项目，则可以选择以下两个选项。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>完全重新构建（“清除”和“构建”操作）。这样做比较慢，但会保证一致的构建结果。</p>
</li>
<li>
<p>增量重新构建（“构建”操作）。这样做比较快，但能否正确重新构建所有应重新构建的内容？</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>增量重新构建的主要问题在于存在  <code>#include</code>  指令，这些指令将一个文件的内容包含到另一个文件。包含的文件称为“文件依赖关系”。修改包含的文件应视为修改包含该文件的所有文件。间接包含（A 包含 B，B 包含 C &#8658; A 包含 C）使问题更加复杂。</p>
</div>
<div class="paragraph">
<p>NetBeans IDE 支持自动检查文件依赖关系并尽可能使增量重新构建正常工作。如果更改包含到某些源文件的头文件，然后单击“构建”，则 IDE 将仅重新构建那些真正依赖于所更改头文件的项目部分。此功能可节省时间并保证一致的构建结果。</p>
</div>
<div class="sect2">
<h3 id="_为项目启用依赖关系检查">为项目启用依赖关系检查</h3>
<div class="paragraph">
<p>可控制各个特定项目的依赖关系检查。您可能需要确保启用该功能。</p>
</div>
<div class="paragraph">
<p><strong>为项目启用依赖关系检查：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>右键单击 "Projects"（项目）窗口中的项目，然后选择 "Properties"（属性）。</p>
</li>
<li>
<p>在 "Project Properties"（项目属性）对话框中，选择 "Categories"（类别）列表中的 "Build"（构建）节点。</p>
</li>
<li>
<p>在构建属性中，选中 "Enable Make Dependency Checking"（启用 Make 依赖关系检查）对应的复选框。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/project-checkbox.png" alt="project checkbox">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_默认情况下为新项目启用依赖关系检查">默认情况下为新项目启用依赖关系检查</h3>
<div class="paragraph">
<p>可以设置依赖关系检查的默认状态，以便自动为您创建的新项目启用 Make 依赖关系检查。</p>
</div>
<div class="paragraph">
<p><strong>为在 IDE 中创建的所有新项目启用依赖关系检查：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 IDE 主菜单中选择 "Tools"（工具）&gt; "Options"（选项）。</p>
</li>
<li>
<p>单击顶部窗格中的 "C/C++" 按钮。</p>
</li>
<li>
<p>单击 "Project Options"（项目选项）标签。</p>
</li>
<li>
<p>选中 "Enable dependency checking in generated makefiles"（在生成的 makefile 中启用依赖关系检查）对应的复选框</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/global-checkbox.png" alt="global checkbox">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_注">注</h3>
<div class="ulist">
<ul>
<li>
<p>自动依赖关系检查适用于在 IDE 中创建的 C/C++ 项目（受管项目）。IDE 将依赖关系检查逻辑构建到生成的  <code>Makefile</code> 。对于使用现有源创建的项目，必须依赖于现有  <code>Makefile</code>  中的依赖关系检查逻辑（如果有）。</p>
</li>
<li>
<p>依赖关系检查需要来自工具集合（ <code>make</code>  和编译器）的支持。依赖关系检查已经过 Oracle Solaris Studio 工具集合和 GNU 工具集合（包含 Cygwin 和 MinGW）的测试。</p>
</li>
<li>
<p>当 Oracle Solaris Studio 编译器与 Oracle Solaris  <code>make</code>  一起使用时以及当 GNU 编译器与 GNU  <code>gmake</code>  一起使用时，将执行依赖关系检查。不支持混合 Oracle Solaris  <code>make</code>  与 GNU 编译器，反之亦然。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本文的其余内容是面向那些想要知道 IDE 背后执行的操作的高级用户。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_构建过程make_和_makefile">构建过程（make 和 makefile）</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在  <code>Makefile</code> （ <code>make</code>  实用程序所理解的特殊格式的文件）中描述了 NetBeans 中每个 C/C++ 项目的构建过程。从 GUI 构建或清除项目时，IDE 将调用  <code>make</code>  以执行 Makefile。通过这种方法，您可以在 IDE 外部使用  <code>make</code>  轻松构建项目：只需转到您的项目目录并键入  <code>make help</code>  即可获得指令。</p>
</div>
<div class="paragraph">
<p>NetBeans IDE 用于 C/C++ 项目的 Makefile 如下所示。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/makefiles.png" alt="makefiles">
</div>
</div>
<div class="paragraph">
<p>主  <code>Makefile</code>  生成一次，您可以手动编辑它。不能手动编辑  <code>nbproject</code>  目录中的 Makefile；IDE 自动更新这些 Makefile。插图中的文件  <code>Makefile-<em>CONF</em>.mk</code>  表示所有项目配置的多个文件，例如  <code>Makefile-Release.mk</code> 、 <code>Makefile-Debug.mk</code>  等。</p>
</div>
<div class="paragraph">
<p>对于受管项目，IDE 将生成所有 Makefile 自身并插入正确的指令用于依赖关系检查。对于从现有源创建的项目，只有在现有  <code>Makefile</code>  包含此类指令时才会执行依赖关系检查，因为 NetBeans IDE 不会更改现有的  <code>Makefile</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_依赖关系生成基础知识">依赖关系生成基础知识</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果您希望  <code>make</code>  在构建期间检查包含的文件依赖关系，则必须将依赖关系信息插入到  <code>Makefile</code> 。很遗憾，所有  <code>make</code>  实用程序和编译器都没有可移植方法可这么做。首先，您应检测哪个  <code>make</code>  正在运行，然后生成对应的依赖关系检查指令。</p>
</div>
<div class="paragraph">
<p>Oracle Solaris  <code>make</code>  具有一种非常简单的解决方案。 <code>Makefile</code>  中的特殊  <code>.KEEP_STATE:</code>  规则指示  <code>make</code>  在编译器中查询包含的文件依赖关系并将其存储在临时文件中。下次重新构建项目时， <code>make</code>  将加载该临时文件，分析该文件中存储的依赖关系，然后确定更改了哪些头文件以及应重新编译哪些对象文件。</p>
</div>
<div class="paragraph">
<p>对于 GNU  <code>make</code> （称为  <code>gmake</code> ），解决方案更加复杂。您必须明确请求编译器生成依赖关系信息，然后明确将这些信息包括到  <code>Makefile</code> 。目的是向编译器传递特殊标志，以便编译器将为每个编译的源文件生成依赖关系信息。下次重新构建项目时，将收集依赖关系信息并包含到  <code>Makefile</code>  中。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_实现">实现</h2>
<div class="sectionbody">
<div class="paragraph">
<p>将以下代码添加到  <code>nbproject/Makefile-impl.mk</code>  中。它检测哪个  <code>make</code>  正在运行并将相应的依赖关系检查代码放入  <code>.dep.inc</code>  文件中。若存在  <code>MAKE_VERSION</code>  变量，则会检测到 GNU  <code>make</code> 。如果未设置  <code>MAKE_VERSION</code> ，则会生成 Solaris  <code>make</code>  特定的指令。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java"># dependency checking support
.depcheck-impl:
	@echo "# This code depends on make tool being used" &gt;.dep.inc
	@if [ -n "${MAKE_VERSION}" ]; then \
	    echo "DEPFILES=\$$(wildcard \$$(addsuffix .d, \$${OBJECTFILES}))" &gt;&gt;.dep.inc; \
	    echo "ifneq (\$${DEPFILES},)" &gt;&gt;.dep.inc; \
	    echo "include \$${DEPFILES}" &gt;&gt;.dep.inc; \
	    echo "endif" &gt;&gt;.dep.inc; \
	else \
	    echo ".KEEP_STATE:" &gt;&gt;.dep.inc; \
	    echo ".KEEP_STATE_FILE:.make.state.\$${CONF}" &gt;&gt;.dep.inc; \
	fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>将以下代码添加到  <code>nbproject/Makefile-${CONF}.mk</code>  中。它指示  <code>make</code>  读取以前生成的  <code>.dep.inc</code>  并执行其中的指令。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java"># Enable dependency checking
.dep.inc: .depcheck-impl

include .dep.inc</code></pre>
</div>
</div>
<div class="paragraph">
<p>当  <code>.dep.inc</code>  不存在时，会添加规则  <code>.dep.inc: .depcheck-impl</code>  以防止构建失败。只有在从 "Projects"（项目）窗口编译单个文件时才会发生这种情况。在这种情况下， <code>make</code>  直接执行文件  <code>nbproject/Makefile-${CONF}.mk</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_参考">参考</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://en.wikipedia.org/wiki/Make_%28software%29">关于  ``make``  的 Wikipedia 文章</a></p>
</li>
<li>
<p><a href="http://make.paulandlesley.org/autodep.html">高级自动依赖关系生成</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_另请参见">另请参见</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有关在 NetBeans IDE 中使用 C/C/Fortran 进行开发的更多文章，请参见 link:https://netbeans.org/kb/trails/cnd.html[+C/C 学习资源+]。</p>
</div>
<div class="paragraph">
<p><a href="mailto:users@cnd.netbeans.org?subject=Feedback:%20Make%20Dependency%20Checking%20-%20NetBeans%20IDE%208.0%20Tutorial">发送有关此教程的反馈意见</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/cnd/depchecking_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
