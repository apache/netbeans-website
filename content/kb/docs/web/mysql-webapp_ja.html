
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>MySQLデータベースを使用した単純なWebアプリケーションの作成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MySQLデータベースを使用した単純なWebアプリケーションの作成 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, MySQLデータベースを使用した単純なWebアプリケーションの作成">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">MySQLデータベースを使用した単純なWebアプリケーションの作成</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/web/mysql-webapp_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#planStructure">構造の計画</a>
<ul class="sectlevel2">
<li><a href="#_index_jsp">index.jsp</a></li>
</ul>
</li>
<li><a href="#_response_jsp">response.jsp</a></li>
<li><a href="#createProject">新規プロジェクトの作成</a></li>
<li><a href="#prepareInterface">Webインタフェースの準備</a>
<ul class="sectlevel2">
<li><a href="#welcomePage">開始ページの設定</a></li>
<li><a href="#responsePage">レスポンス・ページの作成</a></li>
<li><a href="#stylesheet">スタイル・シートの作成</a></li>
</ul>
</li>
<li><a href="#prepareCommunication">アプリケーションとデータベース間の通信の準備</a>
<ul class="sectlevel2">
<li><a href="#setUpJDBC">JDBCデータ・ソースと接続プールの設定</a></li>
<li><a href="#referenceDataSource">アプリケーションからのデータ・ソースの参照</a></li>
<li><a href="#addJar">サーバーへのデータベース・ドライバのJARファイルの追加</a></li>
</ul>
</li>
<li><a href="#addLogic">動的ロジックの追加</a>
<ul class="sectlevel2">
<li><a href="#addJSTL">プロジェクトのクラスパスへのJSTLライブラリの追加</a></li>
<li><a href="#implementCode">JSTLコードの実装</a></li>
</ul>
</li>
<li><a href="#run">完成したアプリケーションの実行</a></li>
<li><a href="#troubleshoot">トラブルシューティング</a>
<ul class="sectlevel2">
<li><a href="#access">データベース・リソースは存在していますか。</a></li>
<li><a href="#datasource">接続プールとデータ・ソースはサーバー上に存在していますか。</a></li>
<li><a href="#driver">MySQL Connector/JドライバはGlassFishサーバーにアクセスできますか。</a></li>
<li><a href="#password">データベースはパスワードで保護されていますか。</a></li>
<li><a href="#ping">接続プールのプロパティは正しく設定されていますか。</a></li>
</ul>
</li>
<li><a href="#seealso">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>執筆: Troy Giunipero</p>
</div>
<div class="paragraph">
<p>このドキュメントでは、MySQLデータベース・サーバーに接続する単純なWebアプリケーションを作成する方法を説明します。また、<a href="http://www.oracle.com/technetwork/java/overview-138580.html">JavaServer Pages</a> (JSP)、<a href="http://www.oracle.com/technetwork/java/index-jsp-135995.html">JavaServer Pages標準タグ・ライブラリ</a>(JSTL)、<a href="http://docs.oracle.com/javase/tutorial/jdbc/overview/index.html">Java Database Connectivity</a> (JDBC) API、2層のクライアント・サーバー・アーキテクチャなど、Web開発での基本的なアイデアやテクノロジも紹介します。このチュートリアルは、Web開発の基礎的な知識があり、MySQLデータベースを使用して知識を応用しようとしている初心者を対象としています。</p>
</div>
<div class="paragraph">
<p><a href="http://www.mysql.com">MySQL</a>は、その速さ、柔軟性および信頼性により、Webアプリケーションで一般的に使用されているポピュラなオープン・ソース・データベース管理システムです。MySQLは、データベース内のデータへのアクセスおよび処理にSQL (<em>Structured Query Language</em>)を使用しています。</p>
</div>
<div class="paragraph">
<p>このチュートリアルは、<a href="../ide/mysql.html">MySQL Databaseへの接続</a>のチュートリアルの続きです。`MyNewDatabase`という名前のMySQLデータベースを作成済で、NetBeans IDEで接続が登録されていることを前提としています。そのチュートリアルで使用した表データは<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJava%2520Web%252Fifpwafcad.sql">ifpwafcad.sql</a>に格納されており、このチュートリアルでも必要です。このSQLファイルによって`Subject`および`Counselor`の2つの表が作成され、これらにサンプル・データが生成されます。必要に応じて、このファイルをコンピュータに保存し、NetBeans IDEで開いて、`MyNewDatabase`という名前のMySQLデータベース上で実行します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="paragraph">
<p><strong>このチュートリアルに従うには、次のソフトウェアとリソースが必要です。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EEバンドル版</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQLデータベース・サーバー</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQLコネクタ/J JDBCドライバ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン5.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.xまたは4.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>*注意: *</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NetBeans IDEのJavaダウンロード・バンドルを使用して、GlassFishサーバーをインストールできます。このチュートリアルを実施するには、GlassFishサーバーが必要になります。</p>
</li>
<li>
<p>プロジェクトを、正常に機能するソリューションと比較する必要がある場合は、<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJava%2520Web%252FIFPWAFCAD.zip">サンプル・アプリケーションをダウンロード</a>できます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="planStructure">構造の計画</h2>
<div class="sectionbody">
<div class="paragraph">
<p>単純なWebアプリケーションは、クライアントがサーバーと直接通信する_2層アーキテクチャ_を使用して設計できます。このチュートリアルのJava Webアプリケーションは、Java Database Connectivity APIを使用してMySQLデータベースと直接通信します。基本的に、アプリケーション・サーバー(GlassFishサーバー)が認識するJavaコードと、SQL内の任意の内容、つまりデータベース・サーバー(MySQL)が認識する言語との間で通信を有効にするのは、<a href="http://dev.mysql.com/downloads/connector/j/">MySQL Connector/J JDBCドライバ</a>です。</p>
</div>
<div class="paragraph">
<p>このチュートリアルでビルドするアプリケーションには、2つのJSPページの作成が含まれます。各ページで、HTMLとCSSを使用して単純なインタフェースを実装します。また、データベースに対して直接問合せを実行し、取得したデータを2つのページに挿入するロジックを実行するために、JSTLテクノロジを使用します。この2つのデータベース表は`Subject`と`Counselor`で、<a href="../ide/mysql.html">MySQLデータベースへの接続</a>のチュートリアルで完成させるMySQLデータベース`MyNewDatabase`に含まれています。次の2層方式のシナリオについて考えてみます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>image::images/ifpwafcad-structure.png[title="2層Webアプリケーションのサンプル構造"]</pre>
</div>
</div>
<div class="paragraph">
<p>開始ページ(<code>index.jsp</code>)では、単純なHTMLフォームがユーザーに表示されます。ブラウザが`index.jsp`をリクエストすると、ページ内のJSTLコードが`MyNewDatabase`に対して問合せを開始します。<code>Subject`データベース表からデータを取得し、そのデータをページに挿入してからブラウザに送信します。ユーザーが開始ページのHTMLフォームから選択内容を送信すると、そのレスポンス・ページ(`response.jsp</code>)に対するリクエストが開始されます。ページ内のJSTLコードは、`MyNewDatabase`に対する問合せをもう一度開始します。今度は、`Subject`表と`Counselor`表の両方からデータが取得され、ページに挿入されます。これにより、ページがブラウザに返されたときに、ユーザーは自分の選択内容に基づいたデータを表示できます。</p>
</div>
<div class="paragraph">
<p>前述のシナリオを実装するため、IFPWAFCAD (The International Former Professional Wrestlers' Association for Counseling and Development)という架空の企業向けに単純なアプリケーションを開発します。</p>
</div>
<div class="sect2">
<h3 id="_index_jsp">index.jsp</h3>
<div class="imageblock">
<div class="content">
<img src="images/index-page.png" alt="index page">
</div>
<div class="title">Figure 2. ブラウザに表示されたindex.jsp</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_response_jsp">response.jsp</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/response-page.png" alt="response page">
</div>
<div class="title">Figure 3. ブラウザに表示されたresponse.jsp</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="createProject">新規プロジェクトの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>最初に、IDEで新しいJava Webプロジェクトを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「ファイル」&gt;「新規プロジェクト」([Ctrl]-[Shift]-[N]、Macの場合は[⌘]-[Shift]-[N])を選択します。「Java Web」カテゴリを選択し、「Webアプリケーション」を選択します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-project.png" alt="new project">
</div>
<div class="title">Figure 4. IDEの新規プロジェクト・ウィザードを使用した新規プロジェクトの作成</div>
</div>
<div class="paragraph">
<p>新規プロジェクト・ウィザードを使用すると、標準的なIDEプロジェクト内に空のWebアプリケーションを作成できます。標準的なプロジェクトでは、IDEが生成したAntビルド・スクリプトを使用して、アプリケーションをコンパイル、デプロイおよび実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト名」に「<strong>IFPWAFCAD</strong>」と入力します。また、コンピュータ上でのプロジェクトの場所を指定します。デフォルトでは、IDEはホーム・ディレクトリの`NetBeansProjects`フォルダにプロジェクトを配置します。「次」をクリックします。</p>
</li>
<li>
<p>「サーバーと設定」パネルで、アプリケーションの実行に使用するサーバーとしてGlassFishサーバーを指定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>*注意: *GlassFishサーバーは、Javaバージョンの<a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a>がインストールされている場合に、「サーバー」ドロップダウン・フィールドに表示されます。GlassFishサーバーはダウンロードに含まれているため、自動的にIDEに登録されます。このプロジェクトで他のサーバーを使用する場合は、「サーバー」ドロップダウン・フィールドの横にある「追加」ボタンをクリックし、他のサーバーをIDEに登録します。ただし、GlassFishサーバー以外のサーバーの操作については、このチュートリアルでは説明しません。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Java EEバージョン」フィールドで「<strong>Java EE 5</strong>」を選択します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/server-settings.png" alt="server settings">
</div>
<div class="title">Figure 5. 新規Webアプリケーション・ウィザードでのサーバー設定の指定</div>
</div>
<div class="paragraph">
<p>Java EE 6およびJava EE 7 Webプロジェクトでは`web.xml`デプロイメント・ディスクリプタを使用する必要はなく、Java EE 6およびJava EE 7プロジェクトのNetBeansプロジェクト・テンプレートには`web.xml`ファイルは含まれていません。ただし、このチュートリアルでは、デプロイメント・ディスクリプタでデータ・ソースを宣言する方法について説明し、Java EE 6またはJava EE 7固有の機能に依存しないため、プロジェクトのバージョンをJava EE 5に設定できます。</p>
</div>
<div class="paragraph">
<p>*注意:*同様に、プロジェクトのバージョンをJava EE 6またはJava EE 7に設定し、`web.xml`デプロイメント・ディスクリプタを作成することもできます。これを行うには、新規ファイル・ウィザードから「Web」カテゴリを選択し、「標準のデプロイメント・ディスクリプタ」を選択します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「終了」をクリックします。IDEでアプリケーション全体のプロジェクト・テンプレートが作成され、空のJSPページ(<code>index.jsp</code>)がエディタに表示されます。`index.jsp`ファイルはアプリケーションの開始ページとして動作します。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prepareInterface">Webインタフェースの準備</h2>
<div class="sectionbody">
<div class="paragraph">
<p>最初に、開始ページ(<code>index.jsp</code>)とレスポンス・ページ(<code>response.jsp</code>)を準備します。開始ページには、ユーザーのデータを取り込むために使用するHTMLフォームを実装します。また、どちらのページにも、構造化された形でデータを表示するHTML表を実装します。この項では、両方のページの外観を整えるためのスタイル・シートも作成します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#welcomePage">開始ページの設定</a></p>
</li>
<li>
<p><a href="#responsePage">レスポンス・ページの作成</a></p>
</li>
<li>
<p><a href="#stylesheet">スタイル・シートの作成</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="welcomePage">開始ページの設定</h3>
<div class="paragraph">
<p>エディタで`index.jsp`が開いていることを確認します。ファイルがまだ開いていない場合、「プロジェクト」ウィンドウの「IFPWAFCAD」プロジェクトの「Webページ」ノードで「<code>index.jsp</code>」をダブルクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで、<code>&lt;title&gt;`タグ間のテキストを「`IFPWAFCAD Homepage</code>」に変更します。</p>
</li>
<li>
<p><code>&lt;h1&gt;`タグ間のテキストを「`Welcome to IFPWAFCAD, the International Former Professional Wrestlers' Association for Counseling and Development!</code>」に変更します。</p>
</li>
<li>
<p>メイン・メニューで「ウィンドウ」&gt;「パレット」([Ctrl]-[Shift]-[8]、Macの場合は[⌘]-[Shift]-[8])を選択してIDEのパレットを開きます。ポインタをHTMLカテゴリの「表」アイコン上に置くと、項目のデフォルトのコード・スニペットが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/palette.png" alt="palette">
</div>
<div class="title">Figure 6. 項目の上にポインタを置いてコード・スニペットが表示されたパレット</div>
</div>
<div class="paragraph">
<p><span class="tips">「パレット」は好みにあわせて構成できます。「パレット」を右クリックして「大きなアイコンを表示」と「項目の名前を非表示」を選択すると、上のイメージのようになります。</span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`&lt;h1&gt;`タグのすぐ後ろの場所にカーソルを置きます。ここに、新しいHTML表を実装します。「パレット」で「表」アイコンをダブルクリックします。</p>
</li>
<li>
<p>表示される「挿入表」ダイアログで次の値を指定し、「OK」をクリックします。</p>
<div class="ulist">
<ul>
<li>
<p><strong>行</strong>: 2</p>
</li>
<li>
<p><strong>列</strong>: 1</p>
</li>
<li>
<p><strong>境界線のサイズ</strong>: 0
HTML表コードが生成され、ページに追加されます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>次の内容を、表の見出しと、表の最初の行のセルに追加します(追加する内容は*太字*で表示)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;table border="0"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;*IFPWAFCAD offers expert counseling in a wide range of fields.*&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;tr&gt;
            &lt;td&gt;*To view the contact details of an IFPWAFCAD certified former
                professional wrestler in your area, select a subject below:*&lt;/td&gt;
        &lt;/tr&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>表の最後の行にHTMLフォームを挿入します。そのためには、2番目のペアの`&lt;td&gt;`タグの間にカーソルを置き、パレットの「HTMLフォーム」(<span class="image"><img src="images/html-form-icon.png" alt="html form icon"></span>)アイコンをダブルクリックします。「挿入フォーム」ダイアログで、「アクション」テキスト・フィールドに「<code>response.jsp</code>」と入力し、「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-form.png" alt="insert form">
</div>
<div class="title">Figure 7. 「挿入フォーム」ダイアログでのフォーム設定の指定</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`&lt;form&gt;`タグの間に次の内容を入力します(追加する内容は*太字*で表示)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;tr&gt;
    &lt;td&gt;
        &lt;form action="response.jsp"&gt;
            *&lt;strong&gt;Select a subject:&lt;/strong&gt;*
        &lt;/form&gt;
    &lt;/td&gt;
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>[Enter]を押して、追加したコンテンツの後に空の行を追加し、パレットで「ドロップダウン・リスト」をダブルクリックして、「ドロップダウンの挿入」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>「ドロップダウンの挿入」ダイアログの「名前」テキスト・フィールドに「<code>subject_id</code>」と入力し、「OK」をクリックします。ドロップダウン・リストのコード・スニペットがフォームに追加されます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ドロップダウン・リストのオプションの数は、ここでは重要ではありません。チュートリアルの後の手順で、Subjectデータベース表から収集したデータに基づいてオプションを動的に生成するJSTLタグを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>送信ボタン項目(<span class="image"><img src="images/submit-button.png" alt="submit button"></span>)を、先ほど追加したドロップダウン・リストの直後に追加します。これは、パレットを使用するか、前述のステップのようにエディタのコード補完を呼び出すことで操作できます。「挿入ボタン」ダイアログで、「ラベル」テキスト・フィールドと「名前」テキスト・フィールドの両方に「<code>submit</code>」と入力し、「OK」をクリックします。</p>
</li>
<li>
<p>コードをフォーマットするには、エディタ内を右クリックし、「フォーマット」([Alt]-[Shift]-[F]、Macの場合は[Ctrl]-[Shift]-[F])を選択します。コードが自動的にフォーマットされ、次のような外観になります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;body&gt;
    &lt;h2&gt;Welcome to &lt;strong&gt;IFPWAFCAD&lt;/strong&gt;, the International Former
        Professional Wrestlers' Association for Counseling and Development!
    &lt;/h2&gt;

    &lt;table border="0"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;IFPWAFCAD offers expert counseling in a wide range of fields.&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td&gt;To view the contact details of an IFPWAFCAD certified former
                    professional wrestler in your area, select a subject below:&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;form action="response.jsp"&gt;
                        &lt;strong&gt;Select a subject:&lt;/strong&gt;
                        &lt;select name="subject_id"&gt;
                            &lt;option&gt;&lt;/option&gt;
                        &lt;/select&gt;
                        &lt;input type="submit" value="submit" name="submit" /&gt;
                    &lt;/form&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>このページをブラウザで表示するには、エディタで右クリックし、「ファイルを実行」([Shift]-[F6]、Macの場合は[Fn]-[Shift]-[F6])を選択します。これを実行すると、JSPページが自動的にコンパイルされ、サーバーにデプロイされます。デフォルト・ブラウザが開き、デプロイされた場所からページが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/browser-output.png" alt="browser output">
</div>
<div class="title">Figure 8. ブラウザに表示されたindex.jsp</div>
</div>
</div>
<div class="sect2">
<h3 id="responsePage">レスポンス・ページの作成</h3>
<div class="paragraph">
<p>`response.jsp`のインタフェースを準備するため、プロジェクト内にファイルを作成しておく必要があります。このページに表示される内容のほとんどが、JSPテクノロジを使用して動的に生成されます。そのため、次の手順では、後でJSPコードに置き換えるプレースホルダ(<em>placeholder</em>)を追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「IFPWAFCAD」プロジェクト・ノードを右クリックし、「新規」&gt;「JSP」を選択します。新規JSPファイル・ウィザードが開きます。</p>
</li>
<li>
<p>「JSPファイル名」フィールドに「<code>response</code>」と入力します。「場所」フィールドには現在「Webページ」が選択されています。これは、プロジェクトの`web`ディレクトリにファイルが作成されることを意味します。この場所は、開始ページ`index.jsp`がある場所と同じです。</p>
</li>
<li>
<p>その他のデフォルト設定を受け入れ、「終了」をクリックします。新しい`response.jsp`ページのテンプレートが生成され、エディタ内に表示されます。また、新しいJSPノードが「プロジェクト」ウィンドウの「Webページ」の下に表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/response-jsp-node.png" alt="response jsp node">
</div>
<div class="title">Figure 9. 「プロジェクト」ウィンドウに表示されたresponse.jspノード</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで、タイトルを「<code>IFPWAFCAD - {placeholder}</code>」に変更します。</p>
</li>
<li>
<p><code>&lt;h1&gt;Hello World!&lt;/h1&gt;`行(</code>&lt;body&gt;`タグの間にあります)を除去し、次のHTML表をコピーしてページの本文に貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;table border="0"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th colspan="2"&gt;{placeholder}&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;strong&gt;Description: &lt;/strong&gt;&lt;/td&gt;
            &lt;td&gt;&lt;span style="font-size:smaller; font-style:italic;"&gt;{placeholder}&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;strong&gt;Counselor: &lt;/strong&gt;&lt;/td&gt;
            &lt;td&gt;{placeholder}
                &lt;br&gt;
                &lt;span style="font-size:smaller; font-style:italic;"&gt;
                member since: {placeholder}&lt;/span&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;strong&gt;Contact Details: &lt;/strong&gt;&lt;/td&gt;
            &lt;td&gt;&lt;strong&gt;email: &lt;/strong&gt;
                &lt;a href="mailto:{placeholder}"&gt;{placeholder}&lt;/a&gt;
                &lt;br&gt;&lt;strong&gt;phone: &lt;/strong&gt;{placeholder}
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>このページをブラウザで表示するには、エディタで右クリックし、「ファイルを実行」([Shift]-[F6]、Macの場合は[Fn]-[Shift]-[F6])を選択します。コンパイルされたページがGlassFishサーバーにデプロイされ、デフォルトのブラウザで開かれます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/browser-response.png" alt="browser response">
</div>
<div class="title">Figure 10. ブラウザに表示されたresponse.jsp</div>
</div>
</div>
<div class="sect2">
<h3 id="stylesheet">スタイル・シートの作成</h3>
<div class="paragraph">
<p>Webページの見た目を整える単純なスタイル・シートを作成します。このチュートリアルは、スタイル・ルールの機能について、およびスタイル・ルールが`index.jsp`と`response.jsp`内の該当するHTML要素にどのように影響するかについて、実用的な知識がある方を対象としています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEのメイン・ツールバーで「新規ファイル」(<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>)ボタンを押して、新規ファイル・ウィザードを開きます。「Web」カテゴリを選択し、「Cascading Style Sheet」を選択して「次」をクリックします。</p>
</li>
<li>
<p>「CSSファイル名」に「<code>style</code>」と入力し、「終了」をクリックします。空のCSSファイルが作成され、`index.jsp`および`response.jsp`と同じプロジェクトの場所に配置されます。これで、`style.css`のノードが「プロジェクト」ウィンドウのプロジェクト内に表示されるようになり、ファイルがエディタに表示されます。</p>
</li>
<li>
<p>エディタで、次の内容を`style.css`ファイルに追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">body {
    font-family: Verdana, Arial, sans-serif;
    font-size: smaller;
    padding: 50px;
    color: #555;
}

h1 {
    text-align: left;
    letter-spacing: 6px;
    font-size: 1.4em;
    color: #be7429;
    font-weight: normal;
    width: 450px;
}

table {
    width: 580px;
    padding: 10px;
    background-color: #c5e7e0;
}

th {
    text-align: left;
    border-bottom: 1px solid;
}

td {
    padding: 10px;
}

a:link {
   color: #be7429;
   font-weight: normal;
   text-decoration: none;
}

a:link:hover {
   color: #be7429;
   font-weight: normal;
   text-decoration: underline;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>スタイル・シートを`index.jsp`と`response.jsp`にリンクします。両方のページで、`&lt;head&gt;`タグの間に次の行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;link rel="stylesheet" type="text/css" href="style.css"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">エディタで開かれているファイル間をすばやく移動するには、[Ctrl]-[Tab]を押して目的のファイルを選択します。</span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prepareCommunication">アプリケーションとデータベース間の通信の準備</h2>
<div class="sectionbody">
<div class="paragraph">
<p>サーバーとデータベースとの間の通信を実装するための最も効率的な方法は、データベース_接続プール_を設定することです。クライアント・リクエストごとに新しい接続を作成すると、特にアプリケーションが大量のリクエストを継続的に受け取る場合は、かなり時間がかかる可能性があります。これを解決するため、接続プール内に多数の接続が作成されて管理されます。アプリケーションのデータ・レイヤーへのアクセスを要求する受信リクエストがあると、作成済の接続がプールから使用されます。同様に、リクエストが完了すると、その接続は閉じられずに、プールに返されます。</p>
</div>
<div class="paragraph">
<p>サーバー用のデータ・ソースと接続プールの準備ができたら、そのデータ・ソースを使用するようアプリケーションに指示する必要があります。これは通常、アプリケーションの`web.xml`デプロイメント・ディスクリプタ内にエントリを作成することで実行します。最後に、データベース・ドライバ(MySQL Connector/J JDBCドライバ)がサーバーにアクセスできることを確認する必要があります。</p>
</div>
<div class="paragraph">
<p>*重要: *これ以降では、`MyNewDatabase`という名前のMySQLデータベースが設定され、このデータベースに<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJava%2520Web%252Fifpwafcad.sql">ifpwafcad.sql</a>で提供されるサンプル・データが格納されている必要があります。このSQLファイルによって`Subject`および`Counselor`の2つの表が作成され、これらにサンプル・データが生成されます。これを実行していない場合、またはこの作業に関する支援が必要な場合は、作業を進める前に、<a href="../../docs/ide/mysql.html">MySQLデータベースへの接続</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>また、このチュートリアルでデータ・ソースを作成してGlassFishサーバーで操作するために、データベースをパスワードで保護しておく必要があります。パスワードが設定されていないデフォルトのMySQL`root`アカウントを使用している場合は、コマンド行プロンプトからパスワードを設定できます。</p>
</div>
<div class="paragraph">
<p>このチュートリアルでは、パスワードの例として`nbuser`を使用します。パスワードを`<em>nbuser</em>`に設定するには、コマンド行プロンプトでMySQLのインストール・ディレクトリの`bin`ディレクトリに移動し、次のように入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">shell&gt; mysql -u root
mysql&gt; UPDATE mysql.user SET Password = PASSWORD('_nbuser_')
    -&gt;     WHERE User = 'root';
mysql&gt; FLUSH PRIVILEGES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>詳細は、MySQL公式リファレンス・マニュアルの<a href="http://dev.mysql.com/doc/refman/5.1/en/default-privileges.html">初期MySQLアカウントの保護</a>を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#setUpJDBC">JDBCデータ・ソースと接続プールの設定</a></p>
</li>
<li>
<p><a href="#referenceDataSource">アプリケーションからのデータ・ソースの参照</a></p>
</li>
<li>
<p><a href="#addJar">サーバーへのデータベース・ドライバのJARファイルの追加</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="setUpJDBC">JDBCデータ・ソースと接続プールの設定</h3>
<div class="paragraph">
<p>GlassFish Server Open Source Editionには、開発者に意識させることなく接続プール機能を提供する、DBCP (データベース接続プール)ライブラリがあります。このライブラリを利用するには、アプリケーションが接続プール用に使用できるサーバーの<a href="http://docs.oracle.com/javase/tutorial/jdbc/overview/index.html">Java Database Connectivity</a> (JDBC)_データ・ソース_を構成する必要があります。</p>
</div>
<div class="paragraph">
<p>JDBCテクノロジの詳細は、<a href="http://docs.oracle.com/javase/tutorial/jdbc/basics/index.html">Javaチュートリアル: JDBCの基本</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>データ・ソースは、GlassFishサーバーの管理コンソール内で直接構成するか、次に説明するように、アプリケーションが必要とするリソースを`glassfish-resources.xml`ファイル内で宣言できます。アプリケーションがデプロイされると、サーバーがリソース宣言を読み取り、必要なリソースを作成します。</p>
</div>
<div class="paragraph">
<p>次の手順は、接続プールと、その接続プールに依存するデータ・ソースを宣言する方法です。NetBeansの新規JDBCリソース・ウィザードを使用すると、両方のアクションを実行できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEのメイン・ツールバーで「新規ファイル」(<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>)ボタンを押して、新規ファイル・ウィザードを開きます。「GlassFish」サーバー・カテゴリを選択し、「JDBCリソース」を選択して「次」をクリックします。</p>
</li>
<li>
<p>ステップ2の「一般属性」で、「新規のJDBC接続プールを作成」オプションを選択し、「JNDI名」テキスト・フィールドに「<strong>jdbc/IFPWAFCAD</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jdbc-resource-wizard.png" alt="jdbc resource wizard">
</div>
<div class="title">Figure 11. JDBCリソース・ウィザードでのデータ・ソース設定の指定</div>
</div>
<div class="paragraph">
<p><span class="tips">JDBCデータ・ソースは、<a href="http://www.oracle.com/technetwork/java/jndi/index.html">JNDI</a> (Java Naming and Directory Interface)に依存します。JNDI APIは、アプリケーションでデータ・ソースを検索、利用するための共通の手段を提供します。詳細は、<a href="http://docs.oracle.com/javase/jndi/tutorial/">JNDIチュートリアル</a>を参照してください。</span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(オプション)データ・ソースには説明を追加できます。たとえば、「<code>IFPWAFCADアプリケーション用のデータを提供するデータベースにアクセスします</code>」と入力します。</p>
</li>
<li>
<p>「次」をクリックし、もう一度「次」をクリックして、ステップ3「追加のプロパティ」をスキップします。</p>
</li>
<li>
<p>ステップ4で「JDBC接続プール名」に「<strong>IfpwafcadPool</strong>」と入力します。「既存の接続から抽出」オプションが選択されていることを確認し、ドロップダウン・リストから「<code>jdbc:mysql://localhost:3306/MyNewDatabase</code>」を選択します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jdbc-resource-wizard2.png" alt="jdbc resource wizard2">
</div>
<div class="title">Figure 12. JDBCリソース・ウィザードでの接続プール設定の指定</div>
</div>
<div class="paragraph">
<p><strong>注意:</strong> IDEで設定されたデータベース接続がある場合は、ウィザードで検出されます。そのため、この時点で`MyNewDatabase`データベースへの接続がすでに作成されている必要はありません。作成済の接続を確認するには、「サービス」ウィンドウを開き([Ctrl]-[5]、Macの場合は[⌘]-[5])、「データベース」カテゴリで接続ノード(<span class="image"><img src="images/connection-node-icon.png" alt="connection node icon"></span>)を検索します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>手順5で、「リソースの型」ドロップダウン・リストで「<code>javax.sql.ConnectionPoolDataSource</code>」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IDEは、前のステップで指定したデータベース接続から情報を抽出し、新規接続プール用の名前と値のプロパティを設定することに注意してください。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jdbc-resource-wizard3.png" alt="jdbc resource wizard3">
</div>
<div class="title">Figure 13. 選択したデータベース接続から抽出された情報に基づくデフォルト値</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「終了」をクリックします。ウィザードによって`glassfish-resources.xml`ファイルが生成され、指定したデータ・ソースと接続プール用のエントリが格納されます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで、「サーバー・リソース」ノードに作成した`glassfish-resources.xml`ファイルを開くことができます。`&lt;resources&gt;`タグ内には、前に指定した値を持つデータ・ソースと接続プールが宣言されています。</p>
</div>
<div class="paragraph">
<p>新しいデータ・ソースと接続プールが実際にGlassFishサーバーに登録されていることを確認するには、プロジェクトをサーバーにデプロイして、IDEの「サービス」ウィンドウ内でリソースを検索します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「IFPWAFCAD」プロジェクト・ノードを右クリックし、「デプロイ」を選択します。サーバーが起動し(実行されていない場合)、プロジェクトがコンパイルされ、そのサーバーにデプロイされます。</p>
</li>
<li>
<p>「サービス」ウィンドウを開き([Ctrl]-[5]、Macの場合は[⌘]-[5])、「サーバー」&gt;「GlassFish」&gt;「リソース」&gt;「JDBC」&gt;「JDBCリソース」ノードおよび「接続プール」ノードを展開します。新しいデータ・ソースと接続プールが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/services-window-glassfish.png" alt="services window glassfish">
</div>
<div class="title">Figure 14. 「サービス」ウィンドウに表示された新しいデータ・ソースと接続プール</div>
</div>
</div>
<div class="sect2">
<h3 id="referenceDataSource">アプリケーションからのデータ・ソースの参照</h3>
<div class="paragraph">
<p>構成したJDBCリソースをWebアプリケーションから参照する必要があります。これを行うには、アプリケーションの`web.xml`デプロイメント・ディスクリプタにエントリを作成します。</p>
</div>
<div class="paragraph">
<p>デプロイメント・ディスクリプタはXMLベースのテキスト・ファイルで、アプリケーションを特定の環境にデプロイメントする方法を記述した情報が含まれています。通常これらは、アプリケーション・コンテキスト・パラメータと動作パターンの指定、セキュリティ設定、およびサーブレット、フィルタ、リスナーのマッピングに使用されます。</p>
</div>
<div class="paragraph">
<p>*注意:*プロジェクトの作成時にJavaバージョンとしてJava EE 6またはJava EE 7を指定した場合は、新規ファイル・ウィザードで「Web」&gt;「標準のデプロイメント・ディスクリプタ」を選択して、デプロイメント・ディスクリプタ・ファイルを作成する必要があります。</p>
</div>
<div class="paragraph">
<p>データ・ソースをアプリケーションのデプロイメント・ディスクリプタの中で参照するには、次の手順を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「構成ファイル」フォルダを展開し、`web.xml`をダブルクリックしてエディタでこのファイルを開きます。</p>
</li>
<li>
<p>エディタの最上部にある「参照」タブをクリックします。</p>
</li>
<li>
<p>「リソース参照」見出しを展開し、「追加」をクリックして「リソース参照を追加」ダイアログを開きます。</p>
</li>
<li>
<p>「リソース名」に、前出のサーバーに対するデータ・ソースの構成時に付けたリソース名(<code>jdbc/IFPWAFCAD</code>)を入力します。</p>
</li>
<li>
<p>「リソースの型」フィールドに「<strong><code>javax.sql.ConnectionPoolDataSource</code></strong>」と入力します。「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「説明」フィールドの入力はオプションですが、リソースに理解しやすい説明を入力できます(「<code>IFPWAFCADアプリケーションのデータベース</code>」など)。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/add-resource-reference.png" alt="add resource reference">
</div>
<div class="title">Figure 15. 「リソース参照の追加」ダイアログでのリソース・プロパティの指定</div>
</div>
<div class="paragraph">
<p>「リソース参照」見出しの下に新しいリソースが表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>リソースが`web.xml`ファイルに追加されたことを確認するには、エディタの最上部にある「ソース」タブをクリックします。次に示す&lt;`resource-ref`&gt; タグが含まれるようになりました。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;resource-ref&gt;
    &lt;description&gt;Database for IFPWAFCAD application&lt;/description&gt;
    &lt;res-ref-name&gt;jdbc/IFPWAFCAD&lt;/res-ref-name&gt;
    &lt;res-type&gt;javax.sql.ConnectionPoolDataSource&lt;/res-type&gt;
    &lt;res-auth&gt;Container&lt;/res-auth&gt;
    &lt;res-sharing-scope&gt;Shareable&lt;/res-sharing-scope&gt;
&lt;/resource-ref&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="addJar">サーバーへのデータベース・ドライバのJARファイルの追加</h3>
<div class="paragraph">
<p>データベース・ドライバのJARファイルの追加は、サーバーとデータベースが通信できるようにするために不可欠な、もう1つのステップです。通常、データベース・ドライバのインストール・ディレクトリを特定し、ドライバのルート・ディレクトリにある`mysql-connector-java-5.1.6-bin.jar`ファイルを、使用しているサーバーのライブラリにコピーします。IDEのサーバー管理では、JARファイルが追加されているかどうかをデプロイメント時に検出できます。追加されていない場合、これが自動的に行われます。</p>
</div>
<div class="paragraph">
<p>これを確認するため、サーバー・マネージャ(「ツール」&gt;「サーバー」を選択)を開きます。IDEには、JDBCドライバのデプロイメント・オプションが用意されています。このオプションが有効化されている場合、サーバーのデプロイ対象アプリケーションに必要なドライバがあるかどうかを判断するための確認が開始されます。MySQLで、ドライバが必要だが見つからない場合は、IDEにバンドルされているドライバがサーバー上の適切な場所にデプロイされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「ツール」&gt;「サーバー」を選択してサーバー・マネージャを開きます。左ペインでGlassFishサーバーを選択します。</p>
</li>
<li>
<p>メイン・ペインで、「JDBCドライバのデプロイメントを有効化」オプションを選択します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/servers-window.png" alt="servers window">
</div>
<div class="title">Figure 16. JDBCドライバのデプロイメント・オプションによる、ドライバの自動デプロイメントの有効化</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバー・マネージャを閉じる前に、「ドメイン・フォルダ」テキスト・フィールドに指定されたパスをメモします。IDEでGlassFishサーバーに接続すると、実際はアプリケーション・サーバーの_インスタンス_に接続されます。各インスタンスは一意のドメインでアプリケーションを実行し、「ドメイン名」フィールドはサーバーが使用しているドメインの名前を示します。上のイメージに示されているように、ドライバのJARファイルは`domain1`内に存在します。これは、GlassFishサーバーをインストールしたときに作成されたデフォルトのドメインです。</p>
</li>
<li>
<p>「閉じる」をクリックしてサーバー・マネージャを終了します。</p>
</li>
<li>
<p>コンピュータ上で、GlassFishサーバーのインストール・ディレクトリに移動し、「<code>domains</code>」&gt;「<code>domain1</code>」&gt;「<code>lib</code>」サブフォルダに移動します。IFPWAFCADプロジェクトはすでにサーバーにデプロイされているため、「<code>mysql-connector-java-5.1.6-bin.jar</code>」ファイルが存在しているはずです。ドライバのJARファイルがない場合は、次のステップを実行します。</p>
</li>
<li>
<p>プロジェクトをサーバーにデプロイします。IDEの「プロジェクト」ウィンドウで、プロジェクト・ノードの右クリック・メニューから「デプロイ」を選択します。進捗状況は、IDEの出力ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])に表示されます。この出力に、GlassFishサーバーの場所にMySQLドライバがデプロイされることが示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/output-window.png" alt="output window">
</div>
<div class="title">Figure 17. MySQLドライバがデプロイされたことを示す「出力」ウィンドウ</div>
</div>
<div class="paragraph">
<p>ここでコンピュータ上の`domain1/lib`サブフォルダに戻ると、`mysql-connector-java-5.1.6-bin.jar`ファイルが自動的に追加されています。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="addLogic">動的ロジックの追加</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ここでは、以前にこのチュートリアルで作成した`index.jsp`プレースホルダと`response.jsp`プレースホルダに戻り、ページがユーザーの入力内容などに応じて_動的_にコンテンツを生成できるJSTLコードを実装します。これを行うには、次の3つのタスクを実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#addJSTL">プロジェクトのクラスパスにJSTLライブラリを追加</a></p>
</li>
<li>
<p><a href="#implementCode">JSTLコードの実装</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="addJSTL">プロジェクトのクラスパスへのJSTLライブラリの追加</h3>
<div class="paragraph">
<p><a href="http://www.oracle.com/technetwork/java/index-jsp-135995.html">JavaServer Pages標準タグ・ライブラリ</a> (JSTL)を適用して、データベースから取得したデータにアクセスしたり、そのデータを表示したりできます。GlassFishサーバーには、デフォルトでJSTLライブラリが含まれています。これは、「プロジェクト」ウィンドウで「ライブラリ」ノードの下の「GlassFish Server」ノードを展開し、`javax.servlet.jsp.jstl.jar`ライブラリを検索することで確認できます。(古いバージョンのGlassFishサーバーでは、`jstl-impl.jar`ライブラリを使用します。)GlassFishサーバーのライブラリはプロジェクトのクラスパスにデフォルトで追加されているため、このタスクのために何か実行する必要はありません。</p>
</div>
<div class="paragraph">
<p>JSTLには、次の4つの基本的な機能領域が用意されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core</code>: 反復子や条件などの、フロー制御を処理するための共通の構造的タスク</p>
</li>
<li>
<p><code>fmt</code>: 国際化およびローカライズのメッセージ書式設定</p>
</li>
<li>
<p><code>sql</code>: 単純なデータベース・アクセス</p>
</li>
<li>
<p><code>xml</code>: XMLコンテンツの処理</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このチュートリアルでは、`コア`および`sql`タグ・ライブラリの使用方法を中心に説明します。</p>
</div>
</div>
<div class="sect2">
<h3 id="implementCode">JSTLコードの実装</h3>
<div class="paragraph">
<p>ここでは、各ページでデータを動的に取得して表示するコードを実装します。どちらのページにも、このチュートリアルで以前に作成したデータ・ソースを利用するSQL問合せを実装する必要があります。</p>
</div>
<div class="paragraph">
<p>IDEにはデータベースに固有のJSTLスニペットがいくつか用意されており、パレット([Ctrl]-[Shift]-[8]、Macの場合は[⌘]-[Shift]-[8])から選択できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/palette-db.png" alt="palette db">
</div>
<div class="title">Figure 18. パレットでのデータベース固有のJSTLスニペットの選択</div>
</div>
<div class="sect3">
<h4 id="_index_jsp_2">index.jsp</h4>
<div class="paragraph">
<p>`index.jsp`内のフォームの内容を動的に表示するには、`Subject`データベース表のすべての`name`にアクセスする必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>マウスをパレットの「DBレポート」項目の上に移動します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/db-report.png" alt="db report">
</div>
<div class="title">Figure 19. 「db」と入力した後の[Ctrl]-[Space]の押下による、データベース固有のJSTLスニペットへのアクセス</div>
</div>
<div class="paragraph">
<p>「DBレポート」項目は、<code>&lt;sql:query&gt;`タグを使用してSQL問合せを作成してから、</code>&lt;c:forEach&gt;`タグを使用して問合せの`resultset`をループし、取得したデータを出力します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`&lt;%@page &#8230;&#8203; %&gt;`宣言(行7)のすぐ上の行にカーソルを置き、パレットの「DBレポート」項目をダブルクリックします。表示されたダイアログに、次の詳細を入力します。</p>
<div class="ulist">
<ul>
<li>
<p><strong>変数名:</strong> <code>subjects</code></p>
</li>
<li>
<p><strong>スコープ:</strong> <code>page</code></p>
</li>
<li>
<p><strong>データ・ソース:</strong> <code>jdbc/IFPWAFCAD</code></p>
</li>
<li>
<p><strong>問合せ文:</strong> <code>SELECT subject_id, name FROM Subject</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-db-report.png" alt="insert db report">
</div>
<div class="title">Figure 20. 「DBレポートの挿入」ダイアログを使用した、問合せ固有の詳細の指定</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「OK」をクリックします。次の内容が`index.jsp`ファイル内に生成されます。新しい内容は*太字*で表示しています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">*&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql"%&gt;*
&lt;%--
    Document   : index
    Author     : nbuser
--%&gt;

*&lt;sql:query var="subjects" dataSource="jdbc/IFPWAFCAD"&gt;
    SELECT subject_id, name FROM Subject
&lt;/sql:query&gt;

&lt;table border="1"&gt;
    &lt;!-- column headers --&gt;
    &lt;tr&gt;
    &lt;c:forEach var="columnName" items="${subjects.columnNames}"&gt;
        &lt;th&gt;&lt;c:out value="${columnName}"/&gt;&lt;/th&gt;
    &lt;/c:forEach&gt;
&lt;/tr&gt;
&lt;!-- column data --&gt;
&lt;c:forEach var="row" items="${subjects.rowsByIndex}"&gt;
    &lt;tr&gt;
    &lt;c:forEach var="column" items="${row}"&gt;
        &lt;td&gt;&lt;c:out value="${column}"/&gt;&lt;/td&gt;
    &lt;/c:forEach&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;*

&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>生成されたコンテンツで使用されるJSTLタグに必要な`taglib`ディレクティブ(<code>&lt;sql:query&gt;`および</code>&lt;c:forEach&gt;`)が、IDEによって自動的に追加されました。`taglib`ディレクティブは、JSPページがカスタム(つまり、JSTL)タグを使用することを宣言し、タグを定義するタグ・ライブラリおよびタグの接頭辞を指定します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトを実行し、ブラウザでどのように表示されるかを確認します。「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「実行」を選択すると、IDEによってプロジェクトがGlassFishサーバーにデプロイされ、indexページがサーブレットにコンパイルされ、開始ページがデフォルトのブラウザに表示されます。「DBレポート」項目から生成されたコードによって、開始ページ内に次の表が作成されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/db-report-table.png" alt="db report table">
</div>
<div class="title">Figure 21. 「DBレポート」を使用した、データベース表のデータのプロトタイプの速やかな作成</div>
</div>
<div class="paragraph">
<p>このように、「DBレポート」項目を使用すると、データベース接続をすばやくテストし、データベースの表データをブラウザで表示できるようになります。これは、プロトタイプを作成する場合に特に便利です。</p>
</div>
<div class="paragraph">
<p>次の手順では、生成されたコードを、このチュートリアルで以前に作成したHTMLドロップダウン・リストに統合する方法について説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>生成されたコードの列データを確認します。2つの`&lt;c:forEach&gt;`タグが使用されており、1つがもう1つの入れ子になっています。これにより、JSPコンテナ(つまり、GlassFishサーバー)が表のすべての行でループを実行し、行ごとにすべての列をループします。この方法で、表全体のデータが表示されます。</p>
</li>
<li>
<p>次のように、`&lt;c:forEach&gt;`タグをHTMLフォームに統合します。データベースに記録されているように、各項目の値は`subject_id`に、出力テキストは`name`になります。変更場所は*太字*で示されています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="response.jsp"&gt;
    &lt;strong&gt;Select a subject:&lt;/strong&gt;
    &lt;select name="subject_id"&gt;
        *&lt;c:forEach var="row" items="${subjects.rowsByIndex}"&gt;
            &lt;c:forEach var="column" items="${row}"&gt;*
                &lt;option *value="&lt;c:out value="${column}"/&gt;"*&gt;*&lt;c:out value="${column}"/&gt;*&lt;/option&gt;
            *&lt;/c:forEach&gt;
        &lt;/c:forEach&gt;*
    &lt;/select&gt;
    &lt;input type="submit" value="submit" name="submit" /&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">別の簡易な方法として、次のように`&lt;c:forEach&gt;`タグをHTMLフォームに統合することもできます。</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="response.jsp"&gt;
    &lt;strong&gt;Select a subject:&lt;/strong&gt;
    &lt;select name="subject_id"&gt;
        *&lt;c:forEach var="row" items="${subjects.rows}"&gt;*
            &lt;option *value="${row.subject_id}"*&gt;*${row.name}*&lt;/option&gt;
        *&lt;/c:forEach&gt;*
    &lt;/select&gt;
    &lt;input type="submit" value="submit" name="submit" /&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>どちらの場合も、<code>&lt;c:forEach&gt;`タグはSQL問合せからすべての`subject_id`の値と`name`の値をループし、各ペアをHTMLの</code>&lt;option&gt;`タグに挿入します。この方法で、フォームのドロップダウン・リストがデータと一緒に生成されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「DBレポート」項目から生成された表を削除します。削除場所は*<span class="line-through">取消し線</span>*で示されています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;
&lt;%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql"%&gt;
&lt;%--
    Document   : index
    Created on : Dec 22, 2009, 7:39:49 PM
    Author     : nbuser
--%&gt;

&lt;sql:query var="subjects" dataSource="jdbc/IFPWAFCAD"&gt;
    SELECT subject_id, name FROM Subject
&lt;/sql:query&gt;

*[.line-through]#&lt;table border="1"&gt;
    &lt;!-- column headers --&gt;
    &lt;tr&gt;
    &lt;c:forEach var="columnName" items="${subjects.columnNames}"&gt;
        &lt;th&gt;&lt;c:out value="${columnName}"/&gt;&lt;/th&gt;
    &lt;/c:forEach&gt;
&lt;/tr&gt;
&lt;!-- column data --&gt;
&lt;c:forEach var="row" items="${subjects.rowsByIndex}"&gt;
    &lt;tr&gt;
    &lt;c:forEach var="column" items="${row}"&gt;
        &lt;td&gt;&lt;c:out value="${column}"/&gt;&lt;/td&gt;
    &lt;/c:forEach&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;#*

&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>変更を保存します([Ctrl]-[S]、Macの場合は[⌘]-[S])。</p>
</li>
<li>
<p>プロジェクトの開始ページをブラウザでリフレッシュします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ブラウザのドロップダウン・リストに、データベースから取得されたサブジェクトが追加されています。</p>
</div>
<div class="paragraph">
<p>プロジェクトに対して「保存時にコンパイル」がデフォルトで有効になっているため、プロジェクトを再デプロイする必要はありません。つまり、ファイルを変更して保存するとファイルのコンパイルとデプロイが自動的に行われるので、プロジェクト全体を再コンパイルする必要はありません。プロジェクトの「プロパティ」ウィンドウの「コンパイル」カテゴリで、プロジェクトの「保存時にコンパイル」を有効または無効にできます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_response_jsp_2">response.jsp</h4>
<div class="paragraph">
<p>レスポンス・ページには、開始ページで選択したサブジェクトに対応したカウンセラの詳細情報が表示されます。作成する問合せでは、選択されたサブジェクト・レコードの`counselor_idfk`と一致する`counselor_id`を持つカウンセラ・レコードを選択する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`&lt;%@page &#8230;&#8203; %&gt;`宣言(行7)のすぐ上の行にカーソルを置き、パレットで「DB問合せ」をダブルクリックして、「DB問合せの挿入」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>「DB問合せの挿入」ダイアログ・ボックスで、次の詳細を入力します。</p>
<div class="ulist">
<ul>
<li>
<p><strong>変数名:</strong> <code>counselorQuery</code></p>
</li>
<li>
<p><strong>スコープ:</strong> <code>page</code></p>
</li>
<li>
<p><strong>データ・ソース:</strong> <code>jdbc/IFPWAFCAD</code></p>
</li>
<li>
<p><strong>問合せ文:</strong> <code>SELECT * FROM Subject, Counselor WHERE Counselor.counselor_id=Subject.counselor_idfk AND Subject.subject_id=? &lt;sql:param value="${param.subject_id}"/&gt;</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-db-query2.png" alt="insert db query2">
</div>
<div class="title">Figure 22. 「DB問合せの挿入」ダイアログを使用した、問合せ固有の詳細の指定</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「OK」をクリックします。次の内容が`response.jsp`ファイル内に生成されます。新しい内容は*太字*で表示しています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">*&lt;%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql"%&gt;*
&lt;%--
    Document   : response
    Created on : Dec 22, 2009, 8:52:57 PM
    Author     : nbuser
--%&gt;

*&lt;sql:query var="counselorQuery" dataSource="jdbc/IFPWAFCAD"&gt;
    SELECT * FROM Subject, Counselor
    WHERE Counselor.counselor_id = Subject.counselor_idfk
    AND Subject.subject_id = ? &lt;sql:param value="${param.subject_id}"/&gt;
&lt;/sql:query&gt;*

&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;sql:query&gt;`タグのために必要な`taglib`ディレクティブが、IDEによって自動的に追加されました。また、問合せ内で</code>&lt;sql:param&gt;`タグを直接使用しました。この問合せは`index.jsp`から送信される`subject_id`の値に依存しているため、<code>${param.subject_id}`形式の式言語(EL)文を使用してその値を抽出して</code>&lt;sql:param&gt;`タグに渡すことができます。実行時にはこの値が、SQL疑問符(<code>?</code>)のかわりに使用されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`&lt;c:set&gt;`タグを使用して、問合せから返される`resultset`の最初のレコード(つまり、行)に対応する変数を設定します。新しい内容は*太字*で表示しています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;sql:query var="counselorQuery" dataSource="jdbc/IFPWAFCAD"&gt;
    SELECT * FROM Subject, Counselor
    WHERE Counselor.counselor_id = Subject.counselor_idfk
    AND Subject.subject_id = ? &lt;sql:param value="${param.subject_id}"/&gt;
&lt;/sql:query&gt;

*&lt;c:set var="counselorDetails" value="${counselorQuery.rows[0]}"/&gt;*</code></pre>
</div>
</div>
<div class="paragraph">
<p>問合せから返される`resultset`には本来1件のレコードのみが含まれますが、このページは式言語(EL)文を使用してレコードの値にアクセスする必要があるため、このステップが必要になります。<code>index.jsp`では、</code>&lt;c:forEach&gt;`タグを使用するのみで`resultset`の値にアクセスできました。ただし、`&lt;c:forEach&gt;`タグは、問合せに含まれる行に変数を設定することで動作します。そのため、EL文に行変数を含めることで値を抽出できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JSTL`コア`ライブラリ用の`taglib`ディレクティブをファイルの先頭に追加し、`&lt;c:set&gt;`タグが認識されるようにします。新しい内容は*太字*で表示しています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;*
&lt;%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql"%&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTMLマークアップで、すべてのプレースホルダを、`counselorDetails`変数に保持されているデータを表示するEL文のコードに置き換えます。変更場所は*太字*で示されています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;
        &lt;link rel="stylesheet" type="text/css" href="style.css"&gt;
        &lt;title&gt;*${counselorDetails.name}*&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;th colspan="2"&gt;*${counselorDetails.name}*&lt;/th&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;strong&gt;Description: &lt;/strong&gt;&lt;/td&gt;
                &lt;td&gt;&lt;span style="font-size:smaller; font-style:italic;"&gt;*${counselorDetails.description}*&lt;/span&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;strong&gt;Counselor: &lt;/strong&gt;&lt;/td&gt;
                &lt;td&gt;&lt;strong&gt;*${counselorDetails.first_name} ${counselorDetails.nick_name} ${counselorDetails.last_name}*&lt;/strong&gt;
                    &lt;br&gt;&lt;span style="font-size:smaller; font-style:italic;"&gt;
                    &lt;em&gt;member since: *${counselorDetails.member_since}*&lt;/em&gt;&lt;/span&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;strong&gt;Contact Details: &lt;/strong&gt;&lt;/td&gt;
                &lt;td&gt;&lt;strong&gt;email: &lt;/strong&gt;
                    &lt;a href="mailto:*${counselorDetails.email}*"&gt;*${counselorDetails.email}*&lt;/a&gt;
                    &lt;br&gt;&lt;strong&gt;phone: &lt;/strong&gt;*${counselorDetails.telephone}*&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run">完成したアプリケーションの実行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これで、アプリケーションは完成です。アプリケーションをもう一度実行し、ブラウザでどのように表示されるかを確認します。NetBeansには「保存時にコンパイル」機能があるため、アプリケーションのコンパイルや再デプロイに気を遣う必要はありません。プロジェクトを実行すると、確実に最新の変更がデプロイメントに反映されます。</p>
</div>
<div class="paragraph">
<p>メイン・ツールバーの「プロジェクトの実行」(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>)ボタンをクリックします。IDEのデフォルトのブラウザで`index.jsp`ページが開きます。</p>
</div>
<div class="paragraph">
<p>ブラウザに`index.jsp`が表示されたら、ドロップダウン・リストからサブジェクトを選択し、「<code>submit</code>」をクリックします。ここで`response.jsp`ページに移動します。ここには選択内容に対応する詳細が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/response-display.png" alt="response display">
</div>
<div class="title">Figure 23. ブラウザに表示されたresponse.jsp (データベースから取得したデータの表示)</div>
</div>
<div class="paragraph">
<p>これで「MySQLデータベースを使用した単純なWebアプリケーションの作成」は終わりです。このドキュメントでは、MySQLデータベースに接続する単純なWebアプリケーションの作成方法を説明しました。また、基本的な2層アーキテクチャを使用するアプリケーションの構築方法を説明し、データに動的にアクセスして表示する手段としてJSP、JSTL、JDBC、JNDIなど様々なテクノロジを利用しました。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshoot">トラブルシューティング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>チュートリアルのアプリケーションで発生する問題の多くは、GlassFish Server Open Source EditionとMySQLデータベース・サーバーとの間の接続に原因があります。アプリケーションが正しく表示されない場合、またはサーバー・エラーを受信する場合は、次の確認作業が役に立つ場合があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#access?">データベース・リソースは存在していますか。</a></p>
</li>
<li>
<p><a href="#datasource?">接続プールとデータ・ソースはサーバー上に存在していますか。</a></p>
</li>
<li>
<p><a href="#driver?">MySQL Connector/JドライバはGlassFishサーバーにアクセスできますか。</a></p>
</li>
<li>
<p><a href="#password?">データベースはパスワードで保護されていますか。</a></p>
</li>
<li>
<p><a href="#ping?">接続プールのプロパティは正しく設定されていますか。</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="access">データベース・リソースは存在していますか。</h3>
<div class="paragraph">
<p>IDEの「サービス」ウィンドウ([Ctrl]-[5]、Macの場合は[⌘]-[5])を使用して、MySQLサーバーが実行されていること、および`MyNewDatabase`がアクセス可能で適切な表データを含んでいることを確認します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQLデータベース・サーバーに接続するには、「MySQLサーバー」ノードを右クリックし、「接続」を選択します。</p>
</li>
<li>
<p>`MyNewDatabase`の接続ノード(<span class="image"><img src="images/db-connection-node.png" alt="db connection node"></span>)が「サービス」ウィンドウに表示されない場合は、MySQLのドライバ・ノード(<span class="image"><img src="images/driver-node.png" alt="driver node"></span>)を右クリックし、「接続」を選択することで接続を作成できます。表示されたダイアログで、必要な詳細情報を入力します。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-db-connection-dialog.png" alt="new db connection dialog">
</div>
<div class="title">Figure 24. 「データベースの新規接続」ダイアログを使用したIDEでのデータベース接続の確立</div>
</div>
<div class="paragraph">
<p><span class="tips">「データベースの新規接続」ダイアログの各フィールドの値は、「JDBC URLを表示」オプションに入力するURL文字列が反映されます。したがって、URL (たとえば、<code>jdbc:mysql://localhost:3306/MyNewDatabase</code>)がわかっていれば、そのURLをコピーして「JDBC URLを表示」フィールドに貼り付けると、ダイアログにある残りのフィールドは自動的に入力されます。</span>
* <code>Subject`表と`Counselor`表が存在し、これらの表にサンプル・データが含まれていることを確認するには、「`MyNewDatabase</code>」接続ノード(<span class="image"><img src="images/db-connection-node.png" alt="db connection node"></span>)を展開し、「<code>MyNewDatabase</code>」カタログ・ノード(<span class="image"><img src="images/db-catalog-node.png" alt="db catalog node"></span>)を見つけます。カタログ・ノードを展開し、既存の表を表示します。表ノードを右クリックして「データを表示」を選択すると、表のデータを確認できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/services-window-view-data.png" alt="services window view data">
</div>
<div class="title">Figure 25. データベース表ノードの右クリック・メニューから「データを表示」を選択することによる表データの表示</div>
</div>
</div>
<div class="sect2">
<h3 id="datasource">接続プールとデータ・ソースはサーバー上に存在していますか。</h3>
<div class="paragraph">
<p>アプリケーションをGlassFishサーバーにデプロイしたら、プロジェクトに含まれる`glassfish-resources.xml`からサーバーに対して、JDBCリソースと接続プールを作成する指示を出すようにしてください。これらが存在しているかどうかの確認は、「サービス」ウィンドウの「サーバー」ノードからも実行できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>「サーバー」&gt;「GlassFish Server」&gt;「リソース」ノードを展開します。「JDBCリソース」を展開し、「<code>glassfish-resources.xml</code>」から作成された「<code>jdbc/IFPWAFCAD</code>」データ・ソースを表示します。「接続プール」ノードを展開し、「<code>glassfish-resources.xml</code>」から作成された「<code>IfpwafcadPool</code>」接続プールを表示します。これについては<a href="#view-connection-pool">以前に説明しています</a>。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="driver">MySQL Connector/JドライバはGlassFishサーバーにアクセスできますか。</h3>
<div class="paragraph">
<p>MySQL Connector/JドライバがGlassFishサーバーにデプロイされていることを確認します。これについては、<a href="#addJar">サーバーへのデータベース・ドライバのJARファイルの追加</a>で説明しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>コンピュータ上でGlassFishサーバーのインストール・フォルダを探し、`GlassFish domains/domain1/lib`サブフォルダを表示します。このフォルダに、`mysql-connector-java-5.1.6-bin.jar`ファイルがあるはずです。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="password">データベースはパスワードで保護されていますか。</h3>
<div class="paragraph">
<p>このチュートリアルでGlassFishサーバーのデータ・ソースが正しく動作するためには、データベースをパスワードで保護しておく必要があります。パスワードが設定されていないデフォルトのMySQL`root`アカウントを使用している場合は、コマンド行プロンプトからパスワードを設定できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>パスワードを`<em>nbuser</em>`に設定するには、コマンド行プロンプトでMySQLのインストール・ディレクトリの`bin`ディレクトリに移動し、次のように入力します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">shell&gt; mysql -u root
mysql&gt; UPDATE mysql.user SET Password = PASSWORD('_nbuser_')
    -&gt;     WHERE User = 'root';
mysql&gt; FLUSH PRIVILEGES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>詳細は、MySQL公式リファレンス・マニュアルの<a href="http://dev.mysql.com/doc/refman/5.1/en/default-privileges.html">初期MySQLアカウントの保護</a>を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="ping">接続プールのプロパティは正しく設定されていますか。</h3>
<div class="paragraph">
<p>接続プールがサーバーに対して正しく動作していることを確認します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「サービス」ウィンドウ([Ctrl]-[5]、Macの場合は[⌘]-[5])を開き、「サーバー」ノードを展開します。</p>
</li>
<li>
<p>GlassFishサーバーのノードを右クリックし、「管理コンソールを表示」を選択します。</p>
</li>
<li>
<p>要求された場合は、ユーザー名とパスワードを入力します。サーバー・マネージャで、ユーザー名とパスワードを表示できます。</p>
</li>
<li>
<p>コンソールの左側にあるツリーで、「リソース」&gt;「JDBC」&gt;「JDBC接続プール」&gt;「<code>IfpwafcadPool</code>」ノードを展開します。「<code>IfpwafcadPool</code>」接続プールの詳細がメイン・ウィンドウに表示されます。</p>
</li>
<li>
<p>「Ping」ボタンをクリックします。接続プールが正しく設定されている場合、「<code>Pingが成功しました</code>」というメッセージが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ping-succeeded.png" alt="ping succeeded">
</div>
<div class="title">Figure 26. GlassFishサーバーの管理コンソールでのPingのクリックによる接続プールのテスト</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pingが失敗した場合は、「追加プロパティ」タブをクリックし、一覧表示されているプロパティの値が正しく設定されていることを確認します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Creating%20Web%20App%20MySQL">ご意見をお寄せください</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JavaによるWeb開発の詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>NetBeansの記事およびチュートリアル</strong></p>
</li>
<li>
<p><a href="../ide/mysql.html">NetBeans IDEでのMySQLデータベースへの接続</a>。IDEでMySQLデータベースを操作する方法の基礎を紹介しています。</p>
</li>
<li>
<p><a href="jsf20-intro.html">JavaServer Faces 2.x入門</a>。Java WebプロジェクトでJSFフレームワークを使用する方法について説明したチュートリアルです。</p>
</li>
<li>
<p><a href="quickstart-webapps-spring.html">Spring Framework入門</a>。Spring Frameworkを使用してMVC Webアプリケーションを作成する方法について説明したチュートリアルです。</p>
</li>
<li>
<p><strong>Java Database Connectivity (JDBC)</strong></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/tutorial/jdbc/overview/index.html">JDBCの概要</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javase/6/docs/technotes/guides/jdbc/getstart/GettingStartedTOC.fm.html">JDBC API入門</a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/tutorial/jdbc/basics/index.html">Javaチュートリアル: JDBCの基本</a></p>
</li>
<li>
<p><strong>JavaServer Pages標準タグ・ライブラリ(JSTL)</strong></p>
</li>
<li>
<p><a href="http://www.oracle.com/technetwork/java/index-jsp-135995.html">JavaServer Pages標準タグ・ライブラリ</a> (公式製品ページ)</p>
</li>
<li>
<p><strong>Java Naming and Directory Interface (JNDI)</strong></p>
</li>
<li>
<p><a href="http://www.oracle.com/technetwork/java/jndi-136720.html">Java SEのコア・テクノロジ - Java Naming and Directory Interface</a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/jndi/tutorial/">JNDIチュートリアル</a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/tutorial/jndi/index.html">Javaチュートリアル: Java Naming and Directory Interface</a></p>
</li>
</ul>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/web/mysql-webapp_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
