
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Java WebアプリケーションでのAjax入門</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Java WebアプリケーションでのAjax入門 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Java WebアプリケーションでのAjax入門">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Java WebアプリケーションでのAjax入門</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/web/ajax-quickstart_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#overview">アプリケーションの概要</a></li>
<li><a href="#client1">クライアント側のプログラミング: 第1部</a>
<ul class="sectlevel2">
<li><a href="#_htmlエディタの使用">HTMLエディタの使用</a></li>
<li><a href="#javascript">JavaScriptエディタの使用</a></li>
</ul>
</li>
<li><a href="#serverside">サーバー側のプログラミング</a>
<ul class="sectlevel2">
<li><a href="#_データストアの作成">データ・ストアの作成</a></li>
<li><a href="#servlet">サーブレットの作成</a></li>
</ul>
</li>
<li><a href="#client2">クライアント側のプログラミング: 第2部</a>
<ul class="sectlevel2">
<li><a href="#_コールバック機能の追加">コールバック機能の追加</a></li>
<li><a href="#_html_domの更新">HTML DOMの更新</a></li>
<li><a href="#displayresults">結果の表示</a></li>
<li><a href="#stylesheet">スタイル・シートの添付</a></li>
</ul>
</li>
<li><a href="#run">プロジェクトの実行</a>
<ul class="sectlevel2">
<li><a href="#httpMonitor">HTTPサーバー・モニターの使用</a></li>
<li><a href="#conclusion">まとめ</a></li>
</ul>
</li>
<li><a href="#seeAlso">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このドキュメントでは、Ajaxの概要を説明し、Ajax関連のテクノロジを使用するときにより短時間で効率よくプログラミングできるNetBeans IDEの機能を示します。Ajaxの基本的な機能を学びながら、テキスト・フィールドの自動補完を行う単純なアプリケーションをビルドします。このドキュメントでは、<a href="http://weblogs.java.net/blog/gmurray71/archive/2005/12/using_ajax_with_1.html">Javaテクノロジを使用するAjaxの使用</a>に公開しているGreg Murrayの記事とサンプル・アプリケーションを使用します。</p>
</div>
<div class="paragraph">
<p>Ajaxは「Asynchronous JavaScript and XML」(非同期JavaScriptとXML)の略です。Ajaxは基本的に、ユーザーによるWebページの操作をWebアプリケーションで効率的に処理する方法であり、ユーザーが操作するたびにページをリフレッシュしたり、ページ全体を再ロードしたりする必要を減らします。その結果、デスクトップ・アプリケーションやプラグインに基づいたWebアプリケーションのような、ブラウザを使用したスムーズな操作が可能になります。Ajaxの相互作用はバックグラウンドで非同期で処理されます。このとき、ユーザーはページの操作を続けることができます。Ajaxの相互作用はJavaScriptコードによって開始されます。Ajaxの相互作用が完了したら、JavaScriptがそのページのHTMLソースを更新します。変更は、ページをリフレッシュすることなく、すぐに反映されます。Ajaxの相互作用を使用して、ユーザーがフォームに入力している間にサーバー側ロジックを使用してフォーム・エントリを検証したり、サーバーから詳細なデータを取り出したり、ページ上のデータを動的に更新したり、ページから部分フォームを送信したりできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="paragraph">
<p><strong>このチュートリアルを完了するには、次のソフトウェアとリソースが必要です。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDEのJava EEバンドル版</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.3, 7.4, 8.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://glassfish.java.net/">GlassFishサーバー</a>
<em>または</em>
<a href="http://tomcat.apache.org/index.html">Tomcatサーバー</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Source Edition 3.1.xまたは4.x
_ _
バージョン7.xまたは8.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>*注意: *</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IDEのJava EEインストール版では、GlassFishサーバーとApache Tomcatサーブレット・コンテナをオプションでインストールできます。</p>
</li>
<li>
<p>このチュートリアルは、使用する様々なテクノロジ(HTML、CSS、JavaScript、Java、JSPなど)についての実用的な知識がある方を対象としています。コードによって提供される機能の概要は説明しますが、コード行ごとの処理は_説明しません_。</p>
</li>
<li>
<p>プロジェクトを、正常に機能するソリューションと比較する必要がある場合は、<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaScript%252FMyAjaxApp.zip">サンプル・アプリケーションをダウンロード</a>できます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview">アプリケーションの概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ユーザーが作曲家に関する情報を検索できるWebページを考えます。このページには、ユーザーが作曲家の名前を入力できるフィールドがあります。サンプル・アプリケーションのエントリ・フィールドには、オートコンプリート機能があります。つまり、ユーザーが作曲家の名前の一部を入力すると、Webアプリケーションでは、入力した文字から名または姓のいずれかが始まるすべての作曲家のリストを表示してその名前を補完します。オートコンプリート機能によってユーザーは作曲家の名前を完全に覚えている必要がなく、また求めている情報を直観的かつ容易に入手できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sample-app.png" alt="sample app">
</div>
<div class="title">Figure 2. ブラウザに表示されたサンプル・アプリケーション</div>
</div>
<div class="paragraph">
<p>検索フィールドへの自動補完の実装は、Ajaxを使用して実行できます。Ajaxは、`XMLHttpRequest`オブジェクトを使用してクライアントとサーバーの間でリクエストとレスポンスを非同期で受け渡しすることで機能します。次の図は、クライアントとサーバーの間で行われる通信のプロセス・フローを示します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ajax-process-flow.png" alt="ajax process flow">
</div>
<div class="title">Figure 3. Ajaxのプロセス・フロー図</div>
</div>
<div class="paragraph">
<p>この図には、次の手順のプロセス・フローを示しています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユーザーが、たとえば名前を入力しているときにキーを解除して、イベントをトリガーします。すると、`XMLHttpRequest`オブジェクトを初期化する関数へのJavaScriptコールが行われます。</p>
</li>
<li>
<p>`XMLHttpRequest`オブジェクトが、イベントをトリガーしたコンポーネントのIDを含むリクエスト・パラメータと、ユーザーが入力した値で構成されます。次に、`XMLHttpRequest`オブジェクトがWebサーバーへの非同期リクエストを実行します。</p>
</li>
<li>
<p>Webサーバーでは、サーブレットやリスナーなどのオブジェクトがリクエストを処理します。データ・ストアからデータが取り出され、XMLドキュメント形式のデータを含むレスポンスが作成されます。</p>
</li>
<li>
<p>最後に、コールバック関数を使用して`XMLHttpRequest`オブジェクトがXMLデータを受け取って処理し、新しいデータを含むページを表示するようにHTMLのDOM (Document Object Model)を更新します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>このチュートリアルでは、前述の図で示したプロセス・フローに従ってオートコンプリートのシナリオを構築する方法を示します。最初に、プレゼンテーション用、および`XMLHttpRequest`オブジェクトの生成に必要な機能用のクライアント側ファイルを作成します。次に、Javaベースのテクノロジを使用してデータ・ストアとビジネス・ロジックを作成し、サーバー側を設定します。最後に、クライアント側に戻り、`callback()`と、HTMLのDOMを更新するためのその他のJavaScript機能を実装します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client1">クライアント側のプログラミング: 第1部</h2>
<div class="sectionbody">
<div class="paragraph">
<p>最初にIDEで新しいWebアプリケーション・プロジェクトを作成します。IDEには、様々なタイプのプロジェクト用のテンプレートが組み込まれています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「ファイル」&gt;「新規プロジェクト」を選択します。「カテゴリ」から「Java Web」を選択します。「プロジェクト」で「Webアプリケーション」を選択して、「次」をクリックします。</p>
</li>
<li>
<p>「名前と場所」パネルでプロジェクト名として「<code>MyAjaxApp</code>」と入力します。「プロジェクトの場所」フィールドでコンピュータ上でのプロジェクトの場所を指定できます。他のオプションはデフォルトのままにして、「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/java-name-location.png" alt="java name location">
</div>
<div class="title">Figure 4. アプリケーション・プロジェクトでの名前と場所の指定</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「サーバーと設定」パネルで、アプリケーションをデプロイするサーバーを選択します。IDEに登録されているサーバーのみ表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/java-server-settings.png" alt="java server settings">
</div>
<div class="title">Figure 5. アプリケーションのデプロイ先サーバーの指定</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>その他のデフォルト設定を受け入れ、「終了」をクリックします。プロジェクトがファイル・システムに生成され、IDEで開きます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>JavaベースのWebプロジェクトが作成されると、<a href="http://ant.apache.org/">Ant</a>ビルド・スクリプトが自動的に生成されます。このスクリプトによってプロジェクトをコンパイルし、IDEに登録されているサーバーにすぐにデプロイして実行できます。</p>
</div>
<div class="paragraph">
<p>デフォルトのエントリ・ページが生成され、IDEのソース・エディタで開きます。エントリ・ページは、ターゲット・サーバーに応じて`index.jsp`または`index.html`のいずれかです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/java-proj-win.png" alt="java proj win">
</div>
<div class="title">Figure 6. MyAjaxAppプロジェクトが表示された「プロジェクト」ウィンドウ</div>
</div>
<div class="paragraph">
<p>コーディングを始める前に、アプリケーションを実行してみて、IDE、サーバー、ブラウザの間の構成が正しく設定されていることを確認します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>アプリケーションがコンパイルされ、アプリケーション・サーバーが起動し、アプリケーションがサーバーにデプロイされて実行されます。デフォルト・ブラウザが開き、デフォルト・エントリ・ページが表示されます。</p>
</div>
<div class="sect2">
<h3 id="_htmlエディタの使用">HTMLエディタの使用</h3>
<div class="imageblock">
<div class="content">
<img src="images/palette.png" alt="palette">
</div>
<div class="title">Figure 7. HTML要素が表示されたパレット</div>
</div>
<div class="paragraph">
<p>環境が正しく設定されていることを確認できたら、まずindexページを、ユーザーに表示する自動補完インタフェースに変更します。</p>
</div>
<div class="paragraph">
<p>IDEを使用する利点の1つは、作業を行うエディタには一般にコード補完機能が用意されていて、コーディングするときに適用すれば生産性を大幅に向上できることです。IDEのソース・エディタは通常、使用しているテクノロジに適応するので、HTMLページの作業を実行しているときにコード補完のキーの組合せ([Ctrl]-[Space])を押すとHTMLのタグと属性の候補が表示されます。後述するように、CSSやJavaScriptなどその他のテクノロジも同様です。</p>
</div>
<div class="paragraph">
<p>IDEのパレットも便利な機能です。パレットには、コーディングするテクノロジで一般的に適用される要素の使いやすいテンプレートが用意されています。項目をクリックして、ソース・エディタで開いているファイル内の任意の位置にドラッグするのみです。</p>
</div>
<div class="paragraph">
<p>この図のように大きなアイコンを表示するには、パレット内を右クリックし、「大きなアイコンを表示」を選択します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>&lt;title&gt;`タグおよび</code>&lt;h1&gt;`タグの内容を「<code>Auto-Completion using AJAX</code>」に変更します。indexページにはサーバー側スクリプト・コードは必要ないので、デフォルトで作成された残りの部分を削除してもかまいません。indexページは次のようになります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE html&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;title&gt;Auto-Completion using AJAX&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Auto-Completion using AJAX&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テキスト・フィールドの目的を説明するテキストを追加します。次のテキストをコピーして、`&lt;h1&gt;`タグのすぐ下に貼り付けることもできます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;This example shows how you can do real time auto-completion using Asynchronous
    JavaScript and XML (Ajax) interactions.&lt;/p&gt;

&lt;p&gt;In the form below enter a name. Possible names that will be completed are displayed
    below the form. For example, try typing in "Bach," "Mozart," or "Stravinsky,"
    then click on one of the selections to see composer details.&lt;/p&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ページにHTMLフォームを追加します。この操作を行うには、IDEのパレットに表示されている要素を使用します。パレットが開いていない場合は、メイン・メニューから「ウィンドウ」&gt;「パレット」を選択します。次に「HTMLフォーム」の下にある「フォーム」要素をクリックし、ページ内に追加した`&lt;p&gt;`タグの下までドラッグします。「挿入フォーム」ダイアログ・ボックスが表示されます。次の値を指定します。</p>
<div class="ulist">
<ul>
<li>
<p>アクション: autocomplete</p>
</li>
<li>
<p>メソッド: GET</p>
</li>
<li>
<p>名前: autofillform</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-form.png" alt="insert form">
</div>
<div class="title">Figure 8. 「挿入フォーム」ダイアログ</div>
</div>
<div class="paragraph">
<p>「OK」をクリックします。指定した属性を含むHTMLの`&lt;form&gt;`タグがページに挿入されます。(GETはデフォルトで適用されるので、明示的に宣言しません。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTML表をページに追加します。パレットの「HTML」カテゴリの下で「表」要素をクリックし、`&lt;form&gt;`タグの間の位置までドラッグします。「挿入表」ダイアログ・ボックスが開きます。次の値を指定します。</p>
<div class="ulist">
<ul>
<li>
<p>行: 2</p>
</li>
<li>
<p>列: 2</p>
</li>
<li>
<p>境界線のサイズ: 0</p>
</li>
<li>
<p>セルのパディング: 5</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-table.png" alt="insert table">
</div>
<div class="title">Figure 9. 「挿入表」ダイアログ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタ内を右クリックし、「フォーマット」を選択します。これでコードの体裁が整います。フォームは次のようになります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form name="autofillform" action="autocomplete"&gt;
  &lt;table border="0" cellpadding="5"&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;&lt;/td&gt;
        &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;&lt;/td&gt;
        &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>表の1行目の1列目に次のテキストを入力します(*太字*部分が変更箇所)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;td&gt;*&lt;strong&gt;Composer Name:&lt;/strong&gt;*&lt;/td&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>1行目の2列目では、パレットから「テキスト入力」フィールドをドラッグしないで、次のコードを手動で入力します(*太字*部分が変更箇所)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;td&gt;
    *&lt;input type="text"
        size="40"
        id="complete-field"
        onkeyup="doCompletion();"&gt;*
&lt;/td&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>入力するときは、IDEに組み込まれているコード補完サポートを使用してみてください。たとえば、「<code>&lt;i</code>」と入力して[Ctrl]-[Space]を押します。カーソルの下に候補のリストが表示され、選択されている要素の説明が上のボックスに表示されます。ソース・エディタでコーディングしているときはいつでも[Ctrl]-[Space]を押して候補を表示できます。候補が1つのみの場合は、[Ctrl]-[Space]を押すと要素名が自動的に補完されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-completion.png" alt="code completion">
</div>
<div class="title">Figure 10. エディタでの[Ctrl]-[Space]の押下によるコード補完およびドキュメントのサポートの呼出し</div>
</div>
<div class="paragraph">
<p>入力した`onkeyup`属性はJavaScript関数`doCompletion()`を指しています。この関数は、フォームのテキスト・フィールド内でキーが押されるたびにコールされ、Ajaxの<a href="#flow-diagram">フロー図</a>に示したJavaScriptコールに対応します。</p>
</div>
</div>
<div class="sect2">
<h3 id="javascript">JavaScriptエディタの使用</h3>
<div class="paragraph">
<p>IDEのJavaScriptエディタには、インテリジェントなコード補完、意味解釈の強調表示、名前の即時変更機能とリファクタリング機能など、多数の高度な編集機能が用意されています。</p>
</div>
<div class="paragraph">
<p>JavaScriptのコード補完は、<code>.js`ファイル内でコーディングするとき、および他のテクノロジ(HTML、RHTML、JSP、PHPなど)を使用しているときに</code>&lt;script&gt;`タグ内で自動的に提供されます。IDEは、JavaScriptコードの編集時にヒントを提供できます。「ツール」→「オプション」(Macでは「NetBeans」→プリファレンス)を選択して「オプション」ウィンドウを開き、「エディタ」カテゴリの「ヒント」タブでJavaScript言語を選択することにより、JavaScriptヒント・オプションを指定できます。「オプション」ウィンドウの「コード・テンプレート」タブで、独自のJavaScriptコード・テンプレートを追加することもできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javascript-options.png" alt="javascript options">
</div>
<div class="title">Figure 11. 「オプション」ウィンドウの「JavaScript」ヒント・オプション</div>
</div>
<div class="paragraph">
<p>アプリケーションにJavaScriptファイルを追加し、`doCompletion()`の実装を始めます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「Webページ」ノードを右クリックし、「新規」&gt;「JavaScriptファイル」を選択します。(「JavaScriptファイル」がリストにない場合は「その他」を選択します。次に、新規ファイル・ウィザードで「Web」カテゴリからJavaScriptファイルを選択します。</p>
</li>
<li>
<p>ファイル名を`javascript`にし、「終了」をクリックします。新しいJavaScriptファイルが「プロジェクト」ウィンドウで「Webページ」フォルダ内に表示されることを確認します。</p>
</li>
<li>
<p>次のコードを`javascript.js`に入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">var req;
var isIE;

function init() {
    completeField = document.getElementById("complete-field");
}

function doCompletion() {
        var url = "autocomplete?action=complete&amp;amp;id=" + escape(completeField.value);
        req = initRequest();
        req.open("GET", url, true);
        req.onreadystatechange = callback;
        req.send(null);
}

function initRequest() {
    if (window.XMLHttpRequest) {
        if (navigator.userAgent.indexOf('MSIE') != -1) {
            isIE = true;
        }
        return new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        isIE = true;
        return new ActiveXObject("Microsoft.XMLHTTP");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上のコードは、Firefox 3およびInternet Explorerバージョン6と7の単純なブラウザ互換性チェックを行います。互換性の問題に対してさらに堅牢なコードを取り込むには、<a href="http://www.quirksmode.org">http://www.quirksmode.org</a>の<a href="http://www.quirksmode.org/js/detect.html">ブラウザ検出スクリプト</a>を使用することを検討してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>indexページに戻り、JavaScriptファイルへの参照を`&lt;head&gt;`タグの間に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;script type="text/javascript" src="javascript.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>[Ctrl]-[Tab]を押すと、ソース・エディタ内で開いているページ間を簡単に切り替えることができます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>init()`へのコールを開始</code>&lt;body&gt;`タグ内に挿入します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;body *onload="init()"*&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>このようにすると、ページがロードされるたびに`init()`がコールされます。</p>
</div>
<div class="paragraph">
<p>`doCompletion()`には次の役割があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>サーバー側で利用できるデータを含むURLを作成すること</p>
</li>
<li>
<p>`XMLHttpRequest`オブジェクトを初期化すること</p>
</li>
<li>
<p>非同期リクエストをサーバーに送信するように`XMLHttpRequest`オブジェクトに要求すること</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>`XMLHttpRequest`オブジェクトはAjaxの中核であり、HTTPを使用してXMLデータを非同期で送信するときの事実上の標準になっています。相互作用が_非同期_であるということは、リクエストの送信後にブラウザではページ内で引続きイベントを処理できることを意味します。データはバックグラウンドで送信され、ページをリフレッシュしないで自動的にページにロードできます。</p>
</div>
<div class="paragraph">
<p><code>XMLHttpRequest`オブジェクトは実際には`initRequest()`で作成し、これは`doCompletion()`からコールされます。この関数では、ブラウザで`XMLHttpRequest`を認識できるかどうかを確認し、認識できる場合は`XMLHttpRequest`オブジェクトを作成します。そうでない場合は、`ActiveXObject</code> (Internet Explorer 6で`XMLHttpRequest`に相当する)を確認し、識別された場合は`ActiveXObject`を作成します。</p>
</div>
<div class="paragraph">
<p>相互作用が非同期であるかどうかに関係なく、<code>XMLHttpRequest`オブジェクトを作成するときは、URL、HTTPメソッド(`GET`または`POST</code>)の3つのパラメータを指定します。前述の例では、これらのパラメータは次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL`autocomplete`と、ユーザーが`complete-field`に入力したテキスト</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">var url = "autocomplete?action=complete&amp;amp;id=" + escape(completeField.value);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> (HTTPの相互作用で`GET`メソッドを使用することを示します)</p>
</li>
<li>
<p><code>true</code> (相互作用は非同期であることを示します)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">req.open("GET", url, true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>相互作用を非同期に設定する場合は、コールバック関数を指定します。この相互作用のコールバック関数は次の文で設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">req.onreadystatechange = callback;</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして、`callback()`関数を<a href="#callback">後で定義</a>する必要があります。HTTPの相互作用は`XMLHttpRequest.send()`のコール時に開始します。このアクションは、前述の<a href="#flow-diagram">フロー図</a>でWebサーバーに送信されているHTTPリクエストに対応します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverside">サーバー側のプログラミング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IDEでは、サーバー側のWebプログラミングが総合的にサポートされています。これには多くの一般的なプログラミング言語とスクリプト言語の基本的なエディタ・サポートが含まれており、SOAP、REST、SaaSなどのWebサービスと、JSF、Spring、StrutsなどのMVC指向フレームワークなども網羅されています。<a href="https://developers.google.com/web-toolkit/">GWT</a>や<a href="http://struts.apache.org/2.x/">Struts2</a>など、Ajax駆動フレームワークの<a href="http://plugins.netbeans.org/">NetBeansプラグイン・ポータル</a>から複数のNetBeansプラグインを使用できます。</p>
</div>
<div class="paragraph">
<p>アプリケーションのビジネス・ロジックでは、データ・ストアからデータを取出し、レスポンスを作成して送信することで、リクエストを処理します。ここではサーブレットを使用してこの処理を実装します。サーブレットのコーディングを始める前に、データ・ストアと、サーブレットからデータにアクセスするために必要な機能を設定します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#data">データ・ストアの作成</a></p>
</li>
<li>
<p><a href="#servlet">サーブレットの作成</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_データストアの作成">データ・ストアの作成</h3>
<div class="paragraph">
<p>この単純なアプリケーションでは、<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/HashMap.html">`HashMap`</a>を使用して作曲家のデータを保持する`ComposerData`というクラスを作成します。`HashMap`によって、リンクされている項目のペアをキーと値のペアで保存できます。また、サーブレットで、`HashMap`内のエントリからデータを取り出すための`Composer`クラスも作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「新規」&gt;「Javaクラス」を選択します。</p>
</li>
<li>
<p>クラス名を`ComposerData`にし、「パッケージ」フィールドに「<code>com.ajax</code>」と入力します。このクラス、および後で作成する他のクラスを含めるための新しいパッケージが作成されます。</p>
</li>
<li>
<p>「終了」をクリックします。クラスが作成され、ソース・エディタで開きます。</p>
</li>
<li>
<p>ソース・エディタ内に、次のコードを貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.ajax;

import java.util.HashMap;

/**
 *
 * @author nbuser
 */
public class ComposerData {

    private HashMap composers = new HashMap();

    public HashMap getComposers() {
        return composers;
    }

    public ComposerData() {

        composers.put("1", new Composer("1", "Johann Sebastian", "Bach", "Baroque"));
        composers.put("2", new Composer("2", "Arcangelo", "Corelli", "Baroque"));
        composers.put("3", new Composer("3", "George Frideric", "Handel", "Baroque"));
        composers.put("4", new Composer("4", "Henry", "Purcell", "Baroque"));
        composers.put("5", new Composer("5", "Jean-Philippe", "Rameau", "Baroque"));
        composers.put("6", new Composer("6", "Domenico", "Scarlatti", "Baroque"));
        composers.put("7", new Composer("7", "Antonio", "Vivaldi", "Baroque"));

        composers.put("8", new Composer("8", "Ludwig van", "Beethoven", "Classical"));
        composers.put("9", new Composer("9", "Johannes", "Brahms", "Classical"));
        composers.put("10", new Composer("10", "Francesco", "Cavalli", "Classical"));
        composers.put("11", new Composer("11", "Fryderyk Franciszek", "Chopin", "Classical"));
        composers.put("12", new Composer("12", "Antonin", "Dvorak", "Classical"));
        composers.put("13", new Composer("13", "Franz Joseph", "Haydn", "Classical"));
        composers.put("14", new Composer("14", "Gustav", "Mahler", "Classical"));
        composers.put("15", new Composer("15", "Wolfgang Amadeus", "Mozart", "Classical"));
        composers.put("16", new Composer("16", "Johann", "Pachelbel", "Classical"));
        composers.put("17", new Composer("17", "Gioachino", "Rossini", "Classical"));
        composers.put("18", new Composer("18", "Dmitry", "Shostakovich", "Classical"));
        composers.put("19", new Composer("19", "Richard", "Wagner", "Classical"));

        composers.put("20", new Composer("20", "Louis-Hector", "Berlioz", "Romantic"));
        composers.put("21", new Composer("21", "Georges", "Bizet", "Romantic"));
        composers.put("22", new Composer("22", "Cesar", "Cui", "Romantic"));
        composers.put("23", new Composer("23", "Claude", "Debussy", "Romantic"));
        composers.put("24", new Composer("24", "Edward", "Elgar", "Romantic"));
        composers.put("25", new Composer("25", "Gabriel", "Faure", "Romantic"));
        composers.put("26", new Composer("26", "Cesar", "Franck", "Romantic"));
        composers.put("27", new Composer("27", "Edvard", "Grieg", "Romantic"));
        composers.put("28", new Composer("28", "Nikolay", "Rimsky-Korsakov", "Romantic"));
        composers.put("29", new Composer("29", "Franz Joseph", "Liszt", "Romantic"));

        composers.put("30", new Composer("30", "Felix", "Mendelssohn", "Romantic"));
        composers.put("31", new Composer("31", "Giacomo", "Puccini", "Romantic"));
        composers.put("32", new Composer("32", "Sergei", "Rachmaninoff", "Romantic"));
        composers.put("33", new Composer("33", "Camille", "Saint-Saens", "Romantic"));
        composers.put("34", new Composer("34", "Franz", "Schubert", "Romantic"));
        composers.put("35", new Composer("35", "Robert", "Schumann", "Romantic"));
        composers.put("36", new Composer("36", "Jean", "Sibelius", "Romantic"));
        composers.put("37", new Composer("37", "Bedrich", "Smetana", "Romantic"));
        composers.put("38", new Composer("38", "Richard", "Strauss", "Romantic"));
        composers.put("39", new Composer("39", "Pyotr Il'yich", "Tchaikovsky", "Romantic"));
        composers.put("40", new Composer("40", "Guiseppe", "Verdi", "Romantic"));

        composers.put("41", new Composer("41", "Bela", "Bartok", "Post-Romantic"));
        composers.put("42", new Composer("42", "Leonard", "Bernstein", "Post-Romantic"));
        composers.put("43", new Composer("43", "Benjamin", "Britten", "Post-Romantic"));
        composers.put("44", new Composer("44", "John", "Cage", "Post-Romantic"));
        composers.put("45", new Composer("45", "Aaron", "Copland", "Post-Romantic"));
        composers.put("46", new Composer("46", "George", "Gershwin", "Post-Romantic"));
        composers.put("47", new Composer("47", "Sergey", "Prokofiev", "Post-Romantic"));
        composers.put("48", new Composer("48", "Maurice", "Ravel", "Post-Romantic"));
        composers.put("49", new Composer("49", "Igor", "Stravinsky", "Post-Romantic"));
        composers.put("50", new Composer("50", "Carl", "Orff", "Post-Romantic"));

    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``Composer`` クラスが見つからないため、エディタの左マージンに警告が表示されます。`Composer`クラスを作成するには、次の手順を実行します。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「新規」&gt;「Javaクラス」を選択します。</p>
</li>
<li>
<p>クラス名を`Composer`にし、「パッケージ」フィールドのドロップダウン・リストから「<code>com.ajax</code>」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、IDEによってクラスが作成され、ファイルがソース・エディタで開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタ内に、次のコードを貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.ajax;

public class Composer {

    private String id;
    private String firstName;
    private String lastName;
    private String category;

    public Composer (String id, String firstName, String lastName, String category) {
        this.id = id;
        this.firstName = firstName;
        this.lastName = lastName;
        this.category = category;
    }

    public String getCategory() {
        return category;
    }

    public String getId() {
        return id;
    }

    public String getFirstName() {
        return firstName;
    }

    public String getLastName() {
        return lastName;
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``Composer`` クラスの作成後、エディタで ``ComposerData`` クラスを参照すると、警告注釈が表示されていないことがわかります。 ``ComposerData`` に警告注釈がまだ表示されている場合は、不足しているインポート文を追加してエラーが解決されるか試みます。</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="servlet">サーブレットの作成</h3>
<div class="paragraph">
<p>受信リクエストで受け取る`autocomplete` URLを処理するサーブレットを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「新規」→「サーブレット」を選択して新規サーブレット・ウィザードを開きます。(「サーブレット」がデフォルトでポップアップ・メニューに表示されない場合は、「その他」を選択し、「Web」カテゴリから「サーブレット」を選択します。)</p>
</li>
<li>
<p>サーブレット名を`AutoCompleteServlet`にし、「パッケージ」フィールドのドロップダウン・リストから「<code>com.ajax</code>」を選択します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/newservlet-name-location.png" alt="newservlet name location">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「サーブレット・デプロイメントを構成」パネルで、URLパターンを*<code>/autocomplete</code>*にし、`XMLHttpRequest`オブジェクトで以前に設定したURLと一致するようにします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/newservlet-configure-deployment.png" alt="newservlet configure deployment">
</div>
</div>
<div class="paragraph">
<p>このパネルによって、これらの詳細をデプロイメント・ディスクリプタに手動で追加する必要がなくなります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>オプションで、「サーブレット情報をデプロイメント・ディスクリプタに追加」を選択します。これにより、プロジェクトがダウンロードしたサンプルと同じになります。最近のバージョンのIDEでは、サーブレットはデフォルトで`@WebServlet`注釈によって登録され、デプロイメント・ディスクリプタには登録されません。デプロイメント・ディスクリプタのかわりに`@WebServlet`注釈を使用した場合も、プロジェクトは引続き機能します。</p>
</li>
<li>
<p>「終了」をクリックします。サーブレットが作成され、ソース・エディタで開きます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>オーバーライドする必要があるメソッドは、サーブレットで`autocomplete``GET`リクエストを処理する方法を定義する`doGet()`と、サービスを開始後にサーブレットからアプリケーション内の他のクラスにアクセスできるように`ServletContext`を初期化する`init()`のみです。</p>
</div>
<div class="paragraph">
<p>スーパー・クラスのメソッドは、IDEの「コードを挿入」ポップアップ・メニューを使用してオーバーライドできます。次の手順を実行して`init()`を実装します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタで、`AutoCompleteServlet`クラスの宣言の下にカーソルを置きます。[Alt]-[Insert](Macでは[Ctrl]-[I])を押して「コードを生成」ポップアップ・メニューを開きます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-code.png" alt="insert code">
</div>
<div class="title">Figure 12. ソース・エディタに表示された「コードを挿入」ポップアップ・メニュー</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「メソッドをオーバーライド」を選択します。表示されるダイアログで、<code>AutoCompleteServlet`の継承元クラスがすべて表示されます。「GenericServlet」ノードを展開し、「`init(Servlet Config config)</code>」を選択します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-override.png" alt="new override">
</div>
<div class="title">Figure 13. 継承されたクラスが表示されたオーバーライド・ダイアログ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「OK」をクリックします。`init()`メソッドがソース・エディタに追加されます。</p>
</li>
<li>
<p>`ServletContext`オブジェクトの変数を追加し、`init()`を変更します(*太字*部分が変更箇所)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*private ServletContext context;*

@Override
public void init(ServletConfig *config*) throws ServletException {
    *this.context = config.getServletContext();*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`ServletContext`のインポート文を追加します。そのためには、ソース・エディタの左マージンに表示される電球のアイコンをクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/import-hint.png" alt="import hint">
</div>
<div class="title">Figure 14. ソース・エディタの左マージンに表示されたインポートのヒント</div>
</div>
<div class="paragraph">
<p>`doGet()`メソッドではリクエストのURLを解析し、データ・ストアからデータを取出し、XML形式でレスポンスを作成する必要があります。メソッドの宣言は、クラスの作成時に生成されています。これを表示するには、左マージンにある展開アイコン(<span class="image"><img src="images/expand-icon.png" alt="expand icon"></span>)をクリックしてHttpServlet メソッドを展開する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`AutocompleteServlet`クラスの宣言の下に次の変数宣言を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private ComposerData compData = new ComposerData();
private HashMap composers = compData.getComposers();</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、すべての作曲家データの`HashMap`が作成されます。これは`doGet()`で使用されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`doGet()`までスクロールし、次のようにメソッドを実装します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">@Override
public void doGet(HttpServletRequest request, HttpServletResponse response)
        throws IOException, ServletException {

    String action = request.getParameter("action");
    String targetId = request.getParameter("id");
    StringBuffer sb = new StringBuffer();

    if (targetId != null) {
        targetId = targetId.trim().toLowerCase();
    } else {
        context.getRequestDispatcher("/error.jsp").forward(request, response);
    }

    boolean namesAdded = false;
    if (action.equals("complete")) {

        // check if user sent empty string
        if (!targetId.equals("")) {

            Iterator it = composers.keySet().iterator();

            while (it.hasNext()) {
                String id = (String) it.next();
                Composer composer = (Composer) composers.get(id);

                if ( // targetId matches first name
                     composer.getFirstName().toLowerCase().startsWith(targetId) ||
                     // targetId matches last name
                     composer.getLastName().toLowerCase().startsWith(targetId) ||
                     // targetId matches full name
                     composer.getFirstName().toLowerCase().concat(" ")
                        .concat(composer.getLastName().toLowerCase()).startsWith(targetId)) {

                    sb.append("&lt;composer&gt;");
                    sb.append("&lt;id&gt;" + composer.getId() + "&lt;/id&gt;");
                    sb.append("&lt;firstName&gt;" + composer.getFirstName() + "&lt;/firstName&gt;");
                    sb.append("&lt;lastName&gt;" + composer.getLastName() + "&lt;/lastName&gt;");
                    sb.append("&lt;/composer&gt;");
                    namesAdded = true;
                }
            }
        }

        if (namesAdded) {
            response.setContentType("text/xml");
            response.setHeader("Cache-Control", "no-cache");
            response.getWriter().write("&lt;composers&gt;" + sb.toString() + "&lt;/composers&gt;");
        } else {
            //nothing to show
            response.setStatus(HttpServletResponse.SC_NO_CONTENT);
        }
    }
    if (action.equals("lookup")) {

        // put the target composer in the request scope to display
        if ((targetId != null) &amp;amp;&amp;amp; composers.containsKey(targetId.trim())) {
            request.setAttribute("composer", composers.get(targetId));
            context.getRequestDispatcher("/composer.jsp").forward(request, response);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>サーブレットを見ればわかるように、Ajax処理用のサーバー側コードを記述するために新たに覚えることはありません。XMLドキュメントを交換する場合は、レスポンスのコンテンツ・タイプを`text/xml`に設定します。Ajaxでは、プレーン・テキストを交換でき、クライアントのコールバック関数によって評価または実行できるJavaScriptのスニペットを交換することもできます。一部のブラウザでは結果がキャッシュに保存される場合があるので、Cache-Control HTTPヘッダーを`no-cache`に設定する必要がある場合もあります。</p>
</div>
<div class="paragraph">
<p>この例では、氏名のいずれかが、ユーザーが入力した文字から始まる作曲家がすべて含まれるXMLドキュメントがサーブレットによって生成されます。このドキュメントは、前述の<a href="#flow-diagram">フロー図</a>に示すXMLデータに対応します。`XMLHttpRequest`オブジェクトに返されるXMLドキュメントの例を示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;composers&gt;
    &lt;composer&gt;
        &lt;id&gt;12&lt;/id&gt;
        &lt;firstName&gt;Antonin&lt;/firstName&gt;
        &lt;lastName&gt;Dvorak&lt;/lastName&gt;
    &lt;/composer&gt;
    &lt;composer&gt;
        &lt;id&gt;45&lt;/id&gt;
        &lt;firstName&gt;Aaron&lt;/firstName&gt;
        &lt;lastName&gt;Copland&lt;/lastName&gt;
    &lt;/composer&gt;
    &lt;composer&gt;
        &lt;id&gt;7&lt;/id&gt;
        &lt;firstName&gt;Antonio&lt;/firstName&gt;
        &lt;lastName&gt;Vivaldi&lt;/lastName&gt;
    &lt;/composer&gt;
    &lt;composer&gt;
        &lt;id&gt;2&lt;/id&gt;
        &lt;firstName&gt;Arcangelo&lt;/firstName&gt;
        &lt;lastName&gt;Corelli&lt;/lastName&gt;
    &lt;/composer&gt;
&lt;/composers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションが完成したら、返されるXMLデータを表示するためにIDEの<a href="#httpMonitor">HTTPモニター</a>を使用できます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client2">クライアント側のプログラミング: 第2部</h2>
<div class="sectionbody">
<div class="paragraph">
<p>サーバーのレスポンスを処理するコールバック関数を定義し、ユーザーに表示するページに変更を反映するために必要な機能を追加する必要があります。そのためには、HTMLのDOMを変更する必要があります。JSPページを作成して、成功したリクエストの結果または失敗したリクエストのエラー・メッセージを表示します。次に、プレゼンテーションの単純なスタイルシートを作成できます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#callback">コールバック機能の追加</a></p>
</li>
<li>
<p><a href="#htmldom">HTML DOMの更新</a></p>
</li>
<li>
<p><a href="#displayresults">結果の表示</a></p>
</li>
<li>
<p><a href="#stylesheet">スタイル・シートの添付</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_コールバック機能の追加">コールバック機能の追加</h3>
<div class="paragraph">
<p>コールバック関数は、HTTPの相互作用中に`XMLHttpRequest`オブジェクトの「<code>readyState</code>」プロパティが変化したとき、非同期でコールされます。ここでビルドしているアプリケーションでは、コールバック関数は`callback()<code>です。`doCompletion()`では、`callback`を関数の「`XMLHttpRequest.onreadystatechange</code>」プロパティとして設定しました。ここで、コールバック関数を次のように実装します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`javascript.js`をソース・エディタで開き、次のコードを入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function callback() {
    if (req.readyState == 4) {
        if (req.status == 200) {
            parseMessages(req.responseXML);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>`readyState`が「4」のとき、HTTPの相互作用は完了しています。`XMLHttpRequest.readState`のAPIは、設定できる値が5つあることを示します。これらを次に示します。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">`readyState`の値</th>
<th class="tableblock halign-left valign-top">オブジェクト・ステータスの定義</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非初期化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロード中</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロード済</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対話式</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">完了</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>parseMessages()`関数は、`XMLHttpRequest.readyState`が「4」で、`status</code> (リクエストのHTTPステータス・コード定義)が「200」、つまり成功の場合にのみコールされます。`parseMessages()`は、次の<a href="#htmldom">HTML DOMの更新</a>で定義します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_html_domの更新">HTML DOMの更新</h3>
<div class="paragraph">
<p>受信するXMLデータは`parseMessages()<code>関数で処理します。このとき、`appendComposer()</code>、<code>getElementY()</code>、および`clearTable()`などの補助的関数を使用します。また、オートコンプリート・ボックスとして機能する2番目のHTML表、要素を`javascript.js`で参照可能にするための要素のIDなど、新しい要素をindexページに追加する必要があります。最後に、indexページ内の要素のIDに対応する新しい変数を作成し、前に実装した`init()`関数で初期化し、indexページがロードされるたびに必要とされる機能を追加します。</p>
</div>
<div class="paragraph">
<p>*注意: *次の手順で作成する関数と要素は、相互に依存して動作します。この項の手順を最後まで行い、コードが完成してからその内容を確認することをお薦めします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>indexページをソース・エディタで開き、前に作成したHTML表の2行目として次のコードを入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;tr&gt;
    *&lt;td id="auto-row" colspan="2"&gt;
        &lt;table id="complete-table" /&gt;
    &lt;/td&gt;*
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>表の2番目の行は、別のHTML表を含んでいます。この表は、作曲家の名前を挿入するためのオートコンプリート・ボックスを表します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`javascript.js`をソース・エディタで開き、次の3つの変数をファイルの先頭に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">var completeField;
var completeTable;
var autoRow;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次の*太字*の行を`init()`関数に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function init() {
    completeField = document.getElementById("complete-field");
    *completeTable = document.getElementById("complete-table");
    autoRow = document.getElementById("auto-row");
    completeTable.style.top = getElementY(autoRow) + "px";*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>`init()`の目的の1つは、indexページのDOMを変更する他の関数からindexページ内の要素にアクセスできるようにすることです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`appendComposer()`を`javascript.js`に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function appendComposer(firstName,lastName,composerId) {

    var row;
    var cell;
    var linkElement;

    if (isIE) {
        completeTable.style.display = 'block';
        row = completeTable.insertRow(completeTable.rows.length);
        cell = row.insertCell(0);
    } else {
        completeTable.style.display = 'table';
        row = document.createElement("tr");
        cell = document.createElement("td");
        row.appendChild(cell);
        completeTable.appendChild(row);
    }

    cell.className = "popupCell";

    linkElement = document.createElement("a");
    linkElement.className = "popupItem";
    linkElement.setAttribute("href", "autocomplete?action=lookup&amp;amp;id=" + composerId);
    linkElement.appendChild(document.createTextNode(firstName + " " + lastName));
    cell.appendChild(linkElement);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この関数は、表の新しい行を作成し、3つのパラメータによって関数に渡されたデータを使用して作曲家へのリンクを挿入してから、行をindexページの`complete-table`要素に挿入します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`getElementY()`を`javascript.js`に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function getElementY(element){

    var targetTop = 0;

    if (element.offsetParent) {
        while (element.offsetParent) {
            targetTop += element.offsetTop;
            element = element.offsetParent;
        }
    } else if (element.y) {
        targetTop += element.y;
    }
    return targetTop;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この関数は、親要素の縦方向表示位置を見つけるために適用します。これは、要素の実際の表示位置はブラウザのタイプとバージョンによって異なることが多いため必要です。`complete-table`要素は、作曲家の名前が表示されるときに、この要素が存在する表の右下にシフトします。正しい縦方向の配置は`getElementY()`で決まります。</p>
</div>
<div class="paragraph">
<p>*注意: *<a href="http://www.quirksmode.org/">http://www.quirksmode.org/</a>にある`offset`に関する<a href="http://www.quirksmode.org/js/findpos.html">説明</a>を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`clearTable()`を`javascript.js`に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function clearTable() {
    if (completeTable.getElementsByTagName("tr").length &gt; 0) {
        completeTable.style.display = 'none';
        for (loop = completeTable.childNodes.length -1; loop &gt;= 0 ; loop--) {
            completeTable.removeChild(completeTable.childNodes[loop]);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この関数は`complete-table`要素の表示を&#8217;none&#8217;に設定し(非表示にし)、作成された既存の作曲家の名前エントリを除去します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`callback()`関数を変更して、サーバーから新しいデータを受け取るたびに`clearTable()`をコールするようにします。オートコンプリート・ボックスに作曲家のエントリがある場合は、新しいエントリが入力される前に除去されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function callback() {

    *clearTable();*

    if (req.readyState == 4) {
        if (req.status == 200) {
            parseMessages(req.responseXML);
        }
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`parseMessages()`を`javascript.js`に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">function parseMessages(responseXML) {

    // no matches returned
    if (responseXML == null) {
        return false;
    } else {

        var composers = responseXML.getElementsByTagName("composers")[0];

        if (composers.childNodes.length &gt; 0) {
            completeTable.setAttribute("bordercolor", "black");
            completeTable.setAttribute("border", "1");

            for (loop = 0; loop &lt; composers.childNodes.length; loop++) {
                var composer = composers.childNodes[loop];
                var firstName = composer.getElementsByTagName("firstName")[0];
                var lastName = composer.getElementsByTagName("lastName")[0];
                var composerId = composer.getElementsByTagName("id")[0];
                appendComposer(firstName.childNodes[0].nodeValue,
                    lastName.childNodes[0].nodeValue,
                    composerId.childNodes[0].nodeValue);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>parseMessages()`関数は、`AutoComplete`サーブレットから返されるXMLドキュメントのオブジェクト表現をパラメータとして受け取ります。この関数はプログラムでXMLドキュメント内を横断し、各エントリの`firstName</code>、<code>lastName</code>、および`id`を抽出して、このデータを`appendComposer()`に渡します。その結果、`complete-table`要素の内容が動的に更新されます。たとえば、次のようなエントリが生成され、`complete-table`に挿入されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;tr&gt;
    &lt;td class="popupCell"&gt;
        &lt;a class="popupItem" href="autocomplete?action=lookup&amp;amp;id=12"&gt;Antonin Dvorak&lt;/a&gt;
    &lt;/td&gt;
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>`complete-table`要素の動的な更新は、Ajaxを使用して行われる通信のプロセス・フローの中で最後の手順を表します。この更新は、前述の<a href="#flow-diagram">フロー図</a>のプレゼンテーションに送信されるHTMLとCSSデータに対応します。</p>
</div>
</div>
<div class="sect2">
<h3 id="displayresults">結果の表示</h3>
<div class="paragraph">
<p>結果を表示するには、`composers.jsp`という名前のJSPファイルが必要です。このページは、ルックアップ処理中に`AutoCompleteServlet`からコールされます。`error.jsp`ファイルも必要で、これはコンポーザが見つからない場合に `AutoCompleteServlet`からコールされます。</p>
</div>
<div class="paragraph">
<p><strong>結果とエラーを表示するには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで、アプリケーションの「Webページ」フォルダを右クリックし、「新規」&gt;「JSP」を選択します。新規JSPウィザードが開きます。</p>
</li>
<li>
<p>「ファイル名」フィールドに「<code>composer</code>」と入力します。「作成されるファイル」フィールドに、`/web/composer.jsp`で終わるパスが表示されるはずです。</p>
</li>
<li>
<p>「終了」をクリックします。ファイル`composer.jsp`がエディタで開きます。「プロジェクト」ウィンドウの「Webページ」フォルダに、このファイルのノードが表示されます。</p>
</li>
<li>
<p>`composer.jsp`内のプレースホルダ・コードを次のコードで置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Composer Information&lt;/title&gt;

    &lt;link rel="stylesheet" type="text/css" href="stylesheet.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table&gt;
      &lt;tr&gt;
        &lt;th colspan="2"&gt;Composer Information&lt;/th&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;First Name: &lt;/td&gt;
        &lt;td&gt;${requestScope.composer.firstName}&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;Last Name: &lt;/td&gt;
        &lt;td&gt;${requestScope.composer.lastName}&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;ID: &lt;/td&gt;
        &lt;td&gt;${requestScope.composer.id}&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td&gt;Category: &lt;/td&gt;
        &lt;td&gt;${requestScope.composer.category}&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;

    &lt;p&gt;Go back to &lt;a href="index.html" class="link"&gt;application home&lt;/a&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>*注意:*indexページが <code>index.jsp</code> の場合、indexページに戻るためのリンクを変更する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトの「Webページ」フォルダに、別のJSPファイルを作成します。ファイルに`error.jsp`という名前を付けます。</p>
</li>
<li>
<p>`error.jsp`内のプレースホルダ・コードを次のコードで置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;!DOCTYPE html&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" type="text/css" href="stylesheet.css"&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;title&gt;Seach Error&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h2&gt;Seach Error&lt;/h2&gt;

        &lt;p&gt;An error occurred while performing the search. Please try again.&lt;/p&gt;

        &lt;p&gt;Go back to &lt;a href="index.html" class="link"&gt;application home&lt;/a&gt;.&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>*注意:*indexページが <code>index.jsp</code> の場合、indexページに戻るためのリンクを変更する必要があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="stylesheet">スタイル・シートの添付</h3>
<div class="paragraph">
<p>これで、アプリケーションの機能に必要なコードが完成しました。作業の結果を確認するため、今すぐアプリケーションを実行してみてください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、「実行」を選択します。プロジェクトが再コンパイルされ、ターゲット・サーバーにデプロイされます。ブラウザが開き、indexページが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/no-css.png" alt="no css">
</div>
<div class="title">Figure 15. スタイル・シートなしでの正常なデプロイメント</div>
</div>
<div class="paragraph">
<p>アプリケーションにスタイル・シートを追加するには、<code>.css`ファイルを作成し、プレゼンテーション・ページからそのファイルにリンクします。</code>.css`ファイルで作業する場合、IDEには、コード補完機能や、スタイルシート・ルールの生成と編集に役立つ次のウィンドウが提供されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>「CSSスタイル」ウィンドウ。</strong>「CSSスタイル」ウィンドウでは、CSSファイルのHTML要素およびセレクタのルールの宣言を編集できます。</p>
</li>
<li>
<p><strong>CSSルールの作成ダイアログ・ボックス。</strong>「CSSルールの作成」ダイアログ・ボックスでは、CSSスタイル・シートに新規ルールを作成できます。</p>
</li>
<li>
<p>*CSSプロパティの追加ダイアログ・ボックス。*CSSプロパティの追加ダイアログ・ボックスでは、プロパティと値を追加することで、スタイル・シートのCSSルールに宣言を追加できます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>アプリケーションにスタイルシートを追加するには、次の手順を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「Webページ」ノードを右クリックし、「新規」&gt;「Cascading Style Sheet」を選択します(「Cascading Style Sheet」が表示されない場合は、「その他」を選択します。その後、新規ファイル・ウィザードで「Web」カテゴリから「Cascading Style Sheet」を選択します。)</p>
</li>
<li>
<p>「CSSファイル名」テキスト・フィールドに、「<strong><code>stylesheet</code></strong>」と入力します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>新規ファイルが作成され、エディタで開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで`stylesheet.css`に次のルールを入力します。IDEのコード補完サポートを利用するには、候補を呼び出したい場所で[Ctrl]-[Space]を押します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">body {
   font-family: Verdana, Arial, sans-serif;
   font-size: smaller;
   padding: 50px;
   color: #555;
   width: 650px;
}

h1 {
   letter-spacing: 6px;
   font-size: 1.6em;
   color: #be7429;
   font-weight: bold;
}

h2 {
   text-align: left;
   letter-spacing: 6px;
   font-size: 1.4em;
   color: #be7429;
   font-weight: normal;
   width: 450px;
}

table {
   width: 550px;
   padding: 10px;
   background-color: #c5e7e0;
}

td {
   padding: 10px;
}

a {
  color: #be7429;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.popupBox {
  position: absolute;
  top: 170px;
  left: 140px;
}

.popupCell {
   background-color: #fffafa;
}

.popupCell:hover {
  background-color: #f5ebe9;
}

.popupItem {
  color: #333;
  text-decoration: none;
  font-size: 1.2em;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「ウィンドウ」→「Web」→「CSSスタイル」を選択して、「CSSスタイル」ウィンドウを開きます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/css-styles-window.png" alt="css styles window">
</div>
<div class="title">Figure 16. h1ルールのプロパティを表示している「CSSスタイル」ウィンドウ</div>
</div>
<div class="paragraph">
<p>「CSSスタイル」ウィンドウを使用して、プロパティをすばやく表示し、スタイル・ルールを編集できます。「CSSスタイル」ウィンドウの上部ペインでルールを選択すると、下部ペインにルールのプロパティが表示されます。上部ペインのツールバーで「CSSルールの編集」アイコン(<span class="image"><img src="images/newcssrule.png" alt="newcssrule" title="新規CSSプロパティ・アイコン"></span>)をクリックして、スタイルシートにCSSルールを追加できます。プロパティ・シートを編集して下部ペインでルールを変更したり、下部ペインのツールバーで「プロパティの追加」アイコン(<span class="image"><img src="images/newcssproperty.png" alt="newcssproperty" title="新規CSSプロパティ・アイコン"></span>)をクリックしてプロパティを追加したりできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタでindexページに切り替え、`&lt;head&gt;`タグの間にスタイル・シートへの参照を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;link rel="stylesheet" type="text/css" href="stylesheet.css"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>スタイル・シートで定義されている`popupBox`クラスを`complete-table`要素に追加します(*太字*部分が変更箇所)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;tr&gt;
    &lt;td id="auto-row" colspan="2"&gt;
        &lt;table id="complete-table" *class="popupBox"* /&gt;
    &lt;/td&gt;
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>エディタでコード補完を使用して、セレクタに適用するスタイル・ルールを選択できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/css-completion.png" alt="css completion">
</div>
<div class="title">Figure 17. エディタでのCSSコード補完</div>
</div>
<div class="paragraph">
<p>`stylesheet.css`で指定されているように、このルールでは、`complete-table`要素が親要素の少し右に表示されるように配置されます。</p>
</div>
<div class="paragraph">
<p>indexページを保存すると、アプリケーションがサーバーに自動的に再デプロイされます。ページがまだブラウザに開いている場合は、ページを再ロードして、CSSスタイルシートのルールに従ってページがレンダリングされることを確認できます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run">プロジェクトの実行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アプリケーションを再実行すると、作成したスタイル・シートを使用してブラウザに表示されます。文字を入力するたびに非同期のリクエストがサーバーに送信され、`AutoCompleteServlet`によって作成されたXMLデータが返されます。さらに文字を入力すると、新しい一致リストを反映して作曲家の名前の数が減ります。</p>
</div>
<div class="sect2">
<h3 id="httpMonitor">HTTPサーバー・モニターの使用</h3>
<div class="paragraph">
<p>IDEのHTTPサーバー・モニターを使用して、リクエストとレスポンスがクライアントとサーバーの間で受け渡されるときに実行されるHTTP通信を確認できます。HTTPサーバー・モニターには、クライアントとサーバーのヘッダー、セッション・プロパティ、Cookieの詳細、リクエスト・パラメータなどの情報が表示されます。</p>
</div>
<div class="paragraph">
<p>HTTPモニターを使用する前に、使用しているサーバーでモニターを有効にする必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「ツール」&gt;「サーバー」を選択して、「サーバー」ウィンドウを開きます。</p>
</li>
<li>
<p>左ペインで、プロジェクトで使用しているサーバーを選択します。次に右ペインで、「HTTPモニターを有効化」オプションを選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>注意:</strong> このオプションは、GlassFishサーバーでは「共通」タブに表示されます。Tomcatでは「接続」タブに表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「閉じる」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>サーバーが実行中の場合、変更を有効にするにはサーバーを再起動する必要があります。サーバーを再起動するには、「サービス」ウィンドウを開き(「ウィンドウ」&gt;「サービス」)、「サーバー」ノードの下で使用しているサーバーを右クリックし、「再起動」を選択します。</p>
</div>
<div class="paragraph">
<p>次にアプリケーションを実行すると、IDEの下部にHTTPモニターが開きます。左ペインでレコードを選択し、メイン・ウィンドウ内のタブをクリックすると、各リクエストに関する情報が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/http-monitor.png" alt="http monitor">
</div>
<div class="title">Figure 18. IDEに表示されたHTTPサーバー・モニター</div>
</div>
<div class="paragraph">
<p>ユーザーがオートコンプリート・フィールドに文字を入力したときに送信される非同期リクエストの結果としてサーバーから送信されるXMLデータを確認できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTTPモニターの左側にあるツリー表示で、リクエスト・レコードを右クリックし、「再実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>レスポンスがブラウザに生成されます。この場合、レスポンスはXMLデータから構成されるので、ブラウザではデータがネイティブXMLビューアで表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/xml-data.png" alt="xml data">
</div>
<div class="title">Figure 19. IDEに表示されたHTTPサーバー・モニター</div>
</div>
</div>
<div class="sect2">
<h3 id="conclusion">まとめ</h3>
<div class="paragraph">
<p>これでAjax入門を終了します。ここでは、Ajaxは単にHTTPを使用してバックグラウンドで情報を交換し、その結果に基づいてページを動的に更新していることを学習しました。</p>
</div>
<div class="paragraph">
<p>ここでビルドしたアプリケーションは、オートコンプリート・ボックスで作曲家の名前を選択しても何も起こらないなど、完全ではありません。<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaScript%252FMyAjaxApp.zip">ソリューション・プロジェクトをダウンロード</a>し、JSPテクノロジを使用して、この処理を実装する方法を確認できます。また、ユーザーがデータ・ストアにない名前をリクエストしないようにサーバー側で検証する方法を検討することもできます。これらの手法とテクノロジについては、<a href="../../trails/java-ee.html">Java EEおよびJava Webの学習</a>にある、他のチュートリアルで紹介しています。</p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Introduction%20to%20Ajax%20(Java)">ご意見をお寄せください</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://netbeans.org/">netbeans.org</a>でのAjaxおよびJavaテクノロジの詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../docs/web/js-toolkits-jquery.html">jQueryを使用した、Webページの見た目と使いやすさの向上</a>。jQueryコアおよびUIライブラリをNetBeansプロジェクトに統合する方法について説明しています。</p>
</li>
<li>
<p><a href="../../docs/web/js-toolkits-dojo.html">JSONを使用したDojoツリーのArrayListへの接続</a>。JavaOneハンズオン・ラボに基づいて、このドキュメントではDojoツリー・ウィジェットをWebページに統合する方法や、サーバー側からJSON形式でツリー・リクエストにレスポンスできるようにする方法について説明しています。</p>
</li>
<li>
<p>_NetBeans IDEによるアプリケーションの開発_の<a href="http://www.oracle.com/pls/topic/lookup?ctx=nb8000&amp;id=NBDAG2272">JavaScriptファイルの作成</a></p>
</li>
<li>
<p><a href="quickstart-webapps-wicket.html">Wicket Webフレームワーク入門</a>。Wicketフレームワークを使用して再利用可能なコンポーネントを作成し、Webアプリケーションに適用する方法です。</p>
</li>
</ul>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/web/ajax-quickstart_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
