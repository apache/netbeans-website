
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>使用嵌入的 EJB 容器测试企业应用程序</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="使用嵌入的 EJB 容器测试企业应用程序 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 使用嵌入的 EJB 容器测试企业应用程序">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">使用嵌入的 EJB 容器测试企业应用程序</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_测试会话_bean">测试会话 Bean</a>
<ul class="sectlevel2">
<li><a href="#_创建项目">创建项目</a></li>
<li><a href="#_创建会话_bean">创建会话 Bean</a></li>
<li><a href="#_测试会话_bean_2">测试会话 Bean</a></li>
<li><a href="#_修改测试以指定容器属性">修改测试以指定容器属性</a></li>
<li><a href="#_使用_beforeclass_和_afterclass_标注">使用  <code>@BeforeClass</code>  和  <code>@AfterClass</code>  标注</a></li>
</ul>
</li>
<li><a href="#_测试实体类">测试实体类</a>
<ul class="sectlevel2">
<li><a href="#_创建实体类">创建实体类</a></li>
<li><a href="#_修改会话_bean">修改会话 Bean</a></li>
<li><a href="#_测试实体类_2">测试实体类</a></li>
</ul>
</li>
<li><a href="#_下载解决方案项目">下载解决方案项目</a></li>
<li><a href="#_另请参见">另请参见</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本教程说明了如何为 Java EE 企业应用程序创建和运行 JUnit 测试。在本教程中，将创建一个包含实体类和会话 Bean 的 Web 应用程序。首先，将为会话 Bean 创建一个 JUnit 测试类，并在嵌入的 EJB 容器中运行该测试。然后，在项目中添加一个实体类，并修改测试类以便为该实体类添加一个测试方法。</p>
</div>
<div class="paragraph">
<p><strong>教程练习</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Exercise_1">测试会话 Bean</a></p>
</li>
<li>
<p><a href="#Exercise_1a">创建项目</a></p>
</li>
<li>
<p><a href="#Exercise_1b">创建会话 Bean</a></p>
</li>
<li>
<p><a href="#Exercise_1c">测试会话 Bean</a></p>
</li>
<li>
<p><a href="#Exercise_1d">修改测试以指定容器属性</a></p>
</li>
<li>
<p><a href="#Exercise_1e">使用 @BeforeClass 和 @AfterClass 标注</a></p>
</li>
<li>
<p><a href="#Exercise_2">测试实体类</a></p>
</li>
<li>
<p><a href="#Exercise_2a">创建实体类</a></p>
</li>
<li>
<p><a href="#Exercise_2b">修改会话 Bean</a></p>
</li>
<li>
<p><a href="#Exercise_2c">测试实体类</a></p>
</li>
<li>
<p><a href="#Exercise_3">下载解决方案项目</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>要学习本教程，您需要具备以下软件和资源。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">软件或资源</th>
<th class="tableblock halign-left valign-top">要求的版本</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/downloads/">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EE 包</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 开发工具包 (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">版本 7 或 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1.x 或 4.x</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
本教程需要使用 JUnit 插件。如果在安装 IDE 时未安装 JUnit 插件，请打开 "Plugins"（插件）管理器，选择 "Available plugins"（可用插件）标签，然后安装 JUnit 插件。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>先决条件</strong></p>
</div>
<div class="paragraph">
<p>本文档假定您具备以下技术的一些基本知识或编程经验：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 编程</p>
</li>
<li>
<p>NetBeans IDE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在开始本教程之前，您可能需要熟悉以下文档。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-gettingstarted.html">Java EE 应用程序入门指南</a></p>
</li>
<li>
<p><a href="../java/junit-intro.html">在 NetBeans IDE 中编写 JUnit 测试</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E19798-01/821-1754/gjlde/index.html">将 EJB 3.1 可嵌入 API 与嵌入的 GlassFish Server 一起使用</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以下载<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">已完成项目的 zip 档案文件</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试会话_bean">测试会话 Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，将创建一个包含会话 Bean 和实体类的简单 Java EE Web 应用程序。</p>
</div>
<div class="sect2">
<h3 id="_创建项目">创建项目</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从主菜单中选择 "File"（文件）&gt; "New Project"（新建项目）（Ctrl-Shift-N 组合键；在 Mac 上为 ⌘-Shift-N 组合键）。</p>
</li>
<li>
<p>从 "Java Web" 类别中选择 "Web Application"（Web 应用程序）。单击 "Next"（下一步）。</p>
</li>
<li>
<p>将项目命名为 <strong>WebAppJUnit</strong> 并设置项目位置。</p>
</li>
<li>
<p>取消选中 "Use Dedicated Folder"（使用专用文件夹）选项（如果该选项处于选中状态）。
单击 "Next"（下一步）。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将服务器设置为 <strong>GlassFish Server</strong>，并将 Java EE 版本设置为 <strong>Java EE 6 Web</strong> 或 <strong>Java EE 7 Web</strong>。
单击 "Finish"（完成）。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_创建会话_bean">创建会话 Bean</h3>
<div class="paragraph">
<p>在本练习中，将创建一个非常简单的会话 Bean，它包含一个添加两个数字的方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中右键单击 "WebAppJUnit" 项目，然后选择 "New"（新建）&gt; "Other"（其他）。</p>
</li>
<li>
<p>选择 "Enterprise JavaBeans" 类别中的 "Session Bean"（会话 Bean）。单击 "Next"（下一步）。</p>
</li>
<li>
<p>键入 <strong>MyBean</strong> 作为 EJB 名称。</p>
</li>
<li>
<p>键入 <strong>bean</strong> 作为包名。</p>
</li>
<li>
<p>选择 "Stateless"（无状态）作为会话类型。单击 "Finish"（完成）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>单击 "Finish"（完成），此时将在编辑器中打开新类。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在编辑器中，将以下  <code>addNumbers</code>  方法添加到类中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class MyBean {
    *public int addNumbers(int numberA, int numberB) {
        return numberA + numberB;
    }*
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在本教程中，无需添加  <code>@LocalBean</code>  标注或实现接口。默认情况下，当未显式指定视图时，Bean 将公开无界面视图。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>保存所做的更改。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_测试会话_bean_2">测试会话 Bean</h3>
<div class="paragraph">
<p>在本练习中，将为会话 Bean 创建一个测试类以测试  <code>addNumbers</code>  方法。IDE 可以根据目标类中的方法，生成新的测试类和框架测试方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中右键单击  <code>MyBean</code>  类，然后选择 "Tools"（工具）&gt; "Create Tests"（创建测试）。</p>
</li>
<li>
<p>在 "Frameworks"（框架）下拉列表中选择 "JUnit"。</p>
</li>
<li>
<p>在 "Create Tests"（创建测试）对话框中，使用默认值。单击 "OK"（确定）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-tests-dialog.png" alt="create tests dialog" width="Create Tests"（创建测试）对话框"">
</div>
<div class="title">Figure 1. </div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
首次创建 JUnit 单元测试时，您需要指定 JUnit 版本。在 "Select JUnit Version"（选择 JUnit 版本）对话框中，选择 "JUnit 4.x"，然后单击 "Select"（选择）。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>单击 "OK"（确定）后，IDE 将生成  <code>MyBeanTest.java</code>  文件并在编辑器中打开该类。</p>
</div>
<div class="paragraph">
<p>在 "Projects"（项目）窗口中，您可以看到 IDE 在 "Test Packages"（测试包）节点下面生成了测试类。默认情况下，IDE 在测试类中生成一个框架测试方法，它通过调用  <code>javax.ejb.embeddable.EJBContainer.createEJBContainer()</code>  来创建 EJB 容器实例。 <code>createEJBContainer()</code>  方法是 EJB 3.1 可嵌入 API 中包含的 <a href="http://download.oracle.com/javaee/6/api/javax/ejb/embeddable/EJBContainer.html">+ <code>EJBContainer</code> +</a> 类中的方法之一。</p>
</div>
<div class="paragraph">
<p>如果在 "Projects"（项目）窗口中展开 "Test Libraries"（测试库）节点，您可以看到 IDE 自动添加了 GlassFish Server（可嵌入容器）和 JUnit 4.x 作为测试库。如果展开 GlassFish Server 库，则可以看到该库包含  <code>glassfish-embedded-static-shell.jar</code> 。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/embedded-static-shell-jar.png" alt="embedded static shell jar" width="Projects"（项目）窗口中的项目结构"">
</div>
<div class="title">Figure 2. </div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>glassfish-embedded-static-shell.jar</code>  JAR 不包含嵌入的 EJB 容器的源代码。 <code>glassfish-embedded-static-shell.jar</code>  JAR 要求在本地安装 GlassFish。本地 GlassFish 安装的类路径是由项目的目标服务器确定的。您可以在项目的 "Properties"（属性）对话框中更改目标服务器。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修改生成的框架测试方法以指定  <code>numberA</code> 、 <code>numberB</code>  和  <code>expResult</code>  的值，然后删除会失败的默认调用。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    *int numberA = 1;
    int numberB = 2;*
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer();
    MyBean instance = (MyBean)container.getContext().lookup("java:global/classes/MyBean");
    *int expResult = 3;*
    int result = instance.addNumbers(numberA, numberB);
    assertEquals(expResult, result);
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中右键单击项目，然后选择 "Test"（测试）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>运行测试时，将在 IDE 中打开 "Test Results"（测试结果）窗口并显示测试进度和结果。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results1.png" alt="test results1" width="Test Results"（测试结果）窗口"">
</div>
<div class="title">Figure 3. </div>
</div>
<div class="paragraph">
<p>将在 "Output"（输出）窗口中看到类似以下的内容。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Testsuite: bean.MyBeanTest
addNumbers
...
Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 31.272 sec

------------- Standard Output ---------------
addNumbers
...
------------- ---------------- ---------------
test-report:
test:
BUILD SUCCESSFUL (total time: 35 seconds)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_修改测试以指定容器属性">修改测试以指定容器属性</h3>
<div class="paragraph">
<p>使用创建测试向导时，IDE 生成一个默认框架测试类，它包含用于启动 EJB 容器的代码。在本练习中，将修改用于启动该容器的生成代码，以便为嵌入的容器实例指定其他属性。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将以下代码（粗体）添加到测试类中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    int numberA = 1;
    int numberB = 2;

    // Create a properties map to pass to the embeddable container:
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();*
    // Use the MODULES property to specify the set of modules to be initialized,
    // in this case a java.io.File
    *properties.put(EJBContainer.MODULES, new File("build/jar"));*

    // Create the container instance, passing it the properties map:
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer(*properties*);

    // Create the instance using the container context to look up the bean
    // in the directory that contains the built classes
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    int expResult = 3;

    // Invoke the addNumbers method on the bean instance:
    int result = instance.addNumbers(numberA, numberB);

    assertEquals(expResult, result);

    // Close the embeddable container:
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在编辑器中右键单击，然后选择 "Fix Imports"（修复导入）（Alt-Shift-I 组合键；在 Mac 上为 ⌘-Shift-I 组合键）添加  <code>java.util.HashMap</code>  和  <code>java.util.Map</code>  的 import 语句。</p>
</li>
<li>
<p>再次运行测试，以确认修改的测试正常工作并且正确创建了容器。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>您可以在 "Test Results"（测试结果）窗口中单击 "Rerun"（重新运行）按钮。</p>
</div>
</div>
<div class="sect2">
<h3 id="_使用_beforeclass_和_afterclass_标注">使用  <code>@BeforeClass</code>  和  <code>@AfterClass</code>  标注</h3>
<div class="paragraph">
<p>在本练习中，将修改创建单个方法所需的测试类，以便创建和关闭容器实例。如果要运行几个可使用相同容器实例的测试，这可能是非常有用的。这样，您就不需要针对每个测试打开和关闭容器实例，只需在运行测试之前创建一个实例，并在完成所有测试后关闭该实例。</p>
</div>
<div class="paragraph">
<p>在本练习中，您需要将用于创建 EJB 容器的代码移到  <code>setUpClass</code>  方法中。 <code>setUpClass</code>  方法是使用  <code>@BeforeClass</code>  标注的，用于指示在测试类中的其他方法运行之前将要运行的某个方法。在本示例中，将在  <code>testAddNumbers</code>  测试方法之前创建容器实例，并且该容器在关闭之前将一直存在。</p>
</div>
<div class="paragraph">
<p>同样，您需要将用于关闭该容器的代码移到  <code>tearDownClass</code>  方法中，该方法是使用  <code>@AfterClass</code>  标注的。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将以下字段添加到测试类中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static EJBContainer container;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将用于创建容器的代码从  <code>testAddNumbers</code>  测试方法复制到  <code>setUpClass</code>  方法和</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@BeforeClass
public static void setUpClass() *throws Exception* {
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
    properties.put(EJBContainer.MODULES, new File("build/jar"));
    container = EJBContainer.createEJBContainer(properties);
    System.out.println("Opening the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将用于关闭容器的代码从  <code>testAddNumbers</code>  测试方法复制到  <code>tearDownClass</code>  方法中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@AfterClass
public static void tearDownClass() *throws Exception* {
    *container.close();
    System.out.println("Closing the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从  <code>testAddNumbers</code>  方法中删除多余的代码。保存所做的更改。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>现在，测试类应如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class MyBeanTest {
    private static EJBContainer container;

    public MyBeanTest() {
    }

    @BeforeClass
    public static void setUpClass() throws Exception {
        Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
        properties.put(EJBContainer.MODULES, new File("build/jar"));
        container = EJBContainer.createEJBContainer(properties);
        System.out.println("Opening the container");
    }

    @AfterClass
    public static void tearDownClass() throws Exception {
        container.close();
        System.out.println("Closing the container");
    }

    @Before
    public void setUp() {
    }

    @After
    public void tearDown() {
    }

    /**
     * Test of addNumbers method, of class MyBean.
     */
    @Test
    public void testAddNumbers() throws Exception {
        System.out.println("addNumbers");
        int numberA = 1;
        int numberB = 2;

        // Create the instance using the container context to look up the bean
        // in the directory that contains the built classes
        MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

        int expResult = 3;

        // Invoke the addNumbers method on the bean instance:
        int result = instance.addNumbers(numberA, numberB);

        assertEquals(expResult, result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果再次运行测试以确认正确创建和关闭了容器，则 "Test Results"（测试结果）窗口中将会显示类似下面的输出。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2a.png" alt="test results2a" width="Test Results"（测试结果）窗口"">
</div>
<div class="title">Figure 4. </div>
</div>
<div class="paragraph">
<p>您可以看到在  <code>addNumbers</code>  测试之前运行了  <code>setUpClass</code>  方法并输出了 "Opening the container"。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试实体类">测试实体类</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，将创建一个实体类和持久性单元，并修改会话 Bean 以注入实体管理器和访问实体。在新实体类中，将添加一个简单方法以输出条目的 ID 号。然后，在会话 Bean 中添加一些简单方法以在数据库中创建和验证条目。</p>
</div>
<div class="sect2">
<h3 id="_创建实体类">创建实体类</h3>
<div class="paragraph">
<p>在本节中，将通过新建实体类向导使用数据库连接详细信息创建一个实体类和持久性单元。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中右键单击 "WebAppJUnit" 项目，然后选择 "New"（新建）&gt; "Other"（其他）。</p>
</li>
<li>
<p>在 "Persistence"（持久性）类别中选择 "Entity Class"（实体类）。单击 "Next"（下一步）。</p>
</li>
<li>
<p>在 "Class Name"（类名）中键入 <strong>SimpleEntity</strong>。</p>
</li>
<li>
<p>从 "Package"（包）下拉列表中选择 "Bean"。</p>
</li>
<li>
<p>在 "Primary Key Type"（主键类型）中键入 <strong>int</strong>。单击 "Next"（下一步）。</p>
</li>
<li>
<p>使用默认的持久性单元名称和持久性提供器。</p>
</li>
<li>
<p>选择  <code>jdbc/sample</code>  作为数据源，然后选 "Drop and Create"（删除并创建）作为策略。单击 "Finish"（完成）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-entity-wizard.png" alt="create entity wizard" width="Create Entity Class"（创建实体类）对话框"">
</div>
<div class="title">Figure 5. </div>
</div>
<div class="paragraph">
<p>单击 "Finish"（完成），此时将在编辑器中打开新的实体类。如果在 "Projects"（项目）窗口中展开 "Configuration Files"（配置文件）节点，则可以看到 IDE 自动生成了  <code>persistence.xml</code>  文件，该文件定义了  <code>WebAppJUnitPU</code>  持久性单元的属性。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在编辑器中，将以下私有字段添加到实体类中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private String name;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在源代码编辑器中右键单击，选择 "Insert Code"（插入代码）（Alt-Insert 组合键；在 Mac 上为 Ctrl-I 组合键），然后选择 "Getter and Setter"（Getter 和 Setter），以打开 "Generate Getters and Setters"（生成 Getter 和 Setter）对话框。</p>
</li>
<li>
<p>在对话框中选择  <code>name</code>  字段。单击 "Generate"（生成）。</p>
</li>
<li>
<p>将以下方法添加到类中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public SimpleEntity(int id) {
    this.id = id;
    name = "Entity number " + id + " created at " + new Date();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用  <code>@NamedQueries</code>  和  <code>@NamedQuery</code>  标注来创建指定的 SQL 查询。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Entity
*@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})*
public class SimpleEntity implements Serializable {</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建一个默认构造函数。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果希望 IDE 生成构造函数，您可以单击类声明旁边的装订线中显示的建议图标。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修复导入以添加  <code>javax.persistence.NamedQueries</code> 、 <code>javax.persistence.NamedQuery</code>  和  <code>java.util.Date</code>  的 import 语句。保存所做的更改。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>除了默认的生成代码以外，实体类现在应类似于以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package bean;

import java.io.Serializable;
import java.util.Date;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;


@Entity
@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})
public class SimpleEntity implements Serializable {
    private static final long serialVersionUID = 1L;
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int id;

    private String name;

    public SimpleEntity() {
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public SimpleEntity(int id) {
        this.id = id;
        name = "Entity number " + id + " created at " + new Date();
    }



    ...

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_修改会话_bean">修改会话 Bean</h3>
<div class="paragraph">
<p>在本练习中，将编辑  <code>MyBean</code>  会话 Bean 以添加在数据库表中插入和检索数据的方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在编辑器中打开  <code>MyBean.java</code> 。</p>
</li>
<li>
<p>在编辑器中右键单击，选择 "Insert Code"（插入代码）（Alt-Insert 组合键；在 Mac 上为 Ctrl-I 组合键），然后从弹出式菜单中选择 "Use Entity Manager"（使用实体管理器）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>选择 "Use Entity Manager"（使用实体管理器）时，IDE 将在类中添加以下代码以注入实体管理器。您可以看到自动生成了持久性单元的名称。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PersistenceContext(unitName="WebAppJUnitPU")
private EntityManager em;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>添加以下  <code>verify</code>  和  <code>insert</code>  方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PermitAll
public int verify() {
    String result = null;
    Query q = em.createNamedQuery("SimpleEntity.findAll");
    Collection entities = q.getResultList();
    int s = entities.size();
    for (Object o : entities) {
        SimpleEntity se = (SimpleEntity)o;
        System.out.println("Found: " + se.getName());
    }

    return s;
}

@PermitAll
public void insert(int num) {
    for (int i = 1; i &lt;= num; i++) {
        System.out.println("Inserting # " + i);
        SimpleEntity e = new SimpleEntity(i);
        em.persist(e);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修复导入以导入  <code>javax.persistence.Query</code>  并保存所做的更改。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_测试实体类_2">测试实体类</h3>
<div class="paragraph">
<p>在本练习中，将编辑测试类以添加一个方法，测试应用程序是否可以查找 EJB 以及  <code>insert</code>  和  <code>verify</code>  方法是否正常工作。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>启动 JavaDB 数据库。</p>
</li>
<li>
<p>在编辑器中打开  <code>MyBeanTest.java</code>  测试类。</p>
</li>
<li>
<p>编辑该测试类以添加以下  <code>testInsert</code>  测试方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testInsert() throws Exception {

    // Lookup the EJB
    System.out.println("Looking up EJB...");
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    System.out.println("Inserting entities...");
    instance.insert(5);
    int res = instance.verify();
    System.out.println("JPA call returned: " + res);
    System.out.println("Done calling EJB");

    Assert.assertTrue("Unexpected number of entities", (res == 5));
    System.out.println("..........SUCCESSFULLY finished embedded test");
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中右键单击项目节点，然后从弹出式菜单中选择 "Test"（测试）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>此时将打开 "Test Results"（测试结果）窗口并显示类似下面的输出。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2b.png" alt="test results2b" width="Test Results"（测试结果）窗口"">
</div>
<div class="title">Figure 6. 添加 testInsert 测试后的 </div>
</div>
<div class="paragraph">
<p>您可以通过添加到测试类中的输出消息查看测试进度和测试运行顺序。</p>
</div>
<div class="paragraph">
<p>现在您已为会话 Bean 创建了测试并知道实体类连接正常工作，因此可以开始对应用程序的 Web 接口进行编码。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_下载解决方案项目">下载解决方案项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您可以采用下列方法下载本教程的解决方案（作为一个项目）。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下载<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">已完成项目的 zip 档案文件</a>。</p>
</li>
<li>
<p>通过执行以下步骤从 NetBeans 样例检出项目源代码：</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从主菜单中选择 "Team"（团队开发）&gt; "Subversion" &gt; "Checkout"（检出）。</p>
</li>
<li>
<p>在 "Checkout"（检出）对话框中，输入以下资源库 URL：
 <code><a href="https://svn.netbeans.org/svn/samples~samples-source-code" class="bare">https://svn.netbeans.org/svn/samples~samples-source-code</a></code>
单击 "Next"（下一步）。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>单击 "Browse"（浏览）以打开 "Browse Repository Folders"（浏览资源库文件夹）对话框。</p>
</li>
<li>
<p>展开根节点并选择 <strong>samples/javaee/WebAppJUnit</strong>。单击 "OK"（确定）。</p>
</li>
<li>
<p>指定用于存储源代码的本地文件夹（本地文件夹必须为空）。</p>
</li>
<li>
<p>单击 "Finish"（完成）。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>单击 "Finish"（完成），此时 IDE 会将本地文件夹初始化为 Subversion 资源库，并检出项目源代码。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在完成检出操作后将会显示一个对话框，在该对话框中单击 "Open Project"（打开项目）。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
需要 Subversion 客户端检出源代码。有关安装 Subversion 的更多信息，请参见 <a href="../ide/subversion.html">NetBeans IDE 中的 Subversion 指南</a>中有关<a href="../ide/subversion.html#settingUp">设置 Subversion</a> 的部分。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20the%20Embedded%20EJB%20Container">发送有关此教程的反馈意见</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_另请参见">另请参见</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有关使用 NetBeans IDE 开发 Java EE 应用程序的更多信息，请参见以下资源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-intro.html">Java EE 技术简介</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EE 应用程序入门指南</a></p>
</li>
<li>
<p><a href="../web/quickstart-webapps.html">Web 应用程序开发简介</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Java EE 和 Java Web 学习资源</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以在 <a href="http://download.oracle.com/javaee/6/tutorial/doc/">Java EE 6 教程</a>中找到有关使用 EJB 3.1 企业 Bean 的详细信息。</p>
</div>
<div class="paragraph">
<p>要发送意见和建议、获得支持以及随时了解 NetBeans IDE Java EE 开发功能的最新开发情况，请<a href="../../../community/lists/top.html">加入 nbj2ee 邮件列表</a>。</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
