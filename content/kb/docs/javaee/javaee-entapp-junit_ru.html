
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Использование встроенного контейнера EJB для тестирования приложений уровня предприятия</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Использование встроенного контейнера EJB для тестирования приложений уровня предприятия - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Использование встроенного контейнера EJB для тестирования приложений уровня предприятия">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 12.6</h1>
            <p><a class="button success" href="/download/nb126/nb126.html">Download</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">Использование встроенного контейнера EJB для тестирования приложений уровня предприятия</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_ru.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_тестирование_сеансного_компонента">Тестирование сеансного компонента</a>
<ul class="sectlevel2">
<li><a href="#_создание_проекта">Создание проекта</a></li>
<li><a href="#_создание_компонента_сеанса">Создание компонента сеанса</a></li>
<li><a href="#_тестирование_сеансного_компонента_2">Тестирование сеансного компонента</a></li>
<li><a href="#_изменение_теста_для_указания_свойств_контейнера">Изменение теста для указания свойств контейнера</a></li>
<li><a href="#_использование_аннотаций_beforeclass_и_afterclass">Использование аннотаций  <code>@BeforeClass</code>  и  <code>@AfterClass</code></a></li>
</ul>
</li>
<li><a href="#_тестирование_класса_сущности">Тестирование класса сущности</a>
<ul class="sectlevel2">
<li><a href="#_создание_класса_сущности">Создание класса сущности</a></li>
<li><a href="#_изменение_сеансного_компонента">Изменение сеансного компонента</a></li>
<li><a href="#_тестирование_класса_сущности_2">Тестирование класса сущности</a></li>
</ul>
</li>
<li><a href="#_загрузка_проекта_решения">Загрузка проекта решения</a></li>
<li><a href="#_дополнительные_сведения">Дополнительные сведения</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом учебном курсе демонстрируется создание и выполнение тестов JUnit для приложений Java EE уровня предприятия. В этом учебном курсе будет создано веб-приложение с классом сущности и сеансным компонентом. Сначала будет создан тестовый класс JUnit для сеансного компонента, потом тест будет выполнен во встроенном контейнере EJB. Затем к проекту будет добавлен класс сущности, а тестовый класс будет изменен, и к классу сущности будет добавлен тестовый метод.</p>
</div>
<div class="paragraph">
<p><strong>Упражнения по темам руководства</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Exercise_1">Тестирование сеансного компонента</a></p>
</li>
<li>
<p><a href="#Exercise_1a">Создание проекта</a></p>
</li>
<li>
<p><a href="#Exercise_1b">Создание сеансового компонента</a></p>
</li>
<li>
<p><a href="#Exercise_1c">Тестирование сеансного компонента</a></p>
</li>
<li>
<p><a href="#Exercise_1d">Изменение теста для указания свойств контейнера</a></p>
</li>
<li>
<p><a href="#Exercise_1e">Использование аннотаций @BeforeClass и @AfterClass</a></p>
</li>
<li>
<p><a href="#Exercise_2">Тестирование класса сущности</a></p>
</li>
<li>
<p><a href="#Exercise_2a">Создание класса сущностей</a></p>
</li>
<li>
<p><a href="#Exercise_2b">Изменение сеансного компонента</a></p>
</li>
<li>
<p><a href="#Exercise_2c">Тестирование класса сущности</a></p>
</li>
<li>
<p><a href="#Exercise_3">Загрузка проекта решения</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Для работы с этим учебным курсом требуется следующее программное обеспечение и ресурсы.</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Программное обеспечение или материал</th>
<th class="tableblock halign-left valign-top">Требуемая версия</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/downloads/">IDE NetBeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2, 7.3, 7.4, 8.0, пакет Java EE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Комплект для разработчика на языке Java (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">версия 7 или 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition 3.1.2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1.x или 4.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Примечания.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для этого учебного курса требуется подключаемый модуль JUnit. Если подключаемый модуль JUnit не установлен, при установке среды IDE откройте диспетчер подключаемых модулей, выберите вкладку "Доступные подключаемые модули" и установите подключаемый модуль JUnit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Предпосылки</strong></p>
</div>
<div class="paragraph">
<p>Предполагается, что читатель обладает базовыми знаниями по следующим технологиям или опытом программирования с их использованием:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Программирование на Java</p>
</li>
<li>
<p>IDE NetBeans</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Перед началом этого учебного курса рекомендуется ознакомиться со следующей документацией:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-gettingstarted.html">Начало работы с приложениями Java EE</a></p>
</li>
<li>
<p><a href="../java/junit-intro.html">Writing JUnit Tests in IDE NetBeans</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E19798-01/821-1754/gjlde/index.html">Использование встраиваемого интерфейса API EJB 3.1 вместе со встроенным сервером GlassFish</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Можно загрузить <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">готовый проект в виде архива ZIP</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_тестирование_сеансного_компонента">Тестирование сеансного компонента</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет создано простое веб-приложение Java EE, содержащее сеансный компонент и класс сущности.</p>
</div>
<div class="sect2">
<h3 id="_создание_проекта">Создание проекта</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Выберите 'Файл' &gt; 'Создать проект' (Ctrl-Shift-N; ⌘-Shift-N в Mac) в главном меню.</p>
</li>
<li>
<p>Выберите "Веб-приложение" в категории "Java Web". Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Присвойте проекту имя <strong>WebAppJUnit</strong> и выберите его местоположение.</p>
</li>
<li>
<p>Снимите флажок "Использовать отдельную папку", если он установлен.
Нажмите кнопку "Далее".</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В качестве сервера выберите <strong>GlassFish Server</strong>, а в качестве версии Java EE - <strong>Java EE 6 Web</strong> или <strong>Java EE 7 Web</strong>.
Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_создание_компонента_сеанса">Создание компонента сеанса</h3>
<div class="paragraph">
<p>В этом упражнении будет создан очень простой сеансный компонент, содержащий один метод для сложения двух чисел.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши проект WebAppJUnit в окне "Проекты" и выберите Создать &gt; Другое.</p>
</li>
<li>
<p>Выберите "Сеансный компонент" в категории Enterprise JavaBeans. Нажмите кнопку "Далее".</p>
</li>
<li>
<p>В качестве имени EJB введите <strong>MyBean</strong>.</p>
</li>
<li>
<p>Для имени пакета введите <strong>bean</strong>.</p>
</li>
<li>
<p>Для "Тип сеанса" выберите "Без сохранения состояния". Нажмите кнопку 'Готово'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" в редакторе откроется новый класс.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В редакторе добавьте к классу следующий метод  <code>addNumbers</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class MyBean {
    *public int addNumbers(int numberA, int numberB) {
        return numberA + numberB;
    }*
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Для выполнения заданий этого практического руководства не обязательно создавать аннотацию  <code>@LocalBean</code>  или реализацию интерфейса. Если представление не указано явным образом, по умолчанию компонент предоставляет безынтерфейсное представление.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраните изменения.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_тестирование_сеансного_компонента_2">Тестирование сеансного компонента</h3>
<div class="paragraph">
<p>В этом упражнении будет создан тестовый класс для сеансного компонента, который будет тестировать метод  <code>addNumbers</code> . Среда IDE может создать новый тестовый класс и методы тестирования схемы на основе целевого класса.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В окне 'Проекты' щелкните класс  <code>MyBean</code>  правой кнопкой мыши и выберите Сервис &gt; Создать тесты.</p>
</li>
<li>
<p>Выберите JUnit в списке 'Платформы'.</p>
</li>
<li>
<p>В диалоговом окне "Создать тесты" используйте значения по умолчанию. Нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-tests-dialog.png" alt="create tests dialog">
</div>
<div class="title">Figure 1. Диалоговое окно 'Создать тесты'</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
При первом создании модульного теста JUnit необходимо указать версию JUnit. Выберите версию JUnit 4.x в диалоговом окне 'Выбор версии JUnit' и нажмите 'Выбрать'.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>При нажатии кнопки "ОК" среда IDE создает файл  <code>MyBeanTest.java</code>  и открывает класс в редакторе.</p>
</div>
<div class="paragraph">
<p>В окне 'Проекты' видно, что среда IDE создала класс теста в узле 'Пакеты тестов'. По умолчанию среда IDE создает каркасный тестовый метод в тестовом классе, который вызывает  <code>javax.ejb.embeddable.EJBContainer.createEJBContainer()</code>  для создания экземпляра контейнера EJB. Метод  <code>createEJBContainer()</code>  — это один из методов в классе <a href="http://download.oracle.com/javaee/6/api/javax/ejb/embeddable/EJBContainer.html">+  <code>EJBContainer</code> +</a>, входящем в EJB 3.1 Embeddable API.</p>
</div>
<div class="paragraph">
<p>Если развернуть узел 'Библиотеки тестов' в окне 'Проекты', можно увидеть, что среда IDE автоматически добавила сервер GlassFish (встраиваемый контейнер) и JUnit 4.x как библиотеки тестов. Если развернуть библиотеку "Сервер GlassFish", можно увидеть, что библиотека содержит файл  <code>glassfish-embedded-static-shell.jar</code> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/embedded-static-shell-jar.png" alt="embedded static shell jar">
</div>
<div class="title">Figure 2. Структура проекта в окне 'Проекты'</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Файл JAR  <code>glassfish-embedded-static-shell.jar</code>  не содержит источников для встроенного контейнера EJB. Для файла  <code>glassfish-embedded-static-shell.jar</code>  требуется локальная установка GlassFish. Путь к классам для локальной установки GlassFish определяется целевым сервером для проекта. Целевой сервер можно изменить в диалоговом окне "Свойства" проекта.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Измените созданный каркасный тестовый метод, чтобы указать значения для  <code>numberA</code> ,  <code>numberB</code>  и  <code>expResult</code>  и удалить вызов сбоя по умолчанию.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    *int numberA = 1;
    int numberB = 2;*
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer();
    MyBean instance = (MyBean)container.getContext().lookup("java:global/classes/MyBean");
    *int expResult = 3;*
    int result = instance.addNumbers(numberA, numberB);
    assertEquals(expResult, result);
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши окно "Проекты" и выберите команду "Тест".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При выполнении теста в среде IDE откроется окно "Результаты тестирования", в котором отобразятся ход выполнения и результаты теста.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results1.png" alt="test results1">
</div>
<div class="title">Figure 3. Окно &quot;Результаты теста&quot;</div>
</div>
<div class="paragraph">
<p>Результаты будут сходны с данными в окне вывода.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Testsuite: bean.MyBeanTest
addNumbers
...
Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 31.272 sec

------------- Standard Output ---------------
addNumbers
...
------------- ---------------- ---------------
test-report:
test:
BUILD SUCCESSFUL (total time: 35 seconds)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_изменение_теста_для_указания_свойств_контейнера">Изменение теста для указания свойств контейнера</h3>
<div class="paragraph">
<p>При использовании мастера создания тестов среда IDE создала каркасный тестовый класс по умолчанию, содержащий код для запуска контейнера EJB. В этом упражнении будет изменен созданный код для запуска контейнера, чтобы позволить указать дополнительные свойства для экземпляра встроенного контейнера.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующий код (выделен полужирным) к тестовому классу.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    int numberA = 1;
    int numberB = 2;

    // Create a properties map to pass to the embeddable container:
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();*
    // Use the MODULES property to specify the set of modules to be initialized,
    // in this case a java.io.File
    *properties.put(EJBContainer.MODULES, new File("build/jar"));*

    // Create the container instance, passing it the properties map:
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer(*properties*);

    // Create the instance using the container context to look up the bean
    // in the directory that contains the built classes
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    int expResult = 3;

    // Invoke the addNumbers method on the bean instance:
    int result = instance.addNumbers(numberA, numberB);

    assertEquals(expResult, result);

    // Close the embeddable container:
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши в редакторе и выберите команду 'Исправить операторы импорта' (Alt-Shift-I; ⌘-Shift-I в Mac) для добавления операторов импорта для  <code>java.util.HashMap</code>  и  <code>java.util.Map</code> .</p>
</li>
<li>
<p>Снова выполните тест для подтверждения работы измененного теста и правильности создания контейнера.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Можно нажать кнопку "Повторное выполнение" в окне "Результаты тестирования".</p>
</div>
</div>
<div class="sect2">
<h3 id="_использование_аннотаций_beforeclass_и_afterclass">Использование аннотаций  <code>@BeforeClass</code>  и  <code>@AfterClass</code></h3>
<div class="paragraph">
<p>В этом упражнении будет изменен тестовый класс для создания отдельных методов для создания и отключения экземпляра контейнера. Это может быть полезным при необходимости выполнения нескольких тестов, которые могут использовать один экземпляр контейнера. При этом не требуется открывать и закрывать контейнер для каждого теста, вместо этого до запуска тестов создается один экземпляр, который закрывается после выполнения всех тестов.</p>
</div>
<div class="paragraph">
<p>В этом упражнении код создания контейнера EJB будет перемещен в метод  <code>setUpClass</code> . Метод  <code>setUpClass</code>  аннотирован строкой  <code>@BeforeClass</code> , используемой для обозначения метода, который будет выполнен первым до выполнения других методов в тестовом классе. В этом примере будет создан экземпляр контейнера до тестового метода  <code>testAddNumbers</code> , контейнер будет существовать до его закрытия.</p>
</div>
<div class="paragraph">
<p>Аналогично код выключения контейнера будет перемещен в метод  <code>tearDownClass</code> , аннотированный строкой  <code>@AfterClass</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующую строку к тестовому классу.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static EJBContainer container;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Скопируйте код создания контейнера из тестового метода  <code>testAddNumbers</code>  в метод  <code>setUpClass</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@BeforeClass
public static void setUpClass() *throws Exception* {
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
    properties.put(EJBContainer.MODULES, new File("build/jar"));
    container = EJBContainer.createEJBContainer(properties);
    System.out.println("Opening the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Скопируйте код закрытия контейнера из тестового метода  <code>testAddNumbers</code>  в метод  <code>tearDownClass</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@AfterClass
public static void tearDownClass() *throws Exception* {
    *container.close();
    System.out.println("Closing the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Удалите избыточный код из метода  <code>testAddNumbers</code> . Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь тестовый класс должен выглядеть следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class MyBeanTest {
    private static EJBContainer container;

    public MyBeanTest() {
    }

    @BeforeClass
    public static void setUpClass() throws Exception {
        Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
        properties.put(EJBContainer.MODULES, new File("build/jar"));
        container = EJBContainer.createEJBContainer(properties);
        System.out.println("Opening the container");
    }

    @AfterClass
    public static void tearDownClass() throws Exception {
        container.close();
        System.out.println("Closing the container");
    }

    @Before
    public void setUp() {
    }

    @After
    public void tearDown() {
    }

    /**
     * Test of addNumbers method, of class MyBean.
     */
    @Test
    public void testAddNumbers() throws Exception {
        System.out.println("addNumbers");
        int numberA = 1;
        int numberB = 2;

        // Create the instance using the container context to look up the bean
        // in the directory that contains the built classes
        MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

        int expResult = 3;

        // Invoke the addNumbers method on the bean instance:
        int result = instance.addNumbers(numberA, numberB);

        assertEquals(expResult, result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>При повторном выполнении теста для подтверждения правильности создания и выключения контейнера можно увидеть вывод, сходный со следующим окном "Результаты тестирования.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2a.png" alt="test results2a">
</div>
<div class="title">Figure 4. Окно &quot;Результаты теста&quot;</div>
</div>
<div class="paragraph">
<p>Можно увидеть, что метод  <code>setUpClass</code>  выполнен до теста  <code>addNumbers</code>  и напечатал строку "Открытие контейнера".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_тестирование_класса_сущности">Тестирование класса сущности</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет создан класс сущности и блок сохранения состояния, а также изменен сеансный компонент для внедрения диспетчера сущностей и доступа к сущностям. Также к новому классу сущности будет добавлен простой метод для печати номера идентификатора записи в вывод. После этого к сеансному компоненту будет добавлено несколько простых методов для создания и проверки записей в базе данных.</p>
</div>
<div class="sect2">
<h3 id="_создание_класса_сущности">Создание класса сущности</h3>
<div class="paragraph">
<p>В этом разделе будет использоваться мастер создания класса сущности для создания класса сущности и блока сохранения состояния с настройками подключения к базе данных .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши проект WebAppJUnit в окне "Проекты" и выберите Создать &gt; Другое.</p>
</li>
<li>
<p>Выберите класс сущности в категории сохранения состояния. Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Введите <strong>SimpleEntity</strong> в качестве имени класса.</p>
</li>
<li>
<p>Выберите базовый элемент в раскрывающемся списке "Пакет".</p>
</li>
<li>
<p>Введите <strong>int</strong> как тип первичного ключа. Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Используйте имя блока сохранения состояния и поставщика сохранения состояния по умолчанию.</p>
</li>
<li>
<p>Выберите  <code>jdbc/sample</code>  в качестве источника данных и "Удалить и создать" в качестве стратегии. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-entity-wizard.png" alt="create entity wizard">
</div>
<div class="title">Figure 5. Диалоговое окно создания классов сущностей</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" в редакторе откроется новый класс сущности. Если развернуть узел "Файлы настройки" в окне "Проекты, можно увидеть, что среда IDE автоматически создала файл  <code>persistence.xml</code> , в котором определяются свойства единицы сохранения состояния  <code>WebAppJUnitPU</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В редакторе добавьте к классу сущности следующее закрытое поле.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private String name;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши в редакторе исходного кода, выберите пункт "Вставить код" (Alt-Insert; Ctrl-I на Mac) и выберите пункт "Методы получения и установки", чтобы открыть диалоговое окно "Создать методы получения и установки".</p>
</li>
<li>
<p>В диалоговом окне выберите поле  <code>name</code> . Нажмите кнопку 'Создать'.</p>
</li>
<li>
<p>Добавьте к классу следующий метод.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public SimpleEntity(int id) {
    this.id = id;
    name = "Entity number " + id + " created at " + new Date();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Аннотации  <code>@NamedQueries</code>  и  <code>@NamedQuery</code>  используются для создания именованного запроса SQL.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Entity
*@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})*
public class SimpleEntity implements Serializable {</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создание конструктора по умолчанию.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Можно щелкнуть значок предложения, отображающийся во внутреннем поле рядом с объявлением класса, чтобы среда IDE создала конструктор.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Исправьте операторы импорта для добавления выражений импорта для  <code>javax.persistence.NamedQueries</code> ,  <code>javax.persistence.NamedQuery</code>  и  <code>java.util.Date</code> . Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Помимо созданного кода по умолчанию теперь класс сущности должен выглядеть так, как показано ниже:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package bean;

import java.io.Serializable;
import java.util.Date;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;


@Entity
@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})
public class SimpleEntity implements Serializable {
    private static final long serialVersionUID = 1L;
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int id;

    private String name;

    public SimpleEntity() {
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public SimpleEntity(int id) {
        this.id = id;
        name = "Entity number " + id + " created at " + new Date();
    }



    ...

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_изменение_сеансного_компонента">Изменение сеансного компонента</h3>
<div class="paragraph">
<p>В этом упражнении изменяется сеансный компонент  <code>MyBean</code>  для добавления методов для вставки и получения данных из таблицы базы данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте файл  <code>MyBean.java</code>  в редакторе.</p>
</li>
<li>
<p>Щелкните редактор правой кнопкой мыши и выберите "Вставка кода" (Alt-Insert; Ctrl-I в Mac), затем выберите "Использовать диспетчер сущностей" во всплывающем меню.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При выборе "Использовать диспетчер сущностей" среда IDE добавляет к классу следующий код для вставки в диспетчер сущностей. Можно заметить, что имя блока сохранения состояния создается автоматически.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PersistenceContext(unitName="WebAppJUnitPU")
private EntityManager em;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующие методы  <code>verify</code>  и  <code>insert</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PermitAll
public int verify() {
    String result = null;
    Query q = em.createNamedQuery("SimpleEntity.findAll");
    Collection entities = q.getResultList();
    int s = entities.size();
    for (Object o : entities) {
        SimpleEntity se = (SimpleEntity)o;
        System.out.println("Found: " + se.getName());
    }

    return s;
}

@PermitAll
public void insert(int num) {
    for (int i = 1; i &lt;= num; i++) {
        System.out.println("Inserting # " + i);
        SimpleEntity e = new SimpleEntity(i);
        em.persist(e);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Исправьте операторы импорта, чтобы импортировать  <code>javax.persistence.Query</code> , и сохраните изменения.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_тестирование_класса_сущности_2">Тестирование класса сущности</h3>
<div class="paragraph">
<p>В этом упражнении будет изменяться тестовый класс для добавления метода для тестирования возможности поиска приложением EJB и правильности поведения методов  <code>insert</code>  и  <code>verify</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Запустите базу данных JavaDB.</p>
</li>
<li>
<p>Откройте тестовый класс  <code>MyBeanTest.java</code>  в редакторе.</p>
</li>
<li>
<p>К тестовому классу добавьте следующий тестовый метод  <code>testInsert</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testInsert() throws Exception {

    // Lookup the EJB
    System.out.println("Looking up EJB...");
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    System.out.println("Inserting entities...");
    instance.insert(5);
    int res = instance.verify();
    System.out.println("JPA call returned: " + res);
    System.out.println("Done calling EJB");

    Assert.assertTrue("Unexpected number of entities", (res == 5));
    System.out.println("..........SUCCESSFULLY finished embedded test");
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Правой кнопкой мыши щелкните узел свойств в окне "Проекты" и выберите "Тест" во всплывающем меню.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Откройте окно "Результаты тестирования", в котором будет отображен вывод, сходный со следующим.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2b.png" alt="test results2b">
</div>
<div class="title">Figure 6. Окно результатов теста после добавления теста testInsert</div>
</div>
<div class="paragraph">
<p>Сообщения печати, добавленные к тестовому классу, позволяют проследить ход выполнения тестов и порядок их запуска.</p>
</div>
<div class="paragraph">
<p>Теперь, когда имеется тест для сеансного компонента, и известно, что класс сущности работает, можно приступить к созданию веб-интерфейса для приложения.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_загрузка_проекта_решения">Загрузка проекта решения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Решение для данного учебного курса в виде проекта можно загрузить несколькими способами.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Загрузите <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">архив завершенного проекта в формате zip</a>.</p>
</li>
<li>
<p>Выполните проверку исходных файлов проекта на выходе из примеров NetBeans, выполнив перечисленные ниже действия.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Выберите в главном меню "Группа &gt; Subversion &gt; Проверить".</p>
</li>
<li>
<p>В диалоговом окне "Проверка" введите следующий URL-адрес репозитория:
 <code><a href="https://svn.netbeans.org/svn/samples~samples-source-code" class="bare">https://svn.netbeans.org/svn/samples~samples-source-code</a></code>
Нажмите кнопку "Далее".</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите кнопку Browse ("Обзор") для открытия диалогового окна Browse Repository Folders ("Обзор папок репозитория").</p>
</li>
<li>
<p>Разверните корневой узел и выберите <strong>samples/javaee/WebAppJUnit</strong>. Нажмите кнопку "ОК".</p>
</li>
<li>
<p>Укажите локальную папку для исходных файлов (папка должна быть пустой).</p>
</li>
<li>
<p>Нажмите кнопку 'Готово'.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>После нажатия кнопки "Готово" среда IDE инициализирует локальную папку в качестве репозитория Subversion и выполняет проверку исходных файлов проекта на выходе.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните команду "Открыть проект" в диалоговом окне, которое появится после завершения проверки.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Примечания.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для получения исходных файлов на редактирование требуется клиент Subversion. For more about installing Subversion, see the section on <a href="../ide/subversion.html#settingUp">Setting up Subversion</a> in the <a href="../ide/subversion.html">Guide to Subversion in IDE NetBeans</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20the%20Embedded%20EJB%20Container">Отправить отзыв по этому учебному курсу</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_дополнительные_сведения">Дополнительные сведения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about using IDE NetBeans to develop Java EE applications, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-intro.html">+Введение в технологию Java EE +</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Начало работы с приложениями Java EE</a></p>
</li>
<li>
<p><a href="../web/quickstart-webapps.html">Введение в разработку веб-приложений</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Учебная карта по Java EE и Java Web</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Дополнительные сведения по использованию компонентов уровня предприятия EJB 3.1 см. в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">руководстве по Java EE 6</a>.</p>
</div>
<div class="paragraph">
<p>To send comments and suggestions, get support, and keep informed on the latest developments on the IDE NetBeans Java EE development features, <a href="../../../community/lists/top.html">join the nbj2ee mailing list</a>.</p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_ru.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2020 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
