
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Tutorial do NetBeans E-commerce: Gerenciando Sessões</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tutorial do NetBeans E-commerce: Gerenciando Sessões - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Tutorial do NetBeans E-commerce: Gerenciando Sessões">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Tutorial do NetBeans E-commerce: Gerenciando Sessões</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/manage-sessions_pt_BR.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#session-data">Tratando Dados de Sessão</a>
<ul class="sectlevel2">
<li><a href="#httpSession">Trabalhando com um Objeto HttpSession</a></li>
<li><a href="#scopedVariables">Trabalhando com Variáveis de Escopos em Aplicações Web</a></li>
</ul>
</li>
<li><a href="#debug">Examinando Dados de Sessão com o Depurador Java</a>
<ul class="sectlevel2">
<li><a href="#_página_de_categoria">página de categoria</a></li>
<li><a href="#cartPage">página do carrinho</a></li>
<li><a href="#_página_de_check_out">página de check-out</a></li>
<li><a href="#_aproveitando_o_suporte_do_javadoc_do_ide">Aproveitando o Suporte do Javadoc do IDE</a></li>
</ul>
</li>
<li><a href="#session-track">Analisando as Opções de Rastreamento da Sessão</a>
<ul class="sectlevel2">
<li><a href="#http-monitor">Analisando a Comunicação Cliente-Servidor com o Monitor HTTP</a></li>
<li><a href="#url-rewrite">Mantendo Sessões com a Reescrita de URL</a></li>
</ul>
</li>
<li><a href="#time-out">Tratando Time-Outs de Sessão</a>
<ul class="sectlevel2">
<li><a href="#time-interval">Definindo Intervalos de Tempo da Sessão</a></li>
<li><a href="#programmatically">Tratando de Forma Programática Time-outs de Sessão</a></li>
</ul>
</li>
<li><a href="#seeAlso">Consulte Também</a>
<ul class="sectlevel2">
<li><a href="#_recursos_do_netbeans">Recursos do NetBeans</a></li>
<li><a href="#_recursos_do_glassfish">Recursos do GlassFish</a></li>
<li><a href="#_artigos_técnicos_recursos_variados">Artigos Técnicos &amp; Recursos Variados</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="intro.html">Introdução</a></p>
</li>
<li>
<p><a href="design.html">Criando a Aplicação</a></p>
</li>
<li>
<p><a href="setup-dev-environ.html">Configurando o Ambiente de Desenvolvimento</a></p>
</li>
<li>
<p><a href="data-model.html">Criando o Modelo de Dados</a></p>
</li>
<li>
<p><a href="page-views-controller.html">Preparando as Views de Página e o Servlet do Controlador</a></p>
</li>
<li>
<p><a href="connect-db.html">Conectando a Aplicação ao Banco de Dados</a></p>
</li>
<li>
<p><a href="entity-session.html">Adicionando Classes de Entidades e Beans de Sessão</a></p>
</li>
<li>
<p><strong>Gerenciando Seções</strong></p>
</li>
<li>
<p><a href="transaction.html">Integrando a Lógica de Negócios Transacional</a></p>
</li>
<li>
<p><a href="language.html">Adicionando o Suporte a Idioma</a></p>
</li>
<li>
<p><a href="security.html">Protegendo a Aplicação</a></p>
</li>
<li>
<p><a href="test-profile.html">Testando e Criando Perfis</a></p>
</li>
<li>
<p><a href="conclusion.html">Conclusão</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images_www/articles/68/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. O conteúdo desta página se aplica ao NetBeans IDE, versões e 6.8 e 6.9</div>
</div>
<div class="paragraph">
<p>Cada aplicação de e-commerce que oferece alguma forma de funcionalidade de carrinho de compras precisa poder lembrar dados específicos do usuário, conforme os usuários clicam no site. Infelizmente, para o desenvolvedor, o protocolo HTTP, sobre o qual a comunicação na Internet ocorre, é um protocolo <em>sem estado</em>. Cada solicitação recebida pelo servidor é uma informação independente que não tem nenhuma relação com solicitações recebidas anteriormente. Portanto, se o cliente clicar em um botão para adicionar um item ao seu carrinho de compras, a aplicação deverá tomar medidas para assegurar não somente que o estado do carrinho do usuário seja atualizado, mas que a ação não afete o carrinho de outro usuário que pode estar navegando pelo site ao mesmo tempo.</p>
</div>
<div class="paragraph">
<p>A fim de tratar corretamente o cenário descrito acima, é necessário implementar uma funcionalidade, de maneira que uma <em>sessão</em> possa ser criada e mantida durante toda a visita do usuário ao site. A tecnologia Servlet, que é a base de todas as aplicações web baseadas em Java, fornece isso com sua interface <a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">`HttpSession`</a>. É necessário também definir várias classes, como, por exemplo, <code>ShoppingCart</code> e <code>ShoppingCartItem</code>, que permitem à aplicação armazenar temporariamente dados do usuário, enquanto a sessão é mantida.</p>
</div>
<div class="paragraph">
<p>Esta unidade do tutorial utiliza uma abordagem diferente das outras no Tutorial do NetBeans E-commerce. Ao invés de criar os arquivos de projeto e fornecer as etapas com snippets de código para copiar e colar no seu próprio projeto, você abre o snapshot do projeto completo para esta unidade e examina o código utilizando o depurador do IDE e outras ferramentas. No processo, será possível aprender como aplicar um objeto <code>HttpSession</code> ao seu código, de forma que cada visita ao website resulte em uma sessão dedicada. Você aprenderá também sobre <em>variáveis de escopo</em> e seu uso nas classes Java e nas páginas JSP. Esta unidade também discute o mecanismo default de <code>HttpSession</code> para manutenção de sessões (ex., cookies) e mostra que medidas devem ser tomadas no caso de os cookies estarem desativados no browser do usuário. Por fim, os time-outs de sessão são cobertos e a unidade demonstra como tratá-los criando um filtro simples que intercepta solicitações de verificação da existência da sessão.</p>
</div>
<div class="paragraph">
<p>Você pode exibir uma demonstração ao vivo da aplicação construída neste tutorial: <a href="http://dot.netbeans.org:8080/AffableBean/">Aplicação de Demonstração do Tutorial do NetBeans E-commerce</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software ou Recurso</th>
<th class="tableblock halign-left valign-top">Versão Necessária</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pacote Java, 6.8 ou 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">versão 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">GlassFish Server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 ou Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">Servidor de banco de dados MySQL</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">versão 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">Projeto AffableBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot 5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Observações:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>O NetBeans IDE requer o Java Development Kit (JDK) para ser executado adequadamente. Se você não tiver nenhum dos recursos listados acima, o JDK deverá ser o primeiro item a ser submetido a download e instalado.</p>
</li>
<li>
<p>O Pacote Java do NetBeans IDE inclui o Java Web e tecnologias EE, que são necessárias para a aplicação construída neste tutorial.</p>
</li>
<li>
<p>O pacote Java do NetBeans IDE também inclui o GlassFish Server, necessário para este tutorial. Você poderia <a href="https://glassfish.dev.java.net/public/downloadsindex.html">fazer download do GlassFish Server independentemente</a>, mas a versão fornecida pelo NetBeans do qual fez download tem a vantagem adicional de ser registrada automaticamente no IDE.</p>
</li>
<li>
<p>Você pode seguir esta unidade do tutorial sem ter concluído as unidades anteriores. Para isso, consulte as <a href="setup.html">instruções de configuração</a>, que descrevem como preparar o banco de dados e estabelecer uma conectividade entre o IDE, o GlassFish e o MySQL.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-data">Tratando Dados de Sessão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As aplicações podem gerenciar sessões de usuário com o objeto <code>HttpSession</code>. Você pode vincular dados específicos do usuário ao objeto <code>HttpSession</code> e, em seguida, acessar esses dados em um estágio mais avançado. As duas ações de vincular e acessar podem ser feitas por meio das classes Java, assim como usando variáveis de escopo de sessão em expressões EL.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#httpSession">Trabalhando com um Objeto HttpSession</a></p>
</li>
<li>
<p><a href="#scopedVariables">Trabalhando com Variáveis de Escopos em Aplicações Web</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="httpSession">Trabalhando com um Objeto HttpSession</h3>
<div class="paragraph">
<p>A aplicação <code>AffableBean</code> utiliza o objeto <code>HttpSession</code> para identificar usuários em várias solicitações. Um objeto <code>HttpSession</code> é obtido utilizando <code>getSession()</code> em uma determinada solicitação:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">HttpSession session = request.getSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se ainda não existir um objeto de sessão para a solicitação, o método cria e retorna um novo objeto de sessão.</p>
</div>
<div class="paragraph">
<p>Você pode utilizar o objeto de sessão como um veículo para a transferência de dados entre as solicitações. Você pode utilizar o método <code>setAttribute</code> para vincular objetos à sessão. Da mesma forma, você usa <code>getAttribute</code> para recuperar objetos da sessão. Na aplicação <code>AffableBean</code>, por exemplo, o carrinho de compras do usuário é criado e vinculado à sessão do usuário da seguinte forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ShoppingCart cart = new ShoppingCart();
session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para recuperar o carrinho da sessão, o método <code>getAttibute</code> é aplicado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">cart = (ShoppingCart) session.getAttribute("cart");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nas páginas JSP, você pode acessar objetos vinculados à sessão utilizando expressões EL. Continuando com o exemplo acima, se um objeto <code>ShoppingCart</code> chamado &#8220;cart&#8221; estiver vinculado à sessão, você poderá acessá-lo utilizando a seguinte expressão EL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${cart}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No entanto, acessar o objeto <code>ShoppingCart</code> em si tem pouco valor. O que você realmente quer é uma maneira de acessar valores armazenados no objeto. Se explorar a nova classe <code>ShoppingCart</code> no snapshot do projeto, você notará que ela contém as seguintes propriedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>double total</code></p>
</li>
<li>
<p>`int Numberofitems `</p>
</li>
<li>
<p><code>List&lt;String, ShoppingCartItem&gt; items</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Desde que as propriedades tenham métodos getter correspondentes, você poderá acessar valores para propriedades singulares utilizando notação de ponto simples em uma expressão EL. Se examinar a página <code>cart.jsp</code>, verá que é exatamente assim que o valor para <code>numberOfItems</code> é acessado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;Your shopping cart contains ${cart.numberOfItems} items.&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para extrair dados de propriedades que contêm valores múltiplos, tal como a lista <code>items</code> acima, a página <code>cart.jsp</code> utiliza um loop <code>&lt;c:forEach&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;c:forEach var="cartItem" items="${cart.items}" varStatus="iter"&gt;

  &lt;c:set var="product" value="${cartItem.product}"/&gt;

    &lt;tr class="${((iter.index % 2) == 0) ? 'lightBlue' : 'white'}"&gt;
        &lt;td&gt;
            &lt;img src="${initParam.productImagePath}${product.name}.png"
                 alt="${product.name}"&gt;
        &lt;/td&gt;

        &lt;td&gt;${product.name}&lt;/td&gt;

        &lt;td&gt;
            &amp;amp;euro; ${cartItem.total}
            &lt;br&gt;
            &lt;span class="smallText"&gt;( &amp;amp;euro; ${product.price} / unit )&lt;/span&gt;
        &lt;/td&gt;
        ...
    &lt;/tr&gt;

&lt;/c:forEach&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A propriedade <code>product</code> de <code>ShoppingCartItem</code> identifica o tipo de produto de um item do carrinho. O loop acima aproveita isso definindo primeiramente uma variável <code>product</code> para a expressão <code>${cartItem.product}</code>. Em seguida ele utiliza a variável para obter informações sobre esse produto (ex., nome e preço).</p>
</div>
</div>
<div class="sect2">
<h3 id="scopedVariables">Trabalhando com Variáveis de Escopos em Aplicações Web</h3>
<div class="paragraph">
<p>Quando se trabalha com a tecnologia JSP/Servlet, há quatro objetos de escopo disponíveis no realm da aplicação. A tecnologia JSP implementa <em>objetos implícitos</em> que permitem acessar classes definidas pela API do Servlet.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Escopo</th>
<th class="tableblock halign-left valign-top">Definição</th>
<th class="tableblock halign-left valign-top">Classe Servlet</th>
<th class="tableblock halign-left valign-top">Objeto Implícito JSP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Aplicação</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memória global para uma aplicação web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/ServletContext.html">+javax.servlet.ServletContext+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>applicationScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sessão</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados específicos para uma sessão de usuário</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">+javax.servlet.http.HttpSession+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Solicitação</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados específicos para uma solicitação de servidor individual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpServletRequest.html">+javax.servlet.HttpServletRequest+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Página</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dados que são válidos somente no contexto de uma única página (somente JSPs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[n/d]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pageScope</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Se abrir o arquivo <code>category.jsp</code> do projeto no editor, verá que as expressões EL incluem diversas variáveis de escopo, incluindo <code>${categories}</code>, <code>${selectedCategory}</code> e <code>${categoryProducts}</code>. A variável <code>${categories}</code> é uma aplicação de escopo, definida no método <code>init</code> do <code>ControllerServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// store category list in servlet context
getServletContext().setAttribute("categories", categoryFacade.findAll());</code></pre>
</div>
</div>
<div class="paragraph">
<p>As outras duas, <code>${selectedCategory}</code> e <code>${categoryProducts}</code>, são inseridas no escopo da sessão da aplicação a partir do <code>ControllerServlet</code>. Por exemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// place selected category in session scope
session.setAttribute("selectedCategory", selectedCategory);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> Se você estiver continuando de unidades anteriores do tutorial, provavelmente notará que <code>${selectedCategory}</code> e <code>${categoryProducts}</code> foram originalmente colocadas no escopo da solicitação. Em unidades anteriores, isso não era problema, mas considere agora o que acontece se um usuário clicar no botão "adicionar ao carrinho" na página de uma categoria. O servidor responde a uma solicitação <code>addToCart</code> retornando a página de categoria em exibição no momento. Portanto, é preciso saber a <code>selectedCategory</code> e a <code>categoryProducts</code> pertencentes à categoria selecionada. Em vez de estabelecer essas informações para cada solicitação, você as coloca no escopo da sessão de uma solicitação de <code>category</code> para que sejam mantidas em várias solicitações e possam ser acessadas quando necessário. Além disso, examine a funcionalidade fornecida pela página do carrinho. (Uma descrição funcional é <a href="#cartPage">fornecida abaixo</a>.) O botão "continuar comprando" retorna o usuário à categoria exibida anteriormente. Novamente, as variáveis <code>selectedCategory</code> e <code>categoryProducts</code> são necessárias.</p>
</div>
<div class="paragraph">
<p>Ao fazer referência às variáveis do escopo em uma expressão EL, você não precisa especificar o escopo da variável (desde que você não tenha duas variáveis com o mesmo nome em escopos diferentes). O mecanismo JSP verifica todos os quatro escopos e retorna a primeira variável correspondente que encontrar. Em <code>category.jsp</code> por exemplo, a expressão:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p>é uma abreviação para:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${sessionScope.categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">Para obter mais informações, consulte os recursos a seguir:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/blueprints/guidelines/designing_enterprise_applications_2e/web-tier/web-tier5.html#1079198">Criando Aplicações Corporativas com a Plataforma J2EE: Escopos de Estado</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnafo.html">Compartilhando Informações &gt; Usando Objetos de Escopo</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnahq.html#bnaij">Linguagem de Expressão Unificada &gt; Objetos Implícitos</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debug">Examinando Dados de Sessão com o Depurador Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comece explorando como a aplicação se comporta durante o runtime. Utilize o depurador do IDE para avançar pelo código e examinar como a <code>HttpSession</code> é criada e como outros objetos podem ser colocados no escopo da sessão para serem recuperados em um ponto mais adiante.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra o <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">snapshot do projeto</a> para esta unidade do tutorial no IDE. Clique no botão Abrir Projeto (<span class="image"><img src="images/open-project-btn.png" alt="open project btn"></span>) e use o assistente para navegar para o local em seu computador em que você fez download do projeto. Se estiver prosseguindo de uma <a href="entity-session.html">unidade de tutorial anterior</a>, observe que este snapshot do projeto inclui um novo pacote <code>cart</code>, que contém as classes <code>ShoppingCart</code> e <code>ShoppingCartItem</code>. E note também que os seguintes arquivos foram modificados:</p>
<div class="ulist">
<ul>
<li>
<p><code>WEB-INF/web.xml</code></p>
</li>
<li>
<p><code>css/affablebean.css</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/header.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/footer.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/view/cart.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/category.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/checkout.jsp</code></p>
</li>
<li>
<p><code>controller/ControllerServlet</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Execute o projeto (<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>) para garantir que esteja configurado corretamente com seu banco de dados e servidor de aplicações.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Se receber uma mensagem de erro ao executar o projeto, consulte novamente as <a href="setup.html">instruções de configuração</a>, que descrevem como preparar um banco de dados e estabelecer conectividade entre o IDE, o GlassFish e o MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Teste a funcionalidade da aplicação no browser. Se estiver prosseguindo diretamente da <a href="entity-session.html">unidade anterior do tutorial</a>, notará as seguintes melhorias.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_página_de_categoria">página de categoria</h3>
<div class="ulist">
<ul>
<li>
<p>Clicar em "adicionar ao carrinho" ativa, pela primeira vez, o carrinho de compras e os widgets "avançar para check-out" para serem exibidos no cabeçalho.</p>
</li>
<li>
<p>Clicar em "adicionar ao carrinho" resulta em uma atualização no número de itens do carrinho no widget do carrinho de compras do cabeçalho.</p>
</li>
<li>
<p>Clicar em "exibir carrinho" resulta na exibição da página do carrinho.</p>
</li>
<li>
<p>Clicar em "avançar para check-out" resulta na exibição da página de check-out.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/category-page.png" alt="category page">
</div>
<div class="title">Figure 2. A página Categoria inclui a funcionalidade do carrinho de compras</div>
</div>
</div>
<div class="sect2">
<h3 id="cartPage">página do carrinho</h3>
<div class="ulist">
<ul>
<li>
<p>Clicar em "limpar carrinho" resulta no esvaziamento dos itens do carrinho de compras.</p>
</li>
<li>
<p>Clicar em "continuar comprando" resulta em um retorno à categoria exibida previamente.</p>
</li>
<li>
<p>Clicar em "avançar para check-out" resulta na exibição da página de check-out.</p>
</li>
<li>
<p>Inserir um número (1 a 99) no campo de quantidade de itens e, em seguida, clicar em "atualizar" resulta no recálculo do preço total para o item e do subtotal.</p>
</li>
<li>
<p>Inserir zero no campo de quantidade de um item e, em seguida, clicar em "atualizar" resulta na remoção do item da tabela exibida.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-page.png" alt="cart page">
</div>
<div class="title">Figure 3. A página Carrinho inclui a funcionalidade do carrinho de compras</div>
</div>
</div>
<div class="sect2">
<h3 id="_página_de_check_out">página de check-out</h3>
<div class="ulist">
<ul>
<li>
<p>Clicar em "exibir carrinho" resulta na exibição da página do carrinho.</p>
</li>
<li>
<p>Clicar em "submeter compra" resulta na exibição da página de confirmação (sem dados específicos do usuário).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/checkout-page.png" alt="checkout page">
</div>
<div class="title">Figure 4. A página Check-out inclui a funcionalidade do carrinho de compras</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Utilize a caixa de diálogo Ir para Arquivo para abrir o <code>ControllerServlet</code> no editor. Pressione Alt-Shift-O (Ctrl-Shift-O no Mac), digite &#8220;Controller&#8221; na caixa de diálogo e clique em OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file-dialog.png" alt="go to file dialog">
</div>
<div class="title">Figure 5. Use a caixa de diálogo Ir para Arquivo para abrir rapidamente recursos do projeto no editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Defina um ponto de interrupção no método <code>doPost</code> na linha que cria um objeto <code>HttpSession</code> (linha 150). Para definir um ponto de interrupção, clique na margem esquerda do editor.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint.png" alt="breakpoint">
</div>
<div class="title">Figure 6. Clique na margem esquerda do editor para definir pontos de interrupção</div>
</div>
<div class="paragraph">
<p>Para alternar números de linhas para o editor, clique com o botão direito do mouse na margem esquerda e selecione Exibir Número de Linhas.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Execute o depurador. Clique no botão Depurar Projeto (<span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span>) na barra de ferramentas principal do IDE. O GlassFish Server será iniciado (ou reiniciado, se já estiver sendo executado) e abrirá um soquete no número da porta de depuração. A página de boas-vindas da aplicação será aberta no browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>É possível exibir e modificar o número da porta do depurador a partir da janela Servidores (Ferramentas &gt; Servidores). Selecione a guia Java para o servidor que está utilizando. Especifique o número da porta no campo "Endereço a ser utilizado" em Definições de Depuração.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Quando a página de boas-vindas da aplicação for exibida no browser, clique em qualquer imagem da categoria para navegar para a página da categoria. Lembre-se de que quando você clicar no botão "adicionar ao carrinho" uma solicitação <code>addToCart</code> será enviada ao servidor:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como você deve se lembrar de <a href="page-views-controller.html#controller">Preparando as Views de Página e o Servlet do Controlador</a>, o método <code>doPost</code> de <code>ControllerServlet</code> trata solicitações para o padrão de URL <code>/addToCart</code>. Você poderá, portanto, esperar que quando um usuário clica no botão "adicionar ao carrinho", o método <code>doPost</code> é chamado.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Clique em "adicionar ao carrinho" para qualquer produto na página da categoria. Volte para o IDE e note que o depurador é suspenso no ponto de interrupção.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint-suspended.png" alt="breakpoint suspended">
</div>
<div class="title">Figure 7. O depurador é suspenso em pontos de interrupção no editor</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Posicione o cursor na chamada para <code>getSession()</code> e pressione Ctrl-Espaço para chamar a documentação do Javadoc.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javadoc-getsession.png" alt="javadoc getsession">
</div>
<div class="title">Figure 8. Pressione Ctrl-Espaço para chamar a documentação do Javadoc</div>
</div>
<div class="paragraph">
<p>De acordo com a documentação, a <code>getSession()</code> retorna a <code>HttpSession</code> atualmente associada à solicitação e, caso não exista nenhuma sessão, o método cria um novo objeto de sessão.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aproveitando_o_suporte_do_javadoc_do_ide">Aproveitando o Suporte do Javadoc do IDE</h3>
<div class="paragraph">
<p>O IDE fornece suporte incorporado para Javadoc para o desenvolvimento do Java EE. O IDE agrega a especificação da API do Java EE 6, que pode ser aberta em um browser externo selecionando Ajuda &gt; Referências do Javadoc &gt; Java EE 6.</p>
</div>
<div class="paragraph">
<p>O IDE inclui também várias outras funcionalidades que possibilitam um fácil acesso à documentação da API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Janela Javadoc:</strong> Selecione Janela &gt; Outros &gt; Javadoc. A janela Javadoc será aberta na região inferior do IDE e exibirá a documentação da API relevante à localização do seu cursor no editor.</p>
</li>
<li>
<p><strong>Pesquisa Javadoc por Índice:</strong> Selecione Ajuda &gt; Pesquisa Javadoc por Índice (Shift-F1; fn-Shift-F1 no Mac). Digite o nome da classe que está procurando e, em seguida, selecione uma classe nos resultados listados. A descrição completa da classe a partir da Especificação da API será exibida no painel inferior da janela.</p>
</li>
<li>
<p><strong>Popup da documentação no editor:</strong> a documentação Javadoc é exibida em uma janela de popup ao pressionar Ctrl-Espaço ou em um determinado elemento no editor. Você pode clicar no botão Navegador Externo (<span class="image"><img src="images/external-browser-btn.png" alt="external browser btn"></span>) para abrir a documentação no seu browser. Se desejar utilizar as teclas Ctrl-Espaço somente para a funcionalidade autocompletar código, poderá desativar o popup da documentação abrindo a janela Opções (Ferramentas &gt; Opções; NetBeans &gt; Preferências no Mac) e, em seguida, selecionando Editor &gt; Autocompletar Código. Desmarque a opção "Janela de Popup Automático da Documentação".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ao documentar seu próprio trabalho, considere a adição de comentários Javadoc às suas classes e métodos. Abra a classe <code>ShoppingCart</code> e examine os comentários Javadoc adicionados aos métodos da classe. Os comentários Javadoc são marcados pelos delimitadores <code>/** &#8230;&#8203; */</code>. Por exemplo, o método <code>addItem</code> tem o seguinte comentário antes da sua assinatura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">/**
 * Adds a &lt;code&gt;ShoppingCartItem&lt;/code&gt; to the &lt;code&gt;ShoppingCart&lt;/code&gt;'s
 * &lt;code&gt;items&lt;/code&gt; list. If item of the specified &lt;code&gt;product&lt;/code&gt;
 * already exists in shopping cart list, the quantity of that item is
 * incremented.
 *
 * @param product the &lt;code&gt;Product&lt;/code&gt; that defines the type of shopping cart item
 * @see ShoppingCartItem
 */
public synchronized void addItem(Product product) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isso lhe permite (assim como aos outros que estejam trabalhando no projeto) exibir a documentação Javadoc no método. Para demonstrar, abra o Navegador (Ctrl-7; ⌘-7 no Mac) e passe o mouse sobre o método <code>addItem</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javadoc-additem.png" alt="javadoc additem">
</div>
<div class="title">Figure 9. Passe o mouse sobre métodos no Navegador para exibir documentação do Javadoc</div>
</div>
<div class="paragraph">
<p>Você também pode utilizar o IDE para gerar um conjunto de páginas HTML do Javadoc. Na janela Projetos, clique com o botão direito do mouse no nó do projeto e selecione Gerar Javadoc. O IDE gerará o Javadoc na pasta <code>dist/javadoc</code> no diretório do projeto e abrirá a página do índice no browser.</p>
</div>
<div class="paragraph">
<p>Para obter mais informações sobre o Javadoc, consulte os recursos a seguir:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Home Page Oficial da Ferramenta Javadoc</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">Como Escrever Comentários Doc na Ferramenta Javadoc</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Passe o mouse sobre a variável <code>session</code>. Observe que o depurador é suspenso na linha <em>está prestes a ser executado.</em> O valor retornado por <code>getSession()</code> ainda não foi salvo na variável de <code>session</code> e você verá uma popup informando que "` session` não é uma variável conhecida "no contexto atual".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-variable.png" alt="session variable">
</div>
<div class="title">Figure 10. Passe o mouse sobre variáveis e expressões para determinar seus valores atuais</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Clique no botão Fazer Step Over (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>) na barra de ferramentas do depurador, localizada acima do editor. A linha será executada e o depurador passará para a próxima linha do arquivo.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Passe novamente o mouse sobre a variável <code>session</code>. Agora você poderá ver o valor definido no momento para a variável <code>session</code>.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/session-variable-set.png"><img src="images/session-variable-set.png" alt="session variable set"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>No NetBeans 6.9, você pode clicar no ponteiro cinza (<span class="image"><img src="images/grey-pointer.png" alt="grey pointer"></span>) no popup para expandir uma lista de valores de variáveis contidos no elemento destacado.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Clique o botão Fazer Step Over (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>) (F8; fn-F8 no Mac) para chegar à instrução <code>if</code> (linha 154). Como você acabou de clicar no botão "adicionar ao carrinho" no browser, deve sabe que a expressão <code>userPath.equals("/addToCart)</code> deverá ser avaliada como <code>true</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Realce a expressão <code>userPath.equals("/addToCart")</code> (clicando com o mouse enquanto mantém a tecla Ctrl pressionada). Desta vez você verá um popup que indica o valor da expressão que foi realçada.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/expression.png" alt="expression">
</div>
<div class="title">Figure 11. Destaque as expressões para determinar seus valores atuais</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Pressione F8 (fn-F8 no Mac) para passar para a próxima linha (linha 158). A aplicação foi criada para que o objeto <code>ShoppingCart</code> para a sessão do usuário seja criado somente quando o usuário adicionar um item ao carrinho pela primeira vez. Já que esta é a primeira vez que a solicitação <code>addToCart</code> foi recebida nesta sessão de depuração, pode-se esperar que o objeto <code>cart</code> seja igual a <code>null</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-null.png" alt="cart null">
</div>
<div class="title">Figure 12. O objeto carrinho não existe, até que o usuário adicione item ao carrinho de compras</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Pressione F8 (fn-F8 no Mac) para passar à próxima linha (linha 160). Depois, na linha 160, onde o objeto <code>ShoppingCart</code> é criado, clique no botão Fazer Step Into (<span class="image"><img src="images/step-into-btn.png" alt="step into btn"></span>). O depurador entra no método que está sendo chamado. Neste caso, você será levado diretamente ao construtor do <code>ShoppingCart</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-constructor.png" alt="cart constructor">
</div>
<div class="title">Figure 13. Fazer step into nos métodos para seguir a execução de runtime para outras classes</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Pressione Ctrl-Tab para voltar ao <code>ControllerServlet</code>. Observe que o IDE fornece um Emblema (<span class="image"><img src="images/call-stack-badge.png" alt="call stack badge"></span>) de Pilha de Chamada na linha 160, indicando que o depurador está suspenso temporariamente em algum lugar em um método mais no início da pilha de chamada.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Pressione Alt-Shift-3 (Ctrl-Shift-3 no Mac) para abrir a janela Pilha de Chamada do IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Pressione F8 (fn-F8 no Mac) para continuar avançando pelo código. Quando o depurador conclui o construtor <code>ShoppingCart</code>, você é levado de volta ao <code>ControllerServlet</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A linha 161 do <code>ControllerServlet</code> vincula o objeto <code>cart</code> recém-criado à sessão.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para testemunhar isso, abra a janela Variáveis do depurador. Escolha Janela &gt; Depurando &gt; Variáveis ou pressione Alt-Shift-1 (Ctrl-Shift-1 no Mac).</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-win-session.png"><img src="images/variables-win-session.png" alt="variables win session"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Se expandir o nó sessão &gt; sessão &gt; atributos, você poderá exibir os objetos que estão vinculados à sessão. Na imagem acima há dois itens vinculados atualmente à sessão (realçados). Eles são <code>selectedCategory</code> e <code>categoryProducts</code>, instanciados no <code>ControllerServlet</code>, nas linhas 83 e 89, respectivamente. Os dois itens foram vinculados anteriormente, quando você clicou na imagem de uma categoria, e o <code>ControllerServlet</code> processou a solicitação da página da categoria.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Pressione F8 (fn-F8 no Mac) para executar a linha 161. O objeto <code>cart</code> será vinculado à sessão e a janela Variáveis será atualizada para exibir as alterações. Na janela Variáveis, note que agora a sessão contém três atributos, sendo o terceiro o objeto <code>ShoppingCart</code> recém-inicializado (realçado abaixo).</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-win-session-cart.png"><img src="images/variables-win-session-cart.png" alt="variables win session cart"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Até agora não "provamos" que a sessão, como listada na janela Variáveis, representa uma <code>HttpSession</code>. Como mencionado anteriormente, a <code>HttpSession</code> é na verdade uma interface, portanto, quando falamos sobre um objeto`HttpSession`, ou sobre um objeto de sessão, estamos nos referindo a qualquer objeto que implementa a interface <code>HttpSession</code>. Na janela Variáveis, se você posicionar o cursor sobre &#8220;session&#8221;, um popup será exibido indicando que a variável representa um objeto <code>HttpSession</code>. O tipo <code>StandardSessionFacade</code>, como exibido, é a classe interna que o GlassFish utiliza para implementar a interface <code>HttpSession</code>. Se você estiver familiarizado com o Tomcat e estiver intrigado com os caminhos &#8220;org.apache.catalina&#8221; que aparecem na coluna Valor, é porque o contêiner web/servlet do GlassFish é, na verdade, um derivado do contêiner Apache Tomcat.</p>
</div>
<div class="paragraph">
<p>Um novo <code>ShoppingCart</code> é adicionado à sessão e a solicitação continua a ser processada. Para concluir a implementação da funcionalidade "adicionar ao carrinho", são realizadas as seguintes ações:
* o ID do produto selecionado é recuperado da solicitação (linha 165)
* um objeto <code>Product</code> é criado utilizando o ID (linha 169)
* um novo <code>ShoppingCartItem</code> é criado utilizando o <code>product</code> (linha 170)
* o <code>ShoppingCartItem</code> é adicionado à lista de <code>itens</code> do <code>ShoppingCart</code> (linha 170)</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Pressione F8 (fn-F8 no Mac) para continuar avançando pelo código, ao mesmo tempo ciente das quatro ações listadas acima. Pause quando o depurador for suspenso na linha 170.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Crie um watch na sessão. Isso lhe permitirá exibir valores contidos na sessão ao fazer step into no método <code>addItem</code> na próxima etapa. Clique com o botão direito do mouse na sessão na janela Variáveis e selecione Criar Watch Fixo.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-watch.png" alt="create watch">
</div>
<div class="title">Figure 14. Crie controles em variáveis, à medida que percorre o código em uma sessão de depuração</div>
</div>
<div class="paragraph">
<p>Como alternativa, você pode colocar o cursor na variável <code>session</code> no editor e, em seguida, clicar com o botão direito do mouse e selecionar Novo Watch. A caixa de diálogo Novo Watch permite que você especifique variáveis ou expressões para watch continuamente ao depurar uma aplicação. (No caso de expressões, realce primeiro a expressão e, em seguida, clique com o botão direito do mouse e selecione Novo Watch.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-watch-dialog.png" alt="new watch dialog">
</div>
<div class="title">Figure 15. Clique com o botão direito do mouse nas variáveis e expressões no editor e escolha Novo Watch</div>
</div>
<div class="paragraph">
<p>Um novo watch será criado na variável <code>session</code> e em todas as variáveis que ela contiver. O watch é visível na janela Watches (Janela &gt;Depuração &gt;Watches) ou, se você alternar o botão Watches (<span class="image"><img src="images/watch-btn.png" alt="watch btn"></span>) na margem esquerda da janela Variáveis, ele será exibido na linha superior da janela Variáveis.</p>
</div>
<div class="paragraph">
<p>O depurador lhe permite ficar atento às variáveis enquanto percorre o código. Isso pode ser útil, por exemplo, se você quiser seguir as alterações de valores de variáveis específicas (e não quiser ter que analisar toda a lista apresentada na janela Variáveis em cada etapa) ou se fizer step into temporariamente em uma classe que não contenha as variáveis que lhe interessam.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Clique na botão Fazer Step Into para (<span class="image"><img src="images/step-into-btn.png" alt="step into btn"></span>) fazer step into no método <code>addItem</code> do <code>ShoppingCart</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Percorra o método <code>addItem</code> até chegar na linha 53. Como o Javadoc atesta, <code>addItem</code> <em>"adiciona um <code>ShoppingCartItem</code> à lista de <code>items</code> do <code>ShoppingCart</code>. Se o item do <code>product</code> especificado já existe no carrinho de compra, a quantidade desse item é aumentada."</em></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Examine a variável <code>session</code> na qual você criou um watch (<a href="#step21">etapa 21</a> acima). A instrução <code>items.add(scItem)</code> na linha 51 adicionou o novo <code>ShoppingCartItem</code> à lista de <code>items</code> no <code>ShoppingCart</code>. Isso fica evidente ao entrar no terceiro atributo (ex., a variável <code>cart</code>) contida na sessão.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-window-add-item.png"><img src="images/variables-window-add-item.png" alt="variables window add item"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Nesta etapa, você pode ver como uma <code>HttpSession</code> é criada para a solicitação, como um objeto <code>ShoppingCart</code> é criado e anexado à sessão e como um <code>ShoppingCartItem</code> é criado com base na escolha de produto do usuário e adicionado à lista de <code>Items</code> do <code>ShoppingCart</code>. A única ação remanescente é encaminhar a solicitação à view <code>category.jsp</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Abra o fragmento JSP do cabeçalho (<code>header.jsp</code>) no editor e coloque um ponto de interrupção na linha 86. Essa linha contém a instrução EL no widget do carrinho de compras que exibe o número de itens do carrinho.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint-jsp.png" alt="breakpoint jsp">
</div>
<div class="title">Figure 16. Você pode suspender o depurador nas páginas JSP</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Clique no botão Continuar ( <span class="image"><img src="images/continue-btn.png" alt="continue btn"></span> ) na barra de ferramentas do depurador. O depurador continua agindo até que a execução seja concluída ou até atingir outro ponto de interrupção. Nesse caso, o depurador é suspenso na linha 86 no fragmento JSP do cabeçalho.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> para suspender o depurador em uma página JSP, é necessário definir um ponto de interrupção. Por exemplo, quando o <code>ControllerServlet</code> encaminha a solicitação à view apropriada, o depurador não será suspenso automaticamente dentro da página JSP.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Abra a janela Variáveis (Alt-Shift-1; Ctrl-Shift-1 no Mac), se ainda não estiver aberta. Diferente do que acontece com as classes Java, o depurador <em>não</em> fornece dicas de ferramenta quando o mouse é posicionado sobre as variáveis ou expressões em uma página JSP. Entretanto, a janela Variáveis lhe permitirá determinar os valores das variáveis ao percorrer o código. Então, onde você pode encontrar o valor para <code>${cart.numberOfItems}</code>?</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="28">
<li>
<p>Na janela Variáveis, amplie o nó Objetos implícitos &gt; pageContext &gt; sessão &gt; sessão &gt; atributos. Isso permite o acesso ao objeto de sessão, como o que foi visto anteriormente ao trabalhar com o <code>ControllerServlet</code>. Na verdade, você pode notar que a sessão na qual um watch foi criado na etapa 21 acima indica o mesmo objeto. Aqui você pode verificar se o valor de <code>${cart.numberOfItems}</code> é igual a &#8220;1&#8221;.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-window-number-of-items.png"><img src="images/variables-window-number-of-items.png" alt="variables window number of items"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Maximize a janela Variáveis, ou qualquer janela no IDE, clicando com o botão direito do mouse no cabeçalho da janela e, em seguida, selecionando Maximizar Janela (Shift-Esc).</p>
</div>
<div class="paragraph">
<p>O depurador lhe dá acesso ao objeto implícito <code>pageContext</code>. <code>pageContext</code> representa o contexto da página JSP e oferece acesso direto aos vários objetos, incluindo os objetos <code>HttpServletRequest</code>, <code>HttpSession</code> e <code>ServletContext</code>. Para obter mais informações, consulte o <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bnahq.html#bnaij">Tutorial do Java EE 5: Objetos Implícitos</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="29">
<li>
<p>Clique no botão Finalizar Sessão (<span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span>). O runtime finaliza a execução e a sessão de depuração é encerrada. O browser exibe uma página de categoria totalmente renderizada e você poderá ver que o widget carrinho de compras no cabeçalho da página contém um item.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Esperamos que agora você se sinta confortável ao utilizar o depurador do IDE, não somente para examinar seu projeto quando ele apresentar um comportamento inesperado, mas também como uma ferramenta que o ajuda a se familiarizar mais com o código. Outros botões úteis na barra de ferramentas do depurador incluem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(<span class="image"><img src="images/step-out.png" alt="step out"></span>) <strong>Fazer Step Out:</strong> você sai da chamada do método atual. Execute e remova o método de chamada superior da pilha de chamadas.</p>
</li>
<li>
<p>(<span class="image"><img src="images/run-to-cursor.png" alt="run to cursor"></span>) <strong>Executar até o Cursor:</strong> executa até a linha na qual o cursor está posicionado.</p>
</li>
<li>
<p>(<span class="image"><img src="images/apply-code-changes.png" alt="apply code changes"></span>) <strong>Aplicar Alterações de Código:</strong> depois de editar um arquivo, você pode pressionar este botão para que o arquivo seja recompilado e as alterações levadas em conta na sessão de depuração.</p>
</li>
<li>
<p>(<span class="image"><img src="images/step-over-expression.png" alt="step over expression"></span>) <strong>Fazer Step Over da Expressão:</strong> permite que você exiba os parâmetros de entrada e os valores de saída resultantes de cada chamada de método dentro de uma expressão. Você pode inspecionar os valores de saída do método anterior e os parâmetros de entrada para o próximo método na janela Variáveis Locais. Quando não há mais nenhuma chamada de método, Fazer Step Over da Expressão se comporta como o comando Fazer Step Over (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-track">Analisando as Opções de Rastreamento da Sessão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Há três maneiras convencionais de rastrear as sessões entre o cliente e o servidor. Com certeza a mais comum é com cookies. A reescrita de URL pode ser aplicada na ocasião em que os cookies não estiverem suportados ou desativados. Campos de forms ocultos também podem ser utilizados como uma maneira de "manter o estado" sobre várias solicitações, mas estão limitados ao uso dentro dos forms.</p>
</div>
<div class="paragraph">
<p>O projeto <code>AffableBean</code> inclui um exemplo do método de campo oculto nas duas páginas, da categorias e do carrinho. Os botões "adicionar ao carrinho" e "atualizar", que são exibidos para os itens de produtos, contêm um campo oculto que retransmite ID do produto para o servidor quando o botão é clicado. Se abrir a página <code>cart.jsp</code> no editor, você verá que as tags <code>&lt;form&gt;</code> contêm um campo oculto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="updateCart" method="post"&gt;
    *&lt;input type="hidden"
           name="productId"
           value="${product.id}"&gt;*
    ...
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dessa forma, o ID do produto é enviado como um parâmetro de solicitação que o servidor utiliza para identificar o item dentro do carrinho do usuário, cuja quantidade precisa ser modificada.</p>
</div>
<div class="paragraph">
<p>A API do Servlet fornece um mecanismo de alto nível para o gerenciamento de sessões. Essencialmente, ela cria e passa um cookie entre o cliente e o servidor com cada ciclo de resposta da solicitação. Se o browser do cliente não aceitar cookies, o mecanismo do servlet será revertido automaticamente para a reescrita de URL. Os dois exercícios a seguir demonstram essa funcionalidade.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-monitor">Analisando a Comunicação Cliente-Servidor com o Monitor HTTP</a></p>
</li>
<li>
<p><a href="#url-rewrite">Mantendo Sessões com a Reescrita de URL</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="http-monitor">Analisando a Comunicação Cliente-Servidor com o Monitor HTTP</h3>
<div class="paragraph">
<p>Como default, o mecanismo do servlet utiliza cookies para manter e identificar sessões entre as solicitações. Um número alfanumérico aleatório é gerado para cada objeto de sessão, que serve como um identificador exclusivo. Esse identificador é passado como um cookie &#8220;JSESSIONID&#8221; ao cliente. Quando o cliente faz uma solicitação, o mecanismo do servlet lê o valor do cookie <code>JSESSIONID</code> para determinar a sessão à qual a solicitação pertence.</p>
</div>
<div class="paragraph">
<p>Para demonstrar isso, nós utilizaremos o depurador em conjunto com o monitor HTTP do IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Comece com a ativação do monitor HTTP para o servidor que está utilizando. Selecione Ferramentas &gt; Servidores. Na coluna à esquerda da janela Servidores, selecione o servidor que está utilizando (GlassFish). Em seguida, na coluna principal, selecione a opção Ativar Monitor HTTP.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/servers-win-http-monitor.png" alt="servers win http monitor">
</div>
<div class="title">Figure 17. Selecione a opção Ativar Monitor HTTP para ativar o Monitor HTTP</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Se o servidor já estiver sendo executado, será necessário reiniciá-lo. No entanto, como pretende usar o depurador e executar o depurador reinicia o servidor para se comunicar em uma porta diferente, simplesmente clique no botão Depurar Projeto (<span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span>) no na barra de ferramentas principal do IDE. Quando o servidor é reiniciado, uma sessão de depuração é iniciada e a página de boas-vindas da aplicação é aberta no browser. O monitor HTTP é exibido na parte inferior do IDE.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/http-monitor.png" alt="http monitor">
</div>
<div class="title">Figure 18. O Monitor HTTP é exibido por default na região inferior do IDE</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Clique no registro AffableBean na coluna à esquerda (como mostrado na imagem acima). Quando você seleciona registros na coluna à esquerda, a coluna à direita (ex., principal) será atualizada para exibir os dados correspondentes. Na imagem acima, a guia Solicitação exibe o URI solicitado ( <code>/AffableBean/</code>), o método HTTP ( <code>GET</code>) e indica que nenhuma string de consulta foi enviada com a solicitação.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Selecione a guia Sessão. Note que há uma instrução: "a sessão foi criada como resultado desta solicitação.&amp;quot Isso se deve ao fato de o servidor ter enviado um cabeçalho <code>Set-Cookie</code> para o cookie`JSESSIONID` na sua resposta. Observe também que o novo ID da sessão está listado em "Propriedades da sessão". Como será mostrado mais tarde, o ID da sessão é o valor do cookie <code>JSESSIONID</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-tab.png" alt="session tab">
</div>
<div class="title">Figure 19. Detalhes da sessão são exibidos na guia Sessão no Monitor HTTP</div>
</div>
<div class="paragraph">
<p>Talvez esteja pensando como um objeto de sessão foi criado de uma solicitação para a página de boas-vindas do site. Afinal, o <code>ControllerServlet</code> não trata a solicitação inicial para <code>/AffableBean/</code> e em nenhum lugar essa solicitação encontra <code>getSession()</code>. Ou encontra? Lembre-se de que as páginas JSP são compiladas em servlets na implantação. Depois de ter implantado o projeto no servidor, você poderá, na verdade, utilizar o IDE para exibir o servlet compilado do JSP no seu servidor.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Na janela Projetos, clique com o botão direito do mouse no arquivo <code>index.jsp</code> e selecione Exibir Servlet. Será aberto um arquivo <code>index_jsp.java</code> no editor. Esse é o servlet que foi compilado automaticamente a partir da página <code>index.jsp</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Execute uma pesquisa no arquivo por <code>getSession</code>. Pressione Ctrl-F (⌘-F no Mac), digite &#8220;getSession&#8221; na barra de pesquisa e, em seguida, pressione Enter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ctrl-F (⌘-F no Mac) é um atalho do teclado para Editar &gt; Localizar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/get-session.png" alt="get session">
</div>
<div class="title">Figure 20. O método getSession existe no servidor compilado da página JSP</div>
</div>
<div class="paragraph">
<p>O método <code>getSession</code> foi, na verdade, chamado. A razão para isso é que as páginas JSP incluem, por default, o objeto implícito <code>pageContext.session</code>. Se quisesse desativar esse comportamento, você poderia ter adicionado a diretiva a seguir à parte superior de um arquivo JSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;%@page session="false" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>e o método <code>getSession</code> no servlet compilado seria removido.</p>
</div>
<div class="paragraph">
<p>Para encontrar a localização do servlet compilado no servidor, você pode passar o mouse sobre a guia do nome do servlet acima do editor. Um popup exibe o caminho o caminho para o arquivo no computador.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>No browser, selecione uma categoria e, em seguida, adicione um item ao seu carrinho. Volte para o IDE. Observe que o depurador é suspenso no ponto de interrupção no <code>ControllerServlet</code> que foi definido anteriormente (linha 150). Todos os pontos de interrupção são lembrados entre as sessões. Para remover o ponto de interrupção, você poderia clicar no emblema do ponto de interrupção (<span class="image"><img src="images/breakpoint-badge.png" alt="breakpoint badge"></span>) na margem esquerda do editor. No entanto, como há vários pontos de interrupção já definidos no projeto, abra a janela Pontos de interrupção do depurador (Janela &gt; Depuração &gt; Pontos de Interrupção).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoints-window.png" alt="breakpoints window">
</div>
<div class="title">Figure 21. Exibir todos os pontos de interrupção em seu projeto na janela Pontos de interrupção</div>
</div>
<div class="paragraph">
<p>Na janela Pontos de interrupção, você pode exibir chamar ações em todos os pontos de interrupção definidos nos projetos abertos no IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Clique com o botão direito do mouse no ponto de interrupção definido em <code>header.jspf</code> e selecione Deletar. Em seguida, clique com o botão direito do mouse no ponto de interrupção definido no <code>ControllerServlet</code> e selecione Desativar. (Você irá reabilitá-lo mais tarde neste exercício.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Clique no botão Continuar (<span class="image"><img src="images/continue-btn.png" alt="continue btn"></span>). A execução da solicitação é finalizada e a página da categoria será exibida no browser com um item adicionado ao carrinho.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>No Monitor HTTP, procure a solicitação <code>addToCart</code> na coluna esquerda e, em seguida, selecione-a para exibir os detalhes na coluna principal.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Clique no botão Classificação Ascendente (<span class="image"><img src="images/ascending-sort-btn.png" alt="ascending sort btn"></span>) para que os registros mais recentes sejam listados na parte superior.</p>
</div>
<div class="paragraph">
<p>Na guia Solicitação, observe o URI solicitado (<code>/AffableBean/addToCart</code>), o método HTTP (<code>POST</code>) e os parâmetros da solicitação (<code>productId</code> e <code>submit</code>).</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/http-monitor-add-to-cart.png"><img src="images/http-monitor-add-to-cart.png" alt="http monitor add to cart"></a>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Selecione a guia Cookies. Aqui você verá que existe um cookie chamado <code>JSESSIONID</code> e que foi enviado do cliente para o servidor. Observe que o valor para o cookie é igual ao do ID da Sessão exibido na guia Sessão.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cookies-tab.png" alt="cookies tab">
</div>
<div class="title">Figure 22. Cookies são exibidos na guia Cookies no Monitor HTTP</div>
</div>
<div class="paragraph">
<p>Da mesma forma, se clicar na guia Cabeçalho, verá o cookie listado, já que &#8220;Cookie&#8221; é um cabeçalho da solicitação enviado pelo cliente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/headers-tab.png" alt="headers tab">
</div>
<div class="title">Figure 23. Cookies são exibidos na guia Cookies no Monitor HTTP</div>
</div>
<div class="paragraph">
<p>Consulte a <a href="http://en.wikipedia.org/wiki/List_of_HTTP_headers">Lista de cabeçalhos HTTP</a> da Wikipedia para obter mais informações sobre cabeçalhos de solicitações e de respostas.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Selecione a guia Sessão. Há uma instrução que indica: "A sessão existiu antes desta solilcitação". Note também que o atributo <code>cart</code> é listado em "Atributos de sessão depois da solicitação". Isso faz sentido, já que sabemos que o objeto <code>cart</code> está vinculado à sessão quando a solilcitação <code>addToCart</code> é processada pela primeira vez.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-tab-add-to-cart.png" alt="session tab add to cart">
</div>
<div class="title">Figure 24. Atributos de sessão são exibidos na guia Sessão no Monitor HTTP</div>
</div>
<div class="paragraph">
<p>Nas próximas etapas, localize o ID da sessão e o cookie <code>JSESSIONID</code> na janela Variáveis.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Reative o ponto de interrupção definido anteriormente no <code>ControllerServlet</code>. Pressione Alt-Shift-5 (Ctrl-Shift-5 no Mac) para abrir a janela Pontos de Interrupção e, em seguida, clique na caixa de seleção ao lado da entrada do ponto de interrupção para reativá-lo.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>No browser, clique no botão "adicionar ao carrinho" para um dos produtos listados.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Alterne para o IDE e note que o depurador está suspenso no ponto de interrupção definido no <code>ControllerServlet</code>. Clique no botão Fazer Step Over (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>) para que a variável <code>session</code> seja atribuída ao objeto da sessão.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Abra a janela Variáveis (Alt-Shift-1; Ctrl-Shift-1 no Mac) e expanda sessão &gt; sessão. Você encontrará o ID da sessão listado como o valor para a variável <code>id</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Para localizar o cookie <code>JSESSIONID</code>, lembre-se de que você pode acessar normalmente os cookies de um servlet chamando o método <a href="http://java.sun.com/webservices/docs/1.6/api/javax/servlet/http/HttpServletRequest.html#getCookies%28%29">`getCookies`</a> no <code>HttpServletRequest</code>. Portanto, entre no objeto da solicitação: solicitação &gt; Herdado &gt; solicitação &gt; solicitação &gt; Herdado &gt; cookies. Aqui você pode ver a ArrayList <code>cookies</code>. Se expandir a lista, encontrará o cookie <code>JSESSIONID</code>, cujo valor é o ID da sessão.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Clique no botão Finalizar Sessão (<span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span>) para encerrar a sessão de depuração.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="url-rewrite">Mantendo Sessões com a Reescrita de URL</h3>
<div class="paragraph">
<p>Como mencionado, o mecanismo do servlet detecta se os cookies são suportados para o browser do cliente e, caso não sejam, ele alterna para a reescrita de URL, como uma forma de manter as sessões. Isso tudo ocorre de um modo transparente para o cliente. Para o desenvolvedor, o processo não é totalmente transparente.</p>
</div>
<div class="paragraph">
<p>É necessário certificar-se de que a aplicação pode reescrever os URLs, caso os cookies sejam desativados. Você faz isso chamando o método <code>encodeURL</code> de resposta em todos os URLs retornados por servlets em sua aplicação. Fazer isso permite que o ID da sessão seja acrescentado ao URL, caso o uso de cookies não seja uma opção; caso contrário, será retornado o URL sem alteração.</p>
</div>
<div class="paragraph">
<p>Por exemplo, o browser envia uma solicitação para a terceira categoria (padaria) do <code>AffableBean``category?3</code>. O servidor responde com o ID de sessão incluído no URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">/AffableBean/category*;jsessionid=364b636d75d90a6e4d0085119990*?3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como foi declarado acima, <em>todos os URLs retornados pelos servlets da aplicação devem estar codificados</em>. Lembre-se de que as páginas JSP são compiladas em servlets. Como é possível codificar os URLs em páginas JSP? A tag <a href="http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/c/url.html">`&lt;c:url&gt;`</a> do JSTL serve para esse propósito. O exercício a seguir demonstra o problema e ilustra a solução.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Desative os cookies temporariamente no browser. Se estiver utilizando o Firefox, poderá selecionar Ferramentas &gt; Opções (Firefox &gt; Preferências no Mac). Na janela exibida, selecione a guia Privacidade e, em seguida, em Histórico, selecione "Utilizar definições personalizadas para o histórico" na lista drop-down fornecida. Desmarque a opção "Aceitar cookies de sites".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/firefox.png" alt="firefox">
</div>
<div class="title">Figure 25. Desative os cookies temporariamente no browser.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Execute o projeto <code>AffableBean</code>. Quando a página de boas-vindas for exibida, clique em uma categoria e, em seguida, tente adicionar um item ao seu carrinho. Você verá que a funcionalidade da aplicação está severamente comprometida no seu estado atual.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/compromised.png" alt="compromised">
</div>
<div class="title">Figure 26. A funcionalidade da aplicação fica comprometida quando o cliente não aceita cookies</div>
</div>
<div class="paragraph">
<p>Como antes, o servidor gera uma sessão e vincula objetos a ela. Isso mostra como a página da categoria pode exibir a categoria e os produtos selecionados. Entretanto, o servidor falhou na sua tentativa de definir um cookie <code>JSESSIONID</code>. Portanto, quando o cliente faz uma segunda solicitação (quando o usuário clica em "adicionar ao carrinho"), o servidor não tem como identificar a sessão à qual a solicitação pertence. Portanto, ele não pode localizar nenhum dos atributos definidos anteriormente na sessão, como <code>selectedCategory</code> e <code>categoryProducts</code>. Essa é a razão pela qual falta informações na resposta renderizada especificada por esses atributos.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Abra a página <code>category.jsp</code> do projeto no editor. Localize a linha que implementa o botão "adicionar ao carrinho" (linha 58). O atributo <code>&lt;form&gt;</code> do elemento <code>action</code> determina a solicitação enviada ao servidor.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Modifique a solicitação de forma que seja passada pela guia <code>&lt;c.url&gt;</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="*&lt;c:url value='addToCart'/&gt;*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Pressione Ctrl-S (⌘-S no Mac) para salvar as alterações do arquivo. Lembre-se de que o IDE fornece a funcionalidade Implantar ao Salvar, que é ativada por default. Isso significa que quaisquer alterações salvas são implantadas automaticamente no servidor.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>No browser, selecione uma categoria diferente para que a aplicação renderize a página da categoria modificada recentemente.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Examine o código-fonte da página. No Firefox, você pode pressionar Ctrl-U (⌘-U no Mac). O botão "adicionar ao carrinho" de cada produto é exibido com o ID da sessão acrescentado ao URL.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart*;jsessionid=4188657e21d72f364e0782136dde*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Clique no botão "adicionar ao carrinho" de qualquer item. Você verá que o servidor agora pode determinar a sessão à qual a solicitação pertence e de renderizar a resposta de forma adequada.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Antes de prosseguir, certifique-se de reativar os cookies no browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Novamente, cada link em que o usuário pode clicar na aplicação, cuja resposta exija alguma forma de dados relacionados à sessão, precisa ser codificado corretamente. Às vezes a implementação não é direta, como o exemplo mostrado acima. Por exemplo, o widget "limpar carrinho" utilizado no <code>cart.jsp</code> define atualmente um parâmetro <code>clear</code> como <code>true</code> quando o link é clicado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;
    &lt;a href="viewCart*?clear=true*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A tag <code>&lt;c.url&gt;</code> pode ser aplicada ao URL da seguinte forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;

    *&lt;c:url var="url" value="viewCart"&gt;
        &lt;c:param name="clear" value="true"/&gt;
    &lt;/c:url&gt;*

    &lt;a href="*${url}*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O parâmetro <code>clear=true</code> é definido quando uma tag <code>&lt;c:param</code> é adicionada entre as tags <code>&lt;c.url&gt;</code>. Uma variável chamada &#8220;url&#8221; é definida quando o atributo <code>var</code> de &lt;c.url&gt; é utilizado e <code>var</code> é então acessado na tag âncora HTML utilizando a expressão <code>${url}</code>.</p>
</div>
<div class="paragraph">
<p>É possível fazer download e examinar o <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">snapshot 6</a> para ver como todos os links no projeto foram codificados.</p>
</div>
<div class="paragraph">
<p>A reescrita de URL só deve ser utilizada no caso dos cookies não serem um método de rastreamento disponível. A reescrita de URL é geralmente considerada uma solução de qualidade inferior porque ela expõe o ID da sessão nos logs, marcadores, cabeçalhos de referência e HTML armazenados no cache, além da barra de endereço do browser. São necessários também mais recursos do lado servidor, pois o servidor precisa executar etapas adicionais para cada solicitação de entrada, para extrair o ID da sessão do URL e emparelhá-lo com uma sessão existente.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="time-out">Tratando Time-Outs de Sessão</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#time-interval">Definindo Intervalos de Tempo da Sessão</a></p>
</li>
<li>
<p><a href="#programmatically">Tratando de Forma Programática Time-outs de Sessão</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="time-interval">Definindo Intervalos de Tempo da Sessão</h3>
<div class="paragraph">
<p>É necessário considerar o intervalo de tempo máximo no qual o servidor mantém as sessões. No caso de o website receber um tráfego intenso, um grande número de sessões poderia usar toda a capacidade de memória do servidor. É necessário, portanto, encurtar o intervalo no intuito de remover as sessões não utilizadas. Por outro lado, você certamente não desejaria encurtar muito as sessões, já que isso poderia se tornar um problema de uso que poderia ter impacto negativo nos negócios ligados ao website. Pegando a aplicação <code>AffableBean</code> como exemplo, uma usuária faz o check-out após encher seu carrinho de compras com itens. Ela então percebe que precisa inserir os detalhes do cartão de crédito e sai para pegar a carteira. Depois de retornar ao computador com o cartão de crédito em mãos, preenche o form de check-out e clica em submeter. No entanto, durante esse tempo, sua sessão foi expirada no servidor. A usuária nota que seu carrinho de compras está vazio e é redirecionada à home page. Será que ela realmente irá passar por todo o processo novamente?</p>
</div>
<div class="paragraph">
<p>As etapas a seguir demonstram como definir o intervalo de time-out de sessão no projeto <code>AffableBean</code> para 10 minutos. Claro que a duração real depende, em última análise, dos recursos do servidor, dos objetivos de negócios da aplicação e da popularidade do seu website.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra o descritor de implantação da aplicação no editor. Pressione Alt-Shift-O (Ctrl-Shift-O no Mac) para utilizar a caixa de diálogo do IDE Ir para Arquivo. Digite &#8220;web&#8221; e, em seguida, clique em OK.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file.png" alt="go to file">
</div>
<div class="title">Figure 27. A caixa de diálogo Ir para Arquivo permite navegação rápida para os arquivos do projeto</div>
</div>
<div class="paragraph">
<p>O editor exibirá o arquivo <code>web.xml</code> na view XML. O modelo que o NetBeans fornece para o arquivo <code>web.xml</code> inclui uma definição default de 30 minutos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;
        30
    &lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Clique na guia Geral e digite &#8220;10&#8221; no campo Time-out de Sessão.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-timeout.png" alt="session timeout">
</div>
<div class="title">Figure 28. Especifique o time-out de sessão para a aplicação na guia Geral do web.xml</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Salve o arquivo (Ctrl-S; ⌘-S no Mac).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Se voltar para a view XML, verá que o elemento <code>&lt;session-timeout&gt;</code> foi atualizado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;10&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> como alternativa, você pode remover completamente o elemento <code>&lt;session-timeout&gt;</code> e editar o elemento <code>session-properties</code> no descritor de implantação específico do GlassFish (<code>sun-web.xml</code>). Dessa forma, você definiria o time-out global para todas as aplicações no módulo web do servidor. Consulte o <a href="http://docs.sun.com/app/docs/doc/821-1752/beaha">Oracle GlassFish Server 3.0.1 Application Development Guide: Creating and Managing Sessions</a> para obter mais detalhes.</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatically">Tratando de Forma Programática Time-outs de Sessão</h3>
<div class="paragraph">
<p>Se a sua aplicação se basear em sessões, será necessário tomar medidas para garantir que ela possa tratar, de maneira primorosa, situações nas quais uma solicitação é recebida para uma sessão que teve time-out ou que não pode ser identificada. Você pode realizar isso na aplicação <code>AffableBean</code> criando um filtro simples que intercepta as solicitações enviando-as para o <code>ControllerServlet</code>. O filtro verifica se a sessão existe, se não existir, ele encaminhará a solicitação à página de boas-vindas do site.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Comece examinando o problema que aparece quando há um time-out da sessão durante uma visita do usuário ao site. Redefina temporariamente o intervalo de time-out da sessão para um minuto. Abra o descritor de implantação web (<code>web.xml</code>) e insira &#8220;1&#8221; entre as tags <code>&lt;session-timeout&gt;</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*1*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Execute o projeto <code>AffableBean</code>. No browser, clique na página da categoria, adicione vários itens ao carrinho e, em seguida, clique em "ver carrinho".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-page-session-intact.png" alt="cart page session intact">
</div>
<div class="title">Figure 29. A página do carrinho depende de um objeto da sessão para exibir itens no carrinho de compras</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Aguarde pelo menos um minuto completo.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Atualize a quantidade de um dos itens exibidos na página do carrinho. (Qualquer número entre 1 e 99 é aceitável.) Clique em "atualizar". O servidor retorna uma mensagem HTTP Status 500.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/glassfish-error-report.png" alt="glassfish error report">
</div>
<div class="title">Figure 30. NullPointerException ocorre quando uma solicitação de sessão expirada é recebida</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Examine o log do GlassFish Server no IDE. Abra a janela Saída (Ctrl-4, ⌘-4 no Mac) e selecione a guia GlassFish Server. Role para a parte inferior do log para examinar o rastreamento da pilha de erro.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/gf-server-output.png"><img src="images/gf-server-output.png" alt="gf server output"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>O log do servidor indica que uma <code>NullPointerException</code> ocorreu na linha 184 no <code>ControllerServlet</code>. A janela Saída forma um link para a linha em que ocorreu a exceção.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Clique no link. Você pode navegar diretamente até a linha 184 no <code>ControllerServLet</code>. Passar o mouse sobre o emblema do erro na margem esquerda do editor fornece uma dica de ferramenta que descreve a exceção.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/nullpointer-exception.png" alt="nullpointer exception">
</div>
<div class="title">Figure 31. O emblema do erro e a dica de ferramenta indicam a localização e a causa do problema</div>
</div>
<div class="paragraph">
<p>Como a sessão já havia expirado antes de a solicitação ter sido recebida, o mecanismo do servlet não poderá associar a solicitação à sua sessão correspondente. Portanto, ele não conseguiu localizar o objeto <code>cart</code> (linha 151). A exceção ocorreu finalmente na linha 184 quando o mecanismo tentou chamar um método em uma variável equivalente a <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Agora que identificamos o problema, vamos corrigi-lo implementando um filtro.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Clique no botão Novo Arquivo (<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>) na barra de ferramentas do IDE. (Como alternativa, pressione Ctrl-N; ⌘-N no Mac.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Selecione a categoria <strong>Web*e, em seguida, selecione *Filtro</strong> e clique em Próximo.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Nomeie o filtro`SessionTimeoutFilter`. Digite <code>filter</code> no campo Pacotes, para que a classe do filtro seja colocada em um novo pacote quando for criada.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Clique em Próximo. Aceite as definições default e clique em Finalizar. Um modelo para o <code>SessionTimeoutFilter</code> será gerado e aberto no editor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> atualmente, no NetBeans 6.9, não é possível utilizar o assistente para definir um mapeamento para um servlet que não esteja registrado no descritor de implantação da web. (O <code>ControllerServlet</code> foi registrado usando a anotação <code>@WebServlet</code>.) Portanto, modificaremos o código gerado na próxima etapa.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Modifique a assinatura da anotação <code>@WebFilter</code>, de maneira que apareça da seguinte forma.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebFilter(*servletNames = {"Controller"}*)
public class SessionTimeoutFilter implements Filter {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isso define o filtro para interceptar qualquer solicitação que seja tratada pelo <code>ControllerServlet</code>. (Como alternativa, você poderia ter mantido o atributo <code>urlPatterns</code> e listado todos os padrões que o <code>ControllerServlet</code> trata.)</p>
</div>
<div class="paragraph">
<p>Note que &#8220;Controller&#8221; é o nome do <code>ControllerServlet</code>, como especificado na assinatura da anotação <code>@WebServlet</code> do servlet. Note também que o atributo <code>filterName</code> foi removido, já que o nome da classe do filtro já foi utilizado por default.</p>
</div>
<div class="paragraph">
<p>O modelo do filtro do IDE fornece vários códigos interessantes que valem a pena inspecionar por si só. No entanto, a maioria deles não é necessária para o nosso propósito. Qualquer classe de filtro deve implementar a interface <code>Filter</code>, que define três métodos:
* <strong><code>init</code>:</strong> executa qualquer ação após o filtro ter sido inicializado, mas antes de ele ser colocado em serviço
* <strong><code>destroy</code>:</strong> remove o filtro do serviço. Esse método também pode ser utilizado para executar qualquer operação de limpeza.
* <strong><code>doFilter</code>:</strong> utilizado para executar operações para cada solicitação que o filtro interceptar</p>
</div>
<div class="paragraph">
<p>Utilize a opção Pesquisa Javadoc por Índice para puxar a documentação na interface <code>Filter</code>. Pressione Shift-F1 (fn-Shift-F1 no Mac) e, em seguida, digite &#8220;Filter&#8221; no campo de pesquisa e pressione Enter. Selecione a entrada "Interface no javax.servlet". A documentação Javadoc é exibida no painel inferior da ferramenta de pesquisa em índice.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Substitua o corpo do <code>SessionTimeoutFilter</code> pelo conteúdo a seguir.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebFilter(servletNames = {"Controller"})
public class SessionTimeoutFilter implements Filter {

    *public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;

        HttpSession session = req.getSession(false);

        // if session doesn't exist, forward user to welcome page
        if (session == null) {
            try {
                req.getRequestDispatcher("/index.jsp").forward(request, response);
            } catch (Exception ex) {
                ex.printStackTrace();
            }
            return;
        }

        chain.doFilter(request, response);
    }

    public void init(FilterConfig filterConfig) throws ServletException {}

    public void destroy() {}*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Pressione Ctrl-Shift-I (⌘-Shift-I no Mac) para corrigir instruções de importação. (As importações precisam ser adicionadas a <code>HttpServletRequest</code> e <code>HttpSession</code>.) Além disso, use as dicas do editor para adicionar a anotação <code>@Override</code> aos métodos <code>init</code>, <code>destroy</code> e <code>doFilter</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nas etapas a seguir, você executará o depurador no projeto e percorrerá o método <code>doFilter</code> para ver como ele determina se a solicitação está vinculada a uma sessão existente.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Abra a janela Pontos de Interrupção (Alt-Shift-5; Ctrl-Shift-5 no Mac) e verifique se não há nenhum ponto de interrupção existente definido. Para deletar um ponto de interrupção, clique com o botão direito do mouse no ponto de interrupção e selecione Deletar. (Se tiver concluído o exercício acima, <a href="#http-monitor">Examinando a Comunicação Cliente-Servidor com o Monitor de HTTP</a>, poderá ter um ponto de verificação pendente definido no <code>ControllerServlet</code>.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Execute o depurador. Clique no botão Depurar Projeto (<span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span>) na barra de ferramentas principal do IDE.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Quando a página de boas-vindas for exibida no browser, selecione uma categoria e, em seguida, adicione vários itens ao seu carrinho de compras.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Defina um ponto de interrupção na linha no método <code> doFilter` do `SessionTimeoutFilter </code> que tenta acessar a sessão (linha 32).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/filter-breakpoint.png" alt="filter breakpoint">
</div>
<div class="title">Figure 32. Definir um ponto de interrupção no método getSession</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>No browser, clique no botão "ver carrinho". Alterne para o IDE e note que o depurador foi suspenso no ponto de interrupção.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Lembre-se de que <code>getSession()</code> cria um novo objeto de sessão, caso o atual não exista. Aqui, utilizamos o <code>getSession(false)</code>, que se abstém de criar um novo objeto, caso não seja encontrado nenhum. Em outras palavras, o método retorna <code>null</code>, se a sessão não existir.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Clique no botão Fazer Step Over (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>) e, em seguida, passe o ponteiro do mouse sobre a variável <code>session</code>. Contanto que não tenha se passado um minuto desde que a solicitação anterior foi enviada, você verá que a variável foi designada a <code>StandardSessionFacade</code>. Isso representa o objeto de sessão para a solicitação.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-exists.png" alt="session exists">
</div>
<div class="title">Figure 33. Passe o mouse sobre as variáveis para determinar seus valores atuais</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Continue percorrendo o método, até que a solicitação seja processada. Como <code>session</code> não é igual a <code>null</code>, ignore a instrução <code>if</code> e <code>chain.doFilter</code> e, em seguida, encaminhe a solicitação ao <code>ControllerServlet</code> (linha 44).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>No browser, certifique-se de que se passou um minuto completo e, em seguida, atualize a quantidade de um dos itens de produtos no carrinho. Esse é o mesmo procedimento que executamos anteriormente no exercício, quando foi retornada a mensagem status 500. Agora que o filtro intercepta as solicitações direcionadas ao <code>ControllerServlet</code>, veremos o que acontece quando ocorrer o time-out da sessão.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Depois de clicar em "atualizar", alterne para o IDE e note que o depurador é suspenso novamente no ponto de interrupção definido no filtro.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Realce a expressão <code>req.getSession(false)</code> e, em seguida, passe o mouse sobre ela. Aqui você verá que a expressão equivale a <code>null</code>, já que a sessão já expirou.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-null.png" alt="session null">
</div>
<div class="title">Figure 34. Realce as expressões e passe o mouse sobre elas para determinar seu valor atual</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Continue percorrendo o código. Agora que a variável <code>session</code> equivale a <code>null</code>, a instrução <code>if</code> na linha 35 será processada e a solicitação será encaminhada para <code>/index.jsp</code>. Quando o depurador finalizar a execução, você verá que o browser exibirá a página de boas-vindas do site.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Clique no botão Finalizar Sessão (<span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span>) para encerrar a sessão de depuração.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Abra o arquivo <code>web.xml</code> do projeto e mude o intervalo de time-out da sessão de volta para 10 minutos.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*10*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Salve o arquivo (Ctrl-S; ⌘-S no Mac).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>O <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">Snapshot 6</a> fornece a versão completa do projeto para esta unidade do tutorial. Um tópico final com relação ao gerenciamento de sessão deve ser mencionado. É possível encerrar explicitamente uma sessão chamando o método <code>invalidate</code> no objeto de sessão. Caso a sessão não seja mais necessária, ela deve ser removida para conservar a memória disponível para o servidor. Depois de concluir a próxima unidade, <a href="transaction.html">Integrando Lógica de Negócio Transacional</a>, você verá como o <code>ControllerServlet</code>, ao processar com sucesso um pedido do cliente, destrói o objeto <code>cart</code> do usuário e encerra a sessão usando o método <code>invalidate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// if order processed successfully send user to confirmation page
if (orderId != 0) {

    // dissociate shopping cart from session
    cart = null;

    // end session
    session.invalidate();

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isso é demonstrado no <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">snapshot 8 do projeto</a> (e em snapshots posteriores).</p>
</div>
<div class="paragraph">
<p>link:/about/contact_form.html?to=3&amp;subject=Feedback: NetBeans E-commerce Tutorial - Managing Sessions[Envie-nos Seu Feedback]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso">Consulte Também</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_recursos_do_netbeans">Recursos do NetBeans</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../../../../features/java/debugger.html">Funcionalidades do NetBeans: Depurador</a></p>
</li>
<li>
<p><a href="../../java/debug-multithreaded.html">Depurando Aplicações Multithread</a></p>
</li>
<li>
<p><a href="../../java/debug-multithreaded-screencast.html">Vídeo de Depuração Multithread no NetBeans IDE</a></p>
</li>
<li>
<p><a href="../../java/debug-evaluator-screencast.html">Vídeo sobre o Uso do Avaliador de Snippets de Código no Depurador do NetBeans</a></p>
</li>
<li>
<p><a href="../../screencasts.html">Tutoriais e Demonstrações em Vídeo para NetBeans IDE 6.x</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">Atalhos de Teclado e Cartão de Modelos de Código</a></p>
</li>
<li>
<p><a href="../javaee-gettingstarted.html">Introdução às Aplicações do Java EE 6</a></p>
</li>
<li>
<p><a href="../javaee-intro.html">Introdução à Tecnologia Java EE</a></p>
</li>
<li>
<p><a href="../../../trails/java-ee.html">Trilha do Aprendizado do Java EE e Java Web</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_recursos_do_glassfish">Recursos do GlassFish</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.glassfish.java.net/Wiki.jsp?page=Screencasts">Screencasts do GlassFish</a></p>
</li>
<li>
<p><a href="https://glassfish.dev.java.net/docs/index.html">Documentação do GlassFish v3</a></p>
</li>
<li>
<p><a href="http://www.sun.com/offers/details/GlassFish_Tomcat.html">Aprendendo GlassFish para Usuários do Tomcat</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1751">Guia de Administração do Oracle GlassFish Server 3.0.1</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1750">Guia de Implantação de Aplicações do Oracle GlassFish Server 3.0.1</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1752">Guia de Desenvolvimento de Aplicações do Oracle GlassFish Server 3.0.1</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_artigos_técnicos_recursos_variados">Artigos Técnicos &amp; Recursos Variados</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/javaee/reference/code/">Amostras de Código do Java EE &amp;amp; Aplicações</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Ferramenta Javadoc</a> [home page do produto]</p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">Como Escrever Comentários Doc na Ferramenta Javadoc</a></p>
</li>
<li>
<p><a href="http://java.sun.com/products/servlet/Filters.html">Os Fundamentos dos Filtros</a></p>
</li>
<li>
<p><a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html">Padrões Core J2EE: Interceptando Filtro</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/csajsp2.html">Tutoriais do Servlet, do JSP e do JDBC para os Níveis Iniciante e Intermediário</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/msajsp.html">Tutoriais Avançados do Servlet e do JSP</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/java5.html">Tutoriais do Java 5 &amp;amp; do Java 6</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0211.html">Uma cartilha JSTL, Parte 1: A linguagem da expressão</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0318/index.html">Uma cartilha JSTL, Parte 2: Chegando ao centro do problema</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/manage-sessions_pt_BR.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
