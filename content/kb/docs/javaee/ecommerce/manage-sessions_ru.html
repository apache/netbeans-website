
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Учебный курс по электронной коммерции в NetBeans - управление сеансами</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Учебный курс по электронной коммерции в NetBeans - управление сеансами - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Учебный курс по электронной коммерции в NetBeans - управление сеансами">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Учебный курс по электронной коммерции в NetBeans - управление сеансами</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/manage-sessions_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#session-data">Обработка данных сеанса</a>
<ul class="sectlevel2">
<li><a href="#httpSession">Работа с объектом HttpSession</a></li>
<li><a href="#scopedVariables">Работа с контекстными переменными в веб-приложениях</a></li>
</ul>
</li>
<li><a href="#debug">Изучение данных сеанса при помощи отладчика Java</a>
<ul class="sectlevel2">
<li><a href="#_страница_категории">страница категории</a></li>
<li><a href="#cartPage">страница корзины покупок</a></li>
<li><a href="#_страница_проверки">страница проверки</a></li>
<li><a href="#_использование_поддержки_документации_javadoc_в_среде_ide">Использование поддержки документации Javadoc в среде IDE</a></li>
</ul>
</li>
<li><a href="#session-track">Изучение параметров отслеживания сеанса</a>
<ul class="sectlevel2">
<li><a href="#http-monitor">Изучение обмена данными между сервером и клиентом с использованием монитора HTTP</a></li>
<li><a href="#url-rewrite">Ведение сеансов с перезаписью URL-адреса</a></li>
</ul>
</li>
<li><a href="#time-out">Обработка истечения времени ожидания сеанса</a>
<ul class="sectlevel2">
<li><a href="#time-interval">Установка временных интервалов сеанса</a></li>
<li><a href="#programmatically">Автоматическая обработка истечения времени ожидания сеанса</a></li>
</ul>
</li>
<li><a href="#seeAlso">Дополнительные сведения</a>
<ul class="sectlevel2">
<li><a href="#_материалы_по_netbeans">Материалы по NetBeans</a></li>
<li><a href="#_ресурсы_по_glassfish">Ресурсы по GlassFish</a></li>
<li><a href="#_технические_статьи_и_различные_ресурсы">Технические статьи и различные ресурсы</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="intro.html">Введение</a></p>
</li>
<li>
<p><a href="design.html">Проектирование приложения</a></p>
</li>
<li>
<p><a href="setup-dev-environ.html">Настройка среды разработки</a></p>
</li>
<li>
<p><a href="data-model.html">Проектирование модели данных</a></p>
</li>
<li>
<p><a href="page-views-controller.html">Подготовка представлений страниц и сервлета контроллера</a></p>
</li>
<li>
<p><a href="connect-db.html">Подключение приложения к базе данных</a></p>
</li>
<li>
<p><a href="entity-session.html">Добавление классов сущностей и сеансных компонентов</a></p>
</li>
<li>
<p><strong>Управление сеансами</strong></p>
</li>
<li>
<p><a href="transaction.html">Интеграция транзакционной бизнес-логики</a></p>
</li>
<li>
<p><a href="language.html">Добавление поддержки языков</a></p>
</li>
<li>
<p><a href="security.html">Обеспечение безопасности приложений</a></p>
</li>
<li>
<p><a href="test-profile.html">Тестирование и профилирование</a></p>
</li>
<li>
<p><a href="conclusion.html">Заключение</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images_www/articles/68/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. Содержимое на этой странице применимо к IDE NetBeans, версии 6.8 и 6.9</div>
</div>
<div class="paragraph">
<p>Каждое приложение электронной коммерции, предлагающее какие-либо возможности корзины покупок, должно обладать функцией запоминания пользовательских данных в процессе перехода по веб-страницам/страницам веб-сайта. К сожалению, протокол HTTP, посредством которого осуществляется взаимодействие в Интернете, является протоколом <em>без поддержки состояния</em>. Каждый запрос, получаемый сервером, является независимым элементом данных, не связанным с ранее поступившими запросами. Поэтому при нажатии кнопки для добавления товара в корзину покупок приложение должно не только обеспечивать обновление корзины пользователя, но и предупреждать влияние данной корзины на корзины других пользователей, просматривающих сайт в это же время.</p>
</div>
<div class="paragraph">
<p>Чтобы правильно обработать описанный выше сценарий, необходимо реализовать функцию для создания и ведения <em>сеанса</em> на протяжении пребывания пользователя на сайте. Технология сервлета, являющаяся основой для всех веб-приложений на базе Java, предоставляет для этих целей интерфейс <a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">`HttpSession`</a>. Также необходимо определить некоторые классы, а именно <code>ShoppingCart</code> и <code>ShoppingCartItem</code>, что позволит приложению хранить данные пользователя, пока время сеанса не истекло.</p>
</div>
<div class="paragraph">
<p>Подход данного раздела учебного курса отличается от остальных подходов, рассматриваемых в учебном курсе по электронной коммерции NetBeans. Вместо создания файлов проекта и предоставления пошаговых инструкций с фрагментами кода для копирования и вставки в собственный проект предлагается открыть пример готового проекта для данного раздела и изучить код при помощи отладчика среды IDE и других средств. В процессе работы будут изучены способы применения объекта <code>HttpSession</code> к коду, чтобы в результате каждого посещения веб-сайта создавался отдельный сеанс. Также будут рассмотрены <em>контекстные переменные</em> и их использование как в классах Java, так и на страницах JSP. Кроме того, в этом разделе описывается стандартный механизм <code>HttpSession</code> для ведения сеансов (например файлов cookie) и пошаговые инструкции, которые необходимо выполнить в случае деактивации файлов cookie в браузере пользователя. В заключение затрагивается время ожидания сеанса и демонстрируется принцип его обработки с созданием элементарного фильтра, перехватывающего запросы для проверки существования сеанса.</p>
</div>
<div class="paragraph">
<p>Можно просмотреть интерактивную демонстрацию приложения, которое создается в этом учебном курсе: <a href="http://dot.netbeans.org:8080/AffableBean/">Демонстрация приложения электронной коммерции NetBeans</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Программное обеспечение или материал</th>
<th class="tableblock halign-left valign-top">Требуемая версия</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">IDE NetBeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Набор Java, версия 6.8 или 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Комплект для разработчика на языке Java (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">версия 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#glassFish">Сервер GlassFish</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3 или Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">Сервер базы данных MySQL</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">Проект AffableBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">снимок 5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Примечания:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The IDE NetBeans requires the Java Development Kit (JDK) to run properly. Если указанные материалы не установлены, JDK следует загрузить и установить в первую очередь.</p>
</li>
<li>
<p>The IDE NetBeans Java Bundle includes Java Web and EE technologies, which are required for the application you build in this tutorial.</p>
</li>
<li>
<p>The IDE NetBeans Java Bundle also includes the GlassFish server, which you require for this tutorial. Можно <a href="https://glassfish.dev.java.net/public/downloadsindex.html">загрузить сервер GlassFish отдельно</a>, но версия, предоставляемая с NetBeans, имеет преимущество, так как автоматически зарегистрирована в среде IDE.</p>
</li>
<li>
<p>Этот учебный курс можно выполнять без выполнения предыдущих. Для этого обратитесь к <a href="setup.html">инструкциям по настройке</a>, в которых описана подготовка базы данных и настройка подключений между IDE, GlassFish, и MySQL.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-data">Обработка данных сеанса</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Приложения могут управлять пользовательскими сеансами при помощи объекта <code>HttpSession</code>. Можно привязать пользовательские данные к объекту <code>HttpSession</code> и получить возможность доступа к этим данным на дальнейших этапах. Операции привязки и доступа могут быть выполнены при помощи классов Java, а также переменных в контексте сеанса в выражениях на языке выражений.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#httpSession">Работа с объектом HttpSession</a></p>
</li>
<li>
<p><a href="#scopedVariables">Работа с контекстными переменными в веб-приложениях</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="httpSession">Работа с объектом HttpSession</h3>
<div class="paragraph">
<p>В приложении <code>AffableBean</code> используется объект <code>HttpSession</code> для идентификации пользователей при неоднократных запросах. Объект <code>HttpSession</code> можно получить при помощи метода <code>getSession()</code> для заданного запроса:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">HttpSession session = request.getSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если объект сеанса для запроса еще не существует, метод создает и возвращает новый объект сеанса.</p>
</div>
<div class="paragraph">
<p>Объект сеанса можно использовать в качестве средства для передачи данных между запросами. Метод <code>setAttribute</code> используется для привязки объектов к сеансу. Таким же образом метод <code>getAttribute</code> используется для извлечения объектов из сеанса. Например, в приложении <code>AffableBean</code> корзина покупок пользователя создается и привязывается к пользовательскому сеансу следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ShoppingCart cart = new ShoppingCart();
session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для извлечения корзины из сеанса применяется метод <code>getAttribute</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">cart = (ShoppingCart) session.getAttribute("cart");</code></pre>
</div>
</div>
<div class="paragraph">
<p>На страницах JSP можно получить доступ к объектам, привязанным к сеансу с использованием выражений на языке выражений. Также, если объект <code>ShoppingCart</code> с именем <code>cart</code> привязан к сеансу, можно получить доступ к объекту при помощи следующего выражения на языке выражений:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${cart}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Доступ к объекту <code>ShoppingCart</code> сам по себе не представляет большого значения. Целью является доступ к значениям, хранящимся в объекте. При изучении нового класса <code>ShoppingCart</code> на снимке проекта обратите внимание, что он содержит следующие свойства:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>удвоенный итог</code></p>
</li>
<li>
<p><code>int numberOfItems</code></p>
</li>
<li>
<p><code>List&lt;String, ShoppingCartItem&gt; items</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>При условии, что свойства соответствуют методам получения, можно получить доступ к значениям отдельных свойств при помощи простого точечного представления в выражении на языке выражений. На странице <code>cart.jsp</code> приведен точный способ доступа к свойству <code>numberOfItems</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;p&gt;Your shopping cart contains ${cart.numberOfItems} items.&lt;/p&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для извлечения данных из свойств с несколькими значениями, например списка <code>items</code>, приведенного выше, на странице <code>cart.jsp</code> используется цикл <code>&lt;c:forEach&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;c:forEach var="cartItem" items="${cart.items}" varStatus="iter"&gt;

  &lt;c:set var="product" value="${cartItem.product}"/&gt;

    &lt;tr class="${((iter.index % 2) == 0) ? 'lightBlue' : 'white'}"&gt;
        &lt;td&gt;
            &lt;img src="${initParam.productImagePath}${product.name}.png"
                 alt="${product.name}"&gt;
        &lt;/td&gt;

        &lt;td&gt;${product.name}&lt;/td&gt;

        &lt;td&gt;
            &amp;amp;euro; ${cartItem.total}
            &lt;br&gt;
            &lt;span class="smallText"&gt;( &amp;amp;euro; ${product.price} / unit )&lt;/span&gt;
        &lt;/td&gt;
        ...
    &lt;/tr&gt;

&lt;/c:forEach&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Принадлежащая <code>ShoppingCartItem</code> собственность <code>product</code> определяет тип продукта для элемента корзины. Цикл, рассматриваемый выше, использует результаты определения при первой установке переменной <code>product</code> в выражении <code>${cartItem.product}</code>. Затем переменная используется для получения сведений об этом продукте (например имя, цена).</p>
</div>
</div>
<div class="sect2">
<h3 id="scopedVariables">Работа с контекстными переменными в веб-приложениях</h3>
<div class="paragraph">
<p>При работе с технологией JSP/сервлетов доступны четыре контекстных объекта в области приложения. Технология JSP реализует <em>скрытые объекты</em>, позволяющие получить доступ к классам, определяемым интерфейсом API сервлетов.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Контекст</th>
<th class="tableblock halign-left valign-top">Определение</th>
<th class="tableblock halign-left valign-top">Класс сервлетов</th>
<th class="tableblock halign-left valign-top">Скрытые объекты JSP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Приложение</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Глобальная память веб-приложения</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/ServletContext.html">+javax.servlet.ServletContext+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>applicationScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Сеанс</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Данные пользовательского сеанса</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpSession.html">+javax.servlet.http.HttpSession+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Запрос</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Данные отдельного запроса сервера</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://java.sun.com/javaee/6/docs/api/javax/servlet/http/HttpServletRequest.html">+javax.servlet.HttpServletRequest+</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestScope</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Страница</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Данные, действительные только в контексте отдельной страницы (только JSP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>неприменимо</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pageScope</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>При открытии файла <code>category.jsp</code> проекта в редакторе обратите внимание, что выражения на языке выражений включают в себя различные контекстные переменные, в частности, <code>${categories}</code>, <code>${selectedCategory}</code> и <code>${categoryProducts}</code>. Переменная <code>${categories}</code> находится в контексте приложения, устанавливаемого в методе <code>init</code> файла <code>ControllerServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// store category list in servlet context
getServletContext().setAttribute("categories", categoryFacade.findAll());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Остальные переменные, <code>${selectedCategory}</code> и <code>${categoryProducts}</code>, размещаются в контексте сеанса приложения в файле <code>ControllerServlet</code>. Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// place selected category in session scope
session.setAttribute("selectedCategory", selectedCategory);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> Если изучить предыдущие разделы руководства, можно заметить, что <code>${selectedCategory}</code> и <code>${categoryProducts}</code> были изначально помещены в область запроса. В предыдущих разделах такое размещение было целесообразным, но рассмотрим, что случится, если пользователь нажмет кнопку "добавить в корзину" на странице категорий. В ответ на запрос <code>addToCart</code> сервлет возвратит текущую страницу категорий. Таким образом нужно будет получить информацию о <code>selectedCategory</code> и <code>categoryProducts</code>, относящихся к выбранной категории. Вместо того чтобы узнавать данную информацию о каждом запросе, достаточно поместить ее в область сеанса запроса <code>category</code>, так чтобы она поддерживалась многими запросами и могла быть получена, когда в ней возникнет необходимость. Рассмотрим также функциональность страницы корзины. (Функции <a href="#cartPage">описываются ниже</a>). Кнопка "Продолжить покупки" возвращает пользователя в предыдущую просмотренную категорию. Опять же запрашиваются переменные <code>selectedCategory</code> и <code>categoryProducts</code>.</p>
</div>
<div class="paragraph">
<p>При ссылке на контекстные переменные в выражении на языке выражений нет необходимости в указании контекста переменной (при условии отсутствия двух переменных с одинаковым именем в различных контекстах). Механизм JSP выполняет проверку всех четырех контекстов и возвращает первое найденное соответствие переменных. Например, в файле <code>category.jsp</code> выражение</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p>является сокращением для</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">${sessionScope.categoryProducts}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">Для получения дополнительных сведений ознакомьтесь со следующими материалами:</span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/blueprints/guidelines/designing_enterprise_applications_2e/web-tier/web-tier5.html#1079198">Проектирование приложений уровня предприятия при помощи платформы J2EE: контексты состояния</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnafo.html">"Совместные данные" &gt; "Использование контекстных объектов"</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17477_01/javaee/5/tutorial/doc/bnahq.html#bnaij">"Унифицированный язык выражений" &gt; "Скрытые объекты"</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debug">Изучение данных сеанса при помощи отладчика Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Начало изучения принципов поведения приложения во время выполнения. Используйте отладчик среды IDE для перехода по коду и изучения способов создания объекта <code>HttpSession</code> и размещения прочих объектов в контексте сеанса для их дальнейшего извлечения.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot5.zip">пример проекта</a> для данного раздела учебного курса в среде IDE. В диалоговом окне "Открытие проекта" ( <span class="image"><img src="images/open-project-btn.png" alt="open project btn"></span> ) перейдите к папке на компьютере, в которой хранится разархивированный файл учебного проекта. Если изучить <a href="entity-session.html">предыдущий раздел руководства</a>, можно заметить, что снимок проекта включает новый пакет <code>cart</code>, содержащий классы <code>ShoppingCart</code> и <code>ShoppingCartItem</code>. Также изменены следующие файлы:</p>
<div class="ulist">
<ul>
<li>
<p><code>WEB-INF/web.xml</code></p>
</li>
<li>
<p><code>css/affablebean.css</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/header.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/jspf/footer.jspf</code></p>
</li>
<li>
<p><code>WEB-INF/view/cart.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/category.jsp</code></p>
</li>
<li>
<p><code>WEB-INF/view/checkout.jsp</code></p>
</li>
<li>
<p><code>controller/ControllerServlet</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Запустите проект ( <span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span> ), чтобы убедиться, что этот проект правильно настроен с помощью используемой базы данных и сервера приложений.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Если при выполнении проекта выводится сообщение об ошибке, еще раз обратитесь к <a href="setup.html">указаниям по настройке</a>, в которых описаны принципы подготовки базы данных и установки соединения между средой IDE, сервером GlassFish и MySQL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Протестируйте функциональные возможности приложения в браузере. Если <a href="entity-session.html">предыдущий раздел учебного курса</a> уже изучен, обратите внимание на следующие расширения.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_страница_категории">страница категории</h3>
<div class="ulist">
<ul>
<li>
<p>Первое нажатие кнопки "add to cart" активирует корзину покупок и виджеты "proceed to checkout", отображаемые в заголовке.</p>
</li>
<li>
<p>Нажатие кнопки "add to cart" приводит к обновлению числа товаров в виджете корзины покупок в заголовке.</p>
</li>
<li>
<p>В результате щелчка ссылки "view cart" отображается страница корзины.</p>
</li>
<li>
<p>При щелчке ссылки "proceed to checkout" открывается страница кассы.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/category-page.png" alt="category page">
</div>
<div class="title">Figure 2. IDE NetBeans включает функции отладки.</div>
</div>
</div>
<div class="sect2">
<h3 id="cartPage">страница корзины покупок</h3>
<div class="ulist">
<ul>
<li>
<p>Щелчок ссылки "clear cart" обеспечивает удаление всех товаров из корзины покупок.</p>
</li>
<li>
<p>В результате щелчка ссылки "continue shopping" выполняется возврат к ранее просматриваемой категории.</p>
</li>
<li>
<p>При щелчке ссылки "proceed to checkout" открывается страница кассы.</p>
</li>
<li>
<p>Ввод числа (от 1 до 99) в поле количества товара и нажатие кнопки "update" запускает повторный расчет общей стоимости товара, а также промежуточной суммы.</p>
</li>
<li>
<p>При вводе нуля в поле количества товара и нажатии кнопки "update" товар удаляется из отображаемой таблицы.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-page.png" alt="cart page">
</div>
<div class="title">Figure 3. IDE NetBeans включает функции отладки.</div>
</div>
</div>
<div class="sect2">
<h3 id="_страница_проверки">страница проверки</h3>
<div class="ulist">
<ul>
<li>
<p>В результате щелчка ссылки "view cart" отображается страница корзины.</p>
</li>
<li>
<p>В результате нажатия "подтвердить покупку" на странице подтверждения отображаются результаты покупки (без указания информации о пользователе).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/checkout-page.png" alt="checkout page">
</div>
<div class="title">Figure 4. Страница кассы включает функцию покупательской корзины</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Используйте диалоговое окно "Перейти к файлу", чтобы открыть файл <code>ControllerServlet</code> в редакторе. Нажмите ALT+SHIFT+O (CTRL+SHIFT+O в Mac OS), затем введите &#8220;Controller&#8221; в поле диалога и нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file-dialog.png" alt="go to file dialog" width="Переход к файлу"  быстро откройте ресурсы проекта в редакторе"">
</div>
<div class="title">Figure 5. С помощью диалогового окна </div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Установите точку останова в методе <code>doPost</code> на строке, которая создает объект <code>HttpSession</code> (строка 150). Для установки точки останова щелкните в левом поле редактора.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint.png" alt="breakpoint">
</div>
<div class="title">Figure 6. Щелкните левую границу редактора для задания точек останова</div>
</div>
<div class="paragraph">
<p>Для переключения номеров строк в редакторе щелкните правой кнопкой мыши в левом поле и выберите команду "Показать номера строк".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Запустите отладчик. Нажмите кнопку 'Отладка проекта' (<span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span>) на главной панели инструментов IDE. Сервер GlassFish запускается (или перезапускается, если уже работал ) и открывает подключение через сокет по его отладочному номеру порта. В браузере откроется страница приветствия приложения.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Можно просматривать и изменять номер порта отладки в диалоговом окне "Серверы" ("Сервис" &gt; "Серверы"). Выберите вкладку "Java" для используемого сервера. Укажите номер порта в поле "Используемый адрес" под заголовком "Параметры отладки".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>При выводе страницы приветствия в браузере выберите категорию и добавьте несколько элементов в корзину покупок. Следует помнить, что нажатие кнопки "add to cart" отправляет запрос <code>addToCart</code> на сервер:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как уже было описано в разделе <a href="page-views-controller.html#controller">Подготовка представлений страницы и сервлета контроллера</a>, принадлежащий <code>ControllerServlet</code> метод <code>doPost</code> поддерживает запросы URL-адреса шаблона <code>/addToCart</code>. Следовательно, при нажатии кнопки "add to cart" ожидается вызов метода <code>doPost</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Нажмите кнопку "add to cart" для любого элемента на странице категорий. Перейдите к среде IDE и обратите внимание, что отладчик приостановил работу в точке останова.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint-suspended.png" alt="breakpoint suspended">
</div>
<div class="title">Figure 7. Отладчик приостанавливает работу по достижении точек останова, заданных в редакторе</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Поместите курсор в месте вызова метода <code>getSession()</code> и нажмите сочетание клавиш CTRL+ПРОБЕЛ для вывода документации Javadoc.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javadoc-getsession.png" alt="javadoc getsession">
</div>
<div class="title">Figure 8. Нажмите Ctrl-Space для вызова документации Javadoc</div>
</div>
<div class="paragraph">
<p>В соответствии с документацией метод <code>getSession()</code> возвращает объект <code>HttpSession</code>, связанный в настоящее время с запросом, и (при отсутствии сеанса) создает новый объект сеанса.</p>
</div>
</div>
<div class="sect2">
<h3 id="_использование_поддержки_документации_javadoc_в_среде_ide">Использование поддержки документации Javadoc в среде IDE</h3>
<div class="paragraph">
<p>Среда IDE предоставляет встроенную поддержку документации Javadoc для разработки на базе Java EE. Среда IDE связывается со спецификацией интерфейса API Java EE 6, доступной во внешнем браузере по пути "Справка" &gt; "Справочные сведения Javadoc" &gt; "Java EE 6".</p>
</div>
<div class="paragraph">
<p>Также среда IDE включает в себя различные функции, позволяющие получить быстрый доступ к документации интерфейса API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Диалоговое окно документации Javadoc:</strong> выберите "Окно" &gt; "Прочее" &gt; "Javadoc". В нижней области среды IDE откроется диалоговое окно "Javadoc", в котором отобразится документация интерфейса API, релевантная для позиции курсора в редакторе.</p>
</li>
<li>
<p><strong>Поиск документации по индексу:</strong> выберите в меню "Справка" пункт "Поиск документации по индексу" (SHIFT+F1; fn+SHIFT+F1 в системе Mac). Введите имя искомого класса и выберите класс из списка результатов поиска. Полное описание класса в спецификации интерфейса API отображается на нижней панели диалогового окна.</p>
</li>
<li>
<p><strong>Всплывающее окно документации в редакторе:</strong> документация Javadoc отображается во всплывающем окне при нажатии сочетания клавиш CTRL+ПРОБЕЛ для определенного элемента в редакторе. Можно нажать кнопку 'Внешний браузер' ( <span class="image"><img src="images/external-browser-btn.png" alt="external browser btn"></span> ) для открытия документации в используемом браузере. Для использования сочетания клавиш CTRL+ПРОБЕЛ только для автозавершения кода можно деактивировать всплывающее окно документации, открыв диалоговое окно "Параметры" ("Сервис" &gt; "Параметры"; "NetBeans" &gt; "Параметры" для системы Mac), и затем выбрав в меню "Редактор" пункт "Автозавершение кода". Отмените выбор параметра "Автоматический вызов окна документации".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>При документировании собственной работы рекомендуется добавить комментарии документации Javadoc к классам и методам. Откройте класс <code>ShoppingCart</code> и изучите комментарии документации Javadoc, добавленные к методам класса. Комментарии документации Javadoc отмечены парными символами <code>/** &#8230;&#8203; */</code>. Например, для метода <code>addItem</code> добавлен следующий комментарий:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">/**
 * Adds a &lt;code&gt;ShoppingCartItem&lt;/code&gt; to the &lt;code&gt;ShoppingCart&lt;/code&gt;'s
 * &lt;code&gt;items&lt;/code&gt; list. If item of the specified &lt;code&gt;product&lt;/code&gt;
 * already exists in shopping cart list, the quantity of that item is
 * incremented.
 *
 * @param product the &lt;code&gt;Product&lt;/code&gt; that defines the type of shopping cart item
 * @see ShoppingCartItem
 */
public synchronized void addItem(Product product) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это позволяет разработчикам просматривать документацию Javadoc по методу. Для демонстрации откройте 'Навигатор' (Ctrl-7; ⌘-7 в Mac) и подведите курсор мыши к методу <code>addItem</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javadoc-additem.png" alt="javadoc additem">
</div>
<div class="title">Figure 9. Подведите курсор мыши к 'Навигатору' для просмотра документации Javadoc</div>
</div>
<div class="paragraph">
<p>Также можно использовать среду IDE для создания набора страниц HTML документации Javadoc. В окне "Проекты" щелкните правой кнопкой мыши узел проекта и выберите пункт "Создание документации Javadoc". Среда IDE создает документацию Javadoc в папке <code>dist/javadoc</code> каталога проекта и открывает страницу-указатель в браузере.</p>
</div>
<div class="paragraph">
<p>Для получения дополнительных сведений о документации Javadoc обратитесь к следующим ресурсам:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Официальная домашняя страницы средства Javadoc</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">Принцип записи комментариев документации для средства Javadoc</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Наведите курсор на переменную <code>session</code>. Обратите внимание, что отладчик приостанавливает работу на строке, <em>которая должна быть запущена в нем.</em> Значение, возвращаемое <code>getSession()</code> еще не сохранено в переменной <code>session</code> и отображается всплываюшщее окно, в котором указывается, что "`session` не является известной переменной в текущем контексте".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-variable.png" alt="session variable">
</div>
<div class="title">Figure 10. Наведите курсор на переменные и выражения для определения их текущих значений</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Нажмите кнопку 'Обход процедур' (<span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span>) в отладчике на панели инструментов, расположенной выше в редакторе. Строка обрабатывается, и отладчик переходит к следующей строке файла.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Снова наведите курсор на переменную <code>session</code>. Можно увидеть, что текущее значение сохранено в переменной <code>session</code>.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/session-variable-set.png"><img src="images/session-variable-set.png" alt="session variable set"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>В NetBeans 6.9 можно щелкнуть серый указатель ( <span class="image"><img src="images/grey-pointer.png" alt="grey pointer"></span> ) во всплывающем окне, чтобы расширить список значений переменных, содержащихся в выделенном элементе.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Нажмите кнопку 'Обход процедур' ( <span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span> ) (F8; fn-F8 в Mac) для перехода к оператору <code>if</code> (строка 154). Поскольку в браузере только что была нажата кнопка "add to cart", выражение <code>userPath.equals("/addToCart")</code> должно иметь значение <code>true</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Выделите выражение <code>userPath.equals("/addToCart")</code> (нажав клавишу CTRL и щелкнув клавишей мыши). При этом будет выведено всплывающее окно со значением выделенного выражения.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/expression.png" alt="expression">
</div>
<div class="title">Figure 11. Выделите выражения для определения их текущих значений</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Нажмите клавишу F8 (fn-F8 в Mac OS) для перехода к следующей строке (строка 158). Приложение спроектировано таким образом, что объект <code>ShoppingCart</code> создается для пользовательского сеанса только при первом добавлении элемента в корзину пользователя. Поскольку запрос <code>addToCart</code> в этом сеансе отладки получен впервые, предполагается, что объект <code>cart</code> имеет значение <code>null</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-null.png" alt="cart null">
</div>
<div class="title">Figure 12. Объект покупательской корзины появляется только после добавления пользователем элемента к покупательской корзине</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Нажмите клавишу F8 (fn-F8 в Mac OS) для перехода к следующей линии (линия 160). Затем в строке 160, где создан объект <code>ShoppingCart</code>, нажмите кнопку 'Вход в' ( <span class="image"><img src="images/step-into-btn.png" alt="step into btn"></span> ). Отладчик переходит к вызываемому методу. В этом случае выполняется переход непосредственно к конструктору файла <code>ShoppingCart</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-constructor.png" alt="cart constructor">
</div>
<div class="title">Figure 13. Перейдите к методам для отслеживания этапа выполнения для других классов</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Нажмите сочетание клавиш CTRL+TAB для перехода к файлу <code>ControllerServlet</code>. Обратите внимание, что IDE предоставляет значок 'Стек вызовов' ( <span class="image"><img src="images/call-stack-badge.png" alt="call stack badge"></span> ) в строке 160, указывая, что отладчик в настоящее время приостановлен где-то на методе выше в стеке вызовов.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Нажмите ALT+SHIFT+3 (CTRL+SHIFT+3 в Mac OS), чтобы открыть окно стека вызовов.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Нажмите клавишу F8 (fn+F8 в системе Mac) для продолжения перехода по коду. При завершении обработки отладчиком конструктора <code>ShoppingCart</code> выполняется возврат к файлу <code>ControllerServlet</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Строка 161 <code>ControllerServlet</code> привязывает вновь созданный объект <code>cart</code> к сеансу.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">session.setAttribute("cart", cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы в этом удостовериться, откройте окно переменных отладчика. Выберите "Окно" &gt; "Отладка" &gt; "Переменные" или нажмите ALT+SHIFT+1 (CTRL+SHIFT+1 в Mac OS).</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-win-session.png"><img src="images/variables-win-session.png" alt="variables win session"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>При последовательной развертке узлов "session" &gt; "session" &gt; "attributes" можно просмотреть объекты, привязанные к сеансу. На изображении выше отображены два элемента, привязанные в настоящее время к сеансу (выделены на снимке). Это <code>selectedCategory</code> и <code>categoryProducts</code>, показанные в <code>ControllerServlet</code> на строках 83 и 89, соответственно. Оба элемента были привязаны ранее при щелчке изображения категории и обработке запроса страниц категории в файле <code>ControllerServlet</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Нажмите клавишу F8 (fn-F8 в Mac OS) для выполнения кода со строки 161. Объект <code>cart</code> привязывается к сеансу, и диалоговое окно "Переменные" обновляется для отображения изменений. Обратите внимание, что в окне "Переменные" сеанс содержит в настоящий момент три атрибута, третьим атрибутом является только что инициализированный объект <code>ShoppingCart</code> (выделен на снимке ниже).</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-win-session-cart.png"><img src="images/variables-win-session-cart.png" alt="variables win session cart"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Пока что не было "доказано", что сеанс, как указано в диалоговом окне "Переменные", представляет объект <code>HttpSession</code>. Как упоминалось выше, <code>HttpSession</code> фактически является интерфейсом, так что при рассмотрении объекта <code>HttpSession</code> или объекта сеанса фактически имеется в виду любой объект, реализующий интерфейс <code>HttpSession</code>. При наведении курсора мыши в диалоговом окне "Переменные" на элемент <code>session</code> будет выведено всплывающее окно, указывающее на то, что переменная представляет объект <code>HttpSession</code>. Тип <code>StandardSessionFacade</code>, отображенный на снимке, является внутренним классом, используемым сервером GlassFish для реализации интерфейса <code>HttpSession</code>. При наличии опыта работы с Tomcat обратите внимание, что пути <code>org.apache.catalina</code> в столбце "Значение" обусловлены тем, что веб-контейнер/контейнер сервлета GlassFish фактически является производным от контейнера Apache Tomcat.</p>
</div>
<div class="paragraph">
<p>В сеанс добавляется новый объект <code>ShoppingCart</code>, и запрос продолжает обрабатываться. Для завершения реализации функции "add to cart" предпринимаются следующие действия:
* Идентификатор выбранного продукта получается из запроса (строка 165).
* Объект <code>Product</code> создается с помощью идентификатора (строка 169).
* Новый экземпляр <code>ShoppingCartItem</code> создается с помощью <code>product</code> (строка 170).
* Экземпляр <code>ShoppingCartItem</code> добавляется в состоящий из <code>ShoppingCartItem</code> список <code>экземпляров</code> (строка 170).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Нажмите клавишу F8 (fn+F8 в системе Mac OS), чтобы продолжить выполнение перехода по коду с учетом перечисленных выше четырех действий. Сделайте паузу, когда отладчик временно остановится на строке 170.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Создайте наблюдение за сеансом. Эта функция позволит просматривать значения, содержащиеся в сеансе, при переходе к методу <code>addItem</code> в следующем шаге. Щелкните правой кнопкой мыши сеанс в диалоговом окне "Переменные" и выберите команду "Установить постоянное наблюдение".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-watch.png" alt="create watch">
</div>
<div class="title">Figure 14. Создайте наблюдения за переменными при переходе по коду в сеансе отладки</div>
</div>
<div class="paragraph">
<p>Кроме того, вы можете поместить курсор на переменной <code>session</code> в редакторе, а затем щелкнуть правой кнопкой мыши и выбрать 'Новое наблюдение'. Диалоговое окно создания наблюдения позволяет определить переменные или выражения для постоянного наблюдения за отладкой приложения. (При использовании выражений, сначала выделите выражение, а затем щелкните правой кнопкой мыши и выберите 'Новое наблюдение').</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-watch-dialog.png" alt="new watch dialog">
</div>
<div class="title">Figure 15. Щелкните правой кнопкой мыши переменные и выражения в редакторе и выберите 'Создать наблюдение'</div>
</div>
<div class="paragraph">
<p>Для переменной <code>session</code> и всех содержащихся в ней переменных создается наблюдение. Наблюдение отображается в окне 'Наблюдения' (Window &gt; 'Отладка' &gt; 'Наблюдения') или при переключении кнопки наблюдений ( <span class="image"><img src="images/watch-btn.png" alt="watch btn"></span> ) на левой границе окна 'Переменные' оно отображается в верхней строке окна 'Переменные'.</p>
</div>
<div class="paragraph">
<p>Отладчик позволяет наблюдать за переменными по мере перехода по коду. Это важно, например, при отслеживании изменения для отдельных значений переменных (без просмотра полного списка в окне "Переменные" для каждого шага) или при временном переходе к классу, не содержащему рассматриваемые переменные.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>Нажмите кнопок 'Вход в' ( <span class="image"><img src="images/step-into-btn.png" alt="step into btn"></span> ) для перехода к <code>ShoppingCart</code> к методу <code>addItem</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Последовательно шагайте по методу <code>addItem</code>, пока не достигните строки 53. Согласно документации Javadoc <code>addItem</code> <em>"добавляет элемент`ShoppingCartItem` в список <code>items</code> в файле <code>ShoppingCart</code>. Если указанный товар из списка <code>product</code> уже существует в списке корзины покупок, количество этого товара увеличивается."</em></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Изучите переменную <code>session</code>, для которой был создан параметр наблюдения (<a href="#step21">шаг 21</a> выше). Выражение <code>items.add(scItem)</code> на странице 51 добавляет новый экземпляр <code>ShoppingCartItem</code> в список <code>items</code> в <code>ShoppingCart</code>. Этот процесс можно проследить при переходе к третьему атрибуту, содержащемуся в сеансе (например, переменной <code>cart</code>).</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-window-add-item.png"><img src="images/variables-window-add-item.png" alt="variables window add item"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>На данном этапе можно изучить принцип создания <code>HttpSession</code> для запроса, создания объекта <code>ShoppingCart</code> и его прикрепления к сеансу, а также создания элемента <code>ShoppingCartItem</code> на основе пользовательского выбора продукта с последующим добавлением в список <code>items</code> файла <code>ShoppingCart</code>. Последним действием является переадресация запроса в представление <code>category.jsp</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Откройте в редакторе фрагмент JSP заголовка (<code>header.jspf</code>) и разместите точку останова в строке 86. Эта строка содержит оператор на языке выражений в пределах виджета корзины покупок, отображающего число элементов корзины.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoint-jsp.png" alt="breakpoint jsp">
</div>
<div class="title">Figure 16. Отладчик можно приостановить на страницах JSP</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Нажмите кнопку 'Продолжить' ( <span class="image"><img src="images/continue-btn.png" alt="continue btn"></span> ) на панели инструментов отладчика. Отладчик продолжает работу до завершения обработки или до следующей точки останова. В последнем случае отладчик приостанавливается на строке 86 фрагмента JSP заголовка.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> Чтобы отложить работу отладчика на странице JSP требуется контрольная точка. Например, если в файле <code>ControllerServlet</code> выполняется переадресация запроса в соответствующее представление, отладчик не будет автоматически приостановлен на странице JSP.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Откройте окно переменных (ALT+SHIFT+1; CTRL+SHIFT+1 в системе Mac OS), если оно еще не открыто. В отличие от классов Java отладчик <em>не</em> предоставляет подсказки при наведении курсора мыши на переменные или выражения на странице JSP. Однако диалоговое окно "Переменные" не позволяет определять значения переменных при переходе по коду. Где можно найти значение для переменной <code>${cart.numberOfItems}</code>?</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="28">
<li>
<p>Последовательно разверните в диалоговом окне "Переменные" узлы "Скрытые объекты" &gt; "pageContext" &gt; "session" &gt; "session" &gt; "attributes". В результате будет предоставлен доступ к объекту сеанса, как и при работе с файлом <code>ControllerServlet</code>. Обратите внимание, что сеанс, для которого на шаге 21 было создано наблюдение, указывает на сам объект. Здесь можно убедиться, что значение переменной <code>${cart.numberOfItems}</code> составляет &#8220;1&#8221;.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/variables-window-number-of-items.png"><img src="images/variables-window-number-of-items.png" alt="variables window number of items"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Разверните окно 'Переменные' или любое окно в IDE, щелкнув правой кнопкой мыши заголовок окна, а затем выбрав 'Развернуть окно' (Shift-Esc).</p>
</div>
<div class="paragraph">
<p>Отладчик предоставляет доступ к скрытому объекту <code>pageContext</code>. <code>pageContext</code> предоставляет контекст страницы JSP и открывает прямой доступ к различным объектам, включая объекты <code>HttpServletRequest</code>, <code>HttpSession</code> и <code>ServletContext</code>. Для получения дополнительных сведений обратитесь к <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bnahq.html#bnaij">Учебному курсу по Java EE 5: скрытые объекты</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="29">
<li>
<p>Нажмите кнопку 'Завершить сеанс' ( <span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span> ). Работа среды выполнения и сеанса отладки завершается. Браузер отображает страницу категорий с полной визуализацией, и виджет корзины покупок в заголовке страницы содержит один элемент.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Надеемся, что теперь использование отладчика среды IDE не только для анализа проекта при неожиданном поведении, но и в качестве средства изучения кода, не вызывает у вас затруднений. Ниже перечислены другие функциональные кнопки на панели инструментов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>( <span class="image"><img src="images/step-out.png" alt="step out"></span> ) <strong>Выход.</strong> Выполняется выход из вызова текущего метода. Выполняется обработка и удаление самого верхнего вызова метода в стеке вызовов.</p>
</li>
<li>
<p>( <span class="image"><img src="images/run-to-cursor.png" alt="run to cursor"></span> ) <strong>Переход к курсору</strong> Выполнение до строки, на которой размещен курсор.</p>
</li>
<li>
<p>( <span class="image"><img src="images/apply-code-changes.png" alt="apply code changes"></span> ) <strong>Применить изменения кода.</strong> После редактирования файла можно нажать эту кнопку, чтобы файл был повторно скомпилирован и изменения учитывались в сеансе отладки.</p>
</li>
<li>
<p>( <span class="image"><img src="images/step-over-expression.png" alt="step over expression"></span> ) <strong>Выражение обхода процедур.</strong> Позволяет просматривать входные параметры и получаемые выходные значения всех вызовов методов в выражении. Можно изучить выходные значения для предыдущего метода и входные параметры для следующего метода в диалоговом окне "Локальные переменные". При отсутствии дальнейших вызовов методов, режим работы выражения обхода процедур аналогичено команде Step Over ( <span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span> ).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-track">Изучение параметров отслеживания сеанса</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Существует три традиционных способа отслеживания сеансов между клиентом и сервером. Самым распространенным является способ с использованием файлов cookie. Перезапись URL-адресов можно применять в случае, если файлы cookie не поддерживаются или отключены. Скрытые поля формы также могут использоваться в качестве способа "ведения состояния" нескольких запросов, однако они ограничены использованием в пределах формы.</p>
</div>
<div class="paragraph">
<p>Проект <code>AffableBean</code> включает в себя пример метода скрытого поля на странице категорий и корзины. Кнопки "add to cart" и "update", отображаемые для элементов продукта, содержат скрытое поле, передающее идентификатор продукта на сервер при нажатии кнопки. При открытии страницы <code>cart.jsp</code> в редакторе можно заметить, что теги <code>&lt;form&gt;</code> содержат скрытое поле.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="updateCart" method="post"&gt;
    *&lt;input type="hidden"
           name="productId"
           value="${product.id}"&gt;*
    ...
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Таким образом, идентификатор продукта отправляется в виде параметра запроса, используемого сервером для идентификации элемента в пользовательской корзине, количество которой необходимо изменить.</p>
</div>
<div class="paragraph">
<p>Интерфейс API сервлета предоставляет высокоуровневый механизм для управления сеансами. Фактически он создает и передает файлы cookie между клиентом и сервером в каждом цикле "запрос-ответ". Если браузер клиента не принимает файлы cookie, механизм сервлета автоматически возвращается к перезаписи URL-адреса. Следующие два упражнения демонстрируют работу этой функции.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-monitor">Изучение обмена данными между сервером и клиентом с использованием монитора HTTP</a></p>
</li>
<li>
<p><a href="#url-rewrite">Ведение сеансов с перезаписью URL-адреса</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="http-monitor">Изучение обмена данными между сервером и клиентом с использованием монитора HTTP</h3>
<div class="paragraph">
<p>По умолчанию механизм сервлета использует файлы cookie для ведения и идентификации сеансов между запросами. Для каждого объекта сеанса создается случайный буквенно-цифровой номер, служащий уникальным идентификатором. Этот идентификатор передается в клиент как файл cookie <code>JSESSIONID</code>. При создании запроса клиентом механизм сервлета считывает значение файла cookie <code>JSESSIONID</code> для определения сеанса, к которому относится запрос.</p>
</div>
<div class="paragraph">
<p>Для наглядности отладчик используется вместе с монитором HTTP среды IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Начните работу с активации монитора HTTP для используемого сервера. Выберите элементы "Сервис" &gt; "Серверы". В левом столбце окна "Серверы" выберите используемый сервер (GlassFish). Затем выберите на главной панели режим "Включить монитор HTTP".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/servers-win-http-monitor.png" alt="servers win http monitor">
</div>
<div class="title">Figure 17. Выберите режим 'Включить монитор HTTP', чтобы активировать монитор HTTP</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Если сервер уже запущен, необходимо перезапустить его. Однако поскольку планируется использование отладчика, а при запуске отладчика выполняется перезапуск сервера для взаимодействия с другим портом, просто нажмите кнопку 'Отладка проекта' ( <span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span> ) на главной панели инструментов IDE. Будет выполнена перезагрузка сервера, запустится сеанс отладки, и в браузере откроется страница приветствия приложения. В нижней области среды IDE будет отображен монитор HTTP.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/http-monitor.png" alt="http monitor">
</div>
<div class="title">Figure 18. Монитор HTTP отображается по умолчанию в нижней области среды IDE</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Щелкните запись AffableBean в левом столбце (как показано на снимке выше). При выборе записей в левом столбце правый (т.е. главный) столбец обновляется для отображения соответствующих данных. На изображении выше вкладка "Запрос" отображает идентификатор URI запроса (<code>/AffableBean/</code>), метод HTTP (<code>GET</code>) и указывает на отсутствие отправки строки запроса вместе с запросом.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Выберите вкладку "Сеанс". Обратите внимание на утверждение: "Сеанс создан в результате этого запроса." Это вызвано отправкой сервером заголовка <code>Set-Cookie</code> для файла cookie <code>JSESSIONID</code> в качестве ответа. Также обратите внимание, что новый идентификатор сеанса указан в области "Свойства сеанса". Как будет продемонстрировано ниже, идентификатор сеанса представляет собой значение файла cookie <code>JSESSIONID</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-tab.png" alt="session tab">
</div>
<div class="title">Figure 19. Сведения о сеансе отображаются на вкладке 'Сеанс' в мониторе HTTP</div>
</div>
<div class="paragraph">
<p>Может возникнуть вопрос о способе создания объекта сеанса из запроса для страницы приветствия сайта. Ведь в файле <code>ControllerServlet</code> не выполняется обработка начального запроса для <code>/AffableBean/</code>, и этот запрос нигде не сталкивается с методом <code>getSession()</code>. Или сталкивается? Напомним, что страницы JSP скомпилированы в сервлеты при развертывании. При первом развертывании проекта на сервере можно фактически использовать среду IDE для просмотра скомпилированного сервлета JSP на собственном сервере.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>В окне 'Проекты' щелкните правой кнопкой мыши файл <code>index.jsp</code> и выберите 'Просмотреть сервлет'. В редакторе откроется файл <code>index_jsp.java</code>. Файл является сервлетом, автоматически скомпилированным на основе страницы <code>index.jsp</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Выполните в файле поиск метода <code>getSession</code>. Нажмите Ctrl-F (⌘-F в Mac), введите &#8216;getSession&#8217; на панели поиска, затем нажмите кклавишу Enter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ctrl-F (⌘-F в Mac) - это сочетание клавиш для 'Правка' &gt; 'Найти'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/get-session.png" alt="get session">
</div>
<div class="title">Figure 20. Метод getSession существует в скомпилированном сервлете страницы JSP</div>
</div>
<div class="paragraph">
<p>Фактически выполняется вызов метода <code>getSession</code>. Это вызвано тем, что страницы JSP по умолчанию включают в себя скрытый объект <code>pageContext.session</code>. Для деактивации этого поведения можно добавить следующую директиву в верхнюю область файла JSP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;%@page session="false" %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>, и метод`getSession` в скомпилированном сервлете будет деактивирован.</p>
</div>
<div class="paragraph">
<p>Для выяснения местоположения скомпилированного сервлета на сервере можно навести курсор мыши на вкладку с именем сервлета над редактором. Будет выведено всплывающее окно с путем к файлу на компьютере.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Выберите категорию в браузере и добавьте товар в корзину. Перейдите в среду IDE. Заметим, что отладчик приостанавливает работу на точке останова в <code>ControllerServlet</code>, поставленную ранее (на строке 150). Все точки останова между сеансами запоминаются. Для удаления точки останова можно щелкнуть метку точки останова ( <span class="image"><img src="images/breakpoint-badge.png" alt="breakpoint badge"></span> ) на левой границе редактора. Тем не менее, поскольку в проект уже добавлено несколько точек останова, откройте окно отладчика "Точки останова" ("Окно" &gt; "Отладка" &gt; "Точки останова").</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/breakpoints-window.png" alt="breakpoints window">
</div>
<div class="title">Figure 21. Просмотрите все точки останова в проекте в окне 'Точка останова'</div>
</div>
<div class="paragraph">
<p>В окне "Точки останова" можно просматривать и вызывать действия для всех точек останова, установленных в проектах, которые открыты в среде IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Щелкните правой кнопкой мыши точку останова, установленную в файле <code>header.jspf</code>, и выберите команду "Удалить". Then щелкните правой кнопкой мыши the breakpoint set in the <code>ControllerServlet</code> and choose Disable. (Позднее в этом упражнении будет выполнено ее повторное включение).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Нажмите кнопку 'Продолжить' ( <span class="image"><img src="images/continue-btn.png" alt="continue btn"></span> ). Обработка запроса завершается, и на странице категорий браузера выводится добавленный в корзину товар.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>В мониторе HTTP выполните поиск запроса <code>addToCart</code> в левом столбце, затем выберите его для отображения подробных данных в главном столбце.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Нажмите кнопку 'Сортировка по возрастанию' ( <span class="image"><img src="images/ascending-sort-btn.png" alt="ascending sort btn"></span> ), чтобы последние записи были указаны в верхней части.</p>
</div>
<div class="paragraph">
<p>Обратите внимание на идентификатор URI запроса (<code>/AffableBean/addToCart</code>), метод HTTP (<code>POST</code>) и параметры запроса (<code>productId</code> и <code>submit</code>) на вкладке "Запрос".</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/http-monitor-add-to-cart.png"><img src="images/http-monitor-add-to-cart.png" alt="http monitor add to cart"></a>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Выберите вкладку "Файлы cookie". Здесь отображаются данные о существовании файла cookie с именем <code>JSESSIONID</code> и его отправке от клиента на сервер. Обратите внимание, что значение файла cookie совпадает с идентификатором сеанса, отображаемом на вкладке "Сеанс".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cookies-tab.png" alt="cookies tab">
</div>
<div class="title">Figure 22. Файлы cookies отображаются на вкладке 'Файлы Cookies' в мониторе HTTP</div>
</div>
<div class="paragraph">
<p>Схожие данные представлены на вкладке "Заголовок", на которой отображается файл cookie, поскольку <code>Cookie</code> является заголовком запроса, отправленного клиентом.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/headers-tab.png" alt="headers tab">
</div>
<div class="title">Figure 23. Файлы cookies отображаются на вкладке 'Файлы Cookies' в мониторе HTTP</div>
</div>
<div class="paragraph">
<p>Для получения дополнительных сведений о заголовках запроса и ответа обратитесь к странице веб-энциклопедии Wikipedia <a href="http://en.wikipedia.org/wiki/List_of_HTTP_headers">Список заголовков HTTP</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Выберите вкладку "Сеанс". На вкладке отображается сообщение "Сеанс предшествует запросу". Также обратите внимание, что атрибут <code>cart</code> отображается в списке "Атрибуты сеанса после запроса". И это объяснимо, ведь объект <code>cart</code> привязывается к сеансу при первой обработке запроса <code>addToCart</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-tab-add-to-cart.png" alt="session tab add to cart">
</div>
<div class="title">Figure 24. Атрибуты сеанса отображаются на вкладке 'Сеанс' в мониторе HTTP</div>
</div>
<div class="paragraph">
<p>В следующих нескольких шагах рассматривается поиск идентификатора сеанса и файла cookie <code>JSESSIONID</code> в диалоговом окне "Переменные".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Снова активируйте точку останова, ранее установленную в файле <code>ControllerServlet</code>. Нажмите ALT+SHIFT+5 (CTRL+SHIFT+5 в Mac OS), чтобы открыть окно точек останова, затем установите флажок напротив точки останова, чтобы включить ее заново.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Нажмите в браузере кнопку "add to cart" для одного из перечисленных продуктов.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Перейдите в среду IDE и обратите внимание, что отладчик приостановился на точке останова, установленной в файле <code>ControllerServlet</code>. Нажмите кнопку 'Обход процедур' ( <span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span> ) для назначения переменной <code>session</code> объекту сеанса.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>Откройте окно "Переменные" (ALT+SHIFT+1; CTRL+SHIFT+1 в Mac OS), чтобы развернуть session &gt; session. Идентификатор сессии будет указан в качестве значения переменной <code>id</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>При поиске файла cookie <code>JSESSIONID</code> следует помнить, что обычно файл cookie доступен из сервлета при вызове метода <a href="http://java.sun.com/webservices/docs/1.6/api/javax/servlet/http/HttpServletRequest.html#getCookies%28%29">`getCookies`</a> в объекте <code>HttpServletRequest</code>. Поэтому перейдите к объекту запроса по пути: "request" &gt; "Inherited" &gt; "request" &gt; "request" &gt; "Inherited" &gt; "cookies". Здесь можно просмотреть список <code>файлов cookie</code> ArrayList. При развертке списка можно найти файл cookie <code>JSESSIONID</code>, значением которого является идентификатор сеанса.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Нажмите кнопку 'Завершить сеанс' ( <span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span> ), чтобы завершить сеанс отладки.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="url-rewrite">Ведение сеансов с перезаписью URL-адреса</h3>
<div class="paragraph">
<p>Как упоминалось выше, механизм сервлета обнаруживает возможность поддержки файлов cookie в браузере клиента, в случае невозможности поддержки механизм переходит к перезаписи URL-адреса как способа ведения сеансов. Эти процессы являются прозрачными для клиента. Для разработчиков процесс не является полностью прозрачным.</p>
</div>
<div class="paragraph">
<p>Необходимо убедиться, что приложение может перезаписывать URL-адреса при каждом отключении файлов cookie. Для этого вызовите метод отклика <code>encodeURL</code> для всех URL-адресов, возвращаемых сервлетами в приложении. В результате идентификатор сеанса будет добавлен к URL-адресу в случае, если использование файлов cookie невозможно; в противном случае URL-адрес будет возвращен без изменений.</p>
</div>
<div class="paragraph">
<p>Например, браузер отправляет запрос для третьей категории приложения <code>AffableBean</code> (bakery): <code>category?3</code>. Сервер отправляет в ответ идентификатор сеанса, включенный в URL-адрес:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">/AffableBean/category*;jsessionid=364b636d75d90a6e4d0085119990*?3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как описано выше, <em>все URL-адреса, возвращенные сервлетами приложения, необходимо зашифровать</em>. Помните, что страницы JSP компилируются в сервлеты. Как зашифровать URL-адреса на страницах JSP? Для этих целей необходимо использовать тег <a href="http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/c/url.html">`&lt;c:url&gt;`</a> JSTL. Следующие упражнения демонстрируют проблему и ее решение.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Временно отключите файлы cookie в браузере. При использовании Firefox можно выбрать пункт "Настройки" в меню "Инструменты" ("Firefox" &gt; "Параметры" в системе Mac). Выберите в открывшемся диалоговом окне вкладку "Приватность", затем выберите в области "История" пункт "будет использовать ваши настройки хранения истории" в предоставленном раскрывающемся списке. Снимите флажок параметра "Принимать cookie с сайтов".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/firefox.png" alt="firefox">
</div>
<div class="title">Figure 25. Временно отключите файлы cookie в браузере</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Запустите проект <code>AffableBean</code>. При отображении страницы приветствия щелкните категорию и попытайтесь добавить элемент в корзину. Обратите внимание, что функциональные возможности приложения строго ограничены.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/compromised.png" alt="compromised">
</div>
<div class="title">Figure 26. Для функций приложения возникает угроза в случае, если клиента не принимает файлы cookies</div>
</div>
<div class="paragraph">
<p>Как и ранее, сервер создает сеанс и привязывает к нему объекты. Это метод для отображения выбранной категории и продуктов на странице категорий. Тем не менее, при попытке установить файл cookie <code>JSESSIONID</code> на сервере происходит сбой. Следовательно, при повторном запросе клиента (когда пользователь нажмите кнопку "add to cart") сервер не может определить сеанс, к которому относится запрос. Поэтому невозможно найти атрибуты, ранее установленные в сеансе, например <code>selectedCategory</code> и <code>categoryProducts</code>. По этой причине в отображаемом ответе отсутствуют данные, определяемые этими атрибутами.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Откройте в редакторе страницу <code>category.jsp</code> проекта. Найдите строку, в которой реализуется кнопка "add to cart" (строка 58). Атрибут <code>action</code> элемента <code>&lt;form&gt;</code> определяет запрос, отправленный на сервер.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Измените запрос для его передачи посредством тега <code>&lt;c:url&gt;</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="*&lt;c:url value='addToCart'/&gt;*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Для сохранения изменений в файле нажмите сочетание клавиш CTRL+S (⌘-S в Mac). Помните, что среда IDE предоставляет функцию "Развертывание при сохранении", которая активна по умолчанию. Это означает, что все сохраненные изменения автоматически разворачиваются на сервере.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Выберите в браузере другую категорию для отображения в приложении измененной страницы категорий.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Изучите исходный код страницы. В Firefox можно нажать Ctrl-U (⌘-U в Mac). Отобразится кнопка "add to cart" для каждого продукта с идентификатором сеанса, добавленным к URL-адресу.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">&lt;form action="addToCart*;jsessionid=4188657e21d72f364e0782136dde*" method="post"&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Нажмите кнопку "add to cart" для любого товара. Теперь сервер способен определить сеанс, которому принадлежит запрос, и создает соответствующий ответ.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Перед продолжением убедитесь, что файлы cookie в браузере снова включены.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Снова возникает необходимость в шифровании каждой активной ссылки приложения, ответ которой требует определенной формы данных сеанса. Иногда реализация выполняется не так очевидно, как описывается в примере выше. Например, в настоящий момент виджет "clear cart", используемый на странице <code>cart.jsp</code>, устанавливает для параметра <code>clear</code> значение <code>true</code> при щелчке ссылки.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;
    &lt;a href="viewCart*?clear=true*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Тег <code>&lt;c:url&gt;</code> можно применить к URL-адресу следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;%-- clear cart widget --%&gt;
&lt;c:if test="${!empty cart &amp;amp;&amp;amp; cart.numberOfItems != 0}"&gt;

    *&lt;c:url var="url" value="viewCart"&gt;
        &lt;c:param name="clear" value="true"/&gt;
    &lt;/c:url&gt;*

    &lt;a href="*${url}*" class="bubble hMargin"&gt;clear cart&lt;/a&gt;
&lt;/c:if&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметр <code>clear=true</code> устанавливается путем добавления тега <code>&lt;c:param</code> между тегами <code>&lt;c:url&gt;</code>. Переменная <code>url</code> устанавливается при помощи атрибута <code>var</code> тега &lt;c:url&gt;, затем доступ к атрибуту <code>var</code> осуществляется в теге привязки HTML с использованием выражения <code>${url}</code>.</p>
</div>
<div class="paragraph">
<p>Можно загрузить и изучить <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">снимок 6</a> для просмотра способа шифрования всех ссылок проекта.</p>
</div>
<div class="paragraph">
<p>Перезапись URL-адреса следует использовать только в случае, если файлы cookie не доступны как метод отслеживания. Перезапись URL, по общему мнению, не является оптимальным решением, поскольку он предоставляет идентификатор сеанса в журналах, закладках, ссылочных заголовках и коде HTML в кэше, а также адресной строке браузера. Также для этого требуются ресурсы на стороне сервера, поскольку серверу необходимо выполнить дополнительные шаги для каждого входящего запроса, чтобы извлечь идентификатор сеанса из URL-адреса и согласовать с существующим сеансом.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="time-out">Обработка истечения времени ожидания сеанса</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#time-interval">Установка временных интервалов сеанса</a></p>
</li>
<li>
<p><a href="#programmatically">Автоматическая обработка истечения времени ожидания сеанса</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="time-interval">Установка временных интервалов сеанса</h3>
<div class="paragraph">
<p>Необходимо учитывать максимальный интервал времени, в который выполняется ведение сеансов. Если веб-сайт обрабатывает большой поток данных, большое число сеансов может занять весь объем памяти. Следовательно, необходимо сократить интервал для удаления неиспользуемых сеансов. С другой стороны, следует избегать излишнего сокращения сеансов, поскольку это может привести к проблемам использования веб-сайта, сказывающимся на эффективности работы. В примере проекта <code>AffableBean</code> пользователь переходит к кассе после заполнения корзины покупок товарами. Затем пользователь выходит из сети, например, чтобы найти кредитную карту для ввода данных карты. После входа в сеть пользователь заполняет форму на кассе и нажимает кнопку подтверждения. Однако время ожидания сеанса на сервере уже истекло. Корзина покупок становится пустой, и пользователь перенаправляется на домашнюю страницу. Найдется ли у пользователя время на повторение процесса?</p>
</div>
<div class="paragraph">
<p>Следующие шаги демонстрируют способы установки в проекте <code>AffableBean</code> в качестве интервала для истечения времени ожидания сеанса значения в 10 минут. Конечно, фактическая длительность в конечном счете зависит от ресурсов сервера, бизнес-целей приложения и популярности веб-сайта.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте в редакторе дескриптор развертывания приложения. Нажмите ALT+SHIFT+O (CTRL+SHIFT+O в Mac OS) для использования диалога "Перейти к файлу". Введите &#8220;web&#8221;, затем нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file.png" alt="go to file">
</div>
<div class="title">Figure 27. Диалоговое окно 'Переход к файлу' позволяет быстро перейти к файлам проекта</div>
</div>
<div class="paragraph">
<p>В редакторе будет выведен файл <code>web.xml</code> в представлении XML. Шаблон, предоставляемый NetBeans для файла <code>web.xml</code>, включает в себя по умолчанию параметр с интервалом в 30 минут.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;
        30
    &lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите вкладку "Общее" и введите в поле "Время ожидания сеанса" значение &#8220;10&#8221;.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-timeout.png" alt="session timeout">
</div>
<div class="title">Figure 28. Укажите время ожидания сеанса для приложения на вкладке 'Общие' файла web.xml</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Сохраните файл (сочетание клавиш Ctrl-S; ⌘-S в Mac).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При обратном переходе в представление XML можно заметить, что элемент <code>&lt;session-timeout&gt;</code> был обновлен.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;10&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> В качестве альтернативы вы можете полностью удалить элемент <code>&lt;session-timeout&gt;</code> и изменить элемент <code>session-properties</code> в дескрипторе развертывания, связанном с GlassFish (<code>sun-web.xml</code>). В результате будет установлено глобальное время ожидания для всех приложений в веб-модуле сервера. Получить более подробную информацию можно в руководстве <a href="http://docs.sun.com/app/docs/doc/821-1752/beaha">Oracle GlassFish Server 3.0.1 Application Development Guide: Creating and Managing Sessions</a> (Oracle GlassFish Server 3.0.1 Руководство по разработке приложений. Создание сеансов и управление ими).</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatically">Автоматическая обработка истечения времени ожидания сеанса</h3>
<div class="paragraph">
<p>Если приложение основано на сеансах, необходимо принять меры для обеспечения простоты и удобства обработки ситуаций, когда поступает запрос для сеанса, время ожидания которого истекло или который невозможно определить. Это можно выполнить в проекте <code>AffableBean</code>, создав простой фильтр, перехватывающий заголовки запросов в файле <code>ControllerServlet</code>. Фильтр проверяет факт существования сеанса; если сеанс не существует, он перенаправляет запрос на страницу приветствия сайта.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Начните работу с изучения проблемы, возникающей при истечении времени ожидания сеанса до его завершения из-за посещения сайта пользователем. Временно установите для времени ожидания сеанса значение в 1 минуту. Откройте дескриптор развертывания веб-приложения (<code>web.xml</code>) и введите значение &#8220;1&#8221; между тегами <code>&lt;session-timeout&gt;</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*1*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Запустите проект <code>AffableBean</code>. Щелкните на странице категорий в браузере, добавьте несколько элементов в корзину и щелкните ссылку "view cart".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cart-page-session-intact.png" alt="cart page session intact">
</div>
<div class="title">Figure 29. Страница корзины зависит от объекта сеанса при отображении элементов в покупательской корзине</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Подождите минимум 1 минуту.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Обновите количество для одного из товаров на странице корзины. (Допустимо любое число от 1 до 99.) Нажмите кнопку "update". Сервер отправит сообщение со статусом HTTP "500".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/glassfish-error-report.png" alt="glassfish error report">
</div>
<div class="title">Figure 30. NullPointerException возникает при получении запроса для сеанса, срок действия которого истек</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Изучите журнал сервера GlassFish в среде IDE. Откройте окно вывода (Ctrl-4; ⌘-4 в Mac) и перейдите на вкладку 'Сервер GlassFish'. Прокрутите до конца журнала для изучения трассировки стека ошибок.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/gf-server-output.png"><img src="images/gf-server-output.png" alt="gf server output"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Журнал сервера показывает, что исключение <code>NullPointerException</code> возникло в строке 184 <code>ControllerServlet</code>. В диалоговом окне "Вывод" появляется ссылка на строку, в которой возникло исключение.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Щелкните ссылку. Вы попадете прямо на строку 184 в <code>ControllerServlet</code>. При наведении курсора мыши на значок ошибки в левом поле редактора выводится всплывающая подсказка с описанием исключения.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/nullpointer-exception.png" alt="nullpointer exception">
</div>
<div class="title">Figure 31. Метка ошибки и подсказка указывают местоположение и причину проблемы</div>
</div>
<div class="paragraph">
<p>Поскольку время ожидания сеанса истекло до получения запроса, механизму сервлета не удалось связать запрос с соответствующим сеансом. Таким образом, оказалось невозможным обнаружить объект <code>cart</code> (строка 151). В конце концов, исключение произойдет на строке 184, когда попытка вызова метода по переменной, имеющей значение <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Проблема определена, для ее исправления необходимо реализовать фильтр.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Нажмите кнопку 'Создать файл' (<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>) на панели инструментов IDE. (В качестве альтернативы нажмите Ctrl-N; ⌘-N в Mac.)</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Выберите категорию "<strong>Веб</strong>", затем выберите <strong>"Фильтр"</strong> и нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Присвойте фильтру имя <code>SessionTimeoutFilter</code>. Введите текст <code>filter</code> в поле "Пакеты" для размещения класса фильтра в новом пакете при его создании.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Нажмите кнопку "Далее". Примите настройки по умолчанию и нажмите кнопку "Готово". Для фильтра <code>SessionTimeoutFilter</code> создается и открывается в редакторе шаблон.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> В настоящее время в NetBeans 6.9 не поддерживается использование мастера для задания сопоставления с сервлетом, которые не зарегистрирован в дескрипторе веб-развертывания. (<code>ControllerServlet</code> был зарегистрирован с помощью аннотации <code>@WebServlet</code>). Следовательно, необходимо изменить созданный код в следующем шаге.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Измените подпись аннотации <code>@WebFilter</code> следующим образом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebFilter(*servletNames = {"Controller"}*)
public class SessionTimeoutFilter implements Filter {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Фильтр с такими настройками будет перехватывать любой запрос, который управляется <code>ControllerServlet</code>. (Также можно сохранить атрибут <code>urlPatterns</code> и перечислить все шаблоны, обрабатываемые в файле <code>ControllerServlet</code>.)</p>
</div>
<div class="paragraph">
<p>Обратите внимание, что <code>Controller</code> является именем файла <code>ControllerServlet</code>, как указано в подписи аннотации <code>@WebServlet</code> сервлета. Заметим также, что атрибут <code>filterName</code> был удален, поскольку имя класса фильтра используется по умолчанию.</p>
</div>
<div class="paragraph">
<p>Шаблон фильтра среды IDE предоставляет множество примеров кода, которые рекомендуется изучить. Однако большая часть кода не потребуется для целей этого упражнения. Любой класс фильтра должен реализовывать интерфейс <code>Filter</code>, определяющий три метода.
* <strong><code>init</code>:</strong> выполняет действия после инициализации фильтра, но до его размещения в службе.
* <strong><code>destroy</code>:</strong> удаляет фильтр из службы. Этот метод может быть также использован для выполнения операций очистки.
* <strong><code>doFilter</code>:</strong> используется для выполнения операций для каждого запроса, перехваченного фильтром.</p>
</div>
<div class="paragraph">
<p>Используйте функцию поиска документации по индексу, чтобы вытянуть документацию по интерфейсу <code>Filter</code>. Нажмите сочетание клавиш SHIFT+F1 (fn+SHIFT+F1 в системе Mac), введите текст <code>Filter</code> в поле поиска и нажмите ENTER. Выберите запись "Interface in javax.servlet". Документация Javadoc выводится на нижней панели средства поиска по индексу.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Замените тело фильтра <code>SessionTimeoutFilter</code> на следующее содержимое.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebFilter(servletNames = {"Controller"})
public class SessionTimeoutFilter implements Filter {

    *public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;

        HttpSession session = req.getSession(false);

        // if session doesn't exist, forward user to welcome page
        if (session == null) {
            try {
                req.getRequestDispatcher("/index.jsp").forward(request, response);
            } catch (Exception ex) {
                ex.printStackTrace();
            }
            return;
        }

        chain.doFilter(request, response);
    }

    public void init(FilterConfig filterConfig) throws ServletException {}

    public void destroy() {}*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Нажмите Ctrl-Shift-I (⌘-Shift-I в Mac) для исправления операторов импорта. (Необходимо добавить импорт для <code>HttpServletRequest</code> и <code>HttpSession</code>.) Используйте подсказки редактора чтобы добавить аннотацию <code>@Override</code> к методам <code>init</code>, <code>destroy</code> и <code>doFilter</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В следующих шагах выполняется запуск отладчика для проекта и переход по методу <code>doFilter</code> для просмотра способа определения привязки запроса существующему сеансу.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Откройте окно точек останова (ALT+SHIFT+5; CTRL+SHIFT+5 в Mac OS) и удостоверьтесь, что не установлена ни одна точка останова. Для удаления точки останова щелкните правой кнопкой мыши точку останова и выбериет 'Удалить'. (Если было выполнено упражнение выше, <a href="#http-monitor">Examining Client-Server Communication with the HTTP Monitor</a> (Проверка соединения клиент-сервер с помощью HTTP-монитора), в <code>ControllerServlet</code> может быть установлена лишняя точка останова).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Запустите отладчик. Нажмите кнопку 'Отладка проекта' (<span class="image"><img src="images/debug-project-btn.png" alt="debug project btn"></span>) на главной панели инструментов IDE.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>При выводе страницы приветствия в браузере выберите категорию и добавьте несколько элементов в корзину покупок.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>Установите точку останова на строку принадлежащего фильтру <code>SessionTimeoutFilter</code> метода <code>doFilter</code>, который пытается получить доступ к сеансу (строка 32).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/filter-breakpoint.png" alt="filter breakpoint">
</div>
<div class="title">Figure 32. Установите точку останова в методе getSession</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Щелкните в браузере ссылку "view cart". Перейдите к среде IDE и обратите внимание, что отладчик приостановил работу в точке останова.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Учтите, что метод <code>getSession()</code> создает новый объект сеанса, если текущий объект не существует. В данном случае используется метод <code>getSession(false)</code>, который не создает новый объект, если объект не найден. Другими словами, метод возвращает значение <code>null</code>, если сеанс не существует.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="19">
<li>
<p>Нажмите кнопку 'Обход процедур' ( <span class="image"><img src="images/step-over-btn.png" alt="step over btn"></span> ), затем подведите курсор мыши к переменной <code>session</code>. При условии, что с момента отправки предыдущего запроса не прошла минута, переменная присваивается типу <code>StandardSessionFacade</code>. Он представляет объект сеанса для запроса.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-exists.png" alt="session exists">
</div>
<div class="title">Figure 33. Наведите курсор на переменные для определения их текущих значений</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="20">
<li>
<p>Продолжайте двигаться по строкам метода, пока запрос не будет обработан. Поскольку переменная <code>session</code> не равна <code>null</code>, можно пропустить выражение <code>if</code>, и фильтр <code>chain.doFilter</code> направит запрос прямо к <code>ControllerServlet</code> (строка 44).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="21">
<li>
<p>Перейдите в браузер, убедитесь, что прошла минута, и обновите количество для одного из элементов продукта в корзине. Это та же самая процедура, которая выполнялась ранее в упражнении с возвратом сообщения 500. Выясним, что происходит при истечении времени ожидания сеанса теперь, когда фильтр перехватывает заголовки запросов для файла <code>ControllerServlet</code>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="22">
<li>
<p>После щелчка элемента "Обновить" перейдите в среду IDE и обратите внимание, что отладчик снова приостановился на точке останова, установленной в фильтре.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="23">
<li>
<p>Выделите выражение <code>req.getSession(false)</code> и наведите на него курсор мыши. Обратите внимание, что выражение имеет значение <code>null</code>, поскольку время ожидания сеанса истекло.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/session-null.png" alt="session null">
</div>
<div class="title">Figure 34. Выделите выражения и наведите курсор мыши на них для определения их текущих значений</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="24">
<li>
<p>Продолжите переход по коду. Теперь переменная <code>session</code> равна <code>null</code>, выражение <code>if</code> на странице 35 обрабатывается, и запрос направляется прямо к <code>/index.jsp</code>. Когда отладчик завершает работу, в браузере выводится страница приветствия сайта.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="25">
<li>
<p>Нажмите кнопку 'Завершить сеанс' ( <span class="image"><img src="images/finish-session-btn.png" alt="finish session btn"></span> ), чтобы завершить сеанс отладки.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="26">
<li>
<p>Откройте файл <code>web.xml</code> проекта и снова измените время ожидания сеанса на 10 минут.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;session-config&gt;
    &lt;session-timeout&gt;*10*&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="27">
<li>
<p>Сохраните файл (Ctrl-S; ⌘-S в Mac).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot6.zip">Снимок 6</a> демонстрирует полную версию проекта для данного раздела руководства. Рассмотрим еще один вопрос, касающийся управления сеансом. Можно завершить сеанс явным образом, вызвав метод <code>invalidate</code> для объекта сеанса. Если сеанс больше не требуется, необходимо удалить его для сохранения доступной памяти на сервере. После завершения следующего раздела, <a href="transaction.html">Интеграция транзакционной бизнес-логики</a>, можно увидеть, как <code>ControllerServlet</code> после успешной обработки заказ клиента, уничтожает пользовательский объект <code>cart</code> и прерывает сессию, используя метод <code>invalidate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// if order processed successfully send user to confirmation page
if (orderId != 0) {

    // dissociate shopping cart from session
    cart = null;

    // end session
    session.invalidate();

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это демонстрируется в <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">проектный снимок 8</a> (и следующих снимках).</p>
</div>
<div class="paragraph">
<p>link:/about/contact_form.html?to=3&amp;subject=Feedback: NetBeans E-commerce Tutorial - Managing Sessions[Мы ждем ваших отзывов]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso">Дополнительные сведения</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_материалы_по_netbeans">Материалы по NetBeans</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../../../../features/java/debugger.html">IDE NetBeans Features: Debugger</a></p>
</li>
<li>
<p><a href="../../java/debug-multithreaded.html">Отладка многопоточных приложений</a></p>
</li>
<li>
<p><a href="../../java/debug-multithreaded-screencast.html">Видеообзор многопотоковой отладки с помощью IDE NetBeans</a></p>
</li>
<li>
<p><a href="../../java/debug-evaluator-screencast.html">Видео использования блока оценки фрагмента кода в отладчике NetBeans</a></p>
</li>
<li>
<p><a href="../../screencasts.html">Video Tutorials and Demos for IDE NetBeans 6.x</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">Таблица комбинаций клавиш и шаблонов кода</a></p>
</li>
<li>
<p><a href="../javaee-gettingstarted.html">Начало работы с приложениями для Java EE</a></p>
</li>
<li>
<p><a href="../javaee-intro.html">+Введение в технологию Java EE +</a></p>
</li>
<li>
<p><a href="../../../trails/java-ee.html">Учебная карта по Java EE и Java Web</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ресурсы_по_glassfish">Ресурсы по GlassFish</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.glassfish.java.net/Wiki.jsp?page=Screencasts">Экранные демонстрации GlassFish</a></p>
</li>
<li>
<p><a href="https://glassfish.dev.java.net/docs/index.html">Документация GlassFish v3</a></p>
</li>
<li>
<p><a href="http://www.sun.com/offers/details/GlassFish_Tomcat.html">Изучение GlassFish в Tomcat</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1751">Oracle GlassFish Server 3.0.1 Руководства администратора</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1750">Oracle GlassFish Server 3.0.1 Руководство по развертыванию приложений</a></p>
</li>
<li>
<p><a href="http://docs.sun.com/app/docs/doc/821-1752">Oracle GlassFish Server 3.0.1 Руководство по разработке приложений</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_технические_статьи_и_различные_ресурсы">Технические статьи и различные ресурсы</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/javaee/reference/code/">Примеры кода Java EE и приложения</a></p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/">Средство Javadoc</a>[домашняя страница продукта]</p>
</li>
<li>
<p><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">Принцип записи комментариев документации для средства Javadoc</a></p>
</li>
<li>
<p><a href="http://java.sun.com/products/servlet/Filters.html">Сущность фильтров</a></p>
</li>
<li>
<p><a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html">Шаблоны Core J2EE - перехватывающий фильтр</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/csajsp2.html">Учебные курсы по сервлетам начального и среднего уровней, JSP и JDBC</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/msajsp.html">Учебный курс по расширенным сервлетам и JSP</a></p>
</li>
<li>
<p><a href="http://courses.coreservlets.com/Course-Materials/java5.html">Учебные курсы по Java 5 и Java 6</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0211.html">JSTL для начинающих, часть 1: язык выражений</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-jstl0318/index.html">JSTL для начинающих, часть 2: подробное изучение</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/manage-sessions_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
