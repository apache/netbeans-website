
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans Eコマース チュートリアル－トランザクションビジネスロジックの統合</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans Eコマース チュートリアル－トランザクションビジネスロジックの統合 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, NetBeans Eコマース チュートリアル－トランザクションビジネスロジックの統合">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans Eコマース チュートリアル－トランザクションビジネスロジックの統合</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/transaction_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_チュートリアルの内容">チュートリアルの内容</a></li>
<li><a href="#overview">トランザクションの概要</a></li>
<li><a href="#projSnapshot">プロジェクトスナップショットを調べる</a></li>
<li><a href="#orderManager">OrderManager EJB を作成する</a></li>
<li><a href="#requestParam">リクエストパラメータを処理する</a></li>
<li><a href="#placeOrder">placeOrder とヘルパーメソッドの実装</a>
<ul class="sectlevel2">
<li><a href="#_addcustomer">addCustomer</a></li>
<li><a href="#_addorder">addOrder</a></li>
<li><a href="#_addordereditems">addOrderedItems</a></li>
</ul>
</li>
<li><a href="#entityManager">JPA EntityManager を利用する</a>
<ul class="sectlevel2">
<li><a href="#_addcustomer_2">addCustomer</a></li>
<li><a href="#_addorder_2">addOrder</a></li>
<li><a href="#_addordereditems_2">addOrderedItems</a></li>
</ul>
</li>
<li><a href="#persistenceContext">永続性コンテキストをデータベースに同期させる</a></li>
<li><a href="#transaction">トランザクションプログラムをセットアップする</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_はコードテンプレートをサポートします">NetBeans はコードテンプレートをサポートします</a></li>
</ul>
</li>
<li><a href="#validate">ユーザー入力を検証する</a>
<ul class="sectlevel2">
<li><a href="#client">クライアント側の検証</a></li>
<li><a href="#server">サーバー側の検証</a></li>
</ul>
</li>
<li><a href="#seeAlso">関連参照</a>
<ul class="sectlevel2">
<li><a href="#_netbeans_リソース">NetBeans リソース</a></li>
<li><a href="#_外部リソース">外部リソース</a></li>
</ul>
</li>
<li><a href="#_参照">参照</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_チュートリアルの内容">チュートリアルの内容</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="intro_ja.html">はじめに</a></p>
</li>
<li>
<p><a href="design_ja.html">アプリケーションの設計</a></p>
</li>
<li>
<p><a href="setup-dev-environ_ja.html">開発環境の設定</a></p>
</li>
<li>
<p><a href="data-model_ja.html">データモデルの設計</a></p>
</li>
<li>
<p><a href="page-views-controller_ja.html">ページビューとコントローラサーブレットの準備</a></p>
</li>
<li>
<p><a href="connect-db_ja.html">データベースへのアプリケーションの接続</a></p>
</li>
<li>
<p><a href="entity-session_ja.html">エンティティクラスとセッションBeanの追加</a></p>
</li>
<li>
<p><a href="manage-sessions_ja.html">セッションの管理</a></p>
</li>
<li>
<p><strong>トランザクションビジネスロジックの統合</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#overview">トランザクションの概要</a></p>
</li>
<li>
<p><a href="#projSnapshot">プロジェクトスナップショットを確認する</a></p>
</li>
<li>
<p><a href="#orderManager"><code>OrderManager</code> EJB を作成する</a></p>
</li>
<li>
<p><a href="#requestParam">リクエストパラメータを処理する</a></p>
</li>
<li>
<p><a href="#placeOrder"><code>placeOrder</code> と Helper Methods を実装する</a></p>
</li>
<li>
<p><a href="#entityManager">JPA の EntityManager を利用する</a></p>
</li>
<li>
<p><a href="#persistenceContext">永続性コンテキストとデータベースを同期させる</a></p>
</li>
<li>
<p><a href="#transaction">トランザクションプログラムをセットアップする</a></p>
</li>
<li>
<p><a href="#validate">ユーザー入力を検証する</a></p>
</li>
<li>
<p><a href="#seeAlso">関連参照</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p><a href="language_ja.html">言語サポートの追加</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p><a href="security.html">アプリケーションの保護</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p><a href="test-profile.html">アプリケーションの負荷テスト</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p><a href="conclusion_ja.html">まとめ</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images_www/articles/68/netbeans-stamp-68-69.png" alt="netbeans stamp 68 69">
</div>
<div class="title">Figure 1. Content on this page applies to NetBeans IDE, versions 6.8 and 6.9</div>
</div>
<div class="paragraph">
<p>この単元の目的は、Webリクエストからデータを収集し、それをバックエンドのデータベースに書き込む（EJBとJPAの技術によって提供された）オブジェクトリレーショナルマッピング（ ORM）機能の使い方をデモすることです。特に興味深いのは、 <em>container-managed</em> (コンテナ管理) トランザクション（ <a href="entity-session.html#gf-java-ee-container">GlassFish v3のJava EEのコンテナ図</a>を参照）のための EJB サポートです。いくつかの非侵入型の注釈を適用することにより、EJBクラスをトランザクションマネージャに変換することができます、それによってデータベースに含まれているデータの整合性を確保します。言い換えれば、トランザクションマネージャは、一つの作業単位（一つの仕事の固まり）として、データベースへの複数書き込みアクションを処理します。これは、作業単位がそれをまとめて処理するか、または、もし処理中のある時点でエラーが発生したら、それまでのデータベースへの変更をすべて処理前の状態に戻し（ロールバックし）ます。</p>
</div>
<div class="paragraph">
<p><code>AffableBean</code> アプリケーションのコンテキスト内で、この単元はチェックアウトフォームからデータが受信された時の customer order (顧客注文)の処理に焦点を当てています。あなたは <code>OrderManager</code> EJB を作成して、セッション <code>cart</code> オブジェクトと共にチェックアウトのフォームデータを処理します。 <code>OrderManager</code> は <code>affablebean</code> データベースへの複数の書き込みアクションの入ったトランザクションを実行します。いずれかのアクションが失敗した場合、トランザクションはロールバックされます。</p>
</div>
<div class="paragraph">
<p>あなたはこのチュートリアルで構築するアプリケーションのライブデモを見ることができます： <a href="http://services.netbeans.org/AffableBean/">NetBeans E コマース チュートリアル デモアプリケーション</a>。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java バンドル版, 6.8 または 6.9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://java.sun.com/javase/downloads/index.jsp">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v3または Open Source Edition 3.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dev.mysql.com/downloads/mysql/">MySQL データベースサーバー</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン 5.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot7.zip">AffableBean プロジェクト</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スナップショット 7</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>メモ：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>NetBeans IDE を正常に実行するには Java 開発キット（ JDK）が必要です。上記のリソースが全くない場合、あなたは、JDK を最初にダウンロードしてインストールする必要があります。</p>
</li>
<li>
<p>NetBeans IDE Java バンドル版には、このチュートリアルで構築するアプリケーションで必要とされる Java Web と JAVA EE 技術が入っています。</p>
</li>
<li>
<p>NetBeans IDE Java バンドル版には、また、このチュートリアルに必要な GlassFish サーバーが入っています。あなたは <a href="https://glassfish.dev.java.net/public/downloadsindex.html">個別にGlassFishサーバーをダウンロード</a>できますが、NetBeans の提供するバージョンをダウンロードすれば、自動的に IDE に登録される利点があります。</p>
</li>
<li>
<p>あなたは、以前の単元を完了することなく、このチュートリアルで単元を追うことができます。そうするには、<a href="setup.html">セットアップ手順</a>を参照してください、手順には、データベースを準備する方法と、 IDEと GlassFishとMySQL 間の接続を確立する方法について説明してあります。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview">トランザクションの概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>顧客のショッピングカートに入っているアイテム(商品)、同様にチェックアウトフォームからのデータを処理するために、あなたは、<code>OrderManager</code> EJB を作成します。 <code>OrderManager</code> は 提供されたデータを使用して、データベースに以下の書き込みアクションを実行します：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新しい <code>Customer</code> レコードが追加されます。</p>
</li>
<li>
<p>新しい <code>CustomerOrder</code> レコードが追加されます。</p>
</li>
<li>
<p>新しい <code>OrderedProduct</code> レコードは、<code>ShoppingCart</code> に入っているアイテム順に追加されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>我々は、<code>placeOrder</code> メソッドを作成してこれを実装します。このメソッドは３つの書き込みアクションを実行します。プライベートヘルパーメソッド、 <code>addCustomer</code>、 <code>addOrder</code>、および <code>addOrderedItems</code> を順次呼び出すことによって実行されます。また、3つのヘルパーメソッドをクラスに実装します。EJB コンテナ管理のトランザクションサービスを活用するには、２つのアノテーションだけが必要です。これらは：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://java.sun.com/javaee/6/docs/api/javax/ejb/TransactionManagement.html">`@TransactionManagement`</a><code>(`<a href="http://java.sun.com/javaee/6/docs/api/javax/ejb/TransactionManagementType.html">+`TransactionManagementType</code>+</a>.<code><em>CONTAINER</em>)</code>:クラスで発生する全てのトランザクションがコンテナ管理されることを指示するために使われます。</p>
</li>
<li>
<p><a href="http://java.sun.com/javaee/6/docs/api/javax/ejb/TransactionAttribute.html">`@TransactionAttribute`</a><code>(`<a href="http://java.sun.com/javaee/6/docs/api/javax/ejb/TransactionAttributeType.html">+`TransactionAttributeType</code>+</a>.<code><em>REQUIRED</em>)</code>: 作成されるべき新しいトランザクションを指示するためのトランザクションを起動するメソッドで使われます。（まだ存在していない場合）。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/transaction-diagram.png" alt="transaction diagram">
</div>
<div class="title">Figure 2. Several write actions are performed within a single transaction</div>
</div>
<div class="paragraph">
<p>我々はより大きなコンテキストの中にトランザクションを実装しているので、我々はそれをいくつかの簡単に消化しやすタスクに分けてこの課題に取り組みます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#projSnapshot">プロジェクトスナップショットを調べる</a></p>
</li>
<li>
<p><a href="#orderManager">OrderManager EJBを作成する</a></p>
</li>
<li>
<p><a href="#requestParam">リクエストパラメータを処理する</a></p>
</li>
<li>
<p><a href="#placeOrder"><code>placeOrder</code> とヘルパーメソッド を実装する</a></p>
</li>
<li>
<p><a href="#entityManager">JPA EntityManager を利用する</a></p>
</li>
<li>
<p><a href="#persistenceContext">データベースと永続性コンテキストを同期させる</a></p>
</li>
<li>
<p><a href="#transaction">トランザクションプログラムをセットアップする</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="projSnapshot">プロジェクトスナップショットを調べる</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この単元に関連付けられたプロジェクト スナップショットを調べることから始めます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEに、この単元用の<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot7.zip">プロジェクト スナップショット</a>を開きます。プロジェクトを開く( <span class="image"><img src="images/open-project-btn.png" alt="open project btn"></span> ) ボタンををクリックして、ウィザードを使用し、お使いのコンピュータにプロジェクトをダウンロードした場所を指示します。あなたが<a href="manage-sessions.html">前の単元</a>から進んでいる場合 、注意して下さい。このプロジェクトのスナップショットは、前の単元の完了後のプロジェクトの状態と同一ですが、以下の例外があります：</p>
<div class="ulist">
<ul>
<li>
<p><code>confirmation.jsp</code> ページが完全に実装されています。</p>
</li>
<li>
<p><code>affablebean.css</code> スタイルシートに <code>confirmation.jsp</code> ページを実装するための特有のルールが入っています。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>プロジェクトを実行 ( <span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span> )し、データベースとアプリケーションサーバを適切に構成していることを確認してください。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>プロジェクトを実行した時、エラーを受け取った場合は、<a href="setup.html">セットアップ手順</a>を再び見ます。そこに「データベースを準備して、IDE、GlassFish 、MySQL 間の接続を確立する方法」が書かれています。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>ブラウザでアプリケーションの機能をテストします。具体的には、全ての <a href="design.html#business">+ ビジネスプロセスフロー+</a> をステップ実行します。チェックアウトのページから [ submit an order(注文を送信する) ] をクリックすると、現在の確認ページが以下のように表示されます：</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/confirmation-page-start.png" alt="confirmation page start">
</div>
<div class="title">Figure 3. Confirmation page displays without any data relating to the processed order</div>
</div>
<div class="paragraph">
<p>確認ページには、注文に関するデータは何も表示されません。実際、現在の状態で、アプリケーションはチェックアウトのフォームからのデータに何もしていません。この単元の終わりには、アプリケーションは顧客データを収集しそれを使って注文を処理しているでしょう。最終の状態では、アプリケーションは確認ページに処理した注文の要約を表示し、ユーザの <code>ShoppingCart（ショッピングカート）</code> を削除して、ユーザセッションを終了しているでしょう。 (<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">スナップショット8</a>チェックアウトフォームが送信された時、リクエスト－レスポンスサイクルを完了する。)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="orderManager">OrderManager EJB を作成する</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDE ツールバーの [ New File(新規ファイル)] ( <span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span> ) ボタンをクリックします。（または Ctrl - n を押す、⌘ - n Mac）。[New File(新規ファイル)] のウィザードで、[ Java EE カテゴリ] を選択し、次に [Session BeanセッションBean] を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>[次へ]をクリック。[EJB Name]に [ <code>OrderManager</code> ] と入れ、Package(パッケージ) に [<code>session</code> (セッション)] をセット、他のデフォルト設定を受け入れます。 （ステートレスセッションBeanを作成します。ウィザードは Bean のインターフェイスを生成しません。 ）</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-wizard.png" alt="ejb wizard">
</div>
<div class="title">Figure 4. Create a stateless EJB session bean using the Session Bean wizard</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>[Finish] をクリックします。新しい <code>OrderManager</code> クラスが生成され、エディタに開きます。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requestParam">リクエストパラメータを処理する</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトの <code>ControllerServlet</code> を開きます。（プロジェクトウィンドウで ControllerServlet を選ぶか、またはAlt - Shift - O（Ctrl - Shift - O Mac）を押し [Go to File] ダイアログを使います。）</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>`/purchase`リクエストが実装されいる doPost メソッド内のエリアに行きます（１９０行目）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ctrl - G を押し、[Go To Line] ダイアログを使用します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-line.png" alt="go to line">
</div>
<div class="title">Figure 5. Use the Go to Line dialog to quickly navigate to a specific line</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>送信されたチェックアウトフォームからパラメータを抽出するコードを実装します。「<code>TODO: Implement purchase action</code>」コメントを探し、それを削除し、以下を追加します：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// if purchase action is called
} else if (userPath.equals("/purchase")) {

    *if (cart != null) {

        // extract user data from request
        String name = request.getParameter("name");
        String email = request.getParameter("email");
        String phone = request.getParameter("phone");
        String address = request.getParameter("address");
        String cityRegion = request.getParameter("cityRegion");
        String ccNumber = request.getParameter("creditcard");
    }*

    userPath = "/confirmation";
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="placeOrder">placeOrder とヘルパーメソッドの実装</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ControllerServlet</code> で、<code>OrderManager</code> EJB への参照を追加します。そのクラスの先頭にスクロールし、すでにリストされている session facade EJB（セッションファサード EJB）の下に参照を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class ControllerServlet extends HttpServlet {

    private String userPath;
    private String surcharge;
    private ShoppingCart cart;

    @EJB
    private CategoryFacade categoryFacade;
    @EJB
    private ProductFacade productFacade;
    *@EJB
    private OrderManager orderManager;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Ctrl - Shift - I （⌘：- Shift Mac）を押し、エディタが <code>session.OrderManager</code> にインポート文を追加できるようにします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>抽出されたパラメータとセッション <code>cart</code> オブジェクトも同様に、<code>OrderManager.placeOrder</code> メソッドの引数として使います。次のコードを追加します：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// if purchase action is called
} else if (userPath.equals("/purchase")) {

    if (cart != null) {

        // extract user data from request
        String name = request.getParameter("name");
        String email = request.getParameter("email");
        String phone = request.getParameter("phone");
        String address = request.getParameter("address");
        String cityRegion = request.getParameter("cityRegion");
        String ccNumber = request.getParameter("creditcard");

        *int orderId = orderManager.placeOrder(name, email, phone, address, cityRegion, ccNumber, cart);*
    }

    userPath = "/confirmation";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>私たちは、まだ <code>placeOrder</code> メソッドを作成していないことに注意してください。エディタがエラーフラグを立てている理由がこれです。あなたは左余白に表示されるチップを使用できます。チップは、あなたが適切なクラスの中にメソッドのシグネチャを生成することができるようにします。</p>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/tool-tip-create-method.png"><img src="images/tool-tip-create-method.png" alt="tool tip create method"></a>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>[ tip ] をクリックします。 IDE は <code>placeOrder</code> メソッド を <code>OrderManager</code> クラスの中に 生成します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class OrderManager {

    *public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {
        throw new UnsupportedOperationException("Not yet implemented");
    }*

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cart.ShoppingCart</code> の import 文も同様に自動的にファイルの先頭に挿入されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>新しい <code>placeOrder</code> メソッドで、メソッドの引数を使用して、 ヘルパーメソッド（まだ存在しない）への呼び出しを行います。次のように入力してください：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    *Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
    CustomerOrder order = addOrder(customer, cart);
    addOrderedItems(order, cart);*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>私たちは、データベースの制約のために特定の順序に従う必要があります。たとえば、 <code>Customer</code> レコードは、<code>CustomerOrder</code> の前に作成される必要があります。というのは、<code>CustomerOrder</code> は <code>Customer`を参照する必要があるからです。同様に `OrderedItem</code> レコードは既にある <code>CustomerOrder</code> への参照を必要とします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Ctrl-Shift-I （⌘-Shift Macの場合）を押して、import を固定します。 <code>entity.Customer</code> と <code>entity.CustomerOrder</code> のインポート文が、自動的にファイルの先頭に追加されます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>エディターのヒントを使い、<code>addCustomer</code>, <code>addOrder</code>, と <code>addOrderedItems</code> 用のメソッドシグニチャをIDEに生成させます。３つのヒントを利用した後の、<code>OrderManager</code> クラスは以下のようになります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class OrderManager {

    public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

        Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
        CustomerOrder order = addOrder(customer, cart);
        addOrderedItems(order, cart);
    }

    *private Customer addCustomer(String name, String email, String phone, String address, String cityRegion, String ccNumber) {
        throw new UnsupportedOperationException("Not yet implemented");
    }

    private CustomerOrder addOrder(Customer customer, ShoppingCart cart) {
        throw new UnsupportedOperationException("Not yet implemented");
    }

    private void addOrderedItems(CustomerOrder order, ShoppingCart cart) {
        throw new UnsupportedOperationException("Not yet implemented");
    }*

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで留意すべきは、まだエディタにエラーフラグが立っていることです。そのメソッドに現在 return 文がないという事実によります。<code>placeOrder</code> シグニチャは、「そのメソッドは <code>int</code> を返す」ように指示しています。あとでデモしますが、それが成功裏に処理されると、そのメソッドは order ID を返します。それ以外の場合は、 <code>0</code> が返されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>次の return 文を入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
    CustomerOrder order = addOrder(customer, cart);
    addOrderedItems(order, cart);
    *return order.getId();*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この段階で、<code>OrderManager</code> クラスのエラー はすべて解決されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>3つのヘルパーメソッドの実装から始めます。今のところ、各メソッドの入力パラメータに新しいエンティティオブジェクトを生成させるコードを単に追加するだけです。</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_addcustomer">addCustomer</h3>
<div class="paragraph">
<p>新しい <code>Customer</code> オブジェクトを作成しそのオブジェクトを返します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Customer addCustomer(String name, String email, String phone, String address, String cityRegion, String ccNumber) {

    *Customer customer = new Customer();
    customer.setName(name);
    customer.setEmail(email);
    customer.setPhone(phone);
    customer.setAddress(address);
    customer.setCityRegion(cityRegion);
    customer.setCcNumber(ccNumber);

    return customer;*
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_addorder">addOrder</h3>
<div class="paragraph">
<p>新しい <code>CustomerOrder</code> オブジェクトを作成しそのオブジェクトを返します。 <code>java.util.Random</code> クラスを使いランダムな confirmation（確認）番号を生成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private CustomerOrder addOrder(Customer customer, ShoppingCart cart) {

    *// set up customer order
    CustomerOrder order = new CustomerOrder();
    order.setCustomer(customer);
    order.setAmount(BigDecimal.valueOf(cart.getTotal()));

    // create confirmation number
    Random random = new Random();
    int i = random.nextInt(999999999);
    order.setConfirmationNumber(i);

    return order;*
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_addordereditems">addOrderedItems</h3>
<div class="paragraph">
<p><code>ShoppingCart</code> を反復処理して、<code>OrderedProduct</code> を作成します。 <code>OrderedProduct</code> を生成するために、あなたは <code>OrderedProductPK</code> エンティティクラス使用することができます。インスタンス化した <code>OrderedProductPK</code> は、<code>OrderedProduct</code> コンストラクタに渡すことができます は、デモを以下に示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void addOrderedItems(CustomerOrder order, ShoppingCart cart) {

    *List&lt;ShoppingCartItem&gt; items = cart.getItems();

    // iterate through shopping cart and create OrderedProducts
    for (ShoppingCartItem scItem : items) {

        int productId = scItem.getProduct().getId();

        // set up primary key object
        OrderedProductPK orderedProductPK = new OrderedProductPK();
        orderedProductPK.setCustomerOrderId(order.getId());
        orderedProductPK.setProductId(productId);

        // create ordered item using PK object
        OrderedProduct orderedItem = new OrderedProduct(orderedProductPK);

        // set quantity
        orderedItem.setQuantity(scItem.getQuantity());
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Ctrl-Shift-I（⌘-Shift Macの場合）を押して、importを固定します。ダイアログが開き、インポートされるすべてのクラスを表示します。ダイアログに`java.util.List` が正しく示されていることに注意してください。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fix-all-imports.png" alt="fix all imports">
</div>
<div class="title">Figure 6. Press Ctrl-Shift-I to fix imports in a file</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>[ OK ]をクリックします。必要なすべてのインポート文が追加され、そのクラスのコンパイラエラーがなくなります。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entityManager">JPA EntityManager を利用する</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="entity-session.html">「エンティティクラスとセッションBeanを追加する」</a>で説明したように 、 <code>EntityManager</code> API は JPA に含まれており、データベースの永続性操作を実行する責任を持っています。<code>AffableBean</code> プロジェクトで、すべての EJB は <code>EntityManager</code> を採用しています。デモのために、エディタで任意のセッションファサード Bean を開きます。注意してください。そのクラスは <code>@PersistenceContext</code> 注釈を使用して、コンテナ管理 <code>EntityManager</code> への依存関係と、それに関連した永続コンテキスト ( <code>persistence.xml</code> ファイルに指定されているように`AffableBeanPU` ）を表現します。たとえば、 <code>ProductFacade</code> Bean は次のようになります：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class ProductFacade extends AbstractFacade&lt;Product&gt; {
    *@PersistenceContext(unitName = "AffableBeanPU")
    private EntityManager em;*

    protected EntityManager getEntityManager() {
        return em;
    }

    ...

    // manually created
    public List&lt;Product&gt; findForCategory(Category category) {
        return em.createQuery("SELECT p FROM Product p WHERE p.category = :category").
               setParameter("category", category).getResultList();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>データベースへ書き込みできるようにするために、<code>OrderManager</code> EJB は同様の手段を取る必要があります。<code>EntityManager</code> インスタンスで、そこで我々はヘルパーメソッド（<code>addCustomer</code>、<code>addOrder</code>、 <code>addOrderedItems</code>）を変更することができます。そして、ヘルパーメソッドが作成したエンティティオブジェクトがデータベースに書き込まれます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>OrderManager</code> で、<code>@PersistenceContext</code> 注釈を適用して、コンテナ管理 <code>EntityManager</code> と <code>AffableBeanPU</code> 永続コンテキストとの依存関係を表現します。また、 <code>EntityManager</code> インスタンスを宣言します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class OrderManager {

    *@PersistenceContext(unitName = "AffableBeanPU")
    private EntityManager em;*

    ...
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Ctrl-Shift-I（⌘:-Shift-I Macの場合）を押して、import を固定します。 <code>javax.persistence.EntityManager</code> と <code>javax.persistence.PersistenceContext</code> 用のインポート文がそのクラスの先頭に追加されます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>EntityManager</code> を使用して、 データベースに書き込まれるエンティティオブジェクトをマークします。これは、 <code>EntityManager</code> API の <code>persist</code> メソッドを使用して達成されます。ヘルパーメソッドに次の変更をします。</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_addcustomer_2">addCustomer</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Customer addCustomer(String name, String email, String phone, String address, String cityRegion, String ccNumber) {

    Customer customer = new Customer();
    customer.setName(name);
    customer.setEmail(email);
    customer.setPhone(phone);
    customer.setAddress(address);
    customer.setCityRegion(cityRegion);
    customer.setCcNumber(ccNumber);

    *em.persist(customer);*
    return customer;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_addorder_2">addOrder</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private CustomerOrder addOrder(Customer customer, ShoppingCart cart) {

    // set up customer order
    CustomerOrder order = new CustomerOrder();
    order.setCustomer(customer);
    order.setAmount(BigDecimal.valueOf(cart.getTotal()));

    // create confirmation number
    Random random = new Random();
    int i = random.nextInt(999999999);
    order.setConfirmationNumber(i);

    *em.persist(order);*
    return order;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_addordereditems_2">addOrderedItems</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void addOrderedItems(CustomerOrder order, ShoppingCart cart) {

    List&lt;ShoppingCartItem&gt; items = cart.getItems();

    // iterate through shopping cart and create OrderedProducts
    for (ShoppingCartItem scItem : items) {

        int productId = scItem.getProduct().getId();

        // set up primary key object
        OrderedProductPK orderedProductPK = new OrderedProductPK();
        orderedProductPK.setCustomerOrderId(order.getId());
        orderedProductPK.setProductId(productId);

        // create ordered item using PK object
        OrderedProduct orderedItem = new OrderedProduct(orderedProductPK);

        // set quantity
        orderedItem.setQuantity(String.valueOf(scItem.getQuantity()));

        *em.persist(orderedItem);*
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>EntityManager</code> の <code>persist`メソッドは、すぐにターゲットオブジェクトをデータベースへ書き込みしません。これをより正確に説明するために、 `persist</code> メソッドはオブジェクトを <em>persistence context</em> に配置します。つまり、 <code>EntityManager</code> は、そのエンティティオブジェクトがデータベースと同期されることを保障する責任を取ります。永続コンテキストを <code>EntityManager</code> で使われる中間物と考えて、オブジェクト 領域とリレーショナル領域の間でエンティティを渡します。（だから、オブジェクトリレーショナルマッピング&#8217;といいます）</p>
</div>
<div class="paragraph">
<p>永続コンテキストのスコープ(範囲)は何ですか？ あなたが、IDE Javadoc 索引検索（ Shift-F1、Shift-fn Macで）を開いて、<a href="http://java.sun.com/javaee/6/docs/api/javax/persistence/PersistenceContext.html">`@PersistenceContext`</a> 注釈の Javadoc ドキュメントを調べる場合、次のことに注意してください。タイプ要素は、「トランザクション永続化コンテキストか、または拡張された永続化コンテキストのどちらが使われるうべきかを指示する）」)ために使われます。<em>transaction-scoped</em> の永続コンテキストが、または拡張永続コンテキストが使用されます。<em>transaction-scoped</em> 永続コンテキストはトランザクションの開始時に作成され、トランザクション エンドで終了します。 そして、<em>extended</em> (拡張) 永続コンテキストは、ステートフルセッション Bean だけに適用されます、そして複数のトランザクションの橋渡しをします。 Javadoc ドキュメントはまた、私たちに「 <code>javax.persistence.PersistenceContextType.TRANSACTION</code> は <code>type</code> 要素のデフォルト値である。」と教えています。したがって、我々は、<code>EntityManager</code> がトランザクションスコープ永続コンテキストにオブジェクトを置くよう指示しませんでしたが、実際に、これがコンテナ管理 <code>EntityManager</code> が デフォルトでふるまう方法なのです。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistenceContext">永続性コンテキストをデータベースに同期させる</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この段階では、そのトランザクションまたはトランザクションがないと思うかもしれませんが、 <code>OrderManager</code> は正常にエンティティオブジェクトをデータベースに書くことができます。プロジェクトを実行し、どのようにcustomer orders(顧客の注文)が、現在、処理されるか見てください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>F6 キーを押し（ fn-F6 Macの場合）、プロジェクトを実行します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="design.html#business">ビジネスプロセスフロー</a>をステップ実行します。チェックアウトのページに到着する時に書き込み動作が実行されるてもSQLエラーを起こさないとあなたが知っているデータを確実に入力してください。（検証は後の単元で説明します。 ）たとえば、チェックアウトのフォームに次のように入力してください：</p>
<div class="ulist">
<ul>
<li>
<p><strong>name:</strong> <code>Hugo Reyes</code></p>
</li>
<li>
<p><strong>email:</strong> ` hurley @ mrcluck.com `</p>
</li>
<li>
<p><strong>phone:</strong> <code>606252924</code></p>
</li>
<li>
<p><strong>address:</strong> <code>Karlova 33</code></p>
</li>
<li>
<p><strong>prague:</strong> <code>1</code></p>
</li>
<li>
<p><strong>credit card number:</strong> <code>1111222233334444</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>以後の手順では、IDE の出力ウィンドウのサーバーログを調べます。チェックアウトフォームを送信する前に、出力ウィンドウを開いてサーバーのログをクリアします。あなたはサーバーログを右クリックして[ Clear クリア] (Ctrl-L; ⌘-L Mac)を選択することでできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>['submit purchase' (購入送信)] ボタンををクリックします。サーバーは HTTP ステータス500 メッセージを返します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf-error-report.png" alt="gf error report">
</div>
<div class="title">Figure 7. Server responds with an HTTP status 500 message</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>DEにスイッチして、サーバーログを調べます。サーバーログは、[ GlassFish サーバー]タブの下の[Output(出力)ウィンドウ]（Ctrl-4 、⌘-4 Macの場合）にあります。あなたは次のテキストを見つけます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">WARNING: A system exception occurred during an invocation on EJB OrderManager method
public int session.OrderManager.placeOrder(java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,cart.ShoppingCart)
javax.ejb.EJBException
...
Caused by: java.lang.NullPointerException
        [.underline]#at session.OrderManager.addOrderedItems(OrderManager.java:75)#
        [.underline]#at session.OrderManager.placeOrder(OrderManager.java:33)#</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力ウィンドウを最大化するには、Shift + Esc キーを押します。</p>
</div>
<div class="paragraph">
<p>サーバーログに表示された下線は、エラーが発生したソースファイルの該当行への直接リンクです。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p><code>session.OrderManager.addOrderedItems</code> リンクをクリックします。エディタは例外を引き起こしている行を表示します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/null-pointer-exception.png" alt="null pointer exception">
</div>
<div class="title">Figure 8. Click links in server output window to navigate directly to offending lines in source files</div>
</div>
<div class="paragraph">
<p>なぜ、<code>order.getId</code> メソッドが`null`を返したかを理解するために、どのようなコードが実際に実行されようとしているか考えてみましょう。 <code>getId</code> メソッドは、生成されたプロセスに現在存在する order の ID 取得を試みます。IDは自動でインクリメントされる主キーなので、データベースは、レコードが追加された時のみ自動的に値を生成します。これを行うもう一つの方法は、手動で永続コンテキストとデータベースとを同期させることです。これは <code>EntityManager</code> の <a href="http://java.sun.com/javaee/6/docs/api/javax/persistence/EntityManager.html#flush%28%29">`flush`</a> メソッドを使用して行うことができます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p><code>addOrderedItems</code> メソッドで、flush を呼び出して、データベースに永続化コンテキストを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void addOrderedItems(CustomerOrder order, ShoppingCart cart) {

    *em.flush();*

    List&lt;ShoppingCartItem&gt; items = cart.getItems();

    // iterate through shopping cart and create OrderedProducts
    for (ShoppingCartItem scItem : items) {

        int productId = scItem.getProduct().getId();

        // set up primary key object
        OrderedProductPK orderedProductPK = new OrderedProductPK();
        orderedProductPK.setCustomerOrderId(order.getId());
        orderedProductPK.setProductId(productId);

        // create ordered item using PK object
        OrderedProduct orderedItem = new OrderedProduct(orderedProductPK);

        // set quantity
        orderedItem.setQuantity(String.valueOf(scItem.getQuantity()));

        em.persist(orderedItem);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>プロジェクトに戻り、ビジネスプロセスの流れをステップ実行します。今回は、チェックアウトフォームを送信したとき、確認ページが表示されます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>データベースに記録されている詳細を確認するために、IDE の [サービス] ウィンドウを開きます。（Ctrl-5; ⌘-5 Macの場合) 。[ <code>affablebean</code> ] 接続ノードに行きます。もしノードが壊れて ( <span class="image"><img src="images/connection-broken.png" alt="connection broken"></span> )表示される場合、ノードを右クリックし、[ Connect (接続)] を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>connection を展開します。そして <code>affablebean</code> データベースの <code>customer</code> テーブルに行きます。テーブルを右クリックし、[ View Data(データを表示)] を選択します。<code>customer</code>(顧客) テーブルがエディターにグラフィック表示されます。チェックアウトフォームに追加された customer(顧客)の詳細がテーブル内のレコードとして表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/customer-record.png" alt="customer record">
</div>
<div class="title">Figure 9. View Data menu option performs a 'select *' query on the selected table</div>
</div>
<div class="paragraph">
<p>このように、あなたも <code>customer_order</code> と <code>ordered_product</code> テーブルを調べることができ、データが記録されているかどうかを判断できます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transaction">トランザクションプログラムをセットアップする</h2>
<div class="sectionbody">
<div class="paragraph">
<p>トランザクションの主な機能はすべての操作が正常に実行されることを保障することです。もしそうでなければ、個々の操作のいずれも実行されなかったことにします。<sup><a href="#footnote1">[1]</a></sup>。以下の手順で、どのように <code>placeOrder</code> メソッドでなされる書き込み操作が単一のトランザクションとして扱われるかをデモします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>上記の <a href="#transactionDiagram">transaction diagram</a> (トランザクションの図)を参照します。二つのトランザクションに関係したアノテーションを <code>OrderManager</code> EJB に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
*@TransactionManagement(TransactionManagementType.CONTAINER)*
public class OrderManager {

    @PersistenceContext(unitName = "AffableBeanPU")
    private EntityManager em;

    *@TransactionAttribute(TransactionAttributeType.REQUIRED)*
    public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

        try {
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TransactionManagement</code> アノテーション（注釈）は、<code>OrderManager</code> EJB で発生するすべてのトランザクションはコンテナ管理されるよう指示するために使います。 <code>placeOrder</code> メソッド上に配置 された <code>@TransactionAttribute</code> 注釈は、メソッドで発生するすべての操作はトランザクションの一部として扱われなければならないと指示します。</p>
</div>
<div class="paragraph">
<p><a href="http://jcp.org/aboutJava/communityprocess/final/jsr318/index.html">EJB 仕様</a>によると、 コンテナ管理トランザクションは、セッションBeanではデフォルトで有効になっています。さらに、あなたは上記の二つのアノテーションの Javadoc を調べると、<code>CONTAINER</code> はデフォルトの <code>TransactionManagementType</code> であり、および <code>REQUIRED</code> はデフォルトの <code>TransactionAttributeType</code> であるとあなたは正しく指摘するかもしれません。言い換えれば、2つのアノテーションのどちらもあなたのコードを正常に実行するためには必要ではありません。しかしながら、しばしば明示的にソースにデフォルト設定を入れることは読みやすさを向上させるために有用です。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>現在、 <code>placeOrder</code> メソッドは処理した order の ID を返します。トランザクションが失敗し、注文が処理できない場合、メソッドは &#8216;0&#8217; を返します。<code>try-catch</code> 句を使用します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@TransactionAttribute(TransactionAttributeType.REQUIRED)
public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    *try {*
        Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
        CustomerOrder order = addOrder(customer, cart);
        addOrderedItems(order, cart);
        return order.getId();
    *} catch (Exception e) {
        return 0;
    }*</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_netbeans_はコードテンプレートをサポートします">NetBeans はコードテンプレートをサポートします</h3>
<div class="paragraph">
<p>エディタで仕事をする場合は、コードテンプレート用の IDE サポートを活用してください。達人になるためにコードテンプレートを使用して、最後にはより効率的かつ確実に仕事をすることができるようになります。</p>
</div>
<div class="paragraph">
<p>たとえば、上記の手順で、<code>trycatch</code> テンプレートを適用することができます 。 &#8216;trycatch&#8217; と入力して Tab キーを押します。テンプレートがあなたのファイルに追加されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@TransactionAttribute(TransactionAttributeType.REQUIRED)
public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    *try {

    } catch (Exception e) {
    }*
    Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
    CustomerOrder order = addOrder(customer, cart);
    addOrderedItems(order, cart);
    return order.getId();</code></pre>
</div>
</div>
<div class="paragraph">
<p>その後、あなたは、4つの既存行を <code>try</code> 節の中に移動することができます。そうするには、行を強調表示して、Alt-Shift （ Ctrl-Shift Macの場合）キーを押しながら上矢印キーを押して移動します。終了するときは、Alt - Shift キーを（Ctrl - Shift Macの場合）を押しながらＦ を押し、コードをフォーマットします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@TransactionAttribute(TransactionAttributeType.REQUIRED)
public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    try {
        *Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
        CustomerOrder order = addOrder(customer, cart);
        addOrderedItems(order, cart);
        return order.getId();*
    } catch (Exception e) {
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、既存のコードテンプレートを表示し編集し、新しいテンプレートをＩＤＥに追加することもできます。 [ツール] &gt; [オプション] （Macでは、 [NetBeans] &gt; [Preference設定]）オプションを選び、オプションウィンドウを開きます。[Editor エディタ] &gt; ［Code Templates (コードテンプレート)］を選択します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-templates.png" alt="code templates">
</div>
<div class="title">Figure 10. View default code templates and define new templates in the Options window</div>
</div>
<div class="paragraph">
<p>もっと多くのテンプレートを見たいならば、キーボードショートカットカードを参照してください。キーボードショートカットカードは一般的に使用されるコードテンプレートのリストとキーボードショートカットを提供します。メインメニューから、[ Help (ヘルプ)] &gt; [ Keyboard Shortcuts Card (キーボードショートカットカード)] を選択します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>次のコードを追加します。説明は後に示します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PersistenceContext(unitName = "AffableBeanPU")
private EntityManager em;
*@Resource
private SessionContext context;*

@TransactionAttribute(TransactionAttributeType.REQUIRED)
public int placeOrder(String name, String email, String phone, String address, String cityRegion, String ccNumber, ShoppingCart cart) {

    try {
        Customer customer = addCustomer(name, email, phone, address, cityRegion, ccNumber);
        CustomerOrder order = addOrder(customer, cart);
        addOrderedItems(order, cart);
        return order.getId();
    } catch (Exception e) {
        *context.setRollbackOnly();*
        return 0;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>残念ながら、 <code>try</code> 句の中に3つのメソッドを配置すると、 実行時にそれらのうちの1つが失敗した場合、エンジンはすぐに <code>catch</code> 句にジャンプすることを意味します。このように、通常次に続くいくつかのロールバック操作をスキップします。</p>
</div>
<div class="paragraph">
<p>あなたは、以前に追加した <code>em.flush()</code> 行をコメントアウトしてこれをテストすることができます 。この方法では、あなたは知っていると思いますが、最初の2つのメソッド (<code>addCustomer</code> と <code>addOrder</code>) が正常に処理され、３番目のメソッド（<code>addOrderedItems</code>）は失敗します。プロジェクトを実行し、ブラウザでチェックアウトフォームを送信します。トランザクションがロールバックしないしないため、顧客と注文のレコードがデータベースに書かれますが、注文したアイテムは書かれません。これはデータベースが破損している状況につながります。</p>
</div>
<div class="paragraph">
<p>この問題を解決するために、あなたは <code>catch</code> 句の中にロールバック用のトランザクションを明示的に設定します 。上記の <code>@Resource</code> 注釈は、EJBの現在の <code>SessionContext</code> のインスタンスをつかむために適用されます。<code>setRollbackOnly</code> メソッドを使用して、トランザクションがロールバックするようにマークします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>プロジェクトを実行し、ビジネスプロセスフローをステップ実行します。order(注文)を送信したときに、IDE に戻りサーバーのログを調べます。出力が次のように表示されています：</p>
</li>
</ol>
</div>
<div class="openblock feature">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="images/transaction-output.png"><img src="images/transaction-output.png" alt="transaction output"></a>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Shift - Esc キーを押し、[出力]ウィンドウを最大化します。</p>
</div>
<div class="paragraph">
<p>上の画像に示すように、緑色のテキストは EclipseLink からの出力を示しています。 <a href="entity-session.html">エンティティクラスとセッション Bean を追加する</a>方法を思い出して、あなたは EclipseLink のログレベルを 永続ユニットで <code>FINEST</code> に設定します。この出力を調べることができるようになるには、永続化プロバイダがデータベースとやり取りする方法を理解することがキーになります。そうすれば、あなたのプロジェクトをデバッグする必要がある時に大きな助けになります。</p>
</div>
<div class="paragraph">
<p>これで <code>AffableBean</code> プロジェクトにトランザクションを正常に統合できました。 <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">スナップショット8をダウンロード</a>して、チェックアウトフォームが送信される時リクエストとレスポンスのサイクルを行うコードを調べることができます。スナップショットは <code>OrderManager</code> に <code>getOrderDetails</code> メソッドを実装しています。これは、セットされた order にかかわるすべての詳細を収集します。トランザクションが成功した場合、 <code>ControllerServlet</code> は、order の詳細をリクエストスコープの中に置き、ユーザーの <code>cart</code> オブジェクトを破壊して、セッションを終了し、リクエストを確認ビューに転送します。トランザクションが失敗した場合、 <code>ControllerServlet</code> は、エラーフラグを立て、レスポンスをチェックアウトViewに転送し、ユーザーが再送信できるようにします。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/checkout-page.png" alt="checkout page">
</div>
<div class="title">Figure 11. Upon transaction failure, the checkout page redisplays with error message</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validate">ユーザー入力を検証する</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">スナップショット8</a> には、チェックアウト フォームのクライアントとサーバー側の検証が実装されています。フォームの検証とは、フォームが処理される前にフォームが正しく記入されているかチェックする処理です。これは、無効な入力フィールドに意味のあるフィードバックを返すことによってユーザを支援するだけでなく、それはまた、処理やストレージに悪影響を与えるコンテンツを送信しようとする悪意のある試みを阻止するのに役立ちます。</p>
</div>
<div class="paragraph">
<p>フォームを検証するための2つの主要メソッドは：サーバー側（この例では、 Javaを使用） とクライアント側の（ JavaScriptを使用）二つです。どちらの方法も通常必要不可欠で、快適なユーザーエクスペリエンスを提供するだけでなく、アプリケーションの堅牢なセキュリティを提供します。クライアント側の検証は、ブラウザとサーバー間の往復を起動する必要なく、ユーザに即座にフィードバックするのに役立ちます。そのため、ネットワークトラフィックトラフィックを抑制し、サーバーの負荷を減少させます。クライアント側検証の近代的なフォームは、しばしばユーザに即座にフィールド固有のフィードバックを返すために実装されます。クライアント側の JavaScript はブラウザ上で実行され、ブラウザは一般的に JavaScript を無効にすることができます。この理由だけで、アプリケーションは、極悪非道な入力に対する保護の唯一の手段としてクライアント側の検証だけに依存することはできません。フォームデータがサーバーに到着するその時に、サーバー側の検証を実行する必要があります。データは、リクエストから抽出され、処理/または保存される前にチェックされます。検証エラーが検出された場合、サーバーはユーザーに適切なメッセージを持つフォームを返すことによってレスポンス(応答)します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#client">クライアント側の検証 </a></p>
</li>
<li>
<p><a href="#server">サーバー側の検証 </a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="client">クライアント側の検証</h3>
<div class="paragraph">
<p><code>AffableBean</code> アプリケーション用に 、クライアント側の検証は人気のある <a href="http://plugins.jquery.com/project/validate">jQuery プラグイン</a>を利用して提供されています。 jQuery はクロスブラウザの JavaScript ライブラリであり、クライアント側の HTML スクリプトを簡素化するように設計されています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/client-side-validation.png" alt="client side validation">
</div>
<div class="title">Figure 12. Field validation messages appear upon clicking 'submit purchase'</div>
</div>
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252Fecommerce%252FAffableBean_snapshot8.zip">スナップショット8</a> には <code>js</code> フォルダがあり、そこには、 jQuery コアライブラリ (<code>jquery-1.4.2.js</code>) 、同様に検証プラグイン用スクリプト (<code>jquery.validate.js</code>) が含まれています。コアライブラリーはアプリケーションの <code>header.jspf</code> ファイルの中で参照されています。同時に検証プラグイン スクリプトは <code>checkout.jsp</code> ファイルの中で直接参照されています。それゆえ、検証用プラグインは、checkout.jspファイルだけに必要とされます。checkout.jsp の中で、プラグインは、<a href="http://docs.jquery.com/Plugins/Validation/validate#toptions">利用可能なドキュメント</a>に従ったチェックアウトフォームに合うようにカスタマイズされます 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;script type="text/javascript"&gt;

    $(document).ready(function(){
        $("#checkoutForm").validate({
            rules: {
                name: "required",
                email: {
                    required: true,
                    email: true
                },
                phone: {
                    required: true,
                    number: true,
                    minlength: 9
                },
                address: {
                    required: true
                },
                creditcard: {
                    required: true,
                    creditcard: true
                }
            }
        });
    });
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>IDE は jQuery をサポートします。Ctrl-Space キーを押すと、エディタでコード補完やドキュメントを呼び出すことができるようになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jquery-editor-support.png" alt="jquery editor support">
</div>
<div class="title">Figure 13. Press Ctrl-Space on JavaScript code to invoke jQuery documentation</div>
</div>
<div class="paragraph">
<p>JavaScript でコードするとき、アプリケーションで使おうとしているブラウザを IDE に指定することができます。オプションウィンドウを開き（ [ツール] &gt; [オプション]。Mac では [NetBeans] &gt; [Preferences 設定]）、 [Miscellaneous(その他)] を選択し、 [ JavaScript ] タブを選択します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/javascript-window.png" alt="javascript window">
</div>
<div class="title">Figure 14. Specify targetted browsers for your application in the Options window</div>
</div>
<div class="paragraph">
<p>ドキュメントを呼び出している関数が、あなたが使おうとしているブラウザで全くサポートされていない場合、そのドキュメントは警告フラグをポップアップします。下の画像例で、Internet Explorerバージョン5.5はアプリケーションで使用できるブラウザに含まれていますが、警告フラグが出ています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ie-55.png" alt="ie 55">
</div>
<div class="title">Figure 15. Documentation popup warns of method calls to non-compatible browser versions</div>
</div>
</div>
<div class="sect2">
<h3 id="server">サーバー側の検証</h3>
<div class="paragraph">
<p>AffableBean プロジェクトのサーバー側の検証は、<code>Validator</code> クラスにより実装されています。 <code>ControllerServlet</code> は <code>Validator</code> オブジェクトを作成し、ユーザデータに対しその <code>validateForm</code> メソッドを呼び出します。：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">// validate user data
boolean validationErrorFlag = false;
validationErrorFlag = validator.validateForm(name, email, phone, address, cityRegion, ccNumber, request);

// if validation error found, return user to checkout
if (validationErrorFlag == true) {
    request.setAttribute("validationErrorFlag", validationErrorFlag);
    userPath = "/checkout";

    // otherwise, save order to database
} else {

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>検証エラーが見つかった場合（つまり、<code>validateForm</code> が`true` を返す場合）、フラグはリクエストスコープ属性の形式で発生します。サーバーはクライアントにチェックアウトのページを送り返します。<code>checkout.jsp</code> でフラグが検出されると、新しいテーブル行が作成されエラーメッセージをそのテーブルのトップに表示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form id="checkoutForm" action="&lt;c:url value='purchase'/&gt;" method="post"&gt;
    &lt;table id="checkoutTable" class="rounded"&gt;
      &lt;c:if test="${!empty validationErrorFlag}"&gt;
        &lt;tr&gt;
            &lt;td colspan="2" style="text-align:left"&gt;
                &lt;span class="error smallText"&gt;Please provide valid entries for the following field(s):

                  &lt;c:if test="${!empty nameError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;name&lt;/strong&gt; (e.g., Bilbo Baggins)&lt;/span&gt;
                  &lt;/c:if&gt;
                  &lt;c:if test="${!empty emailError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;email&lt;/strong&gt; (e.g.,
b.baggins
@
hobbit.com
)&lt;/span&gt;
                  &lt;/c:if&gt;
                  &lt;c:if test="${!empty phoneError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;phone&lt;/strong&gt; (e.g., 222333444)&lt;/span&gt;
                  &lt;/c:if&gt;
                  &lt;c:if test="${!empty addressError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;address&lt;/strong&gt; (e.g., Korunní 56)&lt;/span&gt;
                  &lt;/c:if&gt;
                  &lt;c:if test="${!empty cityRegionError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;city region&lt;/strong&gt; (e.g., 2)&lt;/span&gt;
                  &lt;/c:if&gt;
                  &lt;c:if test="${!empty ccNumberError}"&gt;
                    &lt;br&gt;&lt;span class="indent"&gt;&lt;strong&gt;credit card&lt;/strong&gt; (e.g., 1111222233334444)&lt;/span&gt;
                  &lt;/c:if&gt;

                &lt;/span&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/c:if&gt;

      ...
    &lt;/table&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>あなたは一時的にお使いのブラウザで JavaScript を無効にして、サーバー側の検証をテストできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/server-side-validation.png" alt="server side validation">
</div>
<div class="title">Figure 16. Temporarily disable JavaScript in your browser to test server-side validation</div>
</div>
<div class="paragraph">
<p>提供されているサーバー側の検証の実装は、単に、プロジェクトでサーバー側の検証をセットアップする方法を説明するのに役立つだけです。`Validator`クラスに含まれている実際の検証ロジック は、ほとんど基本的なチェック以外には何も実行しません。決して運用環境では使用しないでください！</p>
</div>
<div class="paragraph">
<p>link:/about/contact_form.html?to=3&amp;subject=Feedback: NetBeans E-commerce Tutorial - Integrating Transactional Business Logic[ご意見をお寄せ下さい]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeAlso">関連参照</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_netbeans_リソース">NetBeans リソース</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../javaee-intro_ja.html">Java EE 技術の概要</a></p>
</li>
<li>
<p><a href="../javaee-gettingstarted_ja.html">Java EE 6 アプリケーション入門</a></p>
</li>
<li>
<p><a href="https://netbeans.org/projects/www/downloads/download/shortcuts.pdf">キーボードショートカットとコードテンプレートカード</a></p>
</li>
<li>
<p><a href="../../../trails/java-ee_ja.html">Java EE と Java Web 学習</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_外部リソース">外部リソース</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://jcp.org/aboutJava/communityprocess/final/jsr318/index.html">JSR 318: EJB 3.1 最終リリース</a> [仕様のダウンロード]</p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E17410_01/javaee/6/tutorial/doc/bncih.html">Java EE 6 チュートリアル: トランザクション</a></p>
</li>
<li>
<p><a href="http://www.manning.com/panda/">EJB 3 in Action</a> [書籍]</p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Database_transaction">データベース トランザクション</a> [Wikipedia]</p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Ejb">Enterprise JavaBean</a> [Wikipedia]</p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/ACID">ACID</a> [Wikipedia]</p>
</li>
<li>
<p><a href="http://jquery.com/">jQuery</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Jquery">jQuery</a> [Wikipedia]</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_参照">参照</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#1">^</a> この 「<em>all or nothing</em>(するかしないか)」の コンセプトから、トランザクションの4つの特徴的な性質を推定することができます： <em>atomicity</em>(原子性)、 <em>consistency</em>(一貫性)、 <em>isolation</em>(分離)、および_durability_(耐久性)（ACID）。詳細については、ここを参照してください： <a href="http://en.wikipedia.org/wiki/ACID">ACID</a> [ウィキペディア]。
訳者注。原子性〔データベースの更新などの〕◆トランザクションが完全に成功するか、またはエラーが起きたら全部取り消し、中途半端に終わらない性質。</p>
</li>
</ol>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/ecommerce/transaction_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
