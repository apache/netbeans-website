
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>@Alternative Beanおよびライフサイクル注釈の適用</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="@Alternative Beanおよびライフサイクル注釈の適用 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, @Alternative Beanおよびライフサイクル注釈の適用">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">@Alternative Beanおよびライフサイクル注釈の適用</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-validate_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_コンテキストと依存性の注入">コンテキストと依存性の注入</a></li>
<li><a href="#alternative">複数デプロイメントの処理</a></li>
<li><a href="#lifecycle">管理対象Beansへのライフサイクル注釈の適用</a></li>
<li><a href="#seealso">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>執筆: Andy Gibson</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_コンテキストと依存性の注入">コンテキストと依存性の注入</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="cdi-intro.html">CDIおよびJSF 2.0の開始</a></p>
</li>
<li>
<p><a href="cdi-inject.html">CDIの注入および修飾子の操作</a></p>
</li>
<li>
<p><strong>@Alternative Beanおよびライフサイクル注釈の適用</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#alternative">複数デプロイメントの処理</a></p>
</li>
<li>
<p><a href="#lifecycle">管理対象Beanへのライフサイクル注釈の適用</a></p>
</li>
<li>
<p><a href="#seealso">関連項目</a></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="cdi-events.html">CDIのイベントの操作</a></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR-299</a>で指定されているコンテキストと依存性の注入(CDI: Contexts and Dependency Injection)はJava EE 6の不可欠な部分であり、サーブレット、エンタープライズBean、JavaBeansなどのJava EEコンポーネントが、アプリケーションのライフサイクル内で明確なスコープを持って存在できるようにするためのアーキテクチャを提供します。また、CDIサービスによって、EJBセッションBeanやJSF (JavaServer Faces)管理対象BeanなどのJava EEコンポーネントが注入可能になり、イベントの起動や監視による疎結合方式の対話が可能になります。</p>
</div>
<div class="paragraph">
<p>このチュートリアルは、Andy Gibson氏によって投稿された<a href="http://www.andygibson.net/blog/index.php/2009/12/22/getting-started-with-cdi-part-2-injection/">CDI入門パート2 - 注入</a>というタイトルのブログをベースにしています。ここでは、<code>@Alternative`注釈を利用して、異なるデプロイメント向けにアプリケーションを構成する方法や、</code>@PostConstruct`や`@PreDestroy`などの管理対象Beanライフサイクル注釈を使用して、CDI注入を<a href="http://jcp.org/en/jsr/detail?id=316">Java EE 6管理対象Beanの仕様</a>で提供されている機能と組み合せる方法を示します。</p>
</div>
<div class="paragraph">
<p>NetBeans IDEは、コンテキストと依存性の注入のサポートを組込みでサポートしています。これには、プロジェクト作成時に`beans.xml` CDI構成ファイルを生成するオプション、注釈のためのエディタおよびナビゲーション・サポート、一般的に使用されるCDIアーティファクトを作成するための各種ウィザードなどが含まれています。</p>
</div>
<div class="paragraph">
<p>このチュートリアルを完了するには、次のソフトウェアとリソースが必要です。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EEバージョン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://glassfish.dev.java.net/">GlassFishサーバー</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Source Edition 3.xまたは4x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo2.zip">cdiDemo2.zip</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>NetBeans IDEのJavaバンドル版には、Java EE準拠のコンテナであるGlassFish Server Open Source Editionも含まれています。</p>
</li>
<li>
<p>このチュートリアルのサンプル・ソリューション・プロジェクトをダウンロードできます: <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo3.zip">cdiDemo3.zip</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternative">複数デプロイメントの処理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CDIでは、注入ポイントに一致するBeanが複数存在する場合でも、あいまい性のエラーを発生させずにパッケージ化できる`@Alternative`注釈を使用できます。つまり、2つ以上のBeanに`@Alternative`注釈を適用してから、デプロイメントに基づいて、使用するBeanをCDIの`beans.xml`構成ファイルに指定できます。</p>
</div>
<div class="paragraph">
<p>これを示すために、次のようなシナリオを考えます。メイン`ItemProcessor`クラスに`ItemValidator`を注入します。`ItemValidator`は、`DefaultItemValidator`と`RelaxedItemValidator`の両方によって実装されます。ここでのデプロイメント要件に基づき、ほとんどの場合に`DefaultItemValidator`を使用しますが、特定のデプロイメント向けに`RelaxedItemValidator`も必要とします。これを解決するために、両方のBeanに注釈を付けてから、アプリケーションの`beans.xml`ファイルにエントリを追加して、指定のデプロイメントにどのBeanを使用するかを指定します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-alternative.png" alt="cdi diagram alternative">
</div>
<div class="title">Figure 1. アプリケーションの疎結合クラスへのCDI注入の使用</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>まず、`cdiDemo2.zip`ファイル(上記の<a href="#requiredSoftware">必要なリソースの一覧表</a>を参照)からサンプルのスタート・プロジェクトを抽出します。「ファイル」&gt;「プロジェクトを開く」([Ctrl]-[Shift]-[O]、Macの場合は[⌘]-[Shift]-[O])を選択してから、コンピュータ上のこのプロジェクトの場所を選択することで、IDEでプロジェクトを開きます。</p>
</li>
<li>
<p>「プロジェクト」ウィンドウでプロジェクトのノードを右クリックし、「プロパティ」を選択します。</p>
</li>
<li>
<p>「実行」カテゴリを選択し、「サーバー」ドロップダウン・リストでGlassFishインスタンスが選択されていることを確認します。</p>
</li>
<li>
<p>`ItemValidator`インタフェースを作成します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「新規ファイル」(<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>)ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Java」カテゴリから「Javaインタフェース」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名として「<strong>ItemValidator</strong>」、パッケージとして「<strong>exercise3</strong>」と入力します。</p>
</li>
<li>
<p>「終了」をクリックします。新しいインタフェースが生成され、エディタで開かれます。</p>
</li>
<li>
<p>`Item`オブジェクトを取って`boolean`値を返す`isValid()`という名前のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public interface ItemValidator {
    *boolean isValid(Item item);*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise2.Item`のインポート文を追加します。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`ItemProcessor`クラスを拡張して新しい機能を組み込みます。エディタで`ItemProcessor`を開いて、次のように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    @Inject @Demo
    private ItemDao itemDao;

    *@Inject
    private ItemValidator itemValidator;*

    public void execute() {
      List&lt;Item&gt;  items = itemDao.fetchItems();
      for (Item item : items) {
          System.out.println(*"Item = " + item + " valid = " + itemValidator.isValid(item)*);
      }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>エディタのヒントを使用して`exercise3.ItemValidator`のインポート文を追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>値の制限値をテストするのみの、`DefaultItemValidator`という名前の`ItemValidator`の実装を作成します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「<code>exercise3</code>」パッケージを右クリックし、「新規」&gt;「Javaクラス」を選択します。クラスに「<strong>DefaultItemValidator</strong>」という名前を付け、「終了」をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のようにして、`DefaultItemValidator`で`ItemValidator`を実装し、`isValid()`メソッドをオーバーライドします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class DefaultItemValidator *implements ItemValidator* {

    *@Override
    public boolean isValid(Item item) {
        return item.getValue() &lt; item.getLimit();
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise2.Item`のインポート文を追加します。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEのメイン・ツールバーにある「プロジェクトの実行」(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>)ボタンをクリックします。プロジェクトがコンパイルされてGlassFishにデプロイされ、アプリケーションの開始ページ(<code>process.xhtml</code>)がブラウザで開きます。</p>
</li>
<li>
<p>ページに表示されている「<code>Execute</code>」ボタンをクリックします。IDEに戻ってGlassFishのサーバー・ログを調べます。サーバー・ログは、「出力」ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])の「GlassFish」タブの下に表示されます。項目が検証されていることが表示されます。制限値より小さい、有効な項目のみが一覧表示されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Item = exercise2.Item@e857ac [Value=34, Limit=7] valid = false
INFO: Item = exercise2.Item@63124f52 [Value=4, Limit=37] valid = true
INFO: Item = exercise2.Item@4715c34e [Value=24, Limit=19] valid = false
INFO: Item = exercise2.Item@65c95a57 [Value=89, Limit=32] valid = false</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/output-window.png" alt="output window">
</div>
<div class="title">Figure 2. 「出力」ウィンドウでのサーバー・ログの表示</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ここで、条件を緩和して、値が制限の2倍を超える場合にのみ項目を無効と見なす別のサイトへデプロイするシナリオを考えます。このロジックのために、`ItemValidator`インタフェースを実装する別のBeanを用意します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>RelaxedItemValidator`という名前の`ItemValidator`の新しい実装を作成します。「プロジェクト」ウィンドウで「`exercise3</code>」パッケージを右クリックし、「新規」&gt;「Javaクラス」を選択します。クラスに「<strong>RelaxedItemValidator</strong>」という名前を付け、「終了」をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のようにして、`RelaxedItemValidator`で`ItemValidator`を実装し、`isValid()`メソッドをオーバーライドします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class RelaxedItemValidator *implements ItemValidator* {

    *@Override
    public boolean isValid(Item item) {
        return item.getValue() &lt; (item.getLimit() * 2);
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise2.Item`のインポート文を追加します。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクトの実行」(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>)ボタンをクリックして、プロジェクトを実行します。今度はプロジェクトのデプロイに失敗します。</p>
</li>
<li>
<p>出力ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])でサーバー・ログを調べます。「あいまいな依存性」の問題を報告するエラー・メッセージが確認できます。これは、現時点で同じインタフェースを実装しているクラスが2つあるために起こります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">org.glassfish.deployment.common.DeploymentException: Injection point has ambiguous dependencies.
Injection point: field exercise2.ItemProcessor.itemValidator;
Qualifiers: [@javax.enterprise.inject.Default()];
Possible dependencies: [exercise3.RelaxedItemValidator, exercise3.DefaultItemValidator]</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDIの実装であるWeldは、特定の注入ポイントに`RelaxedItemValidator`と`DefaultItemValidator`のどちらを使用するかを決定できません。</p>
</div>
<div class="paragraph">
<p>前述のように、唯一の違いはデプロイメントに基づいています。ほとんどのデプロイメントにはデフォルトのバリデータを使用しますが、1つのデプロイメントには「緩和された」実装を使用するようにします。CDIでは、注入ポイントに一致するBeanが複数存在する場合でも、あいまい性のエラーを発生させずにパッケージ化できる`@Alternative`注釈を使用できます。使用するBeanは、`beans.xml`に定義します。これにより、`beans.xml`の定義のみが異なる両方の実装を同じモジュール内にデプロイできます(この定義はデプロイメントごとに変更できます)。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`@Alternative`注釈および対応するインポート文を、`RelaxedItemValidator`および`DefaultItemValidator`に追加します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>エディタで`RelaxedItemValidator`を開いて、次のように変更します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*import javax.enterprise.inject.Alternative;*
...

*@Alternative*
public class RelaxedItemValidator implements ItemValidator {

    public boolean isValid(Item item) {
        return item.getValue() &lt; (item.getLimit() * 2);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>「<code>@Al</code>」を入力してから[Ctrl]-[Space]を押して、コード補完を呼び出します。1つのオプションのみがフィルタされるため、`@Alternative`注釈が完了します。また、対応する`javax.enterprise.inject.Alternative`のインポート文がファイルの最初に自動的に追加されます。通常は、注釈で[Ctrl]-[Space]を押すとJavadocドキュメントのポップアップも表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-completion-alternative.png" alt="code completion alternative">
</div>
<div class="title">Figure 3. 注釈での[Ctrl]-[Space]の押下によるJavadocドキュメントの呼出し</div>
</div>
<div class="paragraph">
<p>`DefaultItemValidator`に切り替え([Ctrl]-[Tab]を押し)、次のように変更します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*import javax.enterprise.inject.Alternative;*
...

*@Alternative*
public class DefaultItemValidator implements ItemValidator {

    public boolean isValid(Item item) {
        return item.getValue() &lt; item.getLimit();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここでアプリケーションをデプロイすると「満たされない依存性」というエラーが出ますが、これは、一致するBeanを選択肢として2つ定義したけれども、`beans.xml`ファイルでどちらも有効にしていないためです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEの「ファイルに移動」ダイアログを使用すると、すばやく`beans.xml`を開けます。IDEのメイン・メニューで「ナビゲート」&gt;「ファイルに移動」([Alt]-[Shift]-[O]、Macの場合は[Ctrl]-[Shift]-[O])を選択してから「<code>beans</code>」と入力します。「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file.png" alt="go to file">
</div>
<div class="title">Figure 4. 「ファイルに移動」ダイアログを使用した、プロジェクト・ファイルの速やかな検索</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`beans.xml`ファイルに以下の変更を加えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;beans xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/beans_1_0.xsd"&gt;

    *&lt;alternatives&gt;
        &lt;class&gt;exercise3.RelaxedItemValidator&lt;/class&gt;
    &lt;/alternatives&gt;*

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>これによって、このデプロイメントでは`RelaxedItemValidator`を使用することがCDIに伝えられます。`@Alternative`注釈は、Beanを事実上無効にして注釈に使用できないようにする一方で、他のBeanとともに実装をパッケージ化できるようにするものと考えることができます。これを`beans.xml`ファイルに代替として追加すると、事実上、Beanを再度有効にして、注入に使用できるようにします。このタイプのメタデータを`beans.xml`ファイルへ移動することで、様々なバージョンのファイルを様々なデプロイメントでバンドルできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクトの実行」(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>)ボタンをクリックして(または[F6]、Macの場合は[fn]-[F6]を押して)、プロジェクトを実行します。ブラウザで、ページに表示されている「<code>Execute</code>」ボタンをクリックします。IDEに戻り、出力ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])に表示されたGlassFishのサーバー・ログを調べます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Item = exercise2.Item@672f0924 [Value=34, Limit=7] valid = false
INFO: Item = exercise2.Item@41014f68 [Value=4, Limit=37] valid = true
INFO: Item = exercise2.Item@3d04562f [Value=24, Limit=19] valid = true
INFO: Item = exercise2.Item@67b646f4 [Value=89, Limit=32] valid = false</code></pre>
</div>
</div>
<div class="paragraph">
<p>3つ目の項目に、提供された値(<code>24</code>)が指定された制限(<code>19</code>)より大きいにもかかわらず、有効であると表示されています。これにより、`RelaxedItemValidator`実装が使用されていることがわかります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle">管理対象Beansへのライフサイクル注釈の適用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この課題では、メイン`ItemProcessor`クラスに`ItemErrorHandler`を注入します。<code>FileErrorReporter`が`ItemErrorHandler`インタフェースの唯一の実装であるため、これが注入用に選択されます。クラスのライフサイクル固有のアクションを設定するには、管理対象Beanの仕様(<a href="http://jcp.org/en/jsr/detail?id=316">+JSR 316: Java Platform, Enterprise Edition 6の仕様+</a>に含まれます)から</code>@PostConstruct`および`@PreDestroy`注釈を使用します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-lifecycle.png" alt="cdi diagram lifecycle">
</div>
<div class="title">Figure 5. アプリケーションの疎結合クラスへのCDI注入の使用</div>
</div>
<div class="paragraph">
<p>例の続きとして、無効な項目が見つかったときにそれを処理する`ItemErrorHandler`インタフェースを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「<code>exercise3</code>」パッケージを右クリックし、「新規」&gt;「Javaインタフェース」を選択します。</p>
</li>
<li>
<p>Javaインタフェース・ウィザードで、クラス名として「<strong>ItemErrorHandler</strong>」、パッケージとして「<strong>exercise3</strong>」と入力します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>新しいインタフェースが生成され、エディタで開かれます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>引数として`Item`オブジェクトを取る`handleItem()`という名前のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public interface ItemErrorHandler {
    *void handleItem(Item item);*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise2.Item`のインポート文を追加します。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>まず、項目の詳細をファイルに保存する`FileErrorReporter`という名前の偽のハンドラを持つ`ItemErrorHandler`を実装します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「<code>exercise3</code>」パッケージを右クリックし、「新規」&gt;「Javaクラス」を選択します。クラスに「<strong>FileErrorReporter</strong>」という名前を付け、「終了」をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のようにして、`FileErrorReporter`で`ItemErrorHandler`を実装し、`handleItem()`メソッドをオーバーライドします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FileErrorReporter *implements ItemErrorHandler* {

    *@Override
    public void handleItem(Item item) {
        System.out.println("Saving " + item + " to file");
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise2.Item`のインポート文を追加します。)</p>
</div>
<div class="paragraph">
<p>項目の処理を始める前にファイルを開き、処理中は開いたままにしてファイルに内容を追加し、処理が終了したらファイルを閉じるようにします。<code>initProcess()`および`finishProcess()`メソッドをエラー・レポータBeanに手動で追加することもできますが、そうするとコール元がそれらのクラス固有のメソッドについて知る必要があるため、インタフェースへのコードを作成できなくなります。それらの同じメソッドを`ItemErrorReporter`インタフェースに追加することもできますが、そうするとこのインタフェースを実装するすべてのクラスに、これらのメソッドを不必要に実装する必要があります。かわりに、管理対象Beanの仕様(<a href="http://jcp.org/en/jsr/detail?id=316">+JSR 316: Java Platform, Enterprise Edition 6の仕様+</a>に含まれる)からいくつかのライフサイクル注釈を使用して、Beanライフサイクルの特定の時点でBean上でメソッドをコールできます。Beanが構築され、Beanが持つすべての依存性が注入されると、</code>@PostConstruct`注釈付きメソッドがコールされます。同様に、Beanがコンテナによって破棄される直前に`@PreDestroy`注釈付きメソッドがコールされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のように、対応する`@PostConstruct`および`@PreDestroy`注釈を持つ`init()`および`release()`メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FileErrorReporter implements ItemErrorHandler {

    *@PostConstruct
    public void init() {
        System.out.println("Creating file error reporter");
    }

    @PreDestroy
    public void release() {
        System.out.println("Closing file error reporter");
    }*

    @Override
    public void handleItem(Item item) {
        System.out.println("Saving " + item + " to file");
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正します。エディタを右クリックして「インポートを修正」を選択するか、[Ctrl]-[Shift]-[I] (Macの場合は[⌘]-[Shift]-[I])を押します。`javax.annotation.PostConstruct`および`javax.annotation.PreDestroy`のインポート文がファイルの最初に追加されます。</p>
</li>
<li>
<p>最後に、新しい`ItemErrorHandler` Beanを`ItemProcessor`に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    @Inject @Demo
    private ItemDao itemDao;

    @Inject
    private ItemValidator itemValidator;

    *@Inject
    private ItemErrorHandler itemErrorHandler;*

    public void execute() {
        List&lt;Item&gt;  items = itemDao.fetchItems();
        for (Item item : items) {
            *if (!itemValidator.isValid(item)) {
                itemErrorHandler.handleItem(item);
            }*
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`exercise3.ItemErrorHandler`のインポート文を追加します。)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクトの実行」(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>)ボタンをクリックして(または[F6]、Macの場合は[fn]-[F6]を押して)、プロジェクトを実行します。ブラウザで、ページに表示されている「<code>Execute</code>」ボタンをクリックします。IDEに戻り、出力ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])に表示されたGlassFishのサーバー・ログを調べます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Creating file error reporter
INFO: Saving exercise2.Item@6257d812 [Value=34, Limit=7] to file
INFO: Saving exercise2.Item@752ab82e [Value=89, Limit=32] to file
INFO: Closing file error reporter</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20CDI%20Injection%20to%20Perform%20Custom%20Validation">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>異なるアプリケーション・デプロイメントでは、無効な項目の処理のために、項目を却下したり、個々に通知を送ったり、フラグを付けたり、単に出力ファイルに一覧表示したりするなどの、異なるルールを使用することがあります。また、これらを組み合せて使用することも考えられます(例: 注文を却下し、営業担当に電子メールを送ってから、ファイルに注文を一覧表示する)。この種の多角的な問題の処理に適した方法の1つは、_イベント_を使用する方法です。このシリーズの最終回はCDIイベントについてです:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-events.html">CDIのイベントの操作</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CDIおよびJava EEの詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-intro.html">コンテキストと依存性の注入およびJSF 2.0の開始</a></p>
</li>
<li>
<p><a href="cdi-inject.html">CDIの注入および修飾子の操作</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EEアプリケーションの開始</a></p>
</li>
<li>
<p><a href="http://blogs.oracle.com/enterprisetechtips/entry/using_cdi_and_dependency_injection">エンタープライズ技術ヒント: JSF 2.0アプリケーションでのJavaのCDIおよび依存性の注入の使用</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/gjbnr.html">Java EE 6チュートリアル、パートV: Java EEプラットフォームのコンテキストと依存性の注入</a></p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR 299: コンテキストと依存性の注入の仕様</a></p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=316">JSR 316: Java Platform Enterprise Edition 6の仕様</a></p>
</li>
</ul>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-validate_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
