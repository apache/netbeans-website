
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Создание приложения J2EE с помощью EJB 3.1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Создание приложения J2EE с помощью EJB 3.1 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Создание приложения J2EE с помощью EJB 3.1">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Создание приложения J2EE с помощью EJB 3.1</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-ejb_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_о_приложении_j2ee_newsapp">О приложении J2EE NewsApp</a></li>
<li><a href="#_создание_проекта_приложения_j2ee">Создание проекта приложения J2EE</a></li>
<li><a href="#_написание_кода_модуля_ejb">Написание кода модуля EJB</a>
<ul class="sectlevel2">
<li><a href="#_создание_класса_сущности">Создание класса сущности</a></li>
<li><a href="#_создание_управляемого_сообщениями_компонента">Создание управляемого сообщениями компонента</a></li>
<li><a href="#_создание_фасада_сеанса">Создание фасада сеанса</a></li>
</ul>
</li>
<li><a href="#_написание_кода_веб_модуля">Написание кода веб-модуля</a>
<ul class="sectlevel2">
<li><a href="#_создание_единичного_сеансного_компонента">Создание единичного сеансного компонента</a></li>
<li><a href="#_создание_сервлета_listnews">Создание сервлета  <code>ListNews</code></a></li>
<li><a href="#_создание_сервлета_postmessage">Создание сервлета  <code>PostMessage</code></a></li>
</ul>
</li>
<li><a href="#_выполнение_проекта">Выполнение проекта</a></li>
<li><a href="#_загрузка_проекта_решения">Загрузка проекта решения</a></li>
<li><a href="#_устранение_проблем">Устранение проблем</a>
<ul class="sectlevel2">
<li><a href="#_проблема_с_ресурсами_jms">Проблема с ресурсами JMS</a></li>
</ul>
</li>
<li><a href="#_дополнительные_сведения">Дополнительные сведения</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом руководстве представлены базовые аспекты разработки приложений Java EE 6 и некоторые возможности технологии EJB 3.1, добавленные в спецификацию Java EE 6. В рамках этого руководства будет создано приложение J2EE, позволяющее пользователю отправлять и получать сообщения из базы данных.</p>
</div>
<div class="paragraph">
<p>Это приложение содержит модуль EJB и веб-модуль. Модуль EJB включает в себя класс сущностей, фасад сеанса класса сущностей и управляемый сообщениями компонент. Веб-модуль содержит сервлеты для отображения и отправки сообщений и единичный сеансный компонент для подсчета числа пользователей в сеансе.</p>
</div>
<div class="paragraph">
<p>Перед изучением этого руководства необходимо ознакомиться со следующей документацией.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-gettingstarted.html">Начало работы с приложениями Java EE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Упражнения по темам руководства</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#intro">О приложении J2EE NewsApp</a></p>
</li>
<li>
<p><a href="#Exercise_1">Создание проекта приложения J2EE</a></p>
</li>
<li>
<p><a href="#Exercise_2">Написание кода модуля EJB</a></p>
</li>
<li>
<p><a href="#Exercise_2a">Создание класса сущностей</a></p>
</li>
<li>
<p><a href="#Exercise_2b">Создание управляемого сообщениями компонента</a></p>
</li>
<li>
<p><a href="#Exercise_2c">Создание фасада сеанса</a></p>
</li>
<li>
<p><a href="#Exercise_3">Написание кода веб-модуля</a></p>
</li>
<li>
<p><a href="#Exercise_3a">Создание единичного сеансного компонента</a></p>
</li>
<li>
<p><a href="#Exercise_3b">Создание сервлета ListNews</a></p>
</li>
<li>
<p><a href="#Exercise_3c">Создание сервлета PostMessage</a></p>
</li>
<li>
<p><a href="#Exercise_4">Выполнение проекта</a></p>
</li>
<li>
<p><a href="#Exercise_5">Загрузка проекта решения</a></p>
</li>
<li>
<p><a href="#Exercise_6">Устранение проблем</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Для работы с этим учебным курсом требуется следующее программное обеспечение и ресурсы.</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Программное обеспечение или материал</th>
<th class="tableblock halign-left valign-top">Требуемая версия</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">IDE NetBeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия 7.2, 7.3, 7.4, 8.0, Java EE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Комплект для разработчика на языке Java (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">версия 7 или 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition 3.1.2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x, 4.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Предпосылки</strong></p>
</div>
<div class="paragraph">
<p>Предполагается, что читатель обладает базовыми знаниями по следующим технологиям или опытом программирования с их использованием:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Программирование на Java</p>
</li>
<li>
<p>IDE NetBeans</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Можно загрузить <a href="https://netbeans.org/projects/samples/downloads/download/Samples/JavaEE/NewsAppEE6.zip">готовый проект в виде архива ZIP</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_о_приложении_j2ee_newsapp">О приложении J2EE NewsApp</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом руководстве приводится несложный пример создания многоуровневого приложения Java EE 6 с именем NewsApp. В приложении NewsApp используется несколько функций, внедренных в спецификации Java EE 6.</p>
</div>
<div class="paragraph">
<p>Структура приложения NewsApp, как правило, соответствует следующим уровням.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Веб-уровень.</strong> Веб-уровень содержит логику представления приложения и запускается на сервере Java EE. В приложении NewsApp веб-уровень представлен веб-модулем и содержит сервлеты, через которые осуществляется доступ к бизнес-логике в модуле EJB.</p>
</li>
<li>
<p><strong>Бизнес-уровень.</strong> Приложения бизнес-уровня также выполняются на серверах Java EE и содержат бизнес-логику приложения. В приложении NewsApp бизнес-уровень представлен модулем EJB. Модуль EJB содержит код для обработки запросов от клиентов веб-уровня и для управления транзакциями и способами сохранения объектов в базе данных.</p>
</li>
<li>
<p><strong>EIS-уровень.</strong> EIS-уровень - это надежный уровень хранения приложения. В приложении NewsApp этот уровень представлен базой данных для сохранения сообщений.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>При сборке приложения J2EE в среде IDE модуль EJB и модуль веб-приложения упаковываются в архивный файл EAR, который затем развертывается на сервере. Затем доступ к приложению обычно получается из <strong>клиентского уровня.</strong> Уровень клиента является средой, в которой клиент запускается и часто является веб-браузером в локальной системе пользователя.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
В примере в этом учебном курсе будет использоваться один компьютер для размещения сервера Java EE, базы данных и просмотра веб-страниц. В больших приложениях J2EE разные уровни часто распределены между несколькими машинами. Приложения веб-уровня и бизнес-уровня зачастую разворачиваются на серверах Java EE, которые размещаются на разных машинах.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Подробные сведения о структуре приложений J2EE Java EE см. в главе <a href="http://download.oracle.com/javaee/6/tutorial/doc/bnaay.html">Распределенные многоуровневые приложения</a> в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">руководстве по Java EE 6, часть I</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_проекта_приложения_j2ee">Создание проекта приложения J2EE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Цель этого упражнения состоит в создании проекта приложения J2EE NewsApp. Для создания приложения J2EE, содержащего EJB-модуль и веб-модуль, используется мастер создания проекта.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Выберите 'Файл' &gt; 'Создать проект' (Ctrl-Shift-N; ⌘-Shift-N в Mac) в главном меню.</p>
</li>
<li>
<p>В категории "Java EE" выберите приложение J2EE и нажмите "Далее".</p>
</li>
<li>
<p>Введите имя проекта <strong>NewsApp</strong> и укажите местоположение проекта.</p>
</li>
<li>
<p>Снимите флажок "Использовать отдельную папку", если он установлен.
(В рамках этого руководства копирование библиотек проекта в отдельную папку нецелесообразно, поскольку совместное использование библиотек с другими пользователями или проектами не требуется.)
Нажмите кнопку "Далее".</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В качестве сервера выберите сервер GlassFish, а в качестве версии Java EE укажите Java EE 6 или Java EE 7.</p>
</li>
<li>
<p>Выберите пункты "Создать модуль EJB" и "Создать модуль веб-приложения". Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-entapp-wizard.png" alt="new entapp wizard">
</div>
<div class="title">Figure 1. Мастер создания проектов</div>
</div>
<div class="paragraph">
<p>После нажатия кнопки "Готово" среда IDE создает три проекта: NewsApp, NewsApp-ejb и NewsApp-war При разворачивании узла NewsApp в окне "Проекты" можно увидеть, что проект приложения J2EE не содержит исходные файлы. Все исходные файлы содержатся в двух модулях, созданных мастером и выведенных в узле "Модули Java EE".</p>
</div>
<div class="paragraph">
<p>Проекты корпоративных приложений содержат только сведения о конфигурации и упаковке приложения. При сборке и запуске корпоративного приложения IDE создает архив EAR и развертывает этот архив EAR на сервере. В некоторых случаях проект корпоративного приложения может содержать файлы дескриптора развертывания с дополнительными сведениями, но файлы дескриптора развертывания не требуются при создании корпоративных приложений Java EE, развертываемых на сервере GlassFish.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-projectswindow.png" alt="ejb projectswindow">
</div>
<div class="title">Figure 2. Окно 'Проекты', в котором отображается структура приложения</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_написание_кода_модуля_ejb">Написание кода модуля EJB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом упражнении будет создан класс сущностей, управляемый сообщениями компонент и фасад сеанса в модуле EJB. Также будет создана единица сохранения состояния для обеспечения контейнера информацией об источнике данных и о способах управления сущностями, а также ресурсы службы передачи сообщений Java (Java Message Service, JMS), используемые управляемым сообщениями компонентом.</p>
</div>
<div class="sect2">
<h3 id="_создание_класса_сущности">Создание класса сущности</h3>
<div class="paragraph">
<p>В этом упражнении будет создан класс сущностей  <code>NewsEntity</code> . Класс сущностей – это простой класс Java, как правило, соответствующий таблице в базе данных. При создании класса сущностей в среде IDE для определения класса как класса сущностей добавляется аннотация  <code>@Entity</code> . После создания класса в нем создаются поля для представления требуемых данных в таблице.</p>
</div>
<div class="paragraph">
<p>Каждый класс сущностей должен иметь первичный ключ. При создании класса сущностей в среде IDE добавляется аннотация  <code>@Id</code>  для объявления, какое поле необходимо использовать в качестве первичного ключа. Также в среде IDE добавляется аннотация  <code>@GeneratedValue</code>  и указывается стратегия создания ключей для первичного идентификатора.</p>
</div>
<div class="paragraph">
<p>Для создания класса  <code>NewsEntity</code>  выполните следующие действия.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши модуль EJB в окне "Проекты" и выберите "Создать &gt; Прочее" для открытия мастера создания файла.</p>
</li>
<li>
<p>Выберите "Класс сущностей" из категории "Сохранение состояния" и нажмите "Далее".</p>
</li>
<li>
<p>В поле "Имя класса" введите <strong>NewsEntity</strong>.</p>
</li>
<li>
<p>В поле Package ("Пакет") введите <strong>ejb</strong>.</p>
</li>
<li>
<p>В мастере создания класса сущностей оставьте тип первичного ключа  <code>Long</code> .</p>
</li>
<li>
<p>Выберите команду "Создать блок сохранения состояния". Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Оставьте имя блока сохранения состояния по умолчанию.</p>
</li>
<li>
<p>Для Поставщика сохранения состояния выберите  <code>EclipseLink (JPA2.0)(по умолчанию)</code> .</p>
</li>
<li>
<p>В поле "Источник данных" укажите источник данных (например, выберите  <code>jdbc/sample</code> , если необходимо использовать JavaDB).</p>
</li>
<li>
<p>Убедитесь в том, что для блока сохранения состояния используется интерфейс API транзакций Java и что для стратегии создания таблиц установлено значение "Создать", т. е. таблицы на основе классов сущностей создаются при развертывании приложения.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-pu-wizard.png" alt="new pu wizard">
</div>
<div class="title">Figure 3. Панель 'Поставщик и база данных'</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Завершить" в среде IDE будет создан файл  <code>persistence.xml</code>  и класс сущностей  <code>NewsEntity.java</code> .  <code>NewsEntity.java</code>  будет открыт средой IDE в редакторе исходного кода.</p>
</div>
<div class="paragraph">
<p>В редакторе исходного кода выполните следующие действия.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте к классу следующие объявления полей:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private String title;
private String body;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши в редакторе исходного кода, выберите пункт "Вставить код" (Alt-Insert; Ctrl-I на Mac) и выберите пункт "Методы получения и установки", чтобы открыть диалоговое окно "Создать методы получения и установки".</p>
</li>
<li>
<p>В диалоговом окне выберите поля  <code>body</code>  и  <code>title</code> . Нажмите кнопку "Создать".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-gettersetter.png" alt="ejb gettersetter">
</div>
<div class="title">Figure 4. Диалоговое окно 'Создание методов получения и установки'</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Создать" в среде IDE добавляются методы получения и установки для полей.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраните изменения в  <code>NewsEntity.java</code> .</p>
<div class="literalblock">
<div class="content">
<pre>``NewsEntity.java``  можно закрыть.</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Для получения подробных сведений о классах сущностей см. главу <a href="http://java.sun.com/javaee/6/docs/tutorial/doc/bnbpz.html">Введение в интерфейс API сохранения состояния Java</a> в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">Руководство по Java EE 6. Часть I</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_создание_управляемого_сообщениями_компонента">Создание управляемого сообщениями компонента</h3>
<div class="paragraph">
<p>В этом упражнении используется мастер создания управляемого сообщениями компонента NewMessage в модуле EJB. Кроме того, с помощью этого мастера можно создавать необходимые ресурсы JMS. Управляемый сообщениями компонент предназначен для получения и обработки сообщений, передаваемых в очередь сервлетом в веб-модуле.</p>
</div>
<div class="paragraph">
<p>Для создания управляемого сообщениями компонента выполните следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши модуль EJB в окне "Проекты" и выберите "Создать &gt; Прочее" для открытия мастера создания файла.</p>
</li>
<li>
<p>В категории "Enterprise JavaBeans" выберите тип файла "Компонент, определяемый сообщениями". Нажмите кнопку "Далее".</p>
</li>
<li>
<p>В поле "Имя EJB" введите <strong>NewMessage</strong>.</p>
</li>
<li>
<p>В раскрывающемся списке "Пакет" выберите  <code>ejb</code> .</p>
</li>
<li>
<p>Для открытия диалогового окна "Добавление адресата сообщения" нажмите кнопку "Добавить" рядом с полем "Адресат проекта".</p>
</li>
<li>
<p>В диалоговом окне "Добавление адресата сообщения" введите <strong>jms/NewMessage</strong> и выберите "Очередь" для типа адресата. Нажмите кнопку "ОК".</p>
</li>
<li>
<p>Подтвердите, что адресат проекта выбран правильно. Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-newmessage.png" alt="ejb newmessage">
</div>
<div class="title">Figure 5. Мастер создания компонентов, управляемых сообщениями</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Завершить" в редакторе исходного кода откроется класс компонента  <code>NewMessage.java</code> . При этом в среде IDE добавляется аннотация  <code>@MessageDriven</code>  и свойства настройки для класса.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MessageDriven(mappedName = "jms/NewMessage", activationConfig =  {
        @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge"),
        @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue")
    })
public class NewMessage implements MessageListener {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Аннотация  <code>@MessageDriven</code>  указывает на то, что данный компонент является управляемым сообщениями, а также определяет ресурс JMS, используемый компонентом. При создании класса в среде IDE отображаемое имя ресурса ( <code>jms/NewMessage</code> ) определяется на основе имени класса ( <code>NewMessage.java</code> ). Ресурс JMS привязан к имени JNDI адресата, от которого в компонент поступают сообщения. Мастер создания управляемых сообщениями компонентов также добавляет в файл  <code>glassfish-resources.xml</code>  информацию о ресурсах JMS. Для указания ресурсов JMS не требуется настраивать дескрипторы развертывания. Если в среде IDE для развертывания приложения на сервере GlassFish выбрать операцию "Выполнить", то ресурсы JMS создаются на сервере при развертывании.</p>
</div>
<div class="paragraph">
<p>В спецификации EJB предусмотрена возможность ввода ресурсов непосредственно в класс с помощью аннотаций. В следующем примере показано, как можно использовать аннотации для ввода в класс ресурса  <code>MessageDrivenContext</code> , а затем ресурса  <code>PersistenceContext</code> , который используется в интерфейсе API EntityManager для управления устойчивыми экземплярами сущностей. В редакторе исходного кода к классу будут добавлены аннотации.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Введите в класс ресурс  <code>MessageDrivenContext</code>  посредством добавления к классу следующего аннотированного поля (выделено полужирным шрифтом):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class NewMessage implements MessageListener {

*@Resource
private MessageDrivenContext mdc;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте диспетчер сущностей в класс, щелкнув правой кнопкой мыши в коде и выбрав 'Вставить код' (Alt-Insert, Ctrl-I в Mac) и выбрав 'Использовать диспетчер сущностей' из всплывающего меню. В среде IDE к исходному коду добавляется следующая аннотация  <code>@PersistenceContext</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PersistenceContext(unitName = "NewsApp-ejbPU")
private EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Кроме того, в среде IDE создается следующий метод  <code>persist</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void persist(Object object) {
    em.persist(object);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для изменения имени на  <code>save</code>  измените метод  <code>persist</code> . В результате метод должен выглядеть следующим образом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void *save*(Object object) {
    em.persist(object);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Измените метод  <code>onMessage</code>  путем добавления следующих строк кода (выделено полужирным шрифтом) в тело метода.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void onMessage(Message message) {
    *ObjectMessage msg = null;
    try {
        if (message instanceof ObjectMessage) {
            msg = (ObjectMessage) message;
            NewsEntity e = (NewsEntity) msg.getObject();
            save(e);
        }
    } catch (JMSException e) {
        e.printStackTrace();
        mdc.setRollbackOnly();
    } catch (Throwable te) {
        te.printStackTrace();
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши в редакторе и выберите 'Исправить выражения импорта' (Alt-Shift-I; ⌘-Shift-I в Mac) для создания необходимых операторов импорта. Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
При создании операторов импорта необходимо *убедиться в импорте библиотек  <code>javax.jms</code>  и  <code>javax.annotation.Resource</code> *.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Подробные сведения об управляемых сообщениями компонентах приведены в главе <a href="http://java.sun.com/javaee/6/docs/tutorial/doc/gipko.html">Что такое управляемый сообщениями компонент?</a> в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">руководстве по Java EE 6. Часть I</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_создание_фасада_сеанса">Создание фасада сеанса</h3>
<div class="paragraph">
<p>В этом упражнении будет создан фасад сеанса для класса сущностей NewsEntity. В спецификации EJB 3.0 упрощено создание сеансных компонентов за счет сокращения объема работ по написанию кода и добавления возможности использования аннотаций для объявления класса как сеансного компонента. Кроме того, в спецификации EJB 3.1 упрощены требования к сеансным компонентам, поскольку выбор бизнес-интерфейсов не является обязательным. Локальные клиенты получают доступ к сеансным компонентам посредством представления с локальным интерфейсом или без интерфейса. В рамках этого руководства будет создан интерфейс для такого компонента. Сервлеты в веб-приложении получают доступ к компоненту через представление без интерфейса.</p>
</div>
<div class="paragraph">
<p>Для создания фасада сеанса выполните следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните модуль EJB правой кнопкой мыши и выберите команду "Создать" &gt; "Другие".</p>
</li>
<li>
<p>Из категории "Сохранение состояния" выберите "Сеансные компоненты для классов сущностей". Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Из списка доступных классов сущностей выберите  <code>ejb.NewsEntity</code>  и нажмите кнопку "Добавить", чтобы переместить класс на панель "Выбранные классы сущностей". Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Убедитесь в том, что для параметра "Пакет" установлено значение  <code>ejb</code> . Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-sessionforentity.png" alt="ejb sessionforentity">
</div>
<div class="title">Figure 6. Мастер создания компонентов, управляемых сообщениями</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" среда IDE создает класс фасада сеанса  <code>NewsEntityFacade.java</code>  и  <code>AbstractFacade.java</code>  и открывает файлы в редакторе. Как видите из созданного кода, аннотация  <code>@Stateless</code>  используется для объявления  <code>NewsEntityFacade.java</code>  в качестве простого сеансного компонента без сохранения состояния. Также в среде IDE добавляется аннотация  <code>PersistenceContext</code>  для внедрения ресурса непосредственно в элемент сеансного компонента. Класс  <code>NewsEntityFacade.java</code>  расширяет класс  <code>AbstractFacade.java</code> , который содержит бизнес-логику и управляет транзакцией.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Удаленный интерфейс все еще является обязательным, если доступ к компонентам будет осуществляться с использованием удаленных клиентов.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Для получения подробных сведений о сеансных компонентах см. главу <a href="http://java.sun.com/javaee/6/docs/tutorial/doc/gipjg.html">Что такое сеансный компонент?</a> в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">руководстве по Java EE 6, часть I</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_написание_кода_веб_модуля">Написание кода веб-модуля</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В примере в этом разделе будет создано два сервлета в веб-модуле. Сервлет ListNews извлекает сообщения из базы данных через фасад сущностей в модуле EJB. Сервлет PostMessage используется для отправки сообщений JMS.</p>
</div>
<div class="paragraph">
<p>Кроме того, в примере в этом разделе будет создан единичный сеансный компонент в веб-модуле для подсчета количества пользователей, участвующих в настоящий момент в этом сеансе. Спецификация EJB 3.1 позволяет создавать компоненты EJB в веб-приложениях. В версиях EJB, предшествующих 3.1, все компоненты EJB должны были находиться в модулях EJB.</p>
</div>
<div class="sect2">
<h3 id="_создание_единичного_сеансного_компонента">Создание единичного сеансного компонента</h3>
<div class="paragraph">
<p>В спецификацию EJB 3.1 добавлена возможность использования аннотации  <code>@Singleton</code> , которая обеспечивает упрощенное создание единичных сеансных компонентов. В EJB 3.1 также определяются дополнительные аннотации для свойств настройки единичных сеансных компонентов, например, при создании экземпляра для компонента.</p>
</div>
<div class="paragraph">
<p>После создания экземпляра единичного сеансного компонента данный компонент доступен в жизненном цикле приложения. Как понятно из его названия, в приложении может быть только один экземпляр единичного сеансного компонента. Аналогично сеансным компонентам без сохранения состояния единичные сеансные компоненты могут иметь несколько клиентов.</p>
</div>
<div class="paragraph">
<p>Для создания единичного сеансного компонента выполните следующие действия.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для открытия мастера создания файла щелкните веб-модуль правой кнопкой мыши и выберите "Создать" &gt; "Другие".</p>
</li>
<li>
<p>Выберите "Сеансный компонент" в категории Enterprise JavaBeans. Нажмите кнопку "Далее".</p>
</li>
<li>
<p>В поле "Имя EJB" введите <strong>SessionManagerBean</strong>.</p>
</li>
<li>
<p>В качестве имени параметра "Пакет" введите <strong>ejb</strong>.</p>
</li>
<li>
<p>Выберите "Единичный". Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-newsingleton.png" alt="ejb newsingleton">
</div>
<div class="title">Figure 7. Создание отдельного компонента в мастере создания компонентов сеансов</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Завершить" в среде IDE будет создан класс единичного сеансного компонента, который откроется в редакторе. При этом в среде IDE добавляется аннотация  <code>@Singleton</code>  к классу для объявления единичного сеансного компонента. В мастере также создается аннотация  <code>@LocalBean</code>  для класса.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Singleton
@LocalBean
public class SessionManagerBean {

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создайте аннотацию  <code>@WebListener</code>  для класса и реализуйте  <code>HttpSessionListener</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Singleton
@LocalBean
*@WebListener*
public class SessionManagerBean *implements HttpSessionListener*{

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Аннотация  <code>@WebListener</code>  является частью интерфейса API сервлета 3.0 и позволяет реализовать прослушивающий процесс непосредственно в коде.</p>
</div>
<div class="paragraph">
<p>При реализации  <code>HttpSessionListener</code>  в среде IDE в поле отображается предупреждение.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните значок предупреждения в левом поле и выберите "Реализовать все абстрактные методы".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-implementabstract.png" alt="ejb implementabstract">
</div>
<div class="title">Figure 8. Подсказка редактора о реализации абстрактных методов</div>
</div>
<div class="paragraph">
<p>В среде IDE добавляются методы  <code>sessionCreated</code>  и  <code>sessionDestroyed</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте статическое поле  <code>counter</code>  и установите начальное значение на  <code>0</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@LocalBean
@WebListener
public class SessionManagerBean implements HttpSessionListener{
    *private static int counter = 0;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Измените созданные тела методов  <code>sessionCreated</code>  и  <code>sessionDestroyed</code>  для увеличения значения поля при запуске нового сеанса и для уменьшения значения при завершении сеанса. Значение сохраняется в поле  <code>counter</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void sessionCreated(HttpSessionEvent se) {
    *counter++;*
}

public void sessionDestroyed(HttpSessionEvent se) {
    *counter--;*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующий метод, возвращающий текущее значение поля  <code>counter</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public int getActiveSessionsCount() {
        return counter;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот метод вызывается из сервлета для отображения текущего количества пользователей/открытых сеансов.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь код сеансного компонента должен выглядеть следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Singleton
@LocalBean
@WebListener
public class SessionManagerBean implements HttpSessionListener {
    private static int counter = 0;

    public void sessionCreated(HttpSessionEvent se) {
        counter++;
    }

    public void sessionDestroyed(HttpSessionEvent se) {
        counter--;
    }

    public int getActiveSessionsCount() {
        return counter;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Подробные сведения об единичных сеансных компонентах см. в главе <a href="http://java.sun.com/javaee/6/docs/tutorial/doc/gipjg.html">Что такое сеансный компонент?</a> в <a href="http://download.oracle.com/javaee/6/tutorial/doc/">руководстве по Java EE 6, часть I</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_создание_сервлета_listnews">Создание сервлета  <code>ListNews</code></h3>
<div class="paragraph">
<p>В этом упражнении будет создан простой сервлет для отображения сохраненных сообщений. Аннотации используются для вызова компонента EJB NewsEntityFacade из сервлета.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните проект веб-модуля правой кнопкой мыши и выберите "Создать" &gt; "Сервлет".</p>
</li>
<li>
<p>В поле "Имя класса" введите <strong>ListNews</strong>.</p>
</li>
<li>
<p>В качестве имени параметра "Пакет" введите <strong>web</strong>. Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" класс  <code>ListNews.java</code>  будет открыт в редакторе исходного кода. В редакторе исходного кода выполните следующие шаги.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши в редакторе исходного кода, выберите пункт "Вставить код" (Alt-Insert; Ctrl-I на Mac) и выберите пункт "Вызов компонента EJB".</p>
</li>
<li>
<p>В диалоговом окне "Вызов компонента EJB" разверните узел NewsApp-ejb и выберите NewsEntityFacade. Нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В среде IDE добавляется аннотация  <code>@EJB</code>  для ввода компонента EJB.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Используйте диалоговое окно "Вызов компонента EJB" еще раз для ввода компонента SessionManagerBean в узел NewsApp-war.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В коде можно увидеть следующие аннотации для ввода двух компонентов EJB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet(name = "ListNews", urlPatterns = {"/ListNews"})
public class ListNews extends HttpServlet {

    @EJB
    private SessionManagerBean sessionManagerBean;
    @EJB
    private NewsEntityFacade newsEntityFacade;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Кроме того, можно увидеть, что аннотация  <code>@WebServlet</code>  используется для объявления класса сервлета и для указания имени сервлета. Аннотация  <code>@WebServlet</code>  является частью интерфейса API сервлета 3.0, представленного в спецификации Java EE 6. Сервлеты можно определить с помощью аннотации вместо дескриптора развертывания в  <code>web.xml</code> . Приложение NewsApp не содержит  <code>web.xml</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В методе  <code>processRequest</code>  добавьте следующий код (выделено полужирным шрифтом) для возврата к текущему сеансу или создания нового.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void processRequest(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
        *request.getSession(true);*
        response.setContentType("text/html;charset=UTF-8");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующий код (выделен жирным шрифтом) к методу  <code>processRequest</code>  для вывода сообщений и добавления ссылки на сервлет PostMessage. (При необходимости удалите знак комментария для кода в методе.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">out.println("&lt;h1&gt;Servlet ListNews at " + request.getContextPath () + "&lt;/h1&gt;");

*List news = newsEntityFacade.findAll();
for (Iterator it = news.iterator(); it.hasNext();) {
    NewsEntity elem = (NewsEntity) it.next();
    out.println(" &lt;b&gt;"+elem.getTitle()+" &lt;/b&gt;&lt;br /&gt;");
    out.println(elem.getBody()+"&lt;br /&gt; ");
}
out.println("&lt;a href='PostMessage'&gt;Add new message&lt;/a&gt;");*

out.println("&lt;/body&gt;");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующий код (выделено полужирным шрифтом) для получения и отображения количества пользователей/открытых сеансов.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">out.println("&lt;a href='PostMessage'&gt;Add new message&lt;/a&gt;");

*out.println("&lt;br&gt;&lt;br&gt;");
out.println(sessionManagerBean.getActiveSessionsCount() + " user(s) reading the news.");*

out.println("&lt;/body&gt;");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите сочетание клавиш Ctrl+Shift+I для создания обязательных операторов импорта для класса. При создании операторов импорта может потребоваться *импортировать библиотеки  <code>java.util</code> *.</p>
</li>
<li>
<p>Сохраните измененный файл.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_создание_сервлета_postmessage">Создание сервлета  <code>PostMessage</code></h3>
<div class="paragraph">
<p>В этом упражнении будет создан сервлет  <code>PostMessage</code> , используемый для отправки сообщений. Для добавления созданных ресурсов JMS непосредственно в сервлет используются аннотации с указанием имени переменной и имени, на которое она отображается. Затем необходимо написать код для отправки сообщения JMS и код для формы HTML, предназначенной для добавления сообщения.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните проект веб-модуля правой кнопкой мыши и выберите "Создать" &gt; "Сервлет".</p>
</li>
<li>
<p>В поле "Имя класса" введите  <code>PostMessage</code> .</p>
</li>
<li>
<p>Для имени параметра "Пакет" введите  <code>web</code>  и нажмите "Завершить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" в редакторе исходного кода будет открыт класс  <code>PostMessage.java</code> . В редакторе исходного кода выполните следующие шаги.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Используйте аннотации для ввода ресурсов  <code>ConnectionFactory</code>  и  <code>Queue</code>  путем добавления следующих объявлений полей (выделено полужирным шрифтом):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet(name="PostMessage", urlPatterns={"/PostMessage"})
public class PostMessage extends HttpServlet {
    *@Resource(mappedName="jms/NewMessageFactory")
    private  ConnectionFactory connectionFactory;

    @Resource(mappedName="jms/NewMessage")
    private  Queue queue;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Теперь создадим код для передачи сообщения JMS путем добавления в метод  <code>processRequest</code>  следующих строк кода, выделенных полужирным шрифтом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">response.setContentType("text/html;charset=UTF-8");

// Add the following code to send the JMS message
*String title=request.getParameter("title");
String body=request.getParameter("body");
if ((title!=null) &amp;amp;&amp;amp; (body!=null)) {
    try {
        Connection connection = connectionFactory.createConnection();
        Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
        MessageProducer messageProducer = session.createProducer(queue);

        ObjectMessage message = session.createObjectMessage();
        // here we create NewsEntity, that will be sent in JMS message
        NewsEntity e = new NewsEntity();
        e.setTitle(title);
        e.setBody(body);

        message.setObject(e);
        messageProducer.send(message);
        messageProducer.close();
        connection.close();
        response.sendRedirect("ListNews");

    } catch (JMSException ex) {
        ex.printStackTrace();
    }
}*

PrintWriter out = response.getWriter();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте следующие строки (выделены жирным шрифтом) к методу  <code>processRequest</code> , чтобы добавить веб-форму добавления сообщения. (При необходимости, уберите знак комментария для вывода кода HTML)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">out.println("Servlet PostMessage at " + request.getContextPath() + "&lt;/h1&gt;");

// The following code adds the form to the web page
*out.println("&lt;form&gt;");
out.println("Title: &lt;input type='text' name='title'&gt;&lt;br/&gt;");
out.println("Message: &lt;textarea name='body'&gt;&lt;/textarea&gt;&lt;br/&gt;");
out.println("&lt;input type='submit'&gt;&lt;br/&gt;");
out.println("&lt;/form&gt;");*

out.println("&lt;/body&gt;");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите сочетание клавиш Ctrl+Shift+I для создания обязательных операторов импорта для класса.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
При выборе библиотек для импорта для  <code>Connection</code> ,  <code>ConnectionFactory</code> ,  <code>Session</code>  и  <code>Queue</code> , *убедитесь, что импортируются библиотеки  <code>javax.jms</code> *.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/import-jms.png" alt="import jms">
</div>
<div class="title">Figure 9. Выберите библиотеки JMS в диалоговом окне 'Исправить все выражения импорта'</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраните измененный файл.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_выполнение_проекта">Выполнение проекта</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Теперь проект можно выполнить. При выполнении проекта страница с сервлетом  <code>ListNews</code>  должна открыться в браузере. Для этого в диалоговом окне "Свойства" для приложения J2EE вводится URL-адрес. Это относительный URL-адрес, связанный с контекстным путем к приложению. После ввода относительного URL-адреса приложение можно собрать, развернуть и запустить в окне "Проекты".</p>
</div>
<div class="paragraph">
<p>Для указания относительного URL-адреса и запуска приложения необходимо выполнить следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В окне 'Проекты' щелкните правой кнопкой мыши узел приложения корпоративного уровня NewsApp и выберите во всплывающем меню 'Свойства'.</p>
</li>
<li>
<p>В панели "Категории" выберите "Выполнить".</p>
</li>
<li>
<p>В текстовое поле "Относительный URL-адрес" введите <strong>/ListNews</strong>.</p>
</li>
<li>
<p>Нажмите кнопку "ОК".</p>
</li>
<li>
<p>В окне 'Проекты' щелкните правой кнопкой мыши узел приложения корпоративного уровня NewsApp и выберите 'Выполнить'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При выполнении проекта в браузере откроется сервлет  <code>ListNews</code> . В нем отображается список сообщений в базе данных. При первом выполнении проекта база данных пуста, но сообщение можно добавить путем щелчка по ссылке "Добавить сообщение".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ejb-browser1.png" alt="ejb browser1">
</div>
<div class="title">Figure 10. Страница сервлета ListNews</div>
</div>
<div class="paragraph">
<p>При добавлении сообщения с помощью сервлета  <code>PostMessage</code>  оно передается на постоянное хранение в управляемый сообщениями компонент. Для просмотра сообщений в базе данных вызывается сервлет  <code>ListNews</code> . Список сообщений в базе данных, извлеченных сервлетом  <code>ListNews</code> , часто выводится без нового сообщения, поскольку служба передачи сообщений работает асинхронно.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_загрузка_проекта_решения">Загрузка проекта решения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Решение для данного учебного курса в виде проекта можно загрузить несколькими способами.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Загрузите <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FNewsAppEE6.zip">архив завершенного проекта в формате zip</a>.</p>
</li>
<li>
<p>Выполните проверку исходных файлов проекта на выходе из примеров NetBeans, выполнив перечисленные ниже действия.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Выберите в главном меню "Группа &gt; Subversion &gt; Проверить".</p>
</li>
<li>
<p>В диалоговом окне "Проверка" введите следующий URL-адрес репозитория:
 <code><a href="https://svn.netbeans.org/svn/samples~samples-source-code" class="bare">https://svn.netbeans.org/svn/samples~samples-source-code</a></code>
Нажмите кнопку "Далее".</p>
</li>
<li>
<p>Нажмите кнопку Browse ("Обзор") для открытия диалогового окна Browse Repository Folders ("Обзор папок репозитория").</p>
</li>
<li>
<p>Разверните корневой узел и выберите <strong>samples/javaee/NewsAppEE6</strong>. Нажмите кнопку "ОК".</p>
</li>
<li>
<p>Укажите локальную папку для исходных файлов (папка должна быть пустой).</p>
</li>
<li>
<p>Нажмите кнопку "Завершить".</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>После нажатия кнопки "Готово" среда IDE инициализирует локальную папку в качестве репозитория Subversion и выполняет проверку исходных файлов проекта на выходе.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните команду "Открыть проект" в диалоговом окне, которое появится после завершения проверки.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Примечания.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для получения исходных файлов на редактирование требуется клиент Subversion. For more about installing Subversion, see the section on <a href="../ide/subversion.html#settingUp">Setting up Subversion</a> in the <a href="../ide/subversion.html">Guide to Subversion in IDE NetBeans</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_устранение_проблем">Устранение проблем</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ниже приводится ряд проблем, которые могут возникнуть при создании проекта.</p>
</div>
<div class="sect2">
<h3 id="_проблема_с_ресурсами_jms">Проблема с ресурсами JMS</h3>
<div class="paragraph">
<p>При создании ресурсов JMS с помощью мастера в окне вывода может появиться следующее сообщение об ошибке сервера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">[com.sun.enterprise.connectors.ConnectorRuntimeException:
                    JMS resource not created : jms/Queue]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это сообщение указывает на то, что ресурс JMS не создан или не зарегистрирован на сервере приложений. Для проверки, создания и изменения ресурсов JMS используйте консоль администратора сервера приложений.</p>
</div>
<div class="paragraph">
<p>Для вызова консоли администратора необходимо выполнить следующие действия.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Убедитесь в том, что сервер приложений запущен. Для этого разверните узел "Серверы" в окне "Службы" среды IDE. Работающий сервер обозначается зеленой стрелкой рядом с узлом сервера приложений.</p>
</li>
<li>
<p>Щелкните правой кнопкой мыши узел сервера приложений и выберите "Просмотр консоли администратора" для открытия в браузере окна входа в систему.</p>
</li>
<li>
<p>Выполните вход в систему сервера. По умолчанию используется имя пользователя  <code>admin</code>  и пароль  <code>adminadmin</code> .</p>
</li>
<li>
<p>Разверните узлы "Ресурсы" и "Ресурсы JMS" в левом поле консоли администратора в браузере.</p>
</li>
<li>
<p>Щелкните ссылки "Фабрики подключений" и "Ресурсы адресатов" в левом поле и проверьте, зарегистрированы ли ресурсы на сервере; при необходимости внесите требуемые изменения. Если ресурсы не существуют, их можно создать при помощи консоли администратора.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Необходимо убедиться в том, что ресурс фабрики подключений JMS в сервлете PostMessage связан с правильным именем JNDI ресурса фабрики подключений JMS, зарегистрированного на сервере приложений Sun Java System Application Server.</p>
</div>
<div class="paragraph">
<p>На сервере Sun Java System Application Server должны быть зарегистрированы следующие ресурсы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ресурс адресата с именем JNDI  <code>jms/NewMessage</code>  и типом  <code>javax.jms.Queue</code> ;</p>
</li>
<li>
<p>ресурс фабрики подключений с именем JNDI  <code>jms/NewMessageFactory</code>  и типом  <code> javax.jms.QueueConnectionFactory</code> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Creating%20an%20Enterprise%20Application%20with%20EJB%203.1">Отправить отзыв по этому учебному курсу</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_дополнительные_сведения">Дополнительные сведения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more information about using IDE NetBeans to develop Java EE applications, see the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-intro.html">+Введение в технологию Java EE +</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Начало работы с приложениями Java EE</a></p>
</li>
<li>
<p><a href="../web/quickstart-webapps.html">Введение в разработку веб-приложений</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Учебная карта по Java EE и Java Web</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Дополнительные сведения об использовании корпоративных компонентов см. в <a href="http://docs.oracle.com/javaee/7/tutorial/doc/ejb-intro.htm">Учебном курсе по Java EE 7</a>.</p>
</div>
<div class="paragraph">
<p>To send comments and suggestions, get support, and keep informed on the latest developments on the IDE NetBeans Java EE development features, <a href="../../../community/lists/top.html">join the nbj2ee mailing list</a>.</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-ejb_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
