
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>CDIの注入および修飾子の操作</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CDIの注入および修飾子の操作 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, CDIの注入および修飾子の操作">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans (incubating)</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/nb100/nb100.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 11.0</h1>
            <p><a class="button success" href="/download/nb110/nb110.html">Read more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">CDIの注入および修飾子の操作</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/incubator-netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-inject_ja.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel2">
<li><a href="#_コンテキストと依存性の注入">コンテキストと依存性の注入</a></li>
<li><a href="#inject">注入(Injection): CDIの「I」</a></li>
<li><a href="#qualifier">修飾子の操作</a></li>
<li><a href="#alternative">代替の注入方法</a></li>
<li><a href="#seealso">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>執筆: Andy Gibson</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_コンテキストと依存性の注入">コンテキストと依存性の注入</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="cdi-intro.html">CDIおよびJSF 2.0の開始</a></p>
</li>
<li>
<p><strong>CDIの注入および修飾子の操作</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#inject">注入(Injection): CDIの「I」</a></p>
</li>
<li>
<p><a href="#qualifier">修飾子の操作</a></p>
</li>
<li>
<p><a href="#alternative">代替の注入方法</a></p>
</li>
<li>
<p><a href="#seealso">関連項目</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="cdi-validate.html">@Alternative Beanおよびライフサイクル注釈の適用</a></p>
</li>
<li>
<p><a href="cdi-events.html">CDIのイベントの操作</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="paragraph">
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR-299</a>で指定されているコンテキストと依存性の注入(CDI: Contexts and Dependency Injection)はJava EE 6の不可欠な部分であり、サーブレット、エンタープライズBean、JavaBeansなどのJava EEコンポーネントが、アプリケーションのライフサイクル内で明確なスコープを持って存在できるようにするためのアーキテクチャを提供します。また、CDIサービスによって、EJBセッションBeanやJSF (JavaServer Faces)管理対象BeanなどのJava EEコンポーネントが注入可能になり、イベントの起動や監視による疎結合方式の対話が可能になります。</p>
</div>
<div class="paragraph">
<p>このチュートリアルは、Andy Gibson氏によって投稿された<a href="http://www.andygibson.net/blog/index.php/2009/12/22/getting-started-with-cdi-part-2-injection/">CDI入門パート2 - 注入</a>というタイトルのブログをベースにしています。ここでは、クラスやインタフェースを他のクラスに_注入_するために、どのようにCDI注入を使用できるかについて示します。また、特定の注入ポイントに注入するクラスの型を指定できるようにするために、CDI_修飾子_をコードに適用する方法についても示します。</p>
</div>
<div class="paragraph">
<p>NetBeans IDEは、コンテキストと依存性の注入のサポートを組込みでサポートしています。これには、プロジェクト作成時に`beans.xml` CDI構成ファイルを生成するオプション、注釈のためのエディタおよびナビゲーション・サポート、一般的に使用されるCDIアーティファクトを作成するための各種ウィザードなどが含まれています。</p>
</div>
<div class="paragraph">
<p>このチュートリアルを完了するには、次のソフトウェアとリソースが必要です。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EEバージョン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://glassfish.dev.java.net/">GlassFishサーバー</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Source Edition 3.xまたは4x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo.zip">cdiDemo.zip</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>*注意: *</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NetBeans IDEのJavaバンドル版には、Java EE準拠のコンテナであるGlassFish Server Open Source Editionも含まれています。</p>
</li>
<li>
<p>このチュートリアルのサンプル・ソリューション・プロジェクトをダウンロードできます: <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo2.zip">cdiDemo2.zip</a></p>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="inject">注入(Injection): CDIの「I」</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CDIは、コンテキストと依存性を注入するためのAPIです。SeamおよびSpringでは多くの場合、Beanに名前を付けて、その名前で注入ポイントにバインディングすることで依存性が機能します。<a href="cdi-intro.html">コンテキストと依存性の注入およびJSF 2.0の開始</a>を終えてからこのチュートリアルを進めている場合、これまでは`@Named`注釈を使用してBeanの名前を定義したときに、JSFページから名前で管理対象Beanを参照するのみでした。`@Named`注釈の主な役割は、アプリケーション内のEL文を解決できるようにBeanを定義することです。この解決は、通常はJSF ELリゾルバによって行われます。注入は名前を使用して実行することもできますが、この方法はCDIの注入を機能させる本来の方法ではありません。CDIには、注入ポイントおよび注入ポイントに注入するBeanを表すための様々な方法が提供されています。</p>
</div>
<div class="paragraph">
<p>次の例では、<code>ItemDao`インタフェースを実装するクラスから項目の一覧を取得する`ItemProcessor`を作成します。別のクラスにBeanを_注入_できるようにする方法を示すため、CDIの</code>@Inject`注釈を利用します。次の図は、この課題で構築するシナリオを図解しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-inject.png" alt="cdi diagram inject">
</div>
<div class="title">Figure 2. アプリケーションの疎結合クラスへのCDI注入の使用</div>
</div>
<div class="paragraph">
<p>DAOはデータ・アクセス・オブジェクト(<em>Data Access Object</em>)を表します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>まず、`cdiDemo.zip`ファイル(上記の<a href="#requiredSoftware">必要なリソースの一覧表</a>を参照)からサンプルのスタート・プロジェクトを抽出します。「ファイル」&gt;「プロジェクトを開く」([Ctrl]-[Shift]-[O]、Macの場合は[⌘]-[Shift]-[O])を選択してから、コンピュータ上のこのプロジェクトの場所を選択することで、IDEでプロジェクトを開きます。</p>
</li>
<li>
<p>「プロジェクト」ウィンドウでプロジェクトのノードを右クリックし、「プロパティ」を選択します。</p>
</li>
<li>
<p>「実行」カテゴリを選択し、「サーバー」ドロップダウン・リストでGlassFishインスタンスが選択されていることを確認します。</p>
</li>
<li>
<p>新しい`Item`クラスを作成して、`exercise2`という名前の新しいパッケージに格納します。「新規ファイル」(image::images/new-file-btn.png[])ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。</p>
</li>
<li>
<p>「Java」カテゴリから「Javaクラス」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名として「<strong>Item</strong>」、パッケージとして「<strong>exercise2</strong>」と入力します。(ウィザードの完了時に新しいパッケージが作成されます。)
image::images/java-class-wizard.png[title="ファイル・ウィザードを使用した新しいJavaクラスの作成"]</p>
</li>
<li>
<p>「終了」をクリックします。新しいクラスおよびパッケージが生成され、エディタで`Item`クラスが開きます。</p>
</li>
<li>
<p>POJOである`Item`に`value`および`limit`プロパティを作成して、`toString()`メソッドを実装します。次の内容をクラスに追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Item {

    *private int value;
    private int limit;

    @Override
    public String toString() {
        return super.toString() + String.format(" [Value=%d, Limit=%d]", value,limit);
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>取得メソッドおよび設定メソッドをクラスに追加します。これを行うには、カーソルがクラス定義の間(クラスの中括弧の間)にあることを確認してからエディタ内で右クリックし、「コードを挿入」を選択します([Alt]-[Insert]、Macの場合は[Ctrl]-[I])。取得メソッドおよび設定メソッドを選択します。
image::images/insert-code.png[title="「コードを挿入」ポップアップを使用した取得メソッドおよび設定メソッドの作成"]</p>
</li>
<li>
<p>「<code>Item</code>」チェックボックスを選択します(これで、クラスに含まれているプロパティがすべて選択されます)。
image::images/generate-getters-setters.png[title="クラスに含まれているすべてのプロパティを選択するためのクラスのチェックボックスの選択"]</p>
</li>
<li>
<p>「生成」をクリックします。クラスの取得メソッドと設定メソッドが生成されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Item {

    private int value;
    private int limit;

    *public int getLimit() {
        return limit;
    }

    public void setLimit(int limit) {
        this.limit = limit;
    }

    public int getValue() {
        return value;
    }

    public void setValue(int value) {
        this.value = value;
    }*

    @Override
    public String toString() {
        return super.toString() + String.format(" [Value=%d, Limit=%d]", value, limit);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>value`と`limit`の両方の引数を取るコンストラクタを作成します。これにもIDEの支援機能を使用できます。クラス定義内で[Ctrl]-[Space]を押して、「`Item(int value, int limit) - 生成</code>」オプションを選択します。
image::images/generate-constructor.png[title="[Ctrl]-[Space]の押下によるエディタのコード補完機能の利用"]
次のコンストラクタがクラスに追加されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Item {

    *public Item(int value, int limit) {
        this.value = value;
        this.limit = limit;
    }*

    private int value;
    private int limit;

    ...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>`ItemDao`インタフェースを作成して、`Item`オブジェクトの一覧を取得する方法を定義します。このテスト・アプリケーションでは複数の実装を使用することを予定しているため、インタフェースへのコードを作成します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「新規ファイル」(image::images/new-file-btn.png[])ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Java」カテゴリから「Javaインタフェース」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名として「<strong>ItemDao</strong>」、パッケージとして「<strong>exercise2</strong>」と入力します。</p>
</li>
<li>
<p>「終了」をクリックします。新しいインタフェースが生成され、エディタで開かれます。</p>
</li>
<li>
<p>`Item`オブジェクトの`List`を返す`fetchItems()`という名前のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface ItemDao {

    *List&lt;Item&gt; fetchItems();*

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(エディタのヒントを使用して`java.util.List`のインポート文を追加します。)
18. `ItemProcessor`クラスを作成します。これはメイン・クラスであり、ここにBeanを注入したり、ここからプロセスを実行したりします。今のところはDAOから始めて、プロセッサBeanにこれを注入する方法を見てみます。</p>
</div>
<div class="paragraph">
<p>「新規ファイル」(image::images/new-file-btn.png[])ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Java」カテゴリから「Javaクラス」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名として「<strong>ItemProcessor</strong>」、パッケージとして「<strong>exercise2</strong>」と入力します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>新しいクラスが生成され、エディタで開かれます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のようにクラスを変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    private ItemDao itemDao;

    public void execute() {
        List&lt;Item&gt; items = itemDao.fetchItems();
        for (Item item : items) {
            System.out.println("Found item " + item);
        }
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正します。エディタを右クリックして「インポートを修正」を選択するか、[Ctrl]-[Shift]-[I] (Macの場合は[⌘]-[Shift]-[I])を押します。
image::images/fix-imports.png[title="エディタで右クリックして「インポートを修正」を選択し、クラスにインポート文を追加する"]</p>
</li>
<li>
<p>「OK」をクリックします。次のクラスのインポート文が必要になります。</p>
<div class="ulist">
<ul>
<li>
<p><code>java.util.List</code></p>
</li>
<li>
<p><code>javax.inject.Named</code></p>
</li>
<li>
<p><code>javax.enterprise.context.RequestScoped</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>項目の一覧を作成して、決まった項目の一覧を返すのみの単純なDAOから始めます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「<code>exercise2</code>」パッケージ・ノードを右クリックし、「新規」&gt;「Javaクラス」を選択します。新規Javaクラス・ウィザードで、クラス名を「<code>DefaultItemDao</code>」にします。「終了」をクリックします。 image::images/java-class-wizard2.png[title="Javaクラス・ウィザードを使用した新しいJavaクラスの作成"]
25. エディタで、`DefaultItemDao`に`ItemDao`インタフェースを実装させて、`fetchItems()`を実装します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class DefaultItemDao *implements ItemDao* {

    *@Override
    public List&lt;Item&gt; fetchItems() {
        List&lt;Item&gt; results = new ArrayList&lt;Item&gt;();
        results.add(new Item(34, 7));
        results.add(new Item(4, 37));
        results.add(new Item(24, 19));
        results.add(new Item(89, 32));
        return results;
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>[Ctrl]-[Shift]-[I] (Macの場合は[⌘]-[Shift]-[I])を押して、`java.util.List`および`java.util.ArrayList`のインポート文を追加します。
26. `ItemProcessor`クラスに切り替えます([Ctrl]-[Tab]を押します)。`ItemProcessor`に`DefaultItemDao`を注入するために、`ItemDao`フィールドに`javax.inject.Inject`注釈を追加して、このフィールドが注入ポイントであることを示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">*import javax.inject.Inject;*
...

@Named
@RequestScoped
public class ItemProcessor {

    *@Inject*
    private ItemDao itemDao;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">エディタのコード補完サポートを利用して、クラスに`@Inject`注釈およびインポート文を追加します。たとえば、「<code>@Inj</code>」と入力してから[Ctrl]-[Space]を押します。</span>
27. 最後に、`ItemProcessor`で`execute()`メソッドをコールするためのなんらかの方法が必要です。これはSE環境なら実行できますが、今のところはJSFページ内にとどめておきます。`execute()`メソッドをコールするボタンを含む`process.xhtml`という名前の新しいページを作成します。</p>
</div>
<div class="paragraph">
<p>「新規ファイル」(image::images/new-file-btn.png[])ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。
28. 「JavaServer Faces」カテゴリを選択し、「JSFページ」を選択します。「次」をクリックします。
29. ファイル名として「<strong>process</strong>」と入力してから「終了」をクリックします。
image::images/new-jsf-page.png[title="JSFファイル・ウィザードを使用した新しい「Facelets」ページの作成"]
30. 新しい`process.xhtml`ファイルで、<code>ItemProcessor.execute()`メソッドに接続されたボタンを追加します。ELを使用する場合、管理対象Beanのデフォルト名は、クラス名の最初の文字を小文字にした名前(つまり`itemProcessor</code>)になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;h:body&gt;
    *&lt;h:form&gt;
        &lt;h:commandButton action="#{itemProcessor.execute}" value="Execute"/&gt;
    &lt;/h:form&gt;*
&lt;/h:body&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトを実行する前に、`process.xhtml`ファイルをプロジェクトのWebデプロイメント・ディスクリプタの新しい開始ページに設定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IDEの「ファイルに移動」ダイアログを使用すると、すばやく`web.xml`を開けます。IDEのメイン・メニューで「ナビゲート」&gt;「ファイルに移動」([Alt]-[Shift]-[O]、Macの場合は[Ctrl]-[Shift]-[O])を選択してから「<code>web</code>」と入力します。
image::images/go-to-file.png[title="「ファイルに移動」ダイアログを使用した、プロジェクト・ファイルの速やかな検索"]
32. 「OK」をクリックします。`web.xml`ファイルの「XML」ビューで、次のように変更します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;welcome-file-list&gt;
    &lt;welcome-file&gt;faces/*process.xhtml*&lt;/welcome-file&gt;
&lt;/welcome-file-list&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEのメイン・ツールバーにある「プロジェクトの実行」(image::images/run-project-btn.png[])ボタンをクリックします。プロジェクトがコンパイルされてGlassFishにデプロイされ、`process.xhtml`ファイルがブラウザで開きます。</p>
</li>
<li>
<p>ページに表示されている「<code>Execute</code>」ボタンをクリックします。IDEに戻ってGlassFishのサーバー・ログを調べます。サーバー・ログは、「出力」ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])の「GlassFish Server」タブの下に表示されます。ボタンをクリックすると、デフォルトDAO実装による項目がログに一覧表示されます。
image::images/output-window.png[title="IDEの「出力」ウィンドウでのサーバー・ログの確認"]
<span class="tips">ログをクリアするには、「出力」ウィンドウで右クリックして「クリア」を選択([Ctrl]-[L]、Macの場合は[⌘]-[L])します。上記のイメージでは、「<code>Execute</code>」ボタンをクリックする直前にログをクリアしています。</span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>ItemDao`インタフェースを実装するクラスを作成し、モジュールの管理対象Beanは、アプリケーションがデプロイされたときに(モジュールの`beans.xml`ファイルのために) CDI実装によって処理されました。ここで使用した</code>@Inject`注釈は、そのフィールドに管理対象Beanを注入することを指定します(注入可能Beanについて把握していることは、このBeanが`ItemDao`またはこのインタフェースのサブタイプを実装する必要があることのみです)。この場合、`DefaultItemDao`クラスは条件を完全に満たしています。</p>
</div>
<div class="paragraph">
<p>注入された可能性のある`ItemDao`の実装が複数ある場合はどうなるでしょうか。CDIはどの実装を選択する必要があるかを判断できないため、デプロイ時エラーが発生します。これを解決するには、CDI修飾子を使用する必要があります。修飾子については次の項で詳しく説明します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="qualifier">修飾子の操作</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CDI修飾子は、クラス・レベルで適用してクラスがどの種類のBeanなのかを示したり、(特に)フィールド・レベルで適用してその場所でどの種類のBeanが注入される必要があるかを示したりできる注釈です。</p>
</div>
<div class="paragraph">
<p>ここでビルドしているアプリケーションに修飾子が必要なことを示すために、やはり`ItemDao`インタフェースを実装するもう1つのDAOクラスをアプリケーションに追加してみます。次の図は、この課題で構築しているシナリオを図解しています。CDIは、注入ポイントで使用する必要があるBean実装を判断できる必要があります。2つの`ItemDao`の実装があるため、<code>Demo`という名前の修飾子を作成することでこれを解決できます。その後、使用するBeanと`ItemProcessor`の注入ポイントの両方に、</code>@Demo`注釈で「タグ」を付けます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-qualify.png" alt="cdi diagram qualify">
</div>
<div class="title">Figure 3. アプリケーションの疎結合クラスへのCDI注入および修飾子の使用</div>
</div>
<div class="paragraph">
<p>次の手順を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで「<code>exercise2</code>」パッケージを右クリックし、「新規」&gt;「Javaクラス」を選択します。</p>
</li>
<li>
<p>新規Javaクラス・ウィザードで、新しいクラス名を「<strong>AnotherItemDao</strong>」にしてから「終了」をクリックします。新しいクラスが生成され、エディタで開かれます。</p>
</li>
<li>
<p>クラスを次のように変更して、`ItemDao`インタフェースを実装し、インタフェースの`fetchItems()`メソッドを定義します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class AnotherItemDao *implements ItemDao* {

    *@Override
    public List&lt;Item&gt; fetchItems() {
        List&lt;Item&gt; results = new ArrayList&lt;Item&gt;();
        results.add(new Item(99, 9));
        return results;
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>`java.util.List`および`java.util.ArrayList`のインポート文を必ず追加するようにしてください。これを行うには、エディタを右クリックして「インポートを修正」を選択するか、[Ctrl]-[Shift]-[I] (Macの場合は[⌘]-[Shift]-[I])を押します。</p>
</div>
<div class="paragraph">
<p>これで`ItemDao`を実装するクラスが2つになったため、どのBeanを注入する必要があるかがわからなくなりました。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクトの実行」(image::images/run-project-btn.png[])ボタンをクリックして、プロジェクトを実行します。今度はプロジェクトのデプロイに失敗します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「保存時にデプロイ」がデフォルトで有効になっていて、IDEがプロジェクトを自動的にデプロイするため、ファイルを保存するのみで済む可能性があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>出力ウィンドウ([Ctrl]-[4]、Macの場合は[⌘]-[4])でサーバー・ログを調べます。次のようなエラー・メッセージが表示されています。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Caused by: org.jboss.weld.DeploymentException: Injection point has ambiguous dependencies.
Injection point: field exercise2.ItemProcessor.itemDao;
Qualifiers: [@javax.enterprise.inject.Default()];
Possible dependencies: [exercise2.DefaultItemDao, exercise2.AnotherItemDao]</code></pre>
</div>
</div>
<div class="paragraph">
<p>「出力」ウィンドウでテキストを複数行に折り返すには、右クリックして「テキストを折り返す」を選択します。これにより、水平方向にスクロールさせる必要がなくなります。</p>
</div>
<div class="paragraph">
<p>CDIの実装であるWeldによって示されたあいまいな依存性のエラーは、指定された注入ポイントに使用するBeanを決定できないということを意味しています。WeldのCDI注入に関して起こる可能性のあるエラーは、ほとんどがデプロイメント時に報告され、パッシベーション(非活性化)可能なBeanに`Serializable`実装が欠落していないかどうかのエラーについても報告されます。</p>
</div>
<div class="paragraph">
<p>1つのクラス型のみに一致させることによって、`ItemProcessor`の`itemDao`フィールドを、`AnotherItemDao`実装型と`DefaultItemDao`実装型のうちの一致する方に指定できました。しかし、このようにするとインタフェースへのコードを作成するメリットがなくなり、フィールドの型を変えずに実装を変更することが難しくなります。よりよい解決策として、かわりにCDI修飾子に目を向けてみます。</p>
</div>
<div class="paragraph">
<p>CDIが注入ポイントを調べて、注入する適切なBeanを探す際、クラスの型のみでなくすべての修飾子も考慮されます。知らないうちに、<code>@Any`というデフォルトの修飾子をすでに1つ使用しました。ここで使用している`DefaultItemDao`実装の他に、`ItemProcessor`の注入ポイントにも適用できる</code>@Demo`修飾子を作成しましょう。</p>
</div>
<div class="paragraph">
<p>IDEには、CDI修飾子を生成できるウィザードがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「新規ファイル」(image::images/new-file-btn.png[])ボタンをクリックするか、[Ctrl]-[N] (Macの場合は[⌘]-[N])を押してファイル・ウィザードを開きます。</p>
</li>
<li>
<p>「コンテキストと依存性の注入」カテゴリから「修飾子タイプ」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名として「<strong>Demo</strong>」、パッケージとして「<strong>exercise2</strong>」と入力します。</p>
</li>
<li>
<p>「終了」をクリックします。新しい`Demo`修飾子がエディタで開きます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package exercise2;

import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.ElementType.FIELD;
import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.RetentionPolicy.RUNTIME;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;
import javax.inject.Qualifier;

/**
*
* @author nbuser
*/
@Qualifier
@Retention(RUNTIME)
@Target({METHOD, FIELD, PARAMETER, TYPE})
public @interface Demo {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、この修飾子をクラス・レベルでデフォルトのDAO実装に追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで`DefaultItemDao`に切り替え([Ctrl]-[Tab]を押し)、クラス定義の上に「<code>@Demo</code>」と入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">*@Demo*
public class DefaultItemDao implements ItemDao {

@Override
public List&lt;Item&gt; fetchItems() {
    List&lt;Item&gt; results = new ArrayList&lt;Item&gt;();
    results.add(new Item(34, 7));
    results.add(new Item(4, 37));
    results.add(new Item(24, 19));
    results.add(new Item(89, 32));
    return results;
}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="tips">「<code>@</code>」を入力した後で[Ctrl]-[Space]を押して、コード補完の候補を呼び出します。エディタは`Demo`修飾子を認識して、コード補完のオプションとして`@Demo`を表示します。</span>
11. 「プロジェクトの実行」(image::images/run-project-btn.png[])ボタンをクリックして、プロジェクトを実行します。プロジェクトがエラーなくビルドおよびデプロイされます。</p>
</div>
<div class="paragraph">
<p>*注意:*この変更では、変更を増分的にデプロイするのではなく、プロジェクトを明示的に実行してアプリケーションを再デプロイする必要がある場合があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ブラウザで「<code>Execute</code>」ボタンをクリックしてからIDEに戻り、「出力」ウィンドウでサーバー・ログを調べます。次のような出力が表示されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">INFO: Found item exercise2.Item@1ef62a93 [Value=99, Limit=9]</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力には、<code>AnotherItemDao`クラスの項目が一覧表示されます。`ItemProcessor`の注入ポイントではなく、`DefaultItemDao`実装に注釈を付けたことを思い出してください。</code>@Demo`修飾子をデフォルトのDAO実装に追加することで、型と修飾子の両方で一致するようになるため、他の実装が注入ポイントに、より一致するようになりました。`DefaultItemDao`にある`Demo`修飾子は注入ポイントにはないため、あまり適切ではありません。</p>
</div>
<div class="paragraph">
<p>次に、<code>ItemProcessor`の注入ポイントに</code>@Demo`注釈を追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで`ItemProcessor`に切り替え([Ctrl]-[Tab]を押し)、次のように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

@Inject *@Demo*
private ItemDao itemDao;

public void execute() {
    List&lt;Item&gt; items = itemDao.fetchItems();
    for (Item item : items) {
        System.out.println("Found item " + item);
    }
}
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ブラウザで「<code>Execute</code>」ボタンをクリックしてからIDEに戻り、「出力」ウィンドウでサーバー・ログを調べます。デフォルトの実装(<code>DefaultItemDao</code>)による出力が再度表示されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">INFO: Found item exercise2.Item@7b3640f1 [Value=34, Limit=7]
INFO: Found item exercise2.Item@26e1cd69 [Value=4, Limit=37]
INFO: Found item exercise2.Item@3274bc70 [Value=24, Limit=19]
INFO: Found item exercise2.Item@dff76f1 [Value=89, Limit=32]</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、現時点では型と修飾子の_両方_をベースにしてマッチングを行っており、正しい型と`@Demo`注釈の両方が当てはまるBeanは`DefaultItemDao`のみであるためです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternative">代替の注入方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>注入されるクラスの注入ポイントを定義するには複数の方法があります。これまでは、注入されるオブジェクトを参照するフィールドに注釈を付けました。フィールド注入のために取得メソッドや設定メソッドを提供する必要はありません。finalフィールドを持つ不変の管理対象Beanを作成する場合、`@Inject`注釈でコンストラクタに注釈を付けることで、コンストラクタで注入を使用できます。その後で、コンストラクタ・パラメータに任意の注釈を適用して、注入するBeanを修飾できます。(注入対象のBeanを修飾できるように、各パラメータには型があります)。Beanは注入ポイントが定義されたコンストラクタを1つしか持てませんが、複数のコンストラクタを実装することは可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    private final ItemDao itemDao;

    @Inject
    public ItemProcessor(@Demo ItemDao itemDao) {
        this.itemDao = itemDao;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注入されるBeanに渡すことができる初期化メソッドをコールすることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    private ItemDao itemDao;

    @Inject
    public void setItemDao(@Demo ItemDao itemDao) {
        this.itemDao = itemDao;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記の場合では初期化用に設定メソッドを使用しましたが、任意のメソッドを作成して、メソッド・コールの中で任意の数のBeanの初期化用に使用できます。1つのBeanに複数の初期化メソッドを持たせることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Inject
public void initBeans(@Demo ItemDao itemDao, @SomeQualifier SomeType someBean) {
    this.itemDao = itemDao;
    this.bean = someBean;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注入ポイントがどのように定義されているかにかかわらず、Beanのマッチングにも同じルールが適用されます。CDIは、型と修飾子をベースに最も適切に一致するものを探そうとします。そして注入ポイントとして一致するBeanが複数ある場合や、一致するBeanがない場合は、デプロイメント時に失敗します。</p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Working%20with%20Injection%20and%20Qualifiers%20in%20CDI">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このコンテキストと依存性の注入についてのシリーズの次回に続きます:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-validate.html">@Alternative Beanおよびライフサイクル注釈の適用</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CDIおよびJava EEの詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-intro.html">コンテキストと依存性の注入およびJSF 2.0の開始</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EEアプリケーションの開始</a></p>
</li>
<li>
<p><a href="http://blogs.oracle.com/enterprisetechtips/entry/using_cdi_and_dependency_injection">エンタープライズ技術ヒント: JSF 2.0アプリケーションでのJavaのCDIおよび依存性の注入の使用</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/gjbnr.html">Java EE 6チュートリアル、パートV: Java EEプラットフォームのコンテキストと依存性の注入</a></p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR 299: コンテキストと依存性の注入の仕様</a></p>
</li>
</ul>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/incubator-netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/incubator-netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-inject_ja.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1>About</h1>
                <ul>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                    <li><a href="https://incubator.apache.org/projects/netbeans.html">Incubation Status</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <p><a href="https://incubator.apache.org/" alt="Apache Incubator"><img src='/images/incubator_feather_egg_logo_bw_crop.png' title='Apache Incubator'></img></a></p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache NetBeans is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
            <p>Apache Incubator, Apache, Apache NetBeans, NetBeans, the Apache feather logo, the Apache NetBeans logo, and the Apache Incubator project logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
