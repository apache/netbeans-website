
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>埋込みEJBコンテナを使用したエンタープライズ・アプリケーションのテスト</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="埋込みEJBコンテナを使用したエンタープライズ・アプリケーションのテスト - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 埋込みEJBコンテナを使用したエンタープライズ・アプリケーションのテスト">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">埋込みEJBコンテナを使用したエンタープライズ・アプリケーションのテスト</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_セッションbeanのテスト">セッションBeanのテスト</a>
<ul class="sectlevel2">
<li><a href="#_プロジェクトの作成">プロジェクトの作成</a></li>
<li><a href="#_セッションbeanの作成">セッションBeanの作成</a></li>
<li><a href="#_セッションbeanのテスト_2">セッションBeanのテスト</a></li>
<li><a href="#_コンテナのプロパティを指定するためのテストの変更">コンテナのプロパティを指定するためのテストの変更</a></li>
<li><a href="#_beforeclass_および_afterclass_注釈の使用"><code>@BeforeClass</code> および <code>@AfterClass</code> 注釈の使用</a></li>
</ul>
</li>
<li><a href="#_エンティティクラスのテスト">エンティティ・クラスのテスト</a>
<ul class="sectlevel2">
<li><a href="#_エンティティクラスの作成">エンティティ・クラスの作成</a></li>
<li><a href="#_セッションbeanの変更">セッションBeanの変更</a></li>
<li><a href="#_エンティティクラスのテスト_2">エンティティ・クラスのテスト</a></li>
</ul>
</li>
<li><a href="#_ソリューションプロジェクトのダウンロード">ソリューション・プロジェクトのダウンロード</a></li>
<li><a href="#_関連項目">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このチュートリアルでは、Java EEエンタープライズ・アプリケーション用のJUnitテストを作成して実行する方法について説明します。このチュートリアルでは、エンティティ・クラスとセッションBeanを含むWebアプリケーションを作成します。最初に、セッションBean用のJUnitテスト・クラスを作成し、埋込みEJBコンテナでそのテストを実行します。次に、プロジェクトにエンティティ・クラスを追加し、テスト・クラスを変更してエンティティ・クラス用のテスト・メソッドを追加します。</p>
</div>
<div class="paragraph">
<p><strong>チュートリアルの課題</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Exercise_1">セッションBeanのテスト</a></p>
</li>
<li>
<p><a href="#Exercise_1a">プロジェクトの作成</a></p>
</li>
<li>
<p><a href="#Exercise_1b">セッションBeanの作成</a></p>
</li>
<li>
<p><a href="#Exercise_1c">セッションBeanのテスト</a></p>
</li>
<li>
<p><a href="#Exercise_1d">コンテナのプロパティを指定するためのテストの変更</a></p>
</li>
<li>
<p><a href="#Exercise_1e">@BeforeClassおよび@AfterClass注釈の使用</a></p>
</li>
<li>
<p><a href="#Exercise_2">エンティティ・クラスのテスト</a></p>
</li>
<li>
<p><a href="#Exercise_2a">エンティティ・クラスの作成</a></p>
</li>
<li>
<p><a href="#Exercise_2b">セッションBeanの変更</a></p>
</li>
<li>
<p><a href="#Exercise_2c">エンティティ・クラスのテスト</a></p>
</li>
<li>
<p><a href="#Exercise_3">ソリューション・プロジェクトのダウンロード</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>このチュートリアルに従うには、次のソフトウェアとリソースが必要です。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/downloads/">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EEバンドル版</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1.xまたは4.x</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このチュートリアルにはJUnitプラグインが必要です。IDEのインストール時にJUnitプラグインをインストールしなかった場合は、プラグイン・マネージャを開き、「使用可能なプラグイン」タブを選択してJUnitプラグインをインストールしてください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>前提条件</strong></p>
</div>
<div class="paragraph">
<p>このドキュメントは、次のテクノロジについて基本的な知識またはプログラミング経験を持つ読者を想定して書かれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Javaプログラミング</p>
</li>
<li>
<p>NetBeans IDE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このチュートリアルを開始する前に、必要に応じて次のドキュメントをお読みください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-gettingstarted.html">Java EEアプリケーションの開始</a></p>
</li>
<li>
<p><a href="../java/junit-intro.html">NetBeans IDEでのJUnitテストの記述</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/docs/cd/E19798-01/821-1754/gjlde/index.html">EJB 3.1の埋込み可能APIと埋込みGlassFish Serverの使用</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">終了したプロジェクトのZIPアーカイブ</a>はダウンロードできます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_セッションbeanのテスト">セッションBeanのテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では、セッションBeanとエンティティ・クラスを含む単純なJava EE Webアプリケーションを作成します。</p>
</div>
<div class="sect2">
<h3 id="_プロジェクトの作成">プロジェクトの作成</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「ファイル」&gt;「新規プロジェクト」([Ctrl]-[Shift]-[N]、Macの場合は[⌘]-[Shift]-[N])を選択します。</p>
</li>
<li>
<p>「Java Web」カテゴリから「Webアプリケーション」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>プロジェクト名を*WebAppJUnit*にし、プロジェクトの場所を設定します。</p>
</li>
<li>
<p>専用フォルダを使用するオプションが選択されている場合は選択を解除します。
「次」をクリックします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーを*「GlassFish Server」<strong>に設定し、「Java EEバージョン」を</strong>「Java EE 6 Web」<strong>または</strong>「Java EE 7 Web」*に設定します。
「終了」をクリックします。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_セッションbeanの作成">セッションBeanの作成</h3>
<div class="paragraph">
<p>この課題では、2つの数値を追加するメソッド1つを含む非常に単純なセッションBeanを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでWebAppJUnitプロジェクトを右クリックし、「新規」&gt;「その他」を選択します。</p>
</li>
<li>
<p>「Enterprise JavaBeans」カテゴリで「セッションBean」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>「EJB名」に「<strong>MyBean</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ名」に「<strong>bean</strong>」と入力します。</p>
</li>
<li>
<p>「セッションのタイプ」として「ステートレス」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、新しいクラスがエディタに表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで、クラスに以下のメソッド <code>addNumbers</code> を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Stateless
public class MyBean {
    *public int addNumbers(int numberA, int numberB) {
        return numberA + numberB;
    }*
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@LocalBean</code> 注釈を追加したり、このチュートリアルでインタフェースを実装する必要はありません。ビューが明示的に指定されていない場合、デフォルトでは、インタフェースなしのビューが公開されます。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>変更を保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_セッションbeanのテスト_2">セッションBeanのテスト</h3>
<div class="paragraph">
<p>この課題では、セッションBean用の、 <code>addNumbers</code> メソッドをテストするテスト・クラスを作成します。IDEでは、ターゲット・クラス内のメソッドに基づいて新しいテスト・クラスとスケルトン・テスト・メソッドを生成できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウで <code>MyBean</code> クラスを右クリックし、「ツール」&gt;「テストを作成」を選択します。</p>
</li>
<li>
<p>「フレームワーク」ドロップダウン・リストで「JUnit」を選択します。</p>
</li>
<li>
<p>「テストを作成」ダイアログ・ボックスのデフォルト値を使用します。「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-tests-dialog.png" alt="create tests dialog">
</div>
<div class="title">Figure 1. 「テストを作成」ダイアログ</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JUnit単体テストを初めて作成するときは、JUnitのバージョンを指定する必要があります。「JUnitのバージョンを選択」ダイアログ・ボックスで「JUnit 4.x」を選択し、「選択」をクリックします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>「OK」をクリックすると、IDEによって <code>MyBeanTest.java</code> ファイルが生成され、エディタでそのクラスが開かれます。</p>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで、IDEによって「テスト・パッケージ」ノードの下にテスト・クラスが生成されたことを確認できます。デフォルトでは、 <code>javax.ejb.embeddable.EJBContainer.createEJBContainer()</code> をコールしてEJBコンテナ・インスタンスを作成するスケルトン・テスト・メソッドがIDEによってテスト・クラス内に生成されます。 <code>createEJBContainer()</code> メソッドは、EJB 3.1埋込み可能APIの一部である<a href="http://download.oracle.com/javaee/6/api/javax/ejb/embeddable/EJBContainer.html">+ <code>EJBContainer</code> +</a>クラス内のメソッドの1つです。</p>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「テスト・ライブラリ」ノードを展開すると、IDEによってGlassFish Server(埋込み可能コンテナ)とJUnit 4.xがテスト・ライブラリとして自動的に追加されたことを確認できます。GlassFish Serverライブラリを展開すると、ライブラリに <code>glassfish-embedded-static-shell.jar</code> が含まれていることを確認できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/embedded-static-shell-jar.png" alt="embedded static shell jar">
</div>
<div class="title">Figure 2. 「プロジェクト」ウィンドウに示されたプロジェクトの構造</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>glassfish-embedded-static-shell.jar</code>  JARには、埋込みEJBコンテナのソースは含まれていません。 <code>glassfish-embedded-static-shell.jar</code>  JARには、GlassFishのローカル・インストールが必要です。ローカルのGlassFishインストールのクラスパスは、プロジェクトのターゲット・サーバーによって決定されます。ターゲット・サーバーは、プロジェクトの「プロパティ」ダイアログ・ボックスで変更できます。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>生成されたスケルトン・テスト・メソッドを変更して、 <code>numberA</code> 、 <code>numberB</code> および <code>expResult</code> の値を指定し、デフォルトのfailのコールを除去します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    *int numberA = 1;
    int numberB = 2;*
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer();
    MyBean instance = (MyBean)container.getContext().lookup("java:global/classes/MyBean");
    *int expResult = 3;*
    int result = instance.addNumbers(numberA, numberB);
    assertEquals(expResult, result);
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクトを右クリックし、「テスト」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>テストを実行すると、IDEで「テスト結果」ウィンドウが開き、テストの進捗状況と結果が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results1.png" alt="test results1">
</div>
<div class="title">Figure 3. 「テスト結果」ウィンドウ</div>
</div>
<div class="paragraph">
<p>「出力」ウィンドウに次のような出力が表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Testsuite: bean.MyBeanTest
addNumbers
...
Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 31.272 sec

------------- Standard Output ---------------
addNumbers
...
------------- ---------------- ---------------
test-report:
test:
BUILD SUCCESSFUL (total time: 35 seconds)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_コンテナのプロパティを指定するためのテストの変更">コンテナのプロパティを指定するためのテストの変更</h3>
<div class="paragraph">
<p>「テストを作成」ウィザードを使用したときに、IDEによってEJBコンテナを起動するためのコードを含むデフォルトのスケルトン・テスト・クラスが生成されました。この課題では、コンテナを起動する生成済のコードを変更して、埋込みコンテナ・インスタンスの追加のプロパティを指定できるようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テスト・クラスに以下のコード(太字部分)を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testAddNumbers() throws Exception {
    System.out.println("addNumbers");
    int numberA = 1;
    int numberB = 2;

    // Create a properties map to pass to the embeddable container:
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();*
    // Use the MODULES property to specify the set of modules to be initialized,
    // in this case a java.io.File
    *properties.put(EJBContainer.MODULES, new File("build/jar"));*

    // Create the container instance, passing it the properties map:
    EJBContainer container = javax.ejb.embeddable.EJBContainer.createEJBContainer(*properties*);

    // Create the instance using the container context to look up the bean
    // in the directory that contains the built classes
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    int expResult = 3;

    // Invoke the addNumbers method on the bean instance:
    int result = instance.addNumbers(numberA, numberB);

    assertEquals(expResult, result);

    // Close the embeddable container:
    container.close();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタを右クリックして「インポートを修正」([Alt]-[Shift]-[I]、Macの場合は[⌘]-[Shift]-[I])を選択し、 <code>java.util.HashMap</code> および <code>java.util.Map</code> 用のインポート文を追加します。</p>
</li>
<li>
<p>テストを再実行して、変更したテストが機能し、コンテナが正しく作成されることを確認します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「テスト結果」ウィンドウの「再実行」ボタンをクリックできます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_beforeclass_および_afterclass_注釈の使用"><code>@BeforeClass</code> および <code>@AfterClass</code> 注釈の使用</h3>
<div class="paragraph">
<p>この課題では、テスト・クラスを変更して、コンテナ・インスタンスを作成するメソッドと停止するメソッドを個別に作成します。これは、同じコンテナ・インスタンスを使用できる複数のテストを実行する場合に役に立つ場合があります。このようにすることで、コンテナ・インスタンスをテストごとに開いて閉じる必要がなくなり、かわりに、テストを実行する前に作成し、すべてのテストが完了した後で閉じるインスタンスを1つ作成します。</p>
</div>
<div class="paragraph">
<p>この課題では、EJBコンテナを作成するコードを <code>setUpClass</code> メソッドに移動します。 <code>setUpClass</code> メソッドには、そのメソッドが最初に(テスト・クラス内の他のメソッドより前に)実行されることを示すために使用される <code>@BeforeClass</code> 注釈が付いています。この例では、コンテナ・インスタンスが <code>testAddNumbers</code> テスト・メソッドの前に作成され、コンテナは停止されるまで存在します。</p>
</div>
<div class="paragraph">
<p>同様に、コンテナを停止するコードを <code>@AfterClass</code> 注釈が付いた <code>tearDownClass</code> メソッドに移動します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テスト・クラスに以下のフィールドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static EJBContainer container;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>コンテナを作成するコードを <code>testAddNumbers</code> テスト・メソッドから <code>setUpClass</code> メソッドにコピーします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@BeforeClass
public static void setUpClass() *throws Exception* {
    *Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
    properties.put(EJBContainer.MODULES, new File("build/jar"));
    container = EJBContainer.createEJBContainer(properties);
    System.out.println("Opening the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>コンテナを閉じるコードを <code>testAddNumbers</code> テスト・メソッドから <code>tearDownClass</code> メソッドにコピーします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@AfterClass
public static void tearDownClass() *throws Exception* {
    *container.close();
    System.out.println("Closing the container");*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>testAddNumbers</code> から余分なコードを除去します。変更を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>テスト・クラスは次のようになるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class MyBeanTest {
    private static EJBContainer container;

    public MyBeanTest() {
    }

    @BeforeClass
    public static void setUpClass() throws Exception {
        Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
        properties.put(EJBContainer.MODULES, new File("build/jar"));
        container = EJBContainer.createEJBContainer(properties);
        System.out.println("Opening the container");
    }

    @AfterClass
    public static void tearDownClass() throws Exception {
        container.close();
        System.out.println("Closing the container");
    }

    @Before
    public void setUp() {
    }

    @After
    public void tearDown() {
    }

    /**
     * Test of addNumbers method, of class MyBean.
     */
    @Test
    public void testAddNumbers() throws Exception {
        System.out.println("addNumbers");
        int numberA = 1;
        int numberB = 2;

        // Create the instance using the container context to look up the bean
        // in the directory that contains the built classes
        MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

        int expResult = 3;

        // Invoke the addNumbers method on the bean instance:
        int result = instance.addNumbers(numberA, numberB);

        assertEquals(expResult, result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>コンテナの作成と停止が正しく行われることを確認するためにテストを再実行すると、「テスト結果」ウィンドウに以下のような出力が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2a.png" alt="test results2a">
</div>
<div class="title">Figure 4. 「テスト結果」ウィンドウ</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``addNumbers`` テストの前に ``setUpClass`` メソッドが実行され、「Opening the container」と表示されたことがわかります。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_エンティティクラスのテスト">エンティティ・クラスのテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では、エンティティ・クラスと持続性ユニットを作成し、エンティティ・マネージャを注入してエンティティにアクセスするようにセッションBeanを変更します。新しいエンティティ・クラスには、エントリのID番号を出力に表示する単純なメソッドを追加します。次に、データベース内のエントリを作成および確認するための単純なメソッドをセッションBeanにいくつか追加します。</p>
</div>
<div class="sect2">
<h3 id="_エンティティクラスの作成">エンティティ・クラスの作成</h3>
<div class="paragraph">
<p>この項では、新規エンティティ・クラス・ウィザードを使用して、データベース接続の詳細とともにエンティティ・クラスと持続性ユニットを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでWebAppJUnitプロジェクトを右クリックし、「新規」&gt;「その他」を選択します。</p>
</li>
<li>
<p>「持続性」カテゴリで「エンティティ・クラス」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>「クラス名」に「<strong>SimpleEntity</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ」ドロップダウン・リストから「bean」を選択します。</p>
</li>
<li>
<p>「主キー型」に「<strong>int</strong>」と入力します。「次」をクリックします。</p>
</li>
<li>
<p>デフォルトの持続性ユニット名と持続性プロバイダを使用します。</p>
</li>
<li>
<p>データ・ソースとして「 <code>jdbc/sample</code> 」を選択し、戦略として「ドロップして作成」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-entity-wizard.png" alt="create entity wizard">
</div>
<div class="title">Figure 5. 「エンティティ・クラスの作成」ダイアログ</div>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、新しいエンティティ・クラスがエディタに表示されます。「プロジェクト」ウィンドウの「構成ファイル」ノードを展開すると、持続性ユニット <code>WebAppJUnitPU</code> のプロパティを定義する <code>persistence.xml</code> ファイルがIDEによって自動的に生成されたことを確認できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで、エンティティ・クラスに以下のprivateフィールドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private String name;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタ内を右クリックして「コードを挿入」([Alt]-[Insert]、Macの場合は[Ctrl]-[I])を選択し、「取得メソッドおよび設定メソッド」を選択して「取得メソッドおよび設定メソッドの生成」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>ダイアログ・ボックスで「 <code>name</code> 」フィールドを選択します。「生成」をクリックします。</p>
</li>
<li>
<p>クラスに以下のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public SimpleEntity(int id) {
    this.id = id;
    name = "Entity number " + id + " created at " + new Date();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@NamedQueries</code> および <code>NamedQuery</code> 注釈を使用して名前付きSQL問合せを作成します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Entity
*@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})*
public class SimpleEntity implements Serializable {</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>デフォルト・コンストラクタを作成します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IDEでコンストラクタを自動生成する場合は、クラス宣言の横のガターに表示された提案アイコンをクリックできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正して、 <code>javax.persistence.NamedQueries</code> 、 <code>javax.persistence.NamedQuery</code> および <code>java.util.Date</code> のインポート文を追加します。変更を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>デフォルトで生成されるコードに加えて、エンティティ・クラスは次のようになるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package bean;

import java.io.Serializable;
import java.util.Date;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;


@Entity
@NamedQueries({@NamedQuery(name = "SimpleEntity.findAll", query = "select e from SimpleEntity e")})
public class SimpleEntity implements Serializable {
    private static final long serialVersionUID = 1L;
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int id;

    private String name;

    public SimpleEntity() {
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public SimpleEntity(int id) {
        this.id = id;
        name = "Entity number " + id + " created at " + new Date();
    }



    ...

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_セッションbeanの変更">セッションBeanの変更</h3>
<div class="paragraph">
<p>この課題では、 <code>MyBean</code> セッションBeanを編集して、データベース表のデータを挿入および取得するためのメソッドを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>エディタで <code>MyBean.java</code> を開きます。</p>
</li>
<li>
<p>エディタ内を右クリックして「コードを挿入」([Alt]-[Insert]、Macの場合は[Ctrl]-[I])を選択し、ポップアップ・メニューから「エンティティ・マネージャの使用」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「エンティティ・マネージャの使用」を選択したときに、エンティティ・マネージャを注入するためにIDEによってクラスに以下のコードが追加されました。持続性ユニットの名前が自動的に生成されていることがわかります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PersistenceContext(unitName="WebAppJUnitPU")
private EntityManager em;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>以下の <code>verify</code> および <code>insert</code> メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@PermitAll
public int verify() {
    String result = null;
    Query q = em.createNamedQuery("SimpleEntity.findAll");
    Collection entities = q.getResultList();
    int s = entities.size();
    for (Object o : entities) {
        SimpleEntity se = (SimpleEntity)o;
        System.out.println("Found: " + se.getName());
    }

    return s;
}

@PermitAll
public void insert(int num) {
    for (int i = 1; i &lt;= num; i++) {
        System.out.println("Inserting # " + i);
        SimpleEntity e = new SimpleEntity(i);
        em.persist(e);
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>javax.persistence.Query</code> をインポートするようにインポートを修正し、変更内容を保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_エンティティクラスのテスト_2">エンティティ・クラスのテスト</h3>
<div class="paragraph">
<p>この課題では、テスト・クラスを編集して、アプリケーションがEJBを検索すること、および <code>insert</code> メソッドと <code>verify</code> メソッドが正常に動作することをテストするメソッドを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JavaDBデータベースを起動します。</p>
</li>
<li>
<p>エディタで <code>MyBeanTest.java</code> テスト・クラスを開きます。</p>
</li>
<li>
<p>テスト・クラスを編集して、以下の <code>testInsert</code> テスト・メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Test
public void testInsert() throws Exception {

    // Lookup the EJB
    System.out.println("Looking up EJB...");
    MyBean instance = (MyBean) container.getContext().lookup("java:global/classes/MyBean");

    System.out.println("Inserting entities...");
    instance.insert(5);
    int res = instance.verify();
    System.out.println("JPA call returned: " + res);
    System.out.println("Done calling EJB");

    Assert.assertTrue("Unexpected number of entities", (res == 5));
    System.out.println("..........SUCCESSFULLY finished embedded test");
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでプロジェクト・ノードを右クリックし、ポップアップ・メニューから「テスト」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「テスト結果」ウィンドウが開き、以下のような出力が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-results2b.png" alt="test results2b">
</div>
<div class="title">Figure 6. testInsertテストを追加した後の「テスト結果」ウィンドウ</div>
</div>
<div class="paragraph">
<p>テスト・クラスに追加された出力メッセージから、テストの進捗状況とテストの実行順序がわかります。</p>
</div>
<div class="paragraph">
<p>これで、セッションBean用のテストが完成し、エンティティ・クラスの接続が機能することがわかったので、アプリケーションのWebインタフェースのコーディングを開始できます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ソリューションプロジェクトのダウンロード">ソリューション・プロジェクトのダウンロード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次の方法で、このチュートリアルにソリューションをプロジェクトとしてダウンロードできます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FWebAppJUnit.zip">終了したプロジェクトのZIPアーカイブ</a>をダウンロードします。</p>
</li>
<li>
<p>次の手順を実行して、プロジェクト・ソースをNetBeansのサンプルからチェックアウトします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「チーム」&gt;「Subversion」&gt;「チェックアウト」を選択します。</p>
</li>
<li>
<p>「チェックアウト」ダイアログ・ボックスで次のリポジトリURLを入力します。
 <code><a href="https://svn.netbeans.org/svn/samples~samples-source-code" class="bare">https://svn.netbeans.org/svn/samples~samples-source-code</a></code>
「次」をクリックします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「参照」をクリックして「リポジトリ・フォルダを参照」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>ルート・ノードを展開し、*samples/javaee/WebAppJUnit*を選択します。「OK」をクリックします。</p>
</li>
<li>
<p>ソースのローカル・フォルダを指定します(ローカル・フォルダは空である必要があります)。</p>
</li>
<li>
<p>「終了」をクリックします。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、IDEではローカル・フォルダがSubversionリポジトリとして初期化され、プロジェクト・ソースがチェックアウトされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>チェックアウトが完了するときに表示されるダイアログで、「プロジェクトを開く」をクリックします。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ソースをチェックアウトするには、Subversionクライアントが必要です。Subversionのインストールの詳細は、<a href="../ide/subversion.html">NetBeans IDEでのSubversionガイド</a>の<a href="../ide/subversion.html#settingUp">Subversionの設定</a>の項を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20the%20Embedded%20EJB%20Container">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_関連項目">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans IDEを使用したJava EEアプリケーションの開発方法の詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-intro.html">Java EEテクノロジ入門</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EEアプリケーションの開始</a></p>
</li>
<li>
<p><a href="../web/quickstart-webapps.html">Webアプリケーション開発入門</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Java EEおよびJava Webの学習</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EJB 3.1エンタープライズBeanの使用方法については、<a href="http://download.oracle.com/javaee/6/tutorial/doc/">Java EE 6チュートリアル</a>を参照してください。</p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">nbj2eeメーリング・リストに登録する</a>ことによって、NetBeans IDE Java EE開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/javaee-entapp-junit_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
