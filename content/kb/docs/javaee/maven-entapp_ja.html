
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Mavenを使用したエンタープライズ・アプリケーションの作成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mavenを使用したエンタープライズ・アプリケーションの作成 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Mavenを使用したエンタープライズ・アプリケーションの作成">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Mavenを使用したエンタープライズ・アプリケーションの作成</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/maven-entapp_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_ideでのmavenの使用">IDEでのMavenの使用</a></li>
<li><a href="#_mavenエンタープライズアプリケーションプロジェクトの作成">Mavenエンタープライズ・アプリケーション・プロジェクトの作成</a></li>
<li><a href="#_ejbプロジェクトのコーディング">EJBプロジェクトのコーディング</a>
<ul class="sectlevel2">
<li><a href="#_持続性ユニットの作成">持続性ユニットの作成</a></li>
<li><a href="#_エンティティクラスの作成">エンティティ・クラスの作成</a></li>
<li><a href="#_メッセージ駆動型beanの作成">メッセージ駆動型Beanの作成</a></li>
<li><a href="#_セッションbeanの作成">セッションBeanの作成</a></li>
</ul>
</li>
<li><a href="#_webアプリケーションのコーディング">Webアプリケーションのコーディング</a>
<ul class="sectlevel2">
<li><a href="#_listnewsサーブレットの作成">ListNewsサーブレットの作成</a></li>
<li><a href="#_postmessageサーブレットの作成">PostMessageサーブレットの作成</a></li>
</ul>
</li>
<li><a href="#_mavenを使用したアプリケーションのビルド">Mavenを使用したアプリケーションのビルド</a>
<ul class="sectlevel2">
<li><a href="#_プロジェクト依存性の処理">プロジェクト依存性の処理</a></li>
<li><a href="#_依存性でビルド">依存性でビルド</a></li>
</ul>
</li>
<li><a href="#_アプリケーションのデプロイと実行">アプリケーションのデプロイと実行</a>
<ul class="sectlevel2">
<li><a href="#_ideからのアプリケーションのデプロイと実行">IDEからのアプリケーションのデプロイと実行</a></li>
<li><a href="#_glassfish管理コンソールからのデプロイ">GlassFish管理コンソールからのデプロイ</a></li>
</ul>
</li>
<li><a href="#_ソリューションプロジェクトのダウンロード">ソリューション・プロジェクトのダウンロード</a></li>
<li><a href="#_関連項目">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このチュートリアルでは、NetBeans IDEとMaven原型を使用して、単純なエンタープライズ・アプリケーションを作成する方法を示します。また、IDEを使用してMavenアプリケーションを作成およびビルドする方法についても説明し、そのヒントを示します。</p>
</div>
<div class="paragraph">
<p>このチュートリアルでは、EARアーカイブとしてパッケージ化され、GlassFish Server Open Source Edition 3にデプロイされるエンタープライズ・アプリケーションを作成します。アプリケーションの作成には、新規プロジェクト・ウィザードでMavenエンタープライズ・アプリケーション原型を使用します。アプリケーションにはEJBプロジェクトが含まれますが、これには持続エンティティ・クラス、メッセージ駆動型BeanおよびエンティティのセッションBeanファサードが含まれます。アプリケーションには、2つのサーブレットからなる1つのWebプロジェクトも含まれます。</p>
</div>
<div class="paragraph">
<p><strong>チュートリアルの課題</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#intro">IDEでのMavenの使用</a></p>
</li>
<li>
<p><a href="#Exercise_1">Mavenエンタープライズ・アプリケーション・プロジェクトの作成</a></p>
</li>
<li>
<p><a href="#Exercise_2">EJBモジュールのコーディング</a></p>
</li>
<li>
<p><a href="#Exercise_2a">持続性ユニットの作成</a></p>
</li>
<li>
<p><a href="#Exercise_2b">エンティティ・クラスの作成</a></p>
</li>
<li>
<p><a href="#Exercise_2c">メッセージ駆動型Beanの作成</a></p>
</li>
<li>
<p><a href="#Exercise_2d">セッション・ファサードの作成</a></p>
</li>
<li>
<p><a href="#Exercise_3">Webモジュールのコーディング</a></p>
</li>
<li>
<p><a href="#Exercise_3a">ListNewsサーブレットの作成</a></p>
</li>
<li>
<p><a href="#Exercise_3b">PostMessageサーブレットの作成</a></p>
</li>
<li>
<p><a href="#Exercise_4">Mavenを使用したアプリケーションのビルド</a></p>
</li>
<li>
<p><a href="#Exercise_4a">プロジェクト依存性の処理</a></p>
</li>
<li>
<p><a href="#Exercise_4b">依存性でビルド</a></p>
</li>
<li>
<p><a href="#Exercise_5">アプリケーションのデプロイと実行</a></p>
</li>
<li>
<p><a href="#Exercise_5a">IDEからのデプロイ</a></p>
</li>
<li>
<p><a href="#Exercise_5b">GlassFish Server管理コンソールからのデプロイ</a></p>
</li>
<li>
<p><a href="#Exercise_7">ソリューション・プロジェクトのダウンロード</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>このチュートリアルに従うには、次のソフトウェアとリソースが必要です。</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ソフトウェアまたはリソース</th>
<th class="tableblock halign-left valign-top">必須バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EEバージョン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バージョン7または8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlassFish Server Open Source Edition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>前提条件</strong></p>
</div>
<div class="paragraph">
<p>このドキュメントは、次のテクノロジについて基本的な知識またはプログラミング経験を持つ読者を想定して書かれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Javaプログラミング</p>
</li>
<li>
<p>NetBeans IDE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このチュートリアルを開始する前に、必要に応じて次のドキュメントをお読みください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/MavenBestPractices">NetBeans IDEでのApache Mavenのベスト・プラクティス</a></p>
</li>
<li>
<p><a href="http://books.sonatype.com/mvnref-book/reference/introduction.html">Chapter 1. Introducing Apache Maven</a> (<a href="http://books.sonatype.com/mvnref-book/reference/index.html">+Maven: The Complete Reference +</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FMavenEnterpriseApp.zip">終了したプロジェクトのZIPアーカイブ</a>はダウンロードできます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ideでのmavenの使用">IDEでのMavenの使用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans IDEには、Mavenのサポートが完全に統合されています。Mavenフレームワークを使用するプロジェクト開発は、Antでのプロジェクト開発とほぼ同じです。ただし、Mavenによるプロジェクトのビルド方法および依存性の処理方法には、いくつかの違いがあります。次のヒントは、Mavenアプリケーションを初めて作成する場合に発生するいくつかの問題を回避するのに役立ちます。</p>
</div>
<div class="paragraph">
<p><strong>Mavenの設定の確認</strong></p>
</div>
<div class="paragraph">
<p>これが初めてのMavenプロジェクトである場合は、「オプション」ウィンドウでMavenの構成設定を確認します。MavenはIDEにバンドルされており、IDEをインストールするとインストールされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IDEで「オプション」ウィンドウを開きます(「ツール」→「オプション」、Macの場合は「NetBeans」→プリファレンス)。</p>
</li>
<li>
<p>「オプション」ウィンドウで「Java」カテゴリを選択し、「Maven」タブをクリックします。</p>
</li>
<li>
<p>「Mavenのホーム」が指定されていることを確認します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IDEにバンドルされているMavenバージョンを使用することも、ローカルのMavenインストール(2.0.9以降が必要)の場所を指定することもできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「OK」をクリックして「オプション」ウィンドウを閉じます。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Mavenサポートは、IDEでJavaが有効になっている場合に自動的に有効になります。Java EEプラグインが有効になっていない場合は、有効にする必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Mavenリポジトリの更新</strong></p>
</div>
<div class="paragraph">
<p>ローカルおよびリモートのMavenリポジトリは、コード補完およびプロジェクトのビルド時に使用されます。プロジェクトの開発時に、必要な任意のアーティファクトをすぐに使用できるように、Mavenリモート・リポジトリの索引を更新しておきます。「オプション」ウィンドウの「Maven」タブでは、IDEが更新を確認する頻度を構成できます。「サービス」ウィンドウから、更新の有無を即時確認でき、ローカルおよびリモートのMavenリポジトリを調べることができます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「ウィンドウ」&gt;「サービス」を選択し、「サービス」ウィンドウを開きます。</p>
</li>
<li>
<p>「サービス」ウィンドウで「Mavenリポジトリ」ノードを展開します。</p>
</li>
<li>
<p>リポジトリ・ノードを展開してアーティファクトを表示します。</p>
</li>
<li>
<p>リポジトリ・ノードを右クリックし、ポップアップ・メニューで「索引の更新」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「索引を更新」をクリックすると、各Mavenリモート・リポジトリの最新の索引の有無が確認され、ダウンロードされます。索引は、リポジトリ内に存在するアーティファクトの現在の状態を示し、アプリケーションで使用できるアーティファクトへの参照を提供するために使用されます。デフォルトでは、アーティファクトが明示的に要求されないかぎり、リポジトリからアーティファクトはダウンロードされません。</p>
</div>
<div class="paragraph">
<p>アーティファクトを検索するには、「サービス」ウィンドウで「Mavenリポジトリ」ノードを右クリックし、「検索」を選択します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>索引のサイズが非常に大きく、すべてを更新するのに時間がかかる可能性があります。</p>
</li>
<li>
<p>7.1以前のNetBeans IDEを使用している場合は、「ウィンドウ」&gt;「その他」&gt;「Mavenリポジトリ・ブラウザ」を選択し、「Mavenリポジトリ・ブラウザ」ウィンドウの上部にある「索引の更新」( <span class="image"><img src="images/maven-refreshrepo.png" alt="maven refreshrepo" title="「索引を更新」ボタン"></span>  )をクリックする必要があります。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>NetBeans IDEでのMavenの使用に関する詳細は、<a href="https://netbeans.org/kb/docs/java/maven-hib-java-se.html">Hibernateを使用したMaven Swingアプリケーションの作成</a>チュートリアルの<a href="https://netbeans.org/kb/docs/java/maven-hib-java-se.html#02">Mavenの構成</a>の項および<a href="http://wiki.netbeans.org/MavenBestPractices">NetBeans IDEでのApache Mavenのベスト・プラクティス</a>を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mavenエンタープライズアプリケーションプロジェクトの作成">Mavenエンタープライズ・アプリケーション・プロジェクトの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この課題の目標は、IDEにバンドルされたMavenエンタープライズ・アプリケーションの原型を使用して、エンタープライズ・アプリケーション・プロジェクトを作成することです。エンタープライズ・アプリケーションの原型によって、EJBプロジェクトおよびWebアプリケーション・プロジェクトも作成されます。</p>
</div>
<div class="paragraph">
<p>IDEの新規プロジェクト・ウィザードには、いくつかのMaven原型が含まれます。これらを使用すると、エンタープライズ・アプリケーション・プロジェクト(EAR)、Webアプリケーション・プロジェクト(WAR)、EJBモジュール・プロジェクト(JAR)などの一般的なNetBeansプロジェクト・タイプを簡単に作成できます。このウィザードを使用すると、登録済のリモート・リポジトリ内の原型からプロジェクトを作成することもできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「ファイル」&gt;「新規プロジェクト」([Ctrl]-[Shift]-[N]、Macの場合は[⌘]-[Shift]-[N])を選択します。</p>
</li>
<li>
<p>「Maven」カテゴリから「エンタープライズ・アプリケーション」を選択します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-newproject1.png" alt="maven newproject1">
</div>
<div class="title">Figure 1. 新規プロジェクト・ウィザードのMavenエンタープライズ・アプリケーションのプロジェクト・タイプ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト名」として「<strong>MavenEnterpriseApp</strong>」と入力し、プロジェクトの場所を設定します。</p>
</li>
<li>
<p>(オプション)アーティファクトの詳細を変更します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-newproject2.png" alt="maven newproject2">
</div>
<div class="title">Figure 2. 新規プロジェクト・ウィザードのMavenプロジェクトの詳細</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サーバーとして「GlassFish Server」を選択します。</p>
</li>
<li>
<p>「Java EEバージョン」を「Java EE 6」または「Java EE 7」に設定します。</p>
</li>
<li>
<p>「EJBモジュールを作成」および「Webアプリケーション・モジュールを作成」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、Mavenエンタープライズ・アプリケーション原型から次のプロジェクトが作成されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>EJB。</strong>(MavenEnterpriseApp-ejb) EJBプロジェクトには通常、ソース・コードおよびアプリケーションのビジネス・ロジックが含まれます。EJBプロジェクトはEJB JARアーカイブとしてパッケージ化されます。</p>
</li>
<li>
<p><strong>Webアプリケーション。</strong>(MavenEnterpriseApp-web) Webアプリケーション・プロジェクトには通常、アプリケーションのプレゼンテーション・レイヤー(JSFページやJSPページなど)およびサーブレットが含まれます。Webアプリケーション・プロジェクトには、ソース・コードおよびビジネス・ロジックが含まれる場合もあります。Webアプリケーション・プロジェクトはWARアーカイブとしてパッケージ化されます。</p>
</li>
<li>
<p><strong>アセンブリ。</strong>(MavenEnterpriseApp)アセンブリ・プロジェクトは、EJBアーカイブおよびWARアーカイブからEARアーカイブをアセンブルするために使用されます。アセンブリ・プロジェクトには、ソースが含まれていません。</p>
</li>
<li>
<p><strong>エンタープライズ・アプリケーション。</strong>(MavenEnterpriseApp-ear)エンタープライズ・アプリケーション・プロジェクトには、ソースが含まれていません。エンタープライズ・アプリケーションに含まれるのはPOMファイル( <code>pom.xml</code> )のみで、これにはエンタープライズ・アプリケーションに含まれるモジュールの詳細が記述されています。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-projectswindow2.png" alt="maven projectswindow2">
</div>
<div class="title">Figure 3. 生成されたプロジェクトを示す「プロジェクト」ウィンドウ</div>
</div>
<div class="paragraph">
<p>エンタープライズ・アプリケーション・プロジェクトの作成後、使用できない依存性があると、エンタープライズ・アプリケーション・プロジェクトにバッジが表示されます。MavenEnterpriseApp-earプロジェクトの「依存性」ノードを展開すると、クラスパス上に必要なライブラリが欠落していないかどうかを確認できます。エンタープライズ・アプリケーション・プロジェクトはJARおよびWARに対して依存性がありますが、これらはEJBプロジェクトおよびWebプロジェクトのコンパイル後にパッケージ化され、使用可能になります。 <code>MavenEnterpriseApp-ejb</code> および <code>MavenEnterpriseApp-web</code> が依存性として一覧表示されていることがわかります。</p>
</div>
<div class="paragraph">
<p>ステータス・バーにMavenアイコンが表示され、これをクリックしてプライミング・ビルドを実行し、欠落している依存性を解決できる場合があります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/priming-build.png" alt="priming build">
</div>
<div class="title">Figure 4. ステータス・バーのMavenアイコンを使用して実行できるプライミング・ビルド</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejbプロジェクトのコーディング">EJBプロジェクトのコーディング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EJBプロジェクトには、アプリケーションのビジネス・ロジックが含まれます。このアプリケーションでは、GlassFishコンテナはJava Transaction API (JTA)を使用してトランザクションを管理します。このチュートリアルでは、EJBプロジェクトで、エンティティ・クラス、メッセージ駆動型Beanおよびエンティティ・クラスのセッション・ファサードを作成します。</p>
</div>
<div class="sect2">
<h3 id="_持続性ユニットの作成">持続性ユニットの作成</h3>
<div class="paragraph">
<p>この課題では、EJBプロジェクトで持続性ユニットを作成します。持続性ユニットは、データベース接続の詳細、およびトランザクションの管理方法を指定します。このアプリケーションでは、GlassFishサーバーでトランザクションを管理するため、新規持続性ユニット・ウィザードでJTAを指定します。</p>
</div>
<div class="paragraph">
<p>持続性ユニットを作成するには、次の手順を行います:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>EJBプロジェクト・ノードを右クリックし、ポップアップ・メニューから「新規」&gt;「その他」を選択して、新規ファイル・ウィザードを開きます。</p>
</li>
<li>
<p>「持続性」カテゴリから「持続性ユニット」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>「新規持続性ユニット」ダイアログ・ボックスで、「持続性プロバイダ」として「EclipseLink」を選択します。</p>
</li>
<li>
<p>データ・ソースを選択します(たとえば、JavaDBを使用する場合は <code>jdbc/sample</code> を選択)。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>データ・ソース <code>jdbc/sample</code> は、IDEおよびGlassFishサーバーのインストール時にIDEにバンドルされますが、別のデータベースを使用する場合は他のデータ・ソースを指定することもできます。</p>
</div>
<div class="paragraph">
<p>他のデフォルト・オプション(持続性ユニット名、EclipseLink持続性プロバイダ)はそのまま使用できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Java Transaction APIを使用」が選択されており、「表生成戦略」が「作成」に設定されていることを確認します。これにより、アプリケーションのデプロイ時に、エンティティ・クラスに基づいて表が作成されます。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-persistenceunit.png" alt="maven persistenceunit">
</div>
<div class="title">Figure 5. 新規持続性ユニット・ウィザード</div>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、XMLファイル <code>persistence.xml</code> が作成され、エディタでこのファイルが開かれます。「プロジェクト」ウィンドウでは、 <code>「その他のソース」&gt;「src/main/resources」&gt;「META-INF」</code> ディレクトリ内で、このファイルが作成されたことを確認できます。このファイルには、データベースとの接続、およびトランザクションの管理方法に関する詳細が記述されています。エディタで「ソース」タブをクリックすると、次のような持続性ユニットの詳細を表示できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">...
&lt;persistence-unit name="com.mycompany_MavenEnterpriseApp-ejb_ejb_1.0-SNAPSHOTPU" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;jdbc/sample&lt;/jta-data-source&gt;
    &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
    &lt;properties&gt;
      &lt;property name="eclipselink.ddl-generation" value="create-tables"/&gt;
    &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>トランザクション・タイプとして <code>JTA</code> が指定されていること、およびアプリケーションが登録済データ・ソース <code>jdbc/sample</code> を使用することを確認できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_エンティティクラスの作成">エンティティ・クラスの作成</h3>
<div class="paragraph">
<p>この課題では、EJBプロジェクトで、データベースに維持されるオブジェクトを表すエンティティ・クラスを作成します。NewsEntityエンティティ・クラスを作成するには、次の手順を行います:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでEJBモジュールを右クリックし、「新規」&gt;「その他」を選択して新規ファイル・ウィザードを開きます。</p>
</li>
<li>
<p>「持続性」カテゴリから「エンティティ・クラス」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>クラス名に「<strong>NewsEntity</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ」に「<strong>ejb</strong>」と入力し、「主キーの型」は「Long」のままにします。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、エンティティ・クラス <code>NewsEntity.java</code> がソース・エディタに表示されます。ソース・エディタで次の手順を実行し、いくつかのフィールドを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>このクラスに次のフィールド宣言を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private String title;
private String body;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタ内のクラス定義の間を右クリックし、「コードを挿入」([Alt]-[Insert]、Macの場合は[Ctrl]-[I])&gt;「取得メソッドおよび設定メソッド」を選択します。</p>
</li>
<li>
<p>「取得メソッドおよび設定メソッドの生成」ダイアログ・ボックスで、 <code>body</code> フィールドおよび <code>title</code> フィールドを選択します。「生成」をクリックします。</p>
</li>
<li>
<p>変更内容をクラスに保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_メッセージ駆動型beanの作成">メッセージ駆動型Beanの作成</h3>
<div class="paragraph">
<p>この課題では、EJBプロジェクトでメッセージ駆動型Beanを作成します。メッセージ駆動型Beanは、非同期でのメッセージ交換を可能にするエンタープライズBeanです。NewsAppアプリケーションは、メッセージ駆動型Beanを使用して、Webモジュール内でサーブレットがキューに送信するメッセージの受信および処理を行います。</p>
</div>
<div class="paragraph">
<p>アプリケーションでメッセージ駆動型Beanを使用するには、Beanによって使用されるコネクタ・リソースをサーバーに登録する必要があります。GlassFishサーバーにデプロイする場合、管理コンソールを使用してサーバー上にリソースを直接作成できますが、 <code>glassfish-resources.xml</code> ディスクリプタ・ファイルに詳細を指定することでデプロイメント時にリソースを作成することもできます。アプリケーションがサーバーにデプロイされると、サーバーはディスクリプタ・ファイルに基づいてリソースを登録します。IDEの新規ファイル・ウィザードを使用してメッセージ駆動型Beanを作成する場合、ディスクリプタ・ファイル内の要素がIDEによって生成されます。</p>
</div>
<div class="paragraph">
<p>Mavenプロジェクトでは、「ファイル」ウィンドウのプロジェクト・ノードの下の <code>src/main/setup</code> ディレクトリに <code>glassfish-resources.xml</code> ファイルがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでEJBモジュールを右クリックし、「新規」&gt;「その他」を選択して新規ファイル・ウィザードを開きます。</p>
</li>
<li>
<p>「Enterprise JavaBeans」カテゴリから「メッセージ駆動型Bean」を選択します。「次」をクリックします。</p>
</li>
<li>
<p>EJB名に「<strong>NewMessage</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ」ドロップダウン・リストから「<strong>ejb</strong>」を選択します。</p>
</li>
<li>
<p>「プロジェクトの送信先」フィールドの横の「追加」ボタンをクリックして「メッセージ送信先を追加」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>「メッセージ送信先を追加」ダイアログ・ボックスで「<strong>jms/NewMessage</strong>」と入力し、送信先タイプに「キュー」を選択します。「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-messagedestination.png" alt="maven messagedestination">
</div>
<div class="title">Figure 6. 「メッセージ送信先の追加」ダイアログ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトの送信先が正しいことを確認します。「次」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-newmdb.png" alt="maven newmdb">
</div>
<div class="title">Figure 7. 新規メッセージ駆動型Beanウィザード</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「アクティブ化構成プロパティ」でデフォルトの設定を受け入れます。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、Beanクラスが生成され、クラスをメッセージ駆動型Beanと特定する次の注釈、および構成プロパティが追加されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MessageDriven(mappedName = "jms/NewMessage", activationConfig =  {
        @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge"),
        @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue")
    })
public class NewMessage implements MessageListener {

    public NewMessage() {
    }

    @Override
    public void onMessage(Message message) {
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次の注釈済フィールドをクラスに追加して、 <code>MessageDrivenContext</code> リソースをクラスに注入します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class NewMessage implements MessageListener {

*@Resource
private MessageDrivenContext mdc;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次の注釈済フィールド(太字部分)を追加して、エンティティ・マネージャをクラスに導入します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class NewMessage implements MessageListener {

@Resource
private MessageDrivenContext mdc;
*@PersistenceContext(unitName="com.mycompany_MavenEnterpriseApp-ejb_ejb_1.0-SNAPSHOTPU")
private EntityManager em;*</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``@PersistenceContext`` 注釈は、持続性ユニットを宣言することで、コンテキストを指定します。 ``unitName`` 値は、持続性ユニットの名前です。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次の <code>save</code> メソッド(太字部分)を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public NewMessage() {
}

@Override
public void onMessage(Message message) {
}

*private void save(Object object) {
    em.persist(object);
}*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>本文に次のコード(太字部分)を追加して、 <code>onMessage</code> メソッドを変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void onMessage(Message message) {
     *ObjectMessage msg = null;
     try {
          if (message instanceof ObjectMessage) {
          msg = (ObjectMessage) message;
              NewsEntity e = (NewsEntity) msg.getObject();
              save(e);
          }
     } catch (JMSException e) {
          e.printStackTrace();
          mdc.setRollbackOnly();
     } catch (Throwable te) {
          te.printStackTrace();
     }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポート文を修正([Ctrl]-[Shift]-[I]、Macの場合は[⌘]-[Shift]-[I])して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
インポート文の生成時に、* <code>jms</code> <strong>と</strong> <code>javax.annotation.Resource</code> *の各ライブラリを必ずインポートします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>メッセージ駆動型Beanの詳細は、<a href="http://download.oracle.com/javaee/6/tutorial/doc/index.html">Java EE 6チュートリアル、パートI</a>の<a href="http://download.oracle.com/javaee/6/tutorial/doc/gipko.html">メッセージ駆動型Beanとは</a>の章を参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_セッションbeanの作成">セッションBeanの作成</h3>
<div class="paragraph">
<p>この課題では、ウィザードを使用して、NewsEntityエンティティ・クラスのセッションBeanファサードを作成します。このウィザードにより、 <code>create</code> 、 <code>edit</code> および <code>find</code> メソッドが生成されます。これらは、Webアプリケーション・プロジェクトのサーブレットからアクセスできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>EJBモジュールを右クリックし、「新規」&gt;「その他」を選択します。</p>
</li>
<li>
<p>「持続性」カテゴリから「エンティティ・クラスのセッションBean」を選択し、「次」をクリックします。</p>
</li>
<li>
<p>利用可能なエンティティ・クラスのリストから*ejb.NewsEntity*を選択し、「追加」をクリックして、そのクラスを「選択されているエンティティ・クラス」ペインに移動します。「次」をクリックします。</p>
</li>
<li>
<p>「パッケージ」として「<strong>ejb</strong>」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、抽象ファサード・クラスを拡張した <code>AbstractFacade.java</code> と <code>NewsEntityFacade.java</code> という2つのセッション・ファサード・クラスがIDEによって生成されます。抽象ファサード・クラスには、エンティティ・クラスでよく使用される複数のメソッドが定義されています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-sessionwizard.png" alt="maven sessionwizard">
</div>
<div class="title">Figure 8. 「エンティティ・クラスのセッションBean」ウィザード</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_webアプリケーションのコーディング">Webアプリケーションのコーディング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では、Webアプリケーション・プロジェクトに2つのサーブレットを作成します。</p>
</div>
<div class="sect2">
<h3 id="_listnewsサーブレットの作成">ListNewsサーブレットの作成</h3>
<div class="paragraph">
<p>この課題では、送信済メッセージのリストを表示するために使用される、ListNewsサーブレットを作成します。注釈を使用してセッション・ファサードを注入し、 <code>findAll</code> メソッドにアクセスして、送信済メッセージを取得します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Webモジュール・プロジェクトを右クリックし、「新規」&gt;「サーブレット」を選択します。</p>
</li>
<li>
<p>「クラス名」に「<strong>ListNews</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ名」に「<strong>web</strong>」と入力します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、 <code>ListNews.java</code> というクラスがソース・エディタに表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタ内のクラス定義の間を右クリックし、「コードを挿入」([Alt]-[Insert]、Macの場合は[Ctrl]-[I])&gt;「エンタープライズBeanをコール」を選択します。</p>
</li>
<li>
<p>「エンタープライズBeanをコール」ダイアログ・ボックスで、「MavenEnterpriseApp-ejb」ノードを展開し、「NewsEntityFacade」を選択します。「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-callbean.png" alt="maven callbean">
</div>
<div class="title">Figure 9. 「エンタープライズBeanをコール」ダイアログ</div>
</div>
<div class="paragraph">
<p>「OK」をクリックすると、 <code>@EJB</code> という注釈を使用して、EJBリソースがサーブレットに注入されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet(name = "ListNews", urlPatterns = {"/ListNews"})
public class ListNews extends HttpServlet {
    @EJB
    private NewsEntityFacade newsEntityFacade;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>processRequest</code> メソッドで、以下の行(太字部分)をメソッドの本体に追加することでメソッドを変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">out.println("&lt;h1&gt;Servlet ListNews at " + request.getContextPath () + "&lt;/h1&gt;");
*
List news = newsEntityFacade.findAll();
for (Iterator it = news.iterator(); it.hasNext();) {
  NewsEntity elem = (NewsEntity) it.next();
  out.println(" &lt;b&gt;"+elem.getTitle()+" &lt;/b&gt;&lt;br /&gt;");
  out.println(elem.getBody()+"&lt;br /&gt; ");
}
out.println("&lt;a href='PostMessage'&gt;Add new message&lt;/a&gt;");
*
out.println("&lt;/body&gt;");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
以前のバージョンのIDEを使用している場合は、コードのコメント解除が必要になることがあります。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正([Ctrl]-[Shift]-[I]、Macの場合は[⌘]-[Shift]-[I])して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>インポート文を生成するときは、 <code>java.util</code> ライブラリをインポートします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_postmessageサーブレットの作成">PostMessageサーブレットの作成</h3>
<div class="paragraph">
<p>この課題では、メッセージの送信に使用されるPostMessageサーブレットを作成します。注釈を使用して、作成したJMSリソースを直接このサーブレットに注入します。このとき、変数名と、このJMSリソースがマッピングされる名前を指定します。次に、JMSメッセージを送信するためのコードと、メッセージを追加するためのHTML形式のコードを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Webモジュール・プロジェクトを右クリックし、「新規」&gt;「サーブレット」を選択します。</p>
</li>
<li>
<p>「クラス名」に「<strong>PostMessage</strong>」と入力します。</p>
</li>
<li>
<p>「パッケージ名」に「<strong>web</strong>」を選択します。「終了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、 <code>PostMessage.java</code> というクラスがソース・エディタに表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ソース・エディタで、注釈を使用して <code>ConnectionFactory</code> リソースおよび <code>Queue</code> リソースを注入します。これには、次のフィールド宣言を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebServlet(name="PostMessage", urlPatterns={"/PostMessage"})
public class PostMessage extends HttpServlet {
   *@Resource(mappedName="jms/NewMessageFactory")
   private  ConnectionFactory connectionFactory;

   @Resource(mappedName="jms/NewMessage")
   private  Queue queue;*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正して* <code>javax.jms</code> *ライブラリをインポートします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-searchdepend1.png" alt="maven searchdepend1">
</div>
<div class="title">Figure 10. 「すべてのインポートを修正」ダイアログ</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IDEのオプションとして <code>javax.jms</code> がない場合は、 <code>private ConnectionFactory connectionFactory;</code> の横のマージンにある提案アイコンをクリックし、「Mavenリポジトリで依存性を検索」を選択することで、リポジトリから適切なアーティファクトを検索できます。
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-searchdependencies.png" alt="maven searchdependencies">
</div>
<div class="title">Figure 11. リポジトリで依存性を検索するためのエディタのヒント</div>
</div>
<div class="paragraph">
<p>「Mavenリポジトリで検索」ダイアログを使用して、 <code>ConnectionFactory</code> を含む <code>javaee-api-6.0</code> アーティファクトを検索できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-searchdepend2.png" alt="maven searchdepend2">
</div>
<div class="title">Figure 12. 「Mavenリポジトリで検索」ダイアログ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JMSメッセージを送信するための次のコードを <code>processRequest</code> メソッドに追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">response.setContentType("text/html;charset=UTF-8");

*// Add the following code to send the JMS message
String title=request.getParameter("title");
String body=request.getParameter("body");
if ((title!=null) &amp;amp;&amp;amp; (body!=null)) {
    try {
        Connection connection = connectionFactory.createConnection();
        Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
        MessageProducer messageProducer = session.createProducer(queue);

        ObjectMessage message = session.createObjectMessage();
        // here we create NewsEntity, that will be sent in JMS message
        NewsEntity e = new NewsEntity();
        e.setTitle(title);
        e.setBody(body);

        message.setObject(e);
        messageProducer.send(message);
        messageProducer.close();
        connection.close();
        response.sendRedirect("ListNews");

    } catch (JMSException ex) {
        ex.printStackTrace();
    }
}*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メッセージを追加するWebフォームのために、次のコード(太字部分)を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">out.println("Servlet PostMessage at " + request.getContextPath() + "&lt;/h1&gt;");

*// The following code adds the form to the web page
out.println("&lt;form&gt;");
out.println("Title: &lt;input type='text' name='title'&gt;&lt;br/&gt;");
out.println("Message: &lt;textarea name='body'&gt;&lt;/textarea&gt;&lt;br/&gt;");
out.println("&lt;input type='submit'&gt;&lt;br/&gt;");
out.println("&lt;/form&gt;");
*
out.println("&lt;/body&gt;");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
以前のバージョンのIDEを使用している場合は、コードのコメント解除が必要になることがあります。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>インポートを修正して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-jms-imports.png" alt="maven jms imports">
</div>
<div class="title">Figure 13. 「すべてのインポートを修正」ダイアログ</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Connection</code> 、 <code>ConnectionFactory</code> 、 <code>Session</code> および <code>Queue</code> に対して、* <code>javax.jms</code> *ライブラリをインポートします。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mavenを使用したアプリケーションのビルド">Mavenを使用したアプリケーションのビルド</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アプリケーションのコーディングが終了したので、Mavenを使用してエンタープライズ・アプリケーションをビルドできます。この項では、EARアーカイブ内のプロジェクトをビルドおよびパッケージ化します。EARアーカイブには、EJB JARアーカイブおよびWARアーカイブが含まれます。EARアーカイブを作成した後、このアーカイブをターゲット・サーバーにデプロイできます。</p>
</div>
<div class="sect2">
<h3 id="_プロジェクト依存性の処理">プロジェクト依存性の処理</h3>
<div class="paragraph">
<p>この課題では、WebプロジェクトのPOM ( <code>pom.xml</code> )を調べて、パッケージ化の際に不要なアーティファクトがWARに含まれないようにPOMを変更します。  各Mavenプロジェクトには、アーカイブの詳細な内容を含む <code>pom.xml</code> ファイルが含まれます。プロジェクトによって必要とされるすべての外部ライブラリは、POM内に依存性として一覧表示されます。POMを変更して、アーカイブをパッケージ化するときに含める必要がある依存性や除外する必要がある依存性を指定できます。</p>
</div>
<div class="paragraph">
<p>このアプリケーションでは、EJB JARアーカイブおよびWARアーカイブが、EARアーカイブにパッケージ化されます。MavenEnterpriseApp-earプロジェクトの <code>pom.xml</code> ファイルを見ると、EJBおよびWARが依存性として宣言されていることがわかります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-earpom.png" alt="maven earpom">
</div>
<div class="title">Figure 14. EARプロジェクトのpom.xml</div>
</div>
<div class="paragraph">
<p>エディタでWebプロジェクトの <code>pom.xml</code> を見ると、EJBアーカイブが依存性として宣言され、スコープが <code>provided</code> として指定されていることを確認できます。アーティファクトのスコープ要素の値が <code>provided</code> である場合、そのアーティファクトはパッケージ化の際に含まれません。このWebプロジェクトには依存性としてEJBアーカイブが必要ですが、このアプリケーションではEJBアーカイブがEARアーカイブの一部として使用可能になり、提供されるため、パッケージ化の際にEJBアーカイブをWARに含めないようにする必要があります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-webpom.png" alt="maven webpom">
</div>
<div class="title">Figure 15. Webアプリケーション・プロジェクトのpom.xml</div>
</div>
<div class="paragraph">
<p>エディタで <code>pom.xml</code> を開き、「グラフ」タブをクリックすると、プロジェクトの依存性を視覚的に確認できます。古いバージョンのIDEを使用している場合、エディタの <code>pom.xml</code> で右クリックし、「依存性グラフを表示」を選択します。アーティファクト上にカーソルを置くと、このアーティファクトに関する詳細を示すツールチップが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-webpomgraph.png" alt="maven webpomgraph">
</div>
<div class="title">Figure 16. 依存性のグラフ</div>
</div>
<div class="paragraph">
<p>次の手順を実行して、WebプロジェクトのPOMを変更し、 <code>javaee-api</code> アーティファクトに対する依存性に <code>scope</code> 要素を追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Webプロジェクトの下の「プロジェクト・ファイル」ノードを展開します。</p>
</li>
<li>
<p><code>pom.xml</code> をダブルクリックし、エディタでこのファイルを開きます。</p>
</li>
<li>
<p><code>javaee-api</code> アーティファクトの <code>&lt;scope&gt;</code> の値に <code>provided</code> が設定されていることを確認します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>値が <code>provided</code> でない場合、POMを編集して、次の変更を加える必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;javax&lt;/groupId&gt;
    &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;
    &lt;version&gt;7.0&lt;/version&gt;
    &lt;type&gt;jar&lt;/type&gt;
    *&lt;scope&gt;provided&lt;/scope&gt;*
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>POMエディタでコード補完を使用すると、ファイルの編集に役立ちます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-addscope-javaee.png" alt="maven addscope javaee">
</div>
<div class="title">Figure 17. POMのscope要素のコード補完</div>
</div>
<div class="paragraph">
<p>依存性の提供を宣言することで、WARアーカイブのビルド時、アーティファクトがMavenによってパッケージ化されなくなります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>変更を保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_依存性でビルド">依存性でビルド</h3>
<div class="paragraph">
<p>Mavenのビルド・フレームワークでは、特定のフェーズを経て処理されます。各フェーズには1つまたは複数のゴールがあり、様々なMavenプラグインを使用するように構成できます。「依存性でビルド」メニュー項目は、Mavenのビルドライフサイクルの「 <code>インストール</code> 」フェーズにマップされ、Reactorプラグインを使用するように構成されています。ポップアップ・メニューから「依存性でビルド」を選択すると、アプリケーションおよび必要とされるすべての依存性がビルドされ、ビルド・アーティファクトがローカル・リポジトリにコピーされます。</p>
</div>
<div class="paragraph">
<p>プロジェクトの「プロパティ」ダイアログ・ボックスの「アクション」パネルでは、Mavenの各フェーズとゴールが各メニュー・アクションにどのようにマップされるかを変更できます。</p>
</div>
<div class="paragraph">
<p>EARアーカイブをビルドするには、次の手順を行います:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MavenEnterpriseApp-earプロジェクト・ノードを右クリックし、「依存性でビルド」を選択します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>リアクタ・プラグインを使用してEARプロジェクトをビルドすると、EARプロジェクトがビルドされる前に、EARプロジェクトの依存性であるサブプロジェクトがビルドされます。出力ウィンドウに、ビルドの順序が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-reactor1.png" alt="maven reactor1">
</div>
<div class="title">Figure 18. Reactorのビルド順序を示す「出力」ウィンドウ</div>
</div>
<div class="paragraph">
<p>出力ウィンドウには、ビルドの結果も表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-reactor2.png" alt="maven reactor2">
</div>
<div class="title">Figure 19. Reactorのビルド・ステータスを示す「出力」ウィンドウ</div>
</div>
<div class="paragraph">
<p>EARプロジェクトをビルドした後に、「ファイル」ウィンドウのEARプロジェクト・ノードの下の <code>target</code> ディレクトリ内に最終的なEARアーカイブを表示できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-earfileswindow1.png" alt="maven earfileswindow1">
</div>
<div class="title">Figure 20. EARアーカイブを示す「ファイル」ウィンドウ</div>
</div>
<div class="paragraph">
<p>デフォルトのアーティファクト名である <code>com.mycompany</code> を使用した場合は、Mavenリポジトリ・ブラウザを使用して、ローカル・リポジトリ内の <code>com.mycompany</code> を展開し、ビルド・アーティファクトを表示できます。</p>
</div>
<div class="paragraph">
<p>Mavenプロジェクトのビルドの詳細は、<a href="http://maven.apache.org">maven.apache.org</a>で、<a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Maven - ビルド・ライフサイクル入門</a>を参照してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_アプリケーションのデプロイと実行">アプリケーションのデプロイと実行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では、EARアーカイブをサーバーにデプロイするための2つの方法について説明します。アプリケーションをGlassFishサーバーにデプロイするには、IDEのメニュー・アクションを使用するか、またはGlassFish管理コンソールのデプロイ・ツールを使用します。</p>
</div>
<div class="sect2">
<h3 id="_ideからのアプリケーションのデプロイと実行">IDEからのアプリケーションのデプロイと実行</h3>
<div class="paragraph">
<p>この課題では、「実行」アクションを使用してEARアーカイブをGlassFishサーバーにデプロイします。アプリケーションをデプロイしたら、ブラウザでアプリケーションのListNewsページを開き、メッセージを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウでEARプロジェクト・ノードを右クリックし、「実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「実行」をクリックすると、IDEによってサーバー上にEARアーカイブがデプロイされ、JMSリソースが作成されます。IDEがデフォルトのプロジェクト・インデックス・ページ(<a href="http://localhost:8080/MavenEnterpriseApp-web/">http://localhost:8080/MavenEnterpriseApp-web/</a>)をブラウザで開きます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ブラウザで次のURLを開き、ListNewsページを表示します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/MavenEnterpriseApp-web/ListNews">http://localhost:8080/MavenEnterpriseApp-web/ListNews</a></p>
</div>
<div class="paragraph">
<p>プロジェクトを初めて実行するときは、データベースは空であり、メッセージは表示されません。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-browser1.png" alt="maven browser1">
</div>
<div class="title">Figure 21. ブラウザに表示されたListNewsページ</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「新規メッセージを追加」をクリックします。</p>
</li>
<li>
<p>PostMessageサーブレットのフォーム内に、メッセージを入力します。「問合せを送信」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-browser2.png" alt="maven browser2">
</div>
<div class="title">Figure 22. ブラウザに表示されたPostMessageページ</div>
</div>
<div class="paragraph">
<p>PostMessageサーブレットを使用してメッセージを追加すると、永続記憶域に書き込むためのメッセージ駆動型Beanにそのメッセージが送信され、ListNewsサーブレットがコールされて、データベース内のメッセージが表示されます。このメッセージ・サービスは非同期のため、ListNewsによって取得されるデータベース内のメッセージ・リストには、新しいメッセージがまだ含まれていないことがよくあります。</p>
</div>
<div class="paragraph">
<p>GlassFishサーバーをターゲット・サーバーとして指定したMavenプロジェクトでは、「保存時にコンパイル」と「保存時にデプロイ」がデフォルトで有効になっています。たとえば、サーブレットを変更して保存した場合は、アプリケーションを再デプロイしなくても、ブラウザでサーブレットを再ロードして変更内容を表示できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_glassfish管理コンソールからのデプロイ">GlassFish管理コンソールからのデプロイ</h3>
<div class="paragraph">
<p>この課題では、GlassFish管理コンソールのデプロイ・ツールを使用してEARアーカイブをデプロイします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「サービス」ウィンドウで「サーバー」ノードを展開します。</p>
</li>
<li>
<p>GlassFishサーバーを起動します。</p>
</li>
<li>
<p>GlassFishサーバーのノードを右クリックし、「管理コンソールを表示」を選択して、ブラウザ上でGlassFish管理コンソールを開きます。</p>
</li>
<li>
<p>管理コンソールの左のペインで、アプリケーション・ノードをクリックします。</p>
</li>
<li>
<p>管理コンソールのメイン・ペインで、「デプロイ」ボタンをクリックします。</p>
</li>
<li>
<p>「参照」をクリックし、エンタープライズ・アプリケーションのEARアーカイブを特定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ローカル・システムでは、EARアーカイブはエンタープライズ・アプリケーション・ディレクトリ内の <code>target</code> ディレクトリ内に置かれています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「OK」をクリックすると、GlassFishデプロイツールにより、アプリケーションがデプロイされます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GlassFish管理コンソールのデプロイ・ツールを使用してアプリケーションをデプロイするときに、アプリケーションが必要とするリソースが存在しない場合は、それらを手動で作成する必要があります。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ソリューションプロジェクトのダウンロード">ソリューション・プロジェクトのダウンロード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次の方法で、このチュートリアルにソリューションをプロジェクトとしてダウンロードできます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FMavenEnterpriseApp.zip">終了したプロジェクトのZIPアーカイブ</a>をダウンロードします。</p>
</li>
<li>
<p>次の手順を実行して、プロジェクト・ソースをNetBeansのサンプルからチェックアウトします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>メイン・メニューから「チーム」&gt;「Subversion」&gt;「チェックアウト」を選択します。</p>
</li>
<li>
<p>「チェックアウト」ダイアログ・ボックスで次のリポジトリURLを入力します。
 <code><a href="https://svn.netbeans.org/svn/samples~samples-source-code" class="bare">https://svn.netbeans.org/svn/samples~samples-source-code</a></code>
「次」をクリックします。</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「参照」をクリックして「リポジトリ・フォルダを参照」ダイアログ・ボックスを開きます。</p>
</li>
<li>
<p>ルート・ノードを展開し、*samples/javaee/MavenEnterpriseApp*を選択します。「OK」をクリックします。</p>
</li>
<li>
<p>ソースのローカル・フォルダを指定します(ローカル・フォルダは空である必要があります)。</p>
</li>
<li>
<p>「終了」をクリックします。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>「終了」をクリックすると、IDEではローカル・フォルダがSubversionリポジトリとして初期化され、プロジェクト・ソースがチェックアウトされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>チェックアウトが完了するときに表示されるダイアログで、「プロジェクトを開く」をクリックします。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Subversionのインストールの詳細は、<a href="../ide/subversion.html">NetBeans IDEでのSubversionガイド</a>の<a href="../ide/subversion.html#settingUp">Subversionの設定</a>の項を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Creating%20an%20Enterprise%20Application%20Using%20Maven">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_関連項目">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans IDEを使用したJava EEアプリケーションの開発方法の詳細は、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="javaee-intro.html">Java EEテクノロジ入門</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EEアプリケーションの開始</a></p>
</li>
<li>
<p><a href="maven-entapp-testing.html">Mavenエンタープライズ・アプリケーションのテスト</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Java EEおよびJava Webの学習</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>エンタープライズBeanの使用方法については、<a href="http://download.oracle.com/javaee/7/tutorial/doc/">Java EE 7チュートリアル</a>を参照してください。</p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">nbj2eeメーリング・リストに登録する</a>ことによって、NetBeans IDE Java EE開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/maven-entapp_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
