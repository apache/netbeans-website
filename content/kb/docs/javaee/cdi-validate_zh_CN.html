
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>应用 @Alternative Bean 和生命周期标注</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="应用 @Alternative Bean 和生命周期标注 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 应用 @Alternative Bean 和生命周期标注">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">应用 @Alternative Bean 和生命周期标注</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-validate_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_上下文和依赖关系注入">上下文和依赖关系注入</a></li>
<li><a href="#alternative">处理多个部署</a></li>
<li><a href="#lifecycle">将生命周期标注应用于受管 Bean</a></li>
<li><a href="#seealso">另请参见</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>撰稿人：Andy Gibson</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_上下文和依赖关系注入">上下文和依赖关系注入</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="cdi-intro.html">CDI 和 JSF 2.0 入门指南</a></p>
</li>
<li>
<p><a href="cdi-inject.html">使用 CDI 中的注入和限定符</a></p>
</li>
<li>
<p><strong>应用 @Alternative Bean 和生命周期标注</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#alternative">处理多个部署</a></p>
</li>
<li>
<p><a href="#lifecycle">将生命周期标注应用于受管 Bean</a></p>
</li>
<li>
<p><a href="#seealso">另请参见</a></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="cdi-events.html">使用 CDI 中的事件</a></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR-299</a> 指定的上下文和依赖关系注入 (CDI) 是 Java EE 6 的一个组成部分，提供了一个体系结构，以允许 Java EE 组件（例如 Servlet、企业 Bean 和 JavaBeans）在具有明确定义范围的应用程序生命周期内存在。此外，CDI 服务允许 Java EE 组件（例如 EJB 会话 Bean 和 JavaServer Faces (JSF) 受管 Bean）注入并通过触发和观察事件以松散耦合的方式进行交互。</p>
</div>
<div class="paragraph">
<p>本教程基于 Andy Gibson 发布的博客，标题为：<a href="http://www.andygibson.net/blog/index.php/2009/12/22/getting-started-with-cdi-part-2-injection/">CDI 入门指南，第 2 部分 - 注入</a>。本教程演示如何使用 <code>@Alternative</code> 标注配置应用程序用于不同的部署，还将演示如何使用受管 Bean 生命周期标注（例如，<code>@PostConstruct</code> 和 <code>@PreDestroy</code>）将 CDI 注入和 <a href="http://jcp.org/en/jsr/detail?id=316">Java EE 6 受管 Bean 规范</a>提供的功能结合起来。</p>
</div>
<div class="paragraph">
<p>NetBeans IDE 为上下文和依赖关系注入提供了内置支持，包括在项目创建时构建 <code>beans.xml</code> CDI 配置文件的选项，为标注提供的编辑器和导航支持，以及用于创建常用 CDI 工件的各种向导。</p>
</div>
<div class="paragraph">
<p>要学完本教程，您需要具备以下软件和资源。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">软件或资源</th>
<th class="tableblock halign-left valign-top">要求的版本</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.2、7.3、7.4、8.0、Java EE 版本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 开发工具包 (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">版本 7 或 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://glassfish.dev.java.net/">GlassFish Server</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Source Edition 3.x 或 4.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo2.zip">cdiDemo2.zip</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>NetBeans IDE Java 包中还含 GlassFish Server Open Source Edition，后者是与 Java EE 兼容的容器。</p>
</li>
<li>
<p>可以下载本教程的解决方案样例项目：<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FJavaEE%252FcdiDemo3.zip">cdiDemo3.zip</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternative">处理多个部署</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CDI 提供 <code>@Alternative</code> 标注，通过该标注可以包含与注入点匹配的多个 Bean 而不会出现多义性错误。换句话说，可以将 <code>@Alternative</code> 标注应用至两个或多个 Bean，然后，根据部署指定要在 CDI 的 <code>beans.xml</code> 配置文件中使用的 Bean。</p>
</div>
<div class="paragraph">
<p>为演示此情况，请参见下面的方案。我们将 <code>ItemValidator</code> 注入 <code>ItemProcessor</code> 主类。<code>ItemValidator</code> 由 <code>DefaultItemValidator</code> 和 <code>RelaxedItemValidator</code> 实现。根据部署要求，在大多数情况下我们会使用 <code>DefaultItemValidator</code>，但在特定部署中，还需要 <code>RelaxedItemValidator</code>。为解决此问题，我们对两个 Bean 添加标注，然后通过向应用程序的 <code>beans.xml</code> 文件添加条目，指定给定部署要使用的 Bean。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-alternative.png" alt="cdi diagram alternative">
</div>
<div class="title">Figure 1. 在应用程序中使用 CDI 注入对类进行松散耦合</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>首先，从 <code>cdiDemo2.zip</code> 文件提取样例启动项目（请参见上面的<a href="#requiredSoftware">所需资源列表</a>）。在 IDE 中打开项目，方法是选择 "File"（文件）&gt; "Open Project"（打开项目）（Ctrl-Shift-O 组合键；在 Mac 上为 ⌘-Shift-O 组合键），然后从计算机上的相应位置选择该项目。</p>
</li>
<li>
<p>右键单击“项目”窗口中的项目节点，然后选择“属性”。</p>
</li>
<li>
<p>选择 "Run"（运行）类别，并确认在 "Server"（服务器）下拉列表中选定 GlassFish 实例。</p>
</li>
<li>
<p>创建 <code>ItemValidator</code> 接口。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>单击 "New File"（新建文件）(<span class="image"><img src="images/new-file-btn.png" alt="new file btn"></span>) 按钮，或者按 Ctrl-N 组合键（在 Mac 上为 ⌘-N 组合键）以打开文件向导。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>选择 "Java" 类别，然后选择 "Java Interface"（Java 接口）。单击 "Next"（下一步）。</p>
</li>
<li>
<p>键入 <strong>ItemValidator</strong> 作为类名，然后输入 <strong>exercise3</strong> 作为包。</p>
</li>
<li>
<p>单击 "Finish"（完成）。将会生成新接口并在编辑器中将其打开。</p>
</li>
<li>
<p>添加名为 <code>isValid()</code> 的方法，以提取 <code>Item</code> 对象并返回 <code>boolean</code> 值。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public interface ItemValidator {
    *boolean isValid(Item item);*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise2.Item</code> 添加 import 语句。）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>扩展 <code>ItemProcessor</code> 类以包含新功能。在编辑器中打开 <code>ItemProcessor</code>，并进行以下更改。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    @Inject @Demo
    private ItemDao itemDao;

    *@Inject
    private ItemValidator itemValidator;*

    public void execute() {
      List&lt;Item&gt;  items = itemDao.fetchItems();
      for (Item item : items) {
          System.out.println(*"Item = " + item + " valid = " + itemValidator.isValid(item)*);
      }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用编辑器的提示为 <code>exercise3.ItemValidator</code> 添加 import 语句。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建一个 <code>ItemValidator</code> 实现，名为 <code>DefaultItemValidator</code>，该实现根据值简单地对 limit 进行测试。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在 "Projects"（项目）窗口中，右键单击 <code>exercise3</code> 包，并选择 "New"（新建）&gt; "Java Class"（Java 类）。将该类命名为 <strong>DefaultItemValidator</strong>，然后单击 "Finish"（完成）。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>让 <code>DefaultItemValidator</code> 实现 <code>ItemValidator</code> 并覆盖 <code>isValid()</code> 方法，如下所示。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class DefaultItemValidator *implements ItemValidator* {

    *@Override
    public boolean isValid(Item item) {
        return item.getValue() &lt; item.getLimit();
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise2.Item</code> 添加 import 语句。）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 IDE 的主工具栏中单击 "Run Project"（运行项目）(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>) 按钮。编译该项目并将其部署到 GlassFish，然后在浏览器中打开应用程序的欢迎页 (<code>process.xhtml</code>)。</p>
</li>
<li>
<p>单击页面上显示的 <code>Execute</code> 按钮。切换回 IDE 并检查 GlassFish Server 日志。服务器日志会显示在 "Output"（输出）窗口（Ctrl-4 组合键；在 Mac 上为 ⌘-4 组合键）中 "GlassFish" 标签的下方。然后会看到验证项，并列出唯一一个值小于 limit 的有效项。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Item = exercise2.Item@e857ac [Value=34, Limit=7] valid = false
INFO: Item = exercise2.Item@63124f52 [Value=4, Limit=37] valid = true
INFO: Item = exercise2.Item@4715c34e [Value=24, Limit=19] valid = false
INFO: Item = exercise2.Item@65c95a57 [Value=89, Limit=32] valid = false</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/output-window.png" alt="output window" width="Output"（输出）窗口中查看服务器日志"">
</div>
<div class="title">Figure 2. 在 </div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>现在，请考虑以下情况，假定您必须部署到另一个更松散的站点，且仅当项值大于 limit 的两倍时，才将该项视为无效。您可能需要使用另一个 Bean 为该逻辑实现 <code>ItemValidator</code> 接口。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>创建一个新的 <code>ItemValidator</code> 实现，名为 <code>RelaxedItemValidator</code>。在 "Projects"（项目）窗口中，右键单击 <code>exercise3</code> 包，并选择 "New"（新建）&gt; "Java Class"（Java 类）。将该类命名为 <strong>RelaxedItemValidator</strong>，然后单击 "Finish"（完成）。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>让 <code>RelaxedItemValidator</code> 实现 <code>ItemValidator</code> 并覆盖 <code>isValid()</code> 方法，如下所示。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class RelaxedItemValidator *implements ItemValidator* {

    *@Override
    public boolean isValid(Item item) {
        return item.getValue() &lt; (item.getLimit() * 2);
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise2.Item</code> 添加 import 语句。）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>单击 "Run Project"（运行项目）(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>) 按钮以运行项目。请注意，项目现在无法部署。</p>
</li>
<li>
<p>在 "Output"（输出）窗口（Ctrl-4 组合键；在 Mac 上为 ⌘-4 组合键）中查看服务器日志。您会看到一则错误消息，报告 "ambiguous dependency"（依赖关系不明确）问题。出现此错误的原因是，您现在有两个实现同一接口的类。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">org.glassfish.deployment.common.DeploymentException: Injection point has ambiguous dependencies.
Injection point: field exercise2.ItemProcessor.itemValidator;
Qualifiers: [@javax.enterprise.inject.Default()];
Possible dependencies: [exercise3.RelaxedItemValidator, exercise3.DefaultItemValidator]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Weld（CDI 实现）无法确定对给定注入点使用 <code>RelaxedItemValidator</code> 还是使用 <code>DefaultItemValidator</code>。</p>
</div>
<div class="paragraph">
<p>如前面所述，唯一的区别在于部署。对于大多数部署，需要使用默认验证器，但对于一个部署，需要使用 "relaxed" 实现。CDI 提供 <code>@Alternative</code> 标注，通过该标注可以包含与一个注入点匹配的多个 Bean 而不会出现多义性错误，且要使用的 Bean 在 <code>beans.xml</code> 中定义。这允许您在同一模块中部署这两个实现，唯一的差别在于 <code>beans.xml</code> 的定义，该定义可以根据不同的部署进行更改。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将 <code>@Alternative</code> 标注和相应的 import 语句添加至 <code>RelaxedItemValidator</code> 和 <code>DefaultItemValidator</code>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在编辑器中打开 <code>RelaxedItemValidator</code> 并进行以下更改。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*import javax.enterprise.inject.Alternative;*
...

*@Alternative*
public class RelaxedItemValidator implements ItemValidator {

    public boolean isValid(Item item) {
        return item.getValue() &lt; (item.getLimit() * 2);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>键入 <code>Al</code>，然后按 Ctrl-空格组合键以调用代码完成。因为仅过滤了一个选项，将完成 <code>@Alternative</code> 标注，<code>javax.enterprise.inject.Alternative</code> 相应的 import 语句会自动添加到文件顶部。通常情况下，在标注上按 Ctrl-空格组合键还会提供 Javadoc 文档弹出窗口。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-completion-alternative.png" alt="code completion alternative">
</div>
<div class="title">Figure 3. 在标注时按 Ctrl-空格组合键可调用 Javadoc 文档</div>
</div>
<div class="paragraph">
<p>切换至 <code>DefaultItemValidator</code>（按 Ctrl-Tab 组合键）并进行以下更改。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">*import javax.enterprise.inject.Alternative;*
...

*@Alternative*
public class DefaultItemValidator implements ItemValidator {

    public boolean isValid(Item item) {
        return item.getValue() &lt; item.getLimit();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果现在部署了应用程序，则会收到 "unsatisfied dependency"（不符合要求的依赖关系）错误，因为您定义了两个匹配的 Bean 作为替代项，但是没有在 <code>beans.xml</code> 文件中启用这两个文件中的任何一个。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用 IDE 的 "Go to File"（转至文件）对话框快速打开 <code>beans.xml</code> 文件。从 IDE 的主菜单（Alt-Shift-O；在 Mac 上为 Ctrl-Shift-O）选择 "Navigate"（导航）&gt; "Go to File"（转至文件），然后键入 &#8220;beans&#8221;。单击 "OK"（确定）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/go-to-file.png" alt="go to file" width="Go to File"（转至文件）对话框可快速找到项目文件"">
</div>
<div class="title">Figure 4. 使用 </div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>对 <code>beans.xml</code> 文件进行如下更改。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;beans xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/beans_1_0.xsd"&gt;

    *&lt;alternatives&gt;
        &lt;class&gt;exercise3.RelaxedItemValidator&lt;/class&gt;
    &lt;/alternatives&gt;*

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会通知 CDI 使用 <code>RelaxedItemValidator</code> 进行此部署。可以认为 <code>@Alternative</code> 标注有效禁用了 Bean，使其不能用于注入，但是允许该实现与其他 Bean 一起打包。在 <code>beans.xml</code> 文件中将其添加为替代项可有效地重新启用该 Bean，使其可用于注入。通过将此类型的元数据移动至 <code>beans.xml</code> 文件，可以将不同版本的文件与不同部署一起打包。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>单击 "Run Project"（运行项目）(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>) 按钮以运行项目（或者，按 F6 键；在 Mac 上按 fn-F6 组合键）。在浏览器中，单击页面上显示的 &#8220;Execute&#8221; 按钮。切换回 IDE 并查看 "Output"（输出）窗口（Ctrl-4 组合键，在 Mac 上为 ⌘-4 组合键）中显示的 GlassFish Server 日志。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Item = exercise2.Item@672f0924 [Value=34, Limit=7] valid = false
INFO: Item = exercise2.Item@41014f68 [Value=4, Limit=37] valid = true
INFO: Item = exercise2.Item@3d04562f [Value=24, Limit=19] valid = true
INFO: Item = exercise2.Item@67b646f4 [Value=89, Limit=32] valid = false</code></pre>
</div>
</div>
<div class="paragraph">
<p>您会看到，当第三项显示为有效而提供的值 (<code>24</code>) 大于给定 limit (<code>19</code>) 时，会使用 <code>RelaxedItemValidator</code> 实现。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle">将生命周期标注应用于受管 Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此示例中，将 <code>ItemErrorHandler</code> 注入到主 <code>ItemProcessor</code> 类。因为 <code>FileErrorReporter</code> 是 <code>ItemErrorHandler</code> 接口的唯一实现，所以会选中它作为接口。要为此类设置生命周期特定的操作，请从受管 Bean 规范（包含在 <a href="http://jcp.org/en/jsr/detail?id=316">JSR 316：Java Platform, Enterprise Edition 6 规范</a>）使用 <code>@PostConstruct</code> 和 <code>@PreDestroy</code> 标注。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cdi-diagram-lifecycle.png" alt="cdi diagram lifecycle">
</div>
<div class="title">Figure 5. 在应用程序中使用 CDI 注入对类进行松散耦合</div>
</div>
<div class="paragraph">
<p>继续执行本示例，创建 <code>ItemErrorHandler</code> 接口以在发现无效的项时对其进行处理。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Projects"（项目）窗口中，右键单击 <code>exercise3</code> 包，然后选择 "New"（新建）&gt; "Java Interface"（Java 接口）。</p>
</li>
<li>
<p>在 Java 接口向导中，键入 <strong>ItemErrorHandler</strong> 作为类名，然后输入 <strong>exercise3</strong> 作为包。单击 "Finish"（完成）。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>将会生成新接口并在编辑器中将其打开。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>添加名为 <code>handleItem()</code> 的方法，该方法将 <code>Item</code> 对象作为参数。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public interface ItemErrorHandler {
    *void handleItem(Item item);*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise2.Item</code> 添加 import 语句。）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>首先，使用名为 <code>FileErrorReporter</code> 的伪处理程序（该程序将项详细信息保存至文件）实现 <code>ItemErrorHandler</code>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在 "Projects"（项目）窗口中，右键单击 <code>exercise3</code> 包，并选择 "New"（新建）&gt; "Java Class"（Java 类）。将该类命名为 <strong>FileErrorReporter</strong>，然后单击 "Finish"（完成）。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>让 <code>FileErrorReporter</code> 实现 <code>ItemErrorHandler</code> 并覆盖 <code>handleItem()</code> 方法，如下所示。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FileErrorReporter *implements ItemErrorHandler* {

    *@Override
    public void handleItem(Item item) {
        System.out.println("Saving " + item + " to file");
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise2.Item</code> 添加 import 语句。）</p>
</div>
<div class="paragraph">
<p>您需要在开始处理项之前打开文件，并在向文件添加内容的过程中使其保持打开状态，然后在完成处理时关闭文件。您可以手动将 <code>initProcess()</code> 和 <code>finishProcess()</code> 方法添加到错误报告程序 Bean，但之后无法向接口添加代码，因为调用程序需要知道这些类特定的方法。您可以将以上这些方法添加到 <code>ItemErrorReporter</code> 接口，但之后必须在实现该接口的每个类中实现这些方法，这就产生了不必要的操作。不过，您可以使用受管 Bean 规范（<a href="http://jcp.org/en/jsr/detail?id=316">JSR 316：Java 平台 Enterprise Edition 6 规范</a>中包含）中的一些生命周期标注，在 Bean 生命周期中的某些时点对 Bean 调用方法。当已经构造了 Bean 且 Bean 的任何依赖关系都已注入时，则调用 <code>@PostConstruct</code> 标注的方法。同样，容器会在处理 Bean 之前调用 <code>@PreDestroy</code> 标注的方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>添加以下带有相应 <code>@PostConstruct</code> 和 <code>@PreDestroy</code> 标注的 <code>init()</code> 和 <code>release()</code> 方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FileErrorReporter implements ItemErrorHandler {

    *@PostConstruct
    public void init() {
        System.out.println("Creating file error reporter");
    }

    @PreDestroy
    public void release() {
        System.out.println("Closing file error reporter");
    }*

    @Override
    public void handleItem(Item item) {
        System.out.println("Saving " + item + " to file");
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修复导入。在编辑器中右键单击并选择 "Fix Imports"（修复导入），或者按 Ctrl-Shift-I 组合键（在 Mac 上按 ⌘-Shift-I 组合键）。<code>javax.annotation.PostConstruct</code> 和 <code>javax.annotation.PreDestroy</code> 的 Import 语句将添加到文件顶部。</p>
</li>
<li>
<p>最后，向 <code>ItemProcessor</code> 添加 <code>ItemErrorHandler</code> Bean。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Named
@RequestScoped
public class ItemProcessor {

    @Inject @Demo
    private ItemDao itemDao;

    @Inject
    private ItemValidator itemValidator;

    *@Inject
    private ItemErrorHandler itemErrorHandler;*

    public void execute() {
        List&lt;Item&gt;  items = itemDao.fetchItems();
        for (Item item : items) {
            *if (!itemValidator.isValid(item)) {
                itemErrorHandler.handleItem(item);
            }*
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>（使用编辑器的提示为 <code>exercise3.ItemErrorHandler</code> 添加 import 语句。）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>单击 "Run Project"（运行项目）(<span class="image"><img src="images/run-project-btn.png" alt="run project btn"></span>) 按钮以运行项目（或者，按 F6 键；在 Mac 上按 fn-F6 组合键）。在浏览器中，单击页面上显示的 &#8220;Execute&#8221; 按钮。切换回 IDE 并查看 "Output"（输出）窗口（Ctrl-4 组合键，在 Mac 上为 ⌘-4 组合键）中显示的 GlassFish Server 日志。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">INFO: Creating file error reporter
INFO: Saving exercise2.Item@6257d812 [Value=34, Limit=7] to file
INFO: Saving exercise2.Item@752ab82e [Value=89, Limit=32] to file
INFO: Closing file error reporter</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20CDI%20Injection%20to%20Perform%20Custom%20Validation">发送有关此教程的反馈意见</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">另请参见</h2>
<div class="sectionbody">
<div class="paragraph">
<p>不同的应用程序部署会使用不同的规则来处理无效项，例如拒绝项、向个人发送通知、为其添加标记、或者仅在输出文件中列出它们。此外，我们可能需要结合使用这些项（例如，拒绝订单、向销售代表发送电子邮件以及在文件中列出订单）。处理此类多方面问题的一个最佳方式是使用_事件_。本系列最后一部分的主题是 CDI 事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-events.html">使用 CDI 中的事件</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关 CDI 和 Java EE 的详细信息，请参见以下资源。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cdi-intro.html">上下文和依赖关系注入以及 JSF 2.0 入门指南</a></p>
</li>
<li>
<p><a href="cdi-inject.html">使用 CDI 中的注入和限定符</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Java EE 应用程序入门指南</a></p>
</li>
<li>
<p><a href="http://blogs.oracle.com/enterprisetechtips/entry/using_cdi_and_dependency_injection">企业技术提示：在 JSF 2.0 应用程序中使用面向 Java 的 CDI 和依赖关系注入</a></p>
</li>
<li>
<p><a href="http://download.oracle.com/javaee/6/tutorial/doc/gjbnr.html">Java EE 6 教程第五部分：面向 Java EE 平台的上下文和依赖关系注入</a></p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=299">JSR 299：上下文和依赖关系注入规范</a></p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=316">JSR 316：Java Platform、Enterprise Edition 6 规范</a></p>
</li>
</ul>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/cdi-validate_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
