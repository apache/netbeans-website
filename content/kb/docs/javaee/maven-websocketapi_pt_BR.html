
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Usando a API do WebSocket em uma Aplicação Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Usando a API do WebSocket em uma Aplicação Web - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Usando a API do WebSocket em uma Aplicação Web">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Usando a API do WebSocket em uma Aplicação Web</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/maven-websocketapi_pt_BR.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_criando_o_projeto_de_aplicação_web">Criando o Projeto de Aplicação Web</a></li>
<li><a href="#_criando_o_ponto_final_do_websocket">Criando o Ponto Final do WebSocket</a>
<ul class="sectlevel2">
<li><a href="#_criando_o_ponto_final">Criando o Ponto Final</a></li>
<li><a href="#_iniciar_a_sessão_de_websocket">Iniciar a Sessão de WebSocket</a></li>
<li><a href="#_testando_o_ponto_final">Testando o Ponto Final</a></li>
</ul>
</li>
<li><a href="#_criando_o_quadro_de_comunicação">Criando o Quadro de Comunicação</a>
<ul class="sectlevel2">
<li><a href="#_adicionar_a_tela_à_página_web">Adicionar a Tela à Página Web</a></li>
<li><a href="#_criando_o_pojo">Criando o POJO</a></li>
<li><a href="#_criar_uma_classe_de_coordenadas">Criar uma Classe de Coordenadas</a></li>
<li><a href="#_gerar_a_string_json">Gerar a String JSON</a></li>
<li><a href="#_implementar_as_interfaces_do_codificador_e_do_decodificador">Implementar as Interfaces do Codificador e do Decodificador</a></li>
<li><a href="#_executando_a_aplicação">Executando a Aplicação</a></li>
</ul>
</li>
<li><a href="#_enviando_dados_binários_para_o_ponto_final">Enviando Dados Binários para o Ponto Final</a></li>
<li><a href="#_consulte_também">Consulte Também</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Este tutorial demonstra como criar uma aplicação Web simples que permite colaboração entre browsers do cliente que estão conectados a uma aplicação do servidor único. Quando um usuário desenha um elemento gráfico em uma tela no browser do cliente, o elemento aparece na tela de todos os clientes conectados. Como isso funciona? Quando o browser carrega a página Web um script do cliente envia uma solicitação de handshake de WebSocket para o servidor de aplicações. A aplicação pode aceitar mensagens binárias e de JSON dos clientes conectados na sessão e transmitir as mensagens para todos os clientes conectados.</p>
</div>
<div class="paragraph">
<p>Neste tutorial você criará uma aplicação web que usa Java API para WebSocket (<a href="http://www.jcp.org/en/jsr/detail?id=356">JSR 356</a>) para ativar a comunicação bidirecional entre clientes do browser e o servidor de aplicações. Java API para WebSocket fornece suporte para criar componentes de WebSocket Java e interceptar eventos de WebSocket e criar e consumir texto e mensagens binárias de WebSocket. O tutorial também demonstra como você usa a API de Java para Processamento de JSON (<a href="http://jcp.org/en/jsr/detail?id=353">JSR 353</a>) para produzir e consumir JSON. Java API para WebSocket e a API Java para Processamento de JSON fazem parte da plataforma Java EE 7 (<a href="http://jcp.org/en/jsr/detail?id=342">JSR 342</a>).</p>
</div>
<div class="paragraph">
<p>A aplicação contém um ponto final de WebSocket e interfaces do decodificador e do codificador, uma página Web e alguns arquivos de JavaScript que são executados no browser do cliente quando a página for carregada ou quando chamada de um form na página Web. Você implantará a aplicação para GlassFish Server Open Source Edition 4, a implementação de referência da tecnologia Java EE 7.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Este tutorial é baseado no blog <a href="https://blogs.oracle.com/arungupta/entry/collaborative_whiteboard_using_websocket_in">+ Collaborative Whiteboard using WebSocket in GlassFish 4 - Text/JSON and Binary/ArrayBuffer Data Transfer (TOTD #189) (Quadro de Comunicação sobre como usar WebSocket no GlassFish 4 - Texto/JSON e Transferência de Dados/Binário/ArrayBuffer (TOTD #189)) ] e em outros blogs que podem ser encontrados no link:http://blog.arungupta.me/[+blog de Arun Gupta</a>. Certifique-se de visitar o blog e ver muitas outras entradas excelentes sobre como trabalhar com a API de WebSocket e com o GlassFish 4.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Você também pode assistir ao <a href="maven-websocketapi-screencast.html">Vídeo Usando a API do WebSocket em uma Aplicação Web</a>.</p>
</div>
<div class="paragraph">
<p><strong>Exercícios do Tutorial</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Exercise_1">Criando o Projeto de Aplicação Web</a></p>
</li>
<li>
<p><a href="#createendpoint">Criando o Ponto Final do WebSocket</a></p>
</li>
<li>
<p><a href="#createendpoint1">Criar o Ponto Final</a></p>
</li>
<li>
<p><a href="#createendpoint2">Iniciar a Sessão de WebSocket</a></p>
</li>
<li>
<p><a href="#createendpoint3">Testar o Ponto Final</a></p>
</li>
<li>
<p><a href="#createwhiteboard">Criando o Quadro de Comunicação</a></p>
</li>
<li>
<p><a href="#createwhiteboard1">Adicionar a Tela</a></p>
</li>
<li>
<p><a href="#createwhiteboard2">Criar o POJO</a></p>
</li>
<li>
<p><a href="#createwhiteboard3">Criar uma Classe de Coordenadas</a></p>
</li>
<li>
<p><a href="#createwhiteboard6">Gerar a String JSON</a></p>
</li>
<li>
<p><a href="#createwhiteboard4">Implementar as Interfaces do Codificador e do Decodificador</a></p>
</li>
<li>
<p><a href="#createwhiteboard5">Executar a Aplicação</a></p>
</li>
<li>
<p><a href="#sendbinary">Enviando Dados Binários para o Ponto Final</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Para seguir este tutorial, são necessários os recursos e o software a seguir.</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software ou Recurso</th>
<th class="tableblock halign-left valign-top">Versão Necessária</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/downloads/index.html">NetBeans IDE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versão Java EE 7.3.1, 7.4, 8.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK (Java Development Kit)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">versão 7 ou 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://glassfish.java.net/">GlassFish Server Open Source Edition</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
O GlassFish 4 está incluído no pacote de downloads do Java EE do NetBeans IDE.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Pré-requisitos</strong></p>
</div>
<div class="paragraph">
<p>Este tutorial pressupõe que você tenha algum conhecimento básico das tecnologias a seguir, ou alguma experiência de programação com elas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Programação em Java</p>
</li>
<li>
<p>Programação de JavaScript/HTML</p>
</li>
<li>
<p>NetBeans IDE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Antes de começar este tutorial, talvez você queira se familiarizar com a documentação a seguir.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/MavenBestPractices">Melhores Práticas para o Apache Maven no NetBeans IDE</a></p>
</li>
<li>
<p><a href="http://books.sonatype.com/mvnref-book/reference/introduction.html">Capítulo 1. Introdução ao Apache Maven</a> (do <a href="http://books.sonatype.com/mvnref-book/reference/index.html">+Maven: A Referência Completa +</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Você pode fazer download <a href="https://netbeans.org/projects/samples/downloads/download/Samples/JavaEE/WhiteboardApp.zip">de um arquivo compactado zip do projeto finalizado</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_criando_o_projeto_de_aplicação_web">Criando o Projeto de Aplicação Web</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O objetivo deste exercício é criar um projeto de aplicação Web usando o assistente Novo Projeto noIDE. Quando você criar o projeto irá selecionar Java EE 7 como a versão do Java EE e GlassFish 4 como o servidor de aplicações. O GlassFish 4 é a implementação de referência da plataforma Java EE 7. Você deve ter um servidor de aplicações que suporta Java EE 7 registrado com o IDE para criar a aplicação neste tutorial.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selecione Arquivo &gt; Novo Projeto (Ctrl-Shift-N no Windows, ⌘-Shift-N no Mac) no menu principal.</p>
</li>
<li>
<p>Selecione Aplicação Web na categoria Maven. Clique em Próximo.</p>
</li>
<li>
<p>Digite <strong>WhiteboardApp</strong> como nome do projeto e defina a Localização do Projeto.</p>
</li>
<li>
<p>Digite <strong>org.sample</strong> para o Id do Grupo. Clique em Próximo.</p>
</li>
<li>
<p>Selecione <strong>GlassFish Server 4.0</strong> para o Servidor.</p>
</li>
<li>
<p>Defina a Versão do Java EE como <strong>Java EE 7 Web</strong>. Clique em Finalizar.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-newproject.png" alt="websocket newproject">
</div>
<div class="title">Figure 1. Versões de servidor e Java EE no assistente de Novo Projeto</div>
</div>
<div class="paragraph">
<p>Quando você clica em Finalizar, o IDE cria o projeto e o abre na janela Projetos.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_criando_o_ponto_final_do_websocket">Criando o Ponto Final do WebSocket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nesta seção você criará uma classe e um ponto final de WebSocket e um arquivo JavaScript. A classe do ponto final de WebSocket contém alguns métodos básicos que são executados quando a sessão for aberta. Em seguida, você irá criar um arquivo JavaScript que iniciará o handshake com o servidor quando a página for carregada. Você irá então executar a aplicação para testar se a conexão foi bem-sucedida.</p>
</div>
<div class="paragraph">
<p>Para obter mais informações sobre como usar APIs e anotações de WebSocket, consulte o resumo do pacote <a href="https://javaee-spec.java.net/nonav/javadocs/javax/websocket/package-summary.html">+ javax.websocket +</a>.</p>
</div>
<div class="sect2">
<h3 id="_criando_o_ponto_final">Criando o Ponto Final</h3>
<div class="paragraph">
<p>Neste exercício você usará usar um assistente no IDE para ajudá-lo a criar a classe do ponto final de WebSocket.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó Pacotes do Código-fonte na janela Projetos e selecione Novo &gt; Outro.</p>
</li>
<li>
<p>Selecione Ponto Final de WebSocket na categoria Web. Clique em Próximo.</p>
</li>
<li>
<p>Digite <strong>MyWhiteboard</strong> como o Nome da Classe.</p>
</li>
<li>
<p>Selecione  <code>org.sample.whiteboardapp</code>  na lista drop-down Pacote.</p>
</li>
<li>
<p>Digite <strong>/whiteboardendpoint</strong> como o URI de WebSocket. Clique em Finalizar.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-newendpoint.png" alt="websocket newendpoint">
</div>
<div class="title">Figure 2. Ponto Final de WebSocket no assistente Novo Arquivo</div>
</div>
<div class="paragraph">
<p>Quando você clica em Finalizar, o IDE gera a classe Ponto Final do WebSocket e abre a classe no editor de código-fonte. No editor, você pode ver que o IDE gerou algumas anotações que são parte da API do WebSocket. A classe é anotada com  <code><a href="https://javaee-spec.java.net/nonav/javadocs/javax/websocket/server/ServerEndpoint.html">+@ServerEndpoint+</a></code>  para identificar a classe como um ponto final e o URI do WebSocket é especificado como um parâmetro da anotação. O IDE também gerou um método  <code>onMessage</code>  default que é anotado com  <code><a href="https://javaee-spec.java.net/nonav/javadocs/javax/websocket/OnMessage.html">+@onmessage+</a></code> . Um método anotado com  <code>@onmessage</code>  é chamado cada vez que o cliente recebe uma mensagem de WebSocket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@ServerEndpoint("/whiteboardendpoint")
public class MyWhiteboard {

    @OnMessage
    public String onMessage(String message) {
        return null;
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione os campos a seguir (em <strong>negrito</strong>) à classe.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@ServerEndpoint("/whiteboardendpoint")
public class MyWhiteboard {
    *private static Set&lt;Session&gt; peers = Collections.synchronizedSet(new HashSet&lt;Session&gt;());*

    @OnMessage
    public String onMessage(String message) {
        return null;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione os seguintes métodos  <code>onOpen</code>  e  <code>onClose</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    @OnOpen
    public void onOpen (Session peer) {
        peers.add(peer);
    }

    @OnClose
    public void onClose (Session peer) {
        peers.remove(peer);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Você pode ver que os métodos  <code>onOpen</code>  e  <code>onClose</code>  são anotados com as anotações da API de WebSocket  <code><a href="https://javaee-spec.java.net/nonav/javadocs/javax/websocket/OnOpen.html">+@OnOpen+</a></code>  e  <code><a href="https://javaee-spec.java.net/nonav/javadocs/javax/websocket/OnClose.html">+@OnClose+</a></code> . Um método anotado com  <code>@OnOpen</code>  é chamado quando a sessão de web socket é aberta. Neste exemplo, o método  <code>onOpen</code>  anotado adiciona o cliente do browser ao grupo de colegas da sessão atual e o método  <code>onClose</code>  remove o browser do grupo.</p>
</div>
<div class="paragraph">
<p>Use as dicas e a funcionalidade autocompletar código no editor de código-fonte para ajudá-lo a gerar os métodos. Clique no glifo de dicas na margem esquerda próxima à declaração de classe (ou coloque o cursor na declaração de classe e clique em Alt-Enter) e selecione o método no menu pop-up. A funcionalidade autocompletar código pode ajudá-lo a codificar o método.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-endpoint-hint.png" alt="websocket endpoint hint">
</div>
<div class="title">Figure 3. Dica do Código no Editor de Código-fonte</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no editor e selecione Corrigir Importações (Alt-Shift-I; ⌘-Shift-I no Mac). Salve as alterações.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Você verá que as instruções de importação das classes no  <code>javax.websocket</code>  foram adicionadas ao arquivo.</p>
</div>
<div class="paragraph">
<p>O ponto final agora foi criado. Agora você precisará criar um arquivo JavaScript para iniciar a sessão WebSocket.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iniciar_a_sessão_de_websocket">Iniciar a Sessão de WebSocket</h3>
<div class="paragraph">
<p>Neste exercício você criará um arquivo JavaScript que iniciará uma sessão de WebSocket. O cliente do browser junta-se a uma sessão por meio de um 'handshake' HTTP com o servidor em TCP. No arquivo JavaScript você especificará o nome do  <code>wsURI</code>  do ponto final e declarará o WebSocket. O esquema do URI  <code>wsURI</code>  faz parte do protocolo de WebSocket e especifica o caminho para o ponto final da aplicação.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó do projeto na janela Projetos e escolha Novo &gt; Outro.</p>
</li>
<li>
<p>Selecione o Arquivo JavaScript na categoria Web do assistente Novo Arquivo. Clique em Próximo.</p>
</li>
<li>
<p>Digite <strong>websocket</strong> para o Nome do Arquivo JavaScript. Clique em Finalizar.</p>
</li>
<li>
<p>Adicione o seguinte ao arquivo JavaScript.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">var wsUri = "ws://" + document.location.host + document.location.pathname + "whiteboardendpoint";
var websocket = new WebSocket(wsUri);

websocket.onerror = function(evt) { onError(evt) };

function onError(evt) {
    writeToScreen('&lt;span style="color: red;"&gt;ERROR:&lt;/span&gt; ' + evt.data);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este script iniciará o handshake da sessão com o servidor quando  <code>websocket.js</code>  for carregado pelo browser.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>index.html</code>  e adicione o seguinte código (em <strong>negrito</strong>) na parte inferior do arquivo para carregar  <code>websocket.js</code>  quando a página terminar de carregar.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;body&gt;
    *&lt;h1&gt;Collaborative Whiteboard App&lt;/h1&gt;

    &lt;script type="text/javascript" src="websocket.js"&gt;&lt;/script&gt;*
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora você pode testar se o ponto final do WebSocket está trabalhando e se a sessão foi iniciada e o cliente adicionado à sessão.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testando_o_ponto_final">Testando o Ponto Final</h3>
<div class="paragraph">
<p>Neste exercício você adicionará alguns métodos simples ao arquivo JavaScript para imprimir o  <code>wsURI</code>  na janela do browser quando o browser for conectado ao ponto final.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione a seguinte tag  <code>&lt;div&gt;</code>  (em <strong>negrito</strong>) para  <code>index.html</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;h1&gt;Collaborative Whiteboard App&lt;/h1&gt;

*&lt;div id="output"&gt;&lt;/div&gt;*
&lt;script type="text/javascript" src="websocket.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione a seguinte declaração e métodos ao  <code>websocket.js</code> . Salve as alterações.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">// For testing purposes
var output = document.getElementById("output");
websocket.onopen = function(evt) { onOpen(evt) };

function writeToScreen(message) {
    output.innerHTML += message + "&lt;br&gt;";
}

function onOpen() {
    writeToScreen("Connected to " + wsUri);
}
// End test functions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quando a página carregar as funções de JavaScript imprimirá a mensagem que o browser está conectado ao ponto final. Você pode deletar as funções depois que confirmar se o ponto final está executando corretamente.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse na janela Projetos e selecione Executar.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Quando você executar a aplicação, o IDE iniciará o GlassFish server e construirá e implantará a aplicação. A página de índice será aberta no seu browser e você verá a seguinte mensagem na janela do browser.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-browser1.png" alt="websocket browser1">
</div>
<div class="title">Figure 4. Conectado à mensagem do ponto final na janela do browser</div>
</div>
<div class="paragraph">
<p>Na janela do browser você pode ver o seguinte ponto final no qual as mensagens serão aceitas:  <code><a href="http://localhost:8080/WhiteboardApp/whiteboardendpoint" class="bare">http://localhost:8080/WhiteboardApp/whiteboardendpoint</a></code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_criando_o_quadro_de_comunicação">Criando o Quadro de Comunicação</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nesta seção você criará as classes e os arquivos JavaScript para enviar e receber mensagens de texto de JSON. Você também adicionará um elemento <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html">Tela HTML5</a> para exibição de conteúdo e  <code>&lt;form&gt;</code>  HTML com botões de rádio que permitem que você especifique o formato e cor do pincel.</p>
</div>
<div class="sect2">
<h3 id="_adicionar_a_tela_à_página_web">Adicionar a Tela à Página Web</h3>
<div class="paragraph">
<p>Neste exercício você adicionar um elemento  <code>canvas</code>  e um elemento  <code>form</code>  à página do índice default. As caixas de seleção no form determinam as propriedades do pincel da tela.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>index.html</code>  no editor de código-fonte.</p>
</li>
<li>
<p>Delete a tag  <code>&lt;div&gt;</code>  que você adicionou para testar o ponto final e adicione os seguintes elementos  <code>&lt;table&gt;</code>  e  <code>&lt;form&gt;</code>  (em <strong>bold</strong>) após abrir a tag do corpo.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;h1&gt;Collaborative Whiteboard App&lt;/h1&gt;

    *&lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;
            &lt;/td&gt;
            &lt;td&gt;
                &lt;form name="inputForm"&gt;


                &lt;/form&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;*
    &lt;script type="text/javascript" src="websocket.js"&gt;&lt;/script&gt;
    &lt;/body&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione o seguinte código (em <strong>negrito</strong>) ao elemento canvas.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    *&lt;canvas id="myCanvas" width="150" height="150" style="border:1px solid #000000;"&gt;&lt;/canvas&gt;*
                &lt;/td&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione a seguinte  <code>&lt;table&gt;</code>  para adicionar os botões de rádio para selecionar a cor e o formato. Salve as alterações.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;canvas id="myCanvas" width="150" height="150" style="border:1px solid #000000;"&gt;&lt;/canvas&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;form name="inputForm"&gt;
                        *&lt;table&gt;

                            &lt;tr&gt;
                                &lt;th&gt;Color&lt;/th&gt;
                                &lt;td&gt;&lt;input type="radio" name="color" value="#FF0000" checked="true"&gt;Red&lt;/td&gt;
                                &lt;td&gt;&lt;input type="radio" name="color" value="#0000FF"&gt;Blue&lt;/td&gt;
                                &lt;td&gt;&lt;input type="radio" name="color" value="#FF9900"&gt;Orange&lt;/td&gt;
                                &lt;td&gt;&lt;input type="radio" name="color" value="#33CC33"&gt;Green&lt;/td&gt;
                            &lt;/tr&gt;

                            &lt;tr&gt;
                                &lt;th&gt;Shape&lt;/th&gt;
                                &lt;td&gt;&lt;input type="radio" name="shape" value="square" checked="true"&gt;Square&lt;/td&gt;
                                &lt;td&gt;&lt;input type="radio" name="shape" value="circle"&gt;Circle&lt;/td&gt;
                                &lt;td&gt; &lt;/td&gt;
                                &lt;td&gt; &lt;/td&gt;
                            &lt;/tr&gt;

                        &lt;/table&gt;*
                    &lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O formato, cor e coordenadas de qualquer figura desenhada na tela serão convertidos em uma string em uma estrutura JSON e enviadas como uma mensagem ao ponto final de WebSocket.</p>
</div>
</div>
<div class="sect2">
<h3 id="_criando_o_pojo">Criando o POJO</h3>
<div class="paragraph">
<p>Neste exercício você criará um POJO simples.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó do projeto e selecione Novo &gt; Classe Java.</p>
</li>
<li>
<p>Digite <strong>Figura</strong> como o Nome da Classe e escolha  <code>org.sample.whiteboardapp</code>  na lista drop-down Pacote. Clique em Finalizar.</p>
</li>
<li>
<p>No editor de origem, adicione o seguinte (em <strong>negrito</strong>):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class Figure {
    *private JsonObject json;*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quando você adicionar o código será solicitado que adicione uma instrução de importação para  <code>javax.json.jsonobject</code> . Se não for solicitado, digite Alt-Enter.</p>
</div>
<div class="paragraph">
<p>Para obter mais informações sobre  <code>javax.json.JsonObject</code> , consulte Java API para Processamento de JSON (<a href="http://jcp.org/en/jsr/detail?id=353">JSR 353</a>), que faz parte da Especificação Java EE 7.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Criar um getter e setter para  <code>json</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Você pode selecionar getter e setter no menu pop-up Inserir Código (Alt-Ins no Windows; Ctrl-I no Mac) para abrir a caixa de diálogo Gerar Getters e Setter. Se preferir, você pode escolher Origem &gt; Inserir Código no menu principal.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-generategetter.png" alt="websocket generategetter">
</div>
<div class="title">Figure 5. Caixa de diálogo Gerar Getter e Setter</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione um construtor para  <code>json</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    public Figure(JsonObject json) {
        this.json = json;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Você pode escolher Construtor no menu pop-up Inserir Código (Ctrl-I).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-generateconstructor.png" alt="websocket generateconstructor">
</div>
<div class="title">Figure 6. Menu pop-up Gerar Construtor</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione o método  <code>toString</code>  a seguir:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    @Override
    public String toString() {
        StringWriter writer = new StringWriter();
        Json.createWriter(writer).write(json);
        return writer.toString();
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no editor e selecione Corrigir Importações (Alt-Shift-I; ⌘-Shift-I no Mac). Salve as alterações.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_criar_uma_classe_de_coordenadas">Criar uma Classe de Coordenadas</h3>
<div class="paragraph">
<p>Agora você cria uma classe para as coordenadas das figuras que são pintadas na tela.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó do projeto e selecione Novo &gt; Classe Java.</p>
</li>
<li>
<p>No assistente Nova Classe Java, digite <strong>Coordinadas</strong> como o Nome da Classe e selecione  <code>org.sample.whiteboardapp</code>  na lista drop-down Pacote. Clique em Finalizar.</p>
</li>
<li>
<p>No editor de Código-fonte, adicione o seguinte código. Salve as alterações.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    private float x;
    private float y;

    public Coordinates() {
    }

    public Coordinates(float x, float y) {
        this.x = x;
        this.y = y;
    }

    public float getX() {
        return x;
    }

    public void setX(float x) {
        this.x = x;
    }

    public float getY() {
        return y;
    }

    public void setY(float y) {
        this.y = y;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A classe só contém campos para as coordenadas  <code>x</code>  e  <code>y</code>  e alguns getters e setters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gerar_a_string_json">Gerar a String JSON</h3>
<div class="paragraph">
<p>Neste exercício você criará um arquivo JavaScript que coloca os detalhes da figura que é desenhada no elemento  <code>canvas</code>  para uma estrutura JSON que é enviada para o ponto final do websocket.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito no nó e escolha Novo &gt; Arquivo JavaScript para abrir o assistente Novo Arquivo JavaScript.</p>
</li>
<li>
<p>Digite <strong>quadro de comunicações</strong> para Nome do Arquivo. Clique em Finalizar.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Quando você clica em Finalizar, o IDE cria o arquivo JavaScript vazio e o abre no editor. Você pode ver o novo arquivo no nó Páginas Web, na janela Projetos.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione o seguinte código para iniciar a tela e adicionar um listener de evento.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">var canvas = document.getElementById("myCanvas");
var context = canvas.getContext("2d");
canvas.addEventListener("click", defineImage, false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Você pode ver que o método  <code>defineImage</code>  é chamado quando o usuário clica no elemento  <code>canvas</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione os seguintes métodos  <code>getCurrentPos</code> ,  <code>defineImage</code>  e  <code>drawImageText</code>  para construir a estrutura JSON e enviá-la ao ponto final ( <code>sendText(json)</code> ).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">function getCurrentPos(evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}

function defineImage(evt) {
    var currentPos = getCurrentPos(evt);

    for (i = 0; i &lt; document.inputForm.color.length; i++) {
        if (document.inputForm.color[i].checked) {
            var color = document.inputForm.color[i];
            break;
        }
    }

    for (i = 0; i &lt; document.inputForm.shape.length; i++) {
        if (document.inputForm.shape[i].checked) {
            var shape = document.inputForm.shape[i];
            break;
        }
    }

    var json = JSON.stringify({
        "shape": shape.value,
        "color": color.value,
        "coords": {
            "x": currentPos.x,
            "y": currentPos.y
        }
    });
    drawImageText(json);
        sendText(json);
}

function drawImageText(image) {
    console.log("drawImageText");
    var json = JSON.parse(image);
    context.fillStyle = json.color;
    switch (json.shape) {
    case "circle":
        context.beginPath();
        context.arc(json.coords.x, json.coords.y, 5, 0, 2 * Math.PI, false);
        context.fill();
        break;
    case "square":
    default:
        context.fillRect(json.coords.x, json.coords.y, 10, 10);
        break;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A estrutura JSON que é enviada será semelhante à seguinte:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">{
 "shape": "square",
 "color": "#FF0000",
 "coords": {
 "x": 31.59999942779541,
 "y": 49.91999053955078
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora você precisa adicionar um método  <code>sendText(json)</code>  para enviar uma string JSON usando  <code>websocket.send()</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>websocket.js</code>  no editor e adicione os seguintes métodos para enviar JSON ao ponto final e para desenhar a imagem quando uma mensagem for recebida do ponto final.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">websocket.onmessage = function(evt) { onMessage(evt) };

function sendText(json) {
    console.log("sending text: " + json);
    websocket.send(json);
}

function onMessage(evt) {
    console.log("received: " + evt.data);
    drawImageText(evt.data);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Você pode deletar o código adicionado ao  <code>websocket.js</code>  para testar o ponto final.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione a seguinte linha (em <strong>negrito</strong>) na parte inferior de  <code>index.html</code>  para carregar o  <code>whiteboard.js</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">        &lt;/table&gt;
    &lt;script type="text/javascript" src="websocket.js"&gt;&lt;/script&gt;
    *&lt;script type="text/javascript" src="whiteboard.js"&gt;&lt;/script&gt;*
&lt;body&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementar_as_interfaces_do_codificador_e_do_decodificador">Implementar as Interfaces do Codificador e do Decodificador</h3>
<div class="paragraph">
<p>Neste exercício você cria classes para implementar interfaces do decodificador e do codificador para decodificar mensagens do web socket (JSON) para a classe POJO  <code>Figura</code>  e para codificar a <code>Figura</code>  como uma string JSON para enviar ao ponto final.</p>
</div>
<div class="paragraph">
<p>Para obter mais detalhes, consulte a seção sobre tipos de mensagem e codificadores e decodificadores no artito técnico <a href="http://www.oracle.com/technetwork/articles/java/jsr356-1937161.html">JSR 356, Java API para WebSocket</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó do projeto e selecione Novo &gt; Classe Java.</p>
</li>
<li>
<p>Digite <strong>FigureEncoder</strong> como o Nome da Classe e escolha  <code>org.sample.whiteboardapp</code>  na lista drop-down Pacote. Clique em Finalizar.</p>
</li>
<li>
<p>No editor de código-fonte, implemente a interface Codificador do WebSocket adicionando o seguinte código (em <strong>negrito</strong>):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FigureEncoder *implements Encoder.Text&lt;Figure&gt;* {

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione uma instrução de importação para  <code>javax.websocket.Encoder</code>  e implemente os métodos abstratos.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Coloque o cursor na declaração de classe e digite Alt-Enter e selecione <strong>Implementar todos os métodos abstratos</strong> no menu pop-up.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modifique os métodos abstratos gerados fazendo as seguintes alterações (em <strong>negrito</strong>). Salve as alterações.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    @Override
    public String encode(Figure *figure*) throws EncodeException {
        *return figure.getJson().toString();*
    }

    @Override
    public void init(EndpointConfig ec) {
        *System.out.println("init");*
    }

    @Override
    public void destroy() {
        *System.out.println("destroy");*
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no nó do projeto e selecione Novo &gt; Classe Java.</p>
</li>
<li>
<p>Digite <strong>FigureEncoder</strong> como o Nome da Classe e escolha  <code>org.sample.whiteboardapp</code>  na lista drop-down Pacote. Clique em Finalizar.</p>
</li>
<li>
<p>No editor de código-fonte, implemente a interface Decodificador do WebSocket adicionando o seguinte código (em <strong>negrito</strong>):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class FigureDecoder *implements Decoder.Text&lt;Figure&gt;* {

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione uma instrução de importação para  <code>javax.websocket.Decoder</code>  e implemente os métodos abstratos.</p>
</li>
<li>
<p>Faça as seguintes alterações (em <strong>negrito</strong>) para os métodos abstratos gerados.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    @Override
    public Figure decode(String *string*) throws DecodeException {
        *JsonObject jsonObject = Json.createReader(new StringReader(string)).readObject();
        return  new Figure(jsonObject);*
    }

    @Override
    public boolean willDecode(String *string*) {
        *try {
            Json.createReader(new StringReader(string)).readObject();
            return true;
        } catch (JsonException ex) {
            ex.printStackTrace();
            return false;
        }*

    }

    @Override
    public void init(EndpointConfig ec) {
        *System.out.println("init");*
    }

    @Override
    public void destroy() {
        *System.out.println("destroy");*
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Corrija as importações e salve as alterações.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Agora você precisa modificar  <code>MyWhiteboard.java</code>  para especificar o codificador e o decodificador.</p>
</div>
</div>
<div class="sect2">
<h3 id="_executando_a_aplicação">Executando a Aplicação</h3>
<div class="paragraph">
<p>Agora você está quase pronto para executar a aplicação. Neste exercício você modifica a classe do ponto final do WebSocket para especificar o codificador e o decodificador para a string JSON e adicionar um método para enviar a string JSON aos clientes conectados quando uma mensagem for recebida.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>MyWhiteboard.java</code>  no editor.</p>
</li>
<li>
<p>Modifique a anotação  <code>@ServerEndpoint</code>  para especificar o codificador e o decodificador do ponto final. Observe que você precisa especificar explicitamente o parâmetro  <code>valor</code>  para o nome do ponto final.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@ServerEndpoint(*value=*"/whiteboardendpoint"*, encoders = {FigureEncoder.class}, decoders = {FigureDecoder.class}*)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete o método  <code>onMessage</code>  que foi gerado por default.</p>
</li>
<li>
<p>Adicione o seguinte método  <code>broadcastFigure</code>  e anote o método com  <code>@OnMessage</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    @OnMessage
    public void broadcastFigure(Figure figure, Session session) throws IOException, EncodeException {
        System.out.println("broadcastFigure: " + figure);
        for (Session peer : peers) {
            if (!peer.equals(session)) {
                peer.getBasicRemote().sendObject(figure);
            }
        }
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique com o botão direito do mouse no editor e selecione Corrigir Importações (Alt-Shift-I; ⌘-Shift-I no Mac). Salve as alterações.</p>
</li>
<li>
<p>Clique com o botão direito do mouse na janela Projetos e selecione Executar.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Quando você clicar em Executar, o IDE abre uma janela do browser para <a href="http://localhost:8080/WhiteboardApp/">http://localhost:8080/WhiteboardApp/</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Talvez você precise cancelar a implantação da aplicação anterior do servidor de aplicações ou forçar a recarga da página no browser.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Se você exibir as mensagens do browser poderá ver que uma string é enviada por meio de JSON para o ponto final, cada vez que você clicar na tela.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-onebrowser.png" alt="websocket onebrowser">
</div>
<div class="title">Figure 7. Canvas com figuras no browser e JSON exibido na console web</div>
</div>
<div class="paragraph">
<p>Se você abrir outro browser para  <code><a href="http://localhost:8080/WhiteboardApp/" class="bare">http://localhost:8080/WhiteboardApp/</a></code>  você verá que cada vez que você clicar na tela em um browser, o novo círculo ou quadrado é reproduzido na tela de outro browser.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-twobrowsers.png" alt="websocket twobrowsers">
</div>
<div class="title">Figure 8. Dois browsers enviando JSON por meio do ponto final</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enviando_dados_binários_para_o_ponto_final">Enviando Dados Binários para o Ponto Final</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A aplicação agora pode processar e enviar uma string por meio de JSON para o ponto final e a string é, em seguida, enviada para os clientes conectados. Nesta seção você modificará os arquivos JavaScript para enviar e receber dados binários.</p>
</div>
<div class="paragraph">
<p>Para enviar os dados binários para o ponto final, é necessário definir a propriedade  <code>binaryType</code>  do WebSocket para  <code>arraybuffer</code> . Isso garante que quaisquer transferências binárias que usam o WebSocket são feitas usando  <code>ArrayBuffer</code> . A conversão de dados binários é executada pelo método  <code>defineImageBinary</code>  em  <code>whiteboard.js</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>websocket.js</code>  e adicione o seguinte código para definir a propriedade  <code>binaryType</code>  de WebSocket para  <code>arraybuffer</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">websocket.binaryType = "arraybuffer";</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione o seguinte método para enviar dados binários para o ponto final.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">function sendBinary(bytes) {
    console.log("sending binary: " + Object.prototype.toString.call(bytes));
    websocket.send(bytes);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modifique o método  <code>onMessage</code>  para adicionar o seguinte código (em <strong>negrito</strong>) para selecionar o método para atualizar a tela, de acordo com o tipo de dados na mensagem de entrada.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">function onMessage(evt) {
    console.log("received: " + evt.data);
    *if (typeof evt.data == "string") {*
        drawImageText(evt.data);
    *} else {
        drawImageBinary(evt.data);
    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O método  <code>drawImageBinary</code>  é chamado se uma mensagem com dados binários for recebida.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>whiteboard.js</code>  e adicione os seguintes métodos. O método  <code>drawImageBinary</code>  é chamado para atualizar a tela após fazer parse dos dados binários de entrada. O método  <code>defineImageBinary</code>  é usado para preparar um snapshot da tela como dados binários.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">function drawImageBinary(blob) {
    var bytes = new Uint8Array(blob);
//    console.log('drawImageBinary (bytes.length): ' + bytes.length);

    var imageData = context.createImageData(canvas.width, canvas.height);

    for (var i=8; i&lt;imageData.data.length; i++) {
        imageData.data[i] = bytes[i];
    }
    context.putImageData(imageData, 0, 0);

    var img = document.createElement('img');
    img.height = canvas.height;
    img.width = canvas.width;
    img.src = canvas.toDataURL();
}

function defineImageBinary() {
    var image = context.getImageData(0, 0, canvas.width, canvas.height);
    var buffer = new ArrayBuffer(image.data.length);
    var bytes = new Uint8Array(buffer);
    for (var i=0; i&lt;bytes.length; i++) {
        bytes[i] = image.data[i];
    }
    sendBinary(buffer);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora você precisa adicionar uma forma de chamar  <code>defineImageBinary</code>  quando quiser gerar dados como o tipo  <code>ArrayBuffer</code>  e enviá-los ao ponto final.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>index.html</code>  e modifique o elemento  <code>&lt;table&gt;</code>  para adicionar a seguinte linha à tabela do form.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;tr&gt;
    &lt;th&gt; &lt;/th&gt;
    &lt;td&gt;&lt;input type="submit" value="Send Snapshot" onclick="defineImageBinary(); return false;"&gt;&lt;/td&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt; &lt;/td&gt;
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A nova linha contém um botão Enviar Snapshot para enviar um snapshot binário da tela para os colegas conectados. O método  <code>defineImageBinary</code>  em  <code>whiteboard.js</code>  será chamado quando o botão for clicado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>MyWhiteboard.java</code>  e adicione o seguinte método que enviará os dados binários aos colegas quando o ponto final receber uma mensagem com dados binários.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@OnMessage
public void broadcastSnapshot(ByteBuffer data, Session session) throws IOException {
    System.out.println("broadcastBinary: " + data);
    for (Session peer : peers) {
        if (!peer.equals(session)) {
            peer.getBasicRemote().sendBinary(data);
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Será necessário adicionar uma instrução de importação em  <code>java.nio.ByteBuffer</code> .
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Você pode modificar a aplicação para permitir que o usuário interrompa o envio de dados ao ponto final. Por default, todos os colegas são conectados assim que abrem a página e os dados são enviados do browser para todos os colegas conectados. Você pode adicionar uma condicional simples, de forma que os dados não sejam enviados ao ponto final, a menos que a opção seja selecionada. Isso não afeta o recebimento de dados. Os dados ainda são recebidos do ponto final.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modifique o método  <code>defineImage</code>  em  <code>whiteboard.js</code>  para adicionar o seguinte código (em <strong>negrito</strong>).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">        drawImageText(json);
*    if (document.getElementById("instant").checked) {*
        sendText(json);
*    }*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código condicional que você verifica se o elemento com o id for  <code>verificado</code></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Abra  <code>index.html</code>  e modifique o elemento  <code>&lt;table&gt;</code>  para adicionar uma caixa de seleção ao form.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;tr&gt;
    &lt;th&gt; &lt;/th&gt;
    &lt;td&gt;&lt;input type="submit" value="Send Snapshot" onclick="defineImageBinary(); return false;"&gt;&lt;/td&gt;
    &lt;td&gt;*&lt;input type="checkbox" id="instant" value="Online" checked="true"&gt;Online*&lt;/td&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt; &lt;/td&gt;
&lt;/tr&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Os dados não são enviados quando a caixa de seleção On-line estiver desmarcada, mas o cliente ainda receberá dados do ponto final.</p>
</div>
<div class="paragraph">
<p>Se você adicionar o botão Enviar Snapshot e a caixa de seleção On-line e executar a aplicação novamente, você verá os novos elementos na página do índice. Se você abrir outro browser e desmarcar o botão On-line você poderá ver que a mensagem JSON não é enviada ao ponto final quando você clicar na tela.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/websocket-onebrowser-binary.png" alt="websocket onebrowser binary">
</div>
<div class="title">Figure 9. Console da web no browser exibindo a mensagem que os dados binários foram enviados</div>
</div>
<div class="paragraph">
<p>Se você clicar em Enviar Snapshot, os dados binários serão enviados para o ponto final e transmitidos para os clientes conectados.</p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Using%20the%20WebSocket%20API%20in%20a%20Web%20Application">Enviar Feedback neste Tutorial</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consulte_também">Consulte Também</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para obter mais informações sobre o uso do NetBeans IDE para desenvolver aplicações Java EE, consulte os seguintes recursos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Demonstração: <a href="maven-websocketapi-screencast.html">+ Usando a API do WebSocket em uma Aplicação Web+</a></p>
</li>
<li>
<p><a href="javaee-intro.html">Introdução à Tecnologia Java EE</a></p>
</li>
<li>
<p><a href="javaee-gettingstarted.html">Conceitos Básicos sobre Aplicações do Java EE</a></p>
</li>
<li>
<p><a href="../../trails/java-ee.html">Trilha de Aprendizado do Java EE e Java Web</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para obter mais informações sobre o uso de Java EE, consulte o <a href="http://download.oracle.com/javaee/6/tutorial/doc/">Tutorial do Java EE</a>.</p>
</div>
<div class="paragraph">
<p>Para enviar comentários e sugestões, obter suporte e se manter informado sobre os mais recentes desenvolvimentos das funcionalidades de desenvolvimento do Java EE do NetBeans IDE, <a href="../../../community/lists/top.html">inscreva-se na lista de correspondência de nbj2ee</a>.</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/javaee/maven-websocketapi_pt_BR.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
