
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>エンドツーエンドのバイナリSOAPアタッチメント(パート3): Webサービスのコーディングおよびテスト</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="エンドツーエンドのバイナリSOAPアタッチメント(パート3): Webサービスのコーディングおよびテスト - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, エンドツーエンドのバイナリSOAPアタッチメント(パート3): Webサービスのコーディングおよびテスト">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">エンドツーエンドのバイナリSOAPアタッチメント(パート3): Webサービスのコーディングおよびテスト</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/websvc/flower-code-ws_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#coding-ws">Webサービスのコーディング</a>
<ul class="sectlevel2">
<li><a href="#retrieve-jpeg-as-bytes">JPEGファイルをバイト配列として取得</a></li>
<li><a href="#read-bytes-as-image">バイト配列をイメージとして読み取る</a></li>
<li><a href="#implement-getflower">getFlowerの実装</a></li>
<li><a href="#create-byte-array-list">すべてのJPEGファイルのバイト配列のリストの作成</a></li>
<li><a href="#implement-getthumbnails">getThumbnailsの実装</a></li>
</ul>
</li>
<li><a href="#test-ws">Webサービスのテスト</a></li>
<li><a href="#_次の手順">次の手順:</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このレッスンでは、Webサービス/セッションBeanクラスにコードを追加し、JPEGファイルのバイト配列への変換と、バイト配列の <code>java.awt.Image</code> オブジェクトへの変換を実行します。また、公開されているWebサービス操作にコードを追加し、これらの <code>Image</code> オブジェクトが返されるようにします。最後に、NetBeans IDEの「Webサービスをテスト」ユーティリティを使用して、Webサービスをブラウザでテストします。</p>
</div>
<div class="paragraph">
<p>Webサービスの完全版サンプルは、<a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FWeb%2520Services%252FWeb%2520Service%2520Passing%2520Binary%2520Data%2520--%2520EE6%252FFlowerAlbumService.zip">NetBeansサンプル・カタログ</a>からダウンロードできます。</p>
</div>
<div class="paragraph">
<p><strong>このチュートリアルのレッスン</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="./flower_overview.html">概要</a></p>
</li>
<li>
<p><a href="flower_ws.html">Webサービスの作成</a></p>
</li>
<li>
<p>&#8658; Webサービスのコーディングおよびテスト</p>
</li>
<li>
<p><a href="./flower_wsdl_schema.html">バイナリ・データを渡すためのスキーマとWSDLファイルの変更</a></p>
</li>
<li>
<p><a href="./flower_swing.html">Swingクライアントの作成</a></p>
</li>
<li>
<p><a href="#coding-ws">Webサービスのコーディング</a></p>
</li>
<li>
<p><a href="#retrieve-jpeg-as-bytes">JPEGファイルをバイト配列として取得</a></p>
</li>
<li>
<p><a href="#read-bytes-as-image">バイト配列をイメージとして読み取る</a></p>
</li>
<li>
<p><a href="#implement-getflower">getFlowerの実装</a></p>
</li>
<li>
<p><a href="#create-byte-array-list">すべてのJPEGファイルのバイト配列のリストの作成</a></p>
</li>
<li>
<p><a href="#implement-getthumbnails">getThumbnailsの実装</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#test-ws">Webサービスのテスト</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coding-ws">Webサービスのコーディング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一連のJPEGファイルとWebサービスが含まれるWebアプリケーションを作成しました。このWebサービスは、ステートレス・セッションBeanとして実装されています。このWebサービスには、2つの空のWeb操作が含まれています。このレッスンでは、Webサービスにコードを追加し、JPEGファイルのバイト配列への変換と、バイト配列の <code>java.awt.Image</code> オブジェクトへの変換を実行します。また、公開されているWebサービス操作にコードを追加し、これらの <code>Image</code> オブジェクトが返されるようにします。</p>
</div>
<div class="sect2">
<h3 id="retrieve-jpeg-as-bytes">JPEGファイルをバイト配列として取得</h3>
<div class="paragraph">
<p>この項では、1組のプライベート・メソッドを <code>FlowerService</code> クラス本文に追加します。これらのメソッドは、花の名前を取得し、その花のJPEGファイルへのパスを作成し、JPEGファイルのバイナリ表現(バイト配列)を返します。後の項では、公開されているWebサービス操作にコードを追加して、操作がこれらのプライベート・メソッドをコールするようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロジェクトの「ソース」ビューを開きます。イメージの名前を取得し、その名前に基づいてイメージへのパスを作成し、そのイメージをバイト配列として取得するコードを追加する必要があります。次のコードを <code>FlowerService</code> クラス本文に入力または貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private byte[] getFlowerBytes(String name) throws IOException {
    URL resource = this.getClass().getResource("/org/flower/resources/"+name+".jpg");
    return getBytes(resource);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>IDEがクラス <code>URL</code> を見つけられないことを示す警告が表示されます。 <code><a href="http://download.oracle.com/javase/6/docs/api/java/net/URL.html">+java.net.URL+</a></code> のインポート文を、手動で追加するか、[Ctrl]-[Shift]-[I] (Macの場合は[⌘]-[Shift]-[I])を押して追加します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>新しい警告が表示されます。この警告は、IDEが <code>getBytes</code> メソッドを見つけられないことを示します。警告アイコンを左クリックし、ヒントをクリックして <code>getBytes</code> メソッドを作成します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-method-tip.png" alt="create method tip">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>作成したばかりの <code>getBytes</code> メソッドがエディタでフォーカスされます。メソッドに次のコードを追加します。このコードは、 <code>getFlowerBytes</code> メソッドから渡した<a href="http://download.oracle.com/javase/6/docs/api/java/net/URL.html#openStream%28%29">URLへの接続を開き</a>、 <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/InputStream.html">+InputStream+</a></code> を返します。次に、1024バイトごとに入力ストリームを読み取り、そのバイトをバイト配列バッファに保存して、バッファから <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html">+ByteArrayOutputStream+</a></code> に書き込みます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private byte[] getBytes(URL resource) throws IOException {
    InputStream in = resource.openStream();
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    byte[] buf = new byte[1024];
    for(int read; (read = in.read(buf)) != -1;) {
        bos.write(buf, 0, read);
    }
    return bos.toByteArray();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p><code>java.io.InputStream</code> と <code>java.io.ByteArrayOutputStream</code> のインポート文を追加します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="read-bytes-as-image">バイト配列をイメージとして読み取る</h3>
<div class="paragraph">
<p>この項では、プライベート・メソッドを <code>FlowerService</code> クラス本文に追加します。このメソッドでは、JPEGファイルを表すバイト配列を取得し、 <code>java.awt.Image</code> オブジェクトを返します。バイト配列は、<a href="#retrieve-jpeg-as-bytes">JPEGファイルをバイト配列として取得</a>の項で作成した <code>getBytes(URL)</code> メソッドによって作成されることに注意してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>FlowerService</code> クラス本文で、 <code>getImage</code> という次のプライベート・メソッドを追加します。 <code>getImage</code> メソッドの戻り値の型は <code>Image</code> です。このメソッドは、2つのパラメータを取ります。最初のパラメータは、 <code>getBytes</code> メソッドによって作成されるバイト配列です。2番目のパラメータは、イメージがサムネイルかどうかを示すブールです。 <code>getImage</code> メソッドは、 <code>IOException</code> をスローします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>getImage</code> メソッドの本文で、このメソッドがパラメータとして取得するバイト配列から <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayInputStream.html">+ByteArrayInputStream+</a></code> を作成する行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ByteArrayInputStream bis = new ByteArrayInputStream(bytes);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>ByteArrayInputStream</code> から <code>Object</code> を作成する行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Object source = bis;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>汎用の <code>Object</code> から <code><a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/stream/ImageInputStream.html">+ImageInputStream+</a></code> を作成する行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageInputStream iis = ImageIO.createImageInputStream(source);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>JPEGファイルのデコードが可能な、現在登録されているすべての <code><a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/ImageReader.html">+ImageReader+</a></code> から <code><a href="http://download.oracle.com/javase/6/docs/api/java/util/Iterator.html">+Iterator+</a></code> を作成する行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p><code>Iterator</code> の次の要素から <code>ImageReader</code> を作成する行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageReader reader = (ImageReader) readers.next();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>デフォルトの<a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/IIOParam.html">イメージ読取りパラメータ</a>を作成する行を追加します(ただし、 <code>Image</code> がサムネイルを表す場合はイメージ読取りパラメータに4対1の<a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/IIOParam.html#setSourceSubsampling%28int,%20int,%20int,%20int%29">サブサンプリング処理</a>を追加)。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageReadParam param = reader.getDefaultReadParam();
if (isThumbnail) {
    param.setSourceSubsampling(4, 4, 0, 0);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>最後に、 <code>ImageReader</code> オブジェクトを使用して <code>ImageInputStream</code> オブジェクトを読み取り、そのオブジェクトに基づく <code>Image</code> とイメージ読取りパラメータを返すコードを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">reader.setInput(iis, true);
return reader.read(0, param);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>[Ctrl]-[Shift]-[I] (MacOSの場合は[⌘]-[Shift]-[I])を押します。「すべてのインポートを修正」ダイアログが開きます。「すべてのインポートを修正」のデフォルトの修正候補をすべて受け入れ、「OK」をクリックします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fix-getimage-imports.png" alt="fix getimage imports">
</div>
</div>
<div class="paragraph">
<p>これで <code>getImage</code> メソッドは完成です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
    ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
    Object source = bis; // File or InputStream
    ImageInputStream iis = ImageIO.createImageInputStream(source);
    Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");
    ImageReader reader = (ImageReader) readers.next();
    ImageReadParam param = reader.getDefaultReadParam();
    if (isThumbnail) {
        param.setSourceSubsampling(4, 4, 0, 0);
    }
    reader.setInput(iis, true);
    return reader.read(0, param);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implement-getflower">getFlowerの実装</h3>
<div class="paragraph">
<p>名前によって花を取得してその花のイメージを返すために、次の実装コードを <code>getFlower()</code> メソッドに追加します。このコードは、 <code>getFlowerBytes(name)</code> プライベート・メソッドをコールし、JPEGファイルをバイト配列として取得することに注意してください。次に、 <code>getImage</code> プライベート・メソッドをコールし、バイト配列を <code>Image</code> オブジェクトとして返します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebMethod(operationName = "getFlower")
public Image getFlower(@WebParam(name = "name") String name) throws IOException {
    byte[] bytes = getFlowerBytes(name);
    return getImage(bytes, false);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-byte-array-list">すべてのJPEGファイルのバイト配列のリストの作成</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>FlowerService</code> のクラス本文の先頭で、すべての花の名前の文字列配列を作成します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static final String[] FLOWERS = {"aster", "honeysuckle", "rose", "sunflower"};</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code><a href="http://download.oracle.com/javase/6/docs/api/java/util/ArrayList.html">+ArrayList+</a></code> を作成し、すべての花のバイト配列を <code>List</code> に追加するメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private List allFlowers() throws IOException {
    List flowers = new ArrayList();
    for (String flower:FLOWERS) {
        URL resource = this.getClass().getResource("/org/flower/resources/"+flower+".jpg");
        flowers.add(getBytes(resource));
    }
    return flowers;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>java.util.ArrayList</code> と <code>java.util.List</code> のインポート文を追加します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="implement-getthumbnails">getThumbnailsの実装</h3>
<div class="literalblock">
<div class="content">
<pre>``getThumbnails()`` メソッドを次のように変更します。ここでは、実装コードを追加し、戻り値の型を ``List`` から ``List&lt;Image&gt;`` に変更することに注意してください。また、 ``getImage`` メソッドの ``isThumbnail`` のブール値に ``true`` を渡すことに注意してください。 ``getThumbnails`` 実装コードは ``allFlowers`` メソッドをコールし、&lt;&lt;create-byte-array-list,すべてのJPEGファイルのバイト配列のリストを作成します&gt;&gt;。次に、 ``getThumbnails`` メソッドは ``Image`` の ``List`` を作成し、それぞれの花の ``getImage`` メソッドをコールすることで、その花のバイト配列を ``Image`` オブジェクトとして返し、その ``Image`` を ``List`` に追加します。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebMethod(operationName = "getThumbnails")
public List&lt;Image&gt; getThumbnails() throws IOException {
    List&lt;byte[]&gt; flowers = allFlowers();
    List&lt;Image&gt; flowerList = new ArrayList&lt;Image&gt;(flowers.size());
    for (byte[] flower : flowers) {
        flowerList.add(getImage(flower, true));
    }
    return flowerList;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、Webサービス/セッションを組み合せたBeanは完成しました。このWebサービス・クラスの最終的な形は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package org.flower.service;import java.awt.Image;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.jws.WebMethod;
import javax.jws.WebParam;
import javax.jws.WebService;
import javax.ejb.Stateless;
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.stream.ImageInputStream;@WebService(serviceName = "FlowerService")
@Stateless()
public class FlowerService {private static final String[] FLOWERS = {"aster", "honeysuckle", "rose", "sunflower"};@WebMethod(operationName = "getFlower")
    public Image getFlower(@WebParam(name = "name") String name) throws IOException {
        byte[] bytes = getFlowerBytes(name);
        return getImage(bytes, false);
    }@WebMethod(operationName = "getThumbnails")
    public List&lt;Image&gt; getThumbnails() throws IOException {
        List flowers = allFlowers();
        List&lt;Image&gt; flowerList = new ArrayList&lt;Image&gt;(flowers.size());
        for (byte[] flower : flowers) {
            flowerList.add(getImage(flower, true));
        }
        return flowerList;
    }private byte[] getFlowerBytes(String name) throws IOException {
        URL resource = this.getClass().getResource("/org/flower/resources/" + name + ".jpg");
        return getBytes(resource);
    }private byte[] getBytes(URL resource) throws IOException {
        InputStream in = resource.openStream();
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        byte[] buf = new byte[1024];
        for (int read; (read = in.read(buf)) != -1;) {
            bos.write(buf, 0, read);
        }
        return bos.toByteArray();
    }private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
        ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
        Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");
        ImageReader reader = (ImageReader) readers.next();
        Object source = bis; // File or InputStream
        ImageInputStream iis = ImageIO.createImageInputStream(source);
        reader.setInput(iis, true);
        ImageReadParam param = reader.getDefaultReadParam();
        if (isThumbnail) {
            param.setSourceSubsampling(4, 4, 0, 0);
        }
        return reader.read(0, param);
    }private List allFlowers() throws IOException {
        List flowers = new ArrayList();
        for (String flower : FLOWERS) {
            URL resource = this.getClass().getResource("/flower/album/resources/" + flower + ".jpg");
            flowers.add(getBytes(resource));
        }
        return flowers;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-ws">Webサービスのテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Webサービスが完成したので、デプロイとテストを実行できます。</p>
</div>
<div class="paragraph">
<p><strong>Webサービスをテストするには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「FlowerAlbumService」ノードを右クリックし、「デプロイ」を選択します。IDEはソース・コードをコンパイルし、GlassFishサーバーを起動して、プロジェクトのWARファイルをサーバーにデプロイします。「サービス」ウィンドウを開くと、デプロイされた <code>FlowerService</code> がサーバーの「アプリケーション」ノードに表示されます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>*重要: *GlassFish Server Open Source Editionはバージョン3.1以降である必要があります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployed-service.png" alt="deployed service">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>プロジェクトの「Webサービス」ノードを展開します。「FlowerService」を右クリックし、「Webサービスをテスト」を選択します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-ws-node.png" alt="test ws node">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Webサービスのテスト・ページがブラウザで開きます。「 <code>getFlower</code> 」パラメータ・フィールドに「rose」と入力します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ws-tester.png" alt="ws tester">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「 <code>getFlower</code> 」ボタンを押します。IDEが、この呼出しに関する情報をブラウザに表示します。「Method Returned」を見ると、中身が文字化けしていることがわかります。見たいのは記号の羅列ではなく、イメージです。しかし、 <code>java.awt.Image</code> は有効なスキーマ・タイプではないため、バイナリのimage/jpegデータを返すようにスキーマ・ファイルを手動で構成する必要があります。これは、次のチュートリアルで行います。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ws-tester-badschema.png" alt="ws tester badschema">
</div>
</div>
<div class="paragraph">
<p>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_次の手順">次の手順:</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="./flower_wsdl_schema.html">バイナリ・データを渡すためのスキーマとWSDLファイルの変更</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Flower%20Coding%20WS%20EE6">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">nbj2ee@netbeans.orgメーリング・リスト</a>に登録することによって、NetBeans IDE Java EE開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/websvc/flower-code-ws_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
