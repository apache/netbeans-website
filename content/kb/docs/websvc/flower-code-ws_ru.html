
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Сквозная передача двоичных данных – вложение SOAP, часть 3: создание кода для веб-службы и ее тестирование</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Сквозная передача двоичных данных – вложение SOAP, часть 3: создание кода для веб-службы и ее тестирование - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Сквозная передача двоичных данных – вложение SOAP, часть 3: создание кода для веб-службы и ее тестирование">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Сквозная передача двоичных данных – вложение SOAP, часть 3: создание кода для веб-службы и ее тестирование</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/websvc/flower-code-ws_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#coding-ws">Создание кода веб-службы</a>
<ul class="sectlevel2">
<li><a href="#retrieve-jpeg-as-bytes">Получение файла JPEG в виде массива байтов</a></li>
<li><a href="#read-bytes-as-image">Чтение массива байтов как изображения</a></li>
<li><a href="#implement-getflower">Реализация метода getFlower</a></li>
<li><a href="#create-byte-array-list">Создание списка массивов байтов для всех файлов JPEG</a></li>
<li><a href="#implement-getthumbnails">Реализация метода getThumbnails</a></li>
</ul>
</li>
<li><a href="#test-ws">Тестирование веб-службы</a></li>
<li><a href="#_что_дальше">Что дальше?</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом уроке рассматривается добавление кода в веб-службу/класс сеансного компонента для преобразования файлов JPEG в массивы байтов, а массивов байтов – в объекты  <code>java.awt.Image</code> . Также можно добавить код в операции общедоступных веб-служб для возврата данных объектов  <code>Image</code> . И, наконец, выполняется тестирование веб-службы в браузере с помощью служебной программы тестирования веб-служб IDE NetBeans.</p>
</div>
<div class="paragraph">
<p>Готовый образец веб-службы можно загрузить из <a href="https://netbeans.org/projects/samples/downloads/download/Samples%252FWeb%2520Services%252FWeb%2520Service%2520Passing%2520Binary%2520Data%2520--%2520EE6%252FFlowerAlbumService.zip">каталога примеров NetBeans</a>.</p>
</div>
<div class="paragraph">
<p><strong>Уроки, представленные в этом учебном курсе</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. Содержимое этой страницы применимо к IDE NetBeans 7.2, 7.3, 7.4 и 8.0</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="./flower_overview.html">Обзор</a></p>
</li>
<li>
<p><a href="flower_ws.html">+ Создание веб-службы+</a></p>
</li>
<li>
<p>&#8658; Написание кода веб-службы и ее тестирование</p>
</li>
<li>
<p><a href="./flower_wsdl_schema.html">+ Изменение файлов схемы и WSDL для передачи двоичных данных+</a></p>
</li>
<li>
<p><a href="./flower_swing.html">+ Создание клиента Swing+</a></p>
</li>
<li>
<p><a href="#coding-ws">Создание кода веб-службы</a></p>
</li>
<li>
<p><a href="#retrieve-jpeg-as-bytes">Получение файла JPEG в виде массива байтов</a></p>
</li>
<li>
<p><a href="#read-bytes-as-image">Чтение массива байтов как изображения</a></p>
</li>
<li>
<p><a href="#implement-getflower">Реализация метода getFlower</a></p>
</li>
<li>
<p><a href="#create-byte-array-list">Создание списка массивов байтов для всех файлов JPEG</a></p>
</li>
<li>
<p><a href="#implement-getthumbnails">Реализация метода getThumbnails</a></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#test-ws">Тестирование веб-службы</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coding-ws">Создание кода веб-службы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ранее было создано веб-приложение с набором файлов JPEG и веб-службой. Веб-служба реализуется как сеансный компонент без поддержки состояния. Веб-служба содержит две пустые веб-операции. В этом уроке рассматривается добавление кода в веб-службу для преобразования файлов JPEG в массивы байтов, а массивов байтов – в объекты  <code>java.awt.Image</code> . Также можно добавить код в операции общедоступных веб-служб для возврата данных объектов  <code>Image</code> .</p>
</div>
<div class="sect2">
<h3 id="retrieve-jpeg-as-bytes">Получение файла JPEG в виде массива байтов</h3>
<div class="paragraph">
<p>В этом разделе рассматривается добавление нескольких закрытых методов в тело класса  <code>FlowerService</code> . Эти методы принимают имя изображения цветка, создают путь к файлу JPEG цветка и возвращают двоичное представление файла JPEG (массив байтов). В последующих разделах описывается создание кода для общедоступных операций веб-служб, чтобы операции могли вызывать эти закрытые методы.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте представление Source ("Исходный код") проекта. Необходимо добавить код, который принимает имя изображения, создает путь к изображению на основе этого имени и представляет изображение в виде массива байтов. Введите или вставьте в тело класса  <code>FlowerService</code>  следующий код:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private byte[] getFlowerBytes(String name) throws IOException {
    URL resource = this.getClass().getResource("/org/flower/resources/"+name+".jpg");
    return getBytes(resource);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Появится предупреждение о том, что среде IDE не удается найти  <code>URL-адрес</code> . Добавьте оператор импорта для  <code><a href="http://download.oracle.com/javase/6/docs/api/java/net/URL.html">+java.net.URL+</a></code> , вручную или путем нажатия Ctrl-Shift-I (⌘-Shift-I в Mac).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Появится новое предупреждение. В предупреждении сообщается о том, что среде IDE не удается найти метод  <code>getBytes</code> . Щелкните значок предупреждения левой кнопкой мыши и щелкните всплывающую подсказку для создания метода  <code>getBytes</code> .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-method-tip.png" alt="create method tip">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>В окне редактора будет выполнен переход к только что созданному методу  <code>getBytes</code> . Добавьте в метод следующий код. Этот код служит для <a href="http://download.oracle.com/javase/6/docs/api/java/net/URL.html#openStream%28%29">установки подключения к URL-адресу</a>, переданному от метода  <code>getFlowerBytes</code> , и возврата элемента  <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/InputStream.html">+InputStream+</a></code> . Затем код считывает входной поток порциями по 1024 байта, сохраняет байты в буфере массива данных и записывает  <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html">+ByteArrayOutputStream+</a></code>  на основе содержимого буфера.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private byte[] getBytes(URL resource) throws IOException {
    InputStream in = resource.openStream();
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    byte[] buf = new byte[1024];
    for(int read; (read = in.read(buf)) != -1;) {
        bos.write(buf, 0, read);
    }
    return bos.toByteArray();
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Добавьте операторы импорта для  <code>java.io.InputStream</code>  и  <code>java.io.ByteArrayOutputStream</code> .</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="read-bytes-as-image">Чтение массива байтов как изображения</h3>
<div class="paragraph">
<p>В этом разделе рассматривается добавление закрытого метода в тело класса  <code>FlowerService</code> . Этот метод принимает массив байтов, представляющих файл JPEG, и возвращает объект  <code> java.awt.Image</code> . Обратите внимание, что массив байтов создается посредством метода  <code>getBytes(URL)</code> , создание которого изучалось в разделе <a href="#retrieve-jpeg-as-bytes">Получение файла JPEG в виде массива байтов</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте в тело класса  <code>FlowerService</code>  закрытый метод  <code>getImage</code> . Возвращаемым типом метода  <code>getImage</code>  является  <code>Image</code> . Метод принимает два параметра. Первым параметром является массив байтов, созданный посредством метода  <code>getBytes</code> . Вторым параметром является булево значение, указывающее, является ли изображение эскизом. Метод  <code>getImage</code>  выдает исключение  <code>IOException</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Добавьте в тело метода  <code>getImage</code>  строку, которая создает объект  <code><a href="http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayInputStream.html">+ByteArrayInputStream+</a></code>  из массива байтов, принимаемого методом в качестве параметра.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ByteArrayInputStream bis = new ByteArrayInputStream(bytes);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте строку для создания элемента  <code>Object</code>  на основе объекта  <code>ByteArrayInputStream</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Object source = bis;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Добавьте строку для создания объекта  <code><a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/stream/ImageInputStream.html">+ImageInputStream+</a></code>  из общего объекта  <code>Object</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageInputStream iis = ImageIO.createImageInputStream(source);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Добавьте строку для создания элемента  <code><a href="http://download.oracle.com/javase/6/docs/api/java/util/Iterator.html">+Iterator+</a></code>  для всех зарегистрированных в настоящее время объектов  <code><a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/ImageReader.html">+ImageReader+</a></code>  в целях расшифровки файлов JPEG.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Добавьте строку для создания объекта  <code>ImageReader</code>  для следующего элемента в  <code>Iterator</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageReader reader = (ImageReader) readers.next();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Добавьте строки для создания <a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/IIOParam.html">параметров считывания изображения</a> по умолчанию, однако  если объект  <code>Image</code>  представляет эскиз, добавьте код <a href="http://download.oracle.com/javase/6/docs/api/javax/imageio/IIOParam.html#setSourceSubsampling%28int,%20int,%20int,%20int%29">субдискретизации</a> с шагом 4.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">ImageReadParam param = reader.getDefaultReadParam();
if (isThumbnail) {
    param.setSourceSubsampling(4, 4, 0, 0);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Добавьте код, использующий объект  <code>ImageReader</code>  для чтения объекта  <code>ImageInputStream</code>  и возврата элемента  <code>Image</code>  на основе этого объекта, а также параметров чтения изображения.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">reader.setInput(iis, true);
return reader.read(0, param);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Нажмите Ctrl-Shift-I (⌘-Shift-I в MacOS). Откроется диалоговое окно Fix All Imports ("Исправление всех операторов импорта"). Примите настройку по умолчанию диалогового окна "Исправление всех операторов импорта" и нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fix-getimage-imports.png" alt="fix getimage imports">
</div>
</div>
<div class="paragraph">
<p>Метод  <code>getImage</code>  готов.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
    ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
    Object source = bis; // File or InputStream
    ImageInputStream iis = ImageIO.createImageInputStream(source);
    Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");
    ImageReader reader = (ImageReader) readers.next();
    ImageReadParam param = reader.getDefaultReadParam();
    if (isThumbnail) {
        param.setSourceSubsampling(4, 4, 0, 0);
    }
    reader.setInput(iis, true);
    return reader.read(0, param);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implement-getflower">Реализация метода getFlower</h3>
<div class="paragraph">
<p>Добавьте следующий код реализации в метод  <code>getFlower()</code>  для получения цветка по его имени и возврата изображения этого цветка. Обратите внимание, что это код вызывает метод  <code>getFlowerBytes(name)</code>  для получения файла JPEG в виде массива байтов. Затем код вызывает закрытый метод  <code>getImage</code>  для возврата массива байтов в виде объекта  <code>Image</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebMethod(operationName = "getFlower")
public Image getFlower(@WebParam(name = "name") String name) throws IOException {
    byte[] bytes = getFlowerBytes(name);
    return getImage(bytes, false);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-byte-array-list">Создание списка массивов байтов для всех файлов JPEG</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В верхней части тела класса  <code>FlowerService</code>  создайте массив строк с названиями всех цветов.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static final String[] FLOWERS = {"aster", "honeysuckle", "rose", "sunflower"};</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Добавьте метод для создания объекта  <code><a href="http://download.oracle.com/javase/6/docs/api/java/util/ArrayList.html">+ArrayList+</a></code>  и добавления массива байтов для каждого цветка в список  <code>List</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private List allFlowers() throws IOException {
    List flowers = new ArrayList();
    for (String flower:FLOWERS) {
        URL resource = this.getClass().getResource("/org/flower/resources/"+flower+".jpg");
        flowers.add(getBytes(resource));
    }
    return flowers;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте операторы импорта для  <code>java.util.ArrayList</code>  и  <code>java.util.List</code> .</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="implement-getthumbnails">Реализация метода getThumbnails</h3>
<div class="paragraph">
<p>Измените метод  <code>getThumbnails()</code>  следующим образом. Обратите внимание на добавление кода реализации и изменение типа возврата с  <code>List</code>  на  <code>List&lt;Image&gt;</code> . Также учтите, что булево значения  <code>isThumbnail </code>   <code>true</code>  передается в метод  <code>getImage</code> . Код реализации метода  <code>getThumbnails</code>  вызывает метод  <code>allFlowers</code> , чтобы <a href="#create-byte-array-list">создать список массивов байтов для всех файлов JPEG</a>. Метод  <code>getThumbnails</code>  затем создает список  <code>List</code>  объектов  <code>Image</code>  и вызывает метод  <code>getImage</code>  для каждого цветка с целью возврата массива байтов для этого цветка в качестве объекта  <code>Image</code>  и добавления объекта  <code>Image</code>  в объект  <code>List</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@WebMethod(operationName = "getThumbnails")
public List&lt;Image&gt; getThumbnails() throws IOException {
    List&lt;byte[]&gt; flowers = allFlowers();
    List&lt;Image&gt; flowerList = new ArrayList&lt;Image&gt;(flowers.size());
    for (byte[] flower : flowers) {
        flowerList.add(getImage(flower, true));
    }
    return flowerList;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Объединенная веб-служба/сеансный компонент готовы. В итоге класс веб-службы должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package org.flower.service;import java.awt.Image;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.jws.WebMethod;
import javax.jws.WebParam;
import javax.jws.WebService;
import javax.ejb.Stateless;
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.stream.ImageInputStream;@WebService(serviceName = "FlowerService")
@Stateless()
public class FlowerService {private static final String[] FLOWERS = {"aster", "honeysuckle", "rose", "sunflower"};@WebMethod(operationName = "getFlower")
    public Image getFlower(@WebParam(name = "name") String name) throws IOException {
        byte[] bytes = getFlowerBytes(name);
        return getImage(bytes, false);
    }@WebMethod(operationName = "getThumbnails")
    public List&lt;Image&gt; getThumbnails() throws IOException {
        List flowers = allFlowers();
        List&lt;Image&gt; flowerList = new ArrayList&lt;Image&gt;(flowers.size());
        for (byte[] flower : flowers) {
            flowerList.add(getImage(flower, true));
        }
        return flowerList;
    }private byte[] getFlowerBytes(String name) throws IOException {
        URL resource = this.getClass().getResource("/org/flower/resources/" + name + ".jpg");
        return getBytes(resource);
    }private byte[] getBytes(URL resource) throws IOException {
        InputStream in = resource.openStream();
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        byte[] buf = new byte[1024];
        for (int read; (read = in.read(buf)) != -1;) {
            bos.write(buf, 0, read);
        }
        return bos.toByteArray();
    }private Image getImage(byte[] bytes, boolean isThumbnail) throws IOException {
        ByteArrayInputStream bis = new ByteArrayInputStream(bytes);
        Iterator readers = ImageIO.getImageReadersByFormatName("jpeg");
        ImageReader reader = (ImageReader) readers.next();
        Object source = bis; // File or InputStream
        ImageInputStream iis = ImageIO.createImageInputStream(source);
        reader.setInput(iis, true);
        ImageReadParam param = reader.getDefaultReadParam();
        if (isThumbnail) {
            param.setSourceSubsampling(4, 4, 0, 0);
        }
        return reader.read(0, param);
    }private List allFlowers() throws IOException {
        List flowers = new ArrayList();
        for (String flower : FLOWERS) {
            URL resource = this.getClass().getResource("/flower/album/resources/" + flower + ".jpg");
            flowers.add(getBytes(resource));
        }
        return flowers;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-ws">Тестирование веб-службы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>После создания веб-службы можно развернуть ее и протестировать.</p>
</div>
<div class="paragraph">
<p><strong>Порядок тестирования веб-службы.</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Щелкните правой кнопкой мыши узел FlowerAlbumService и выберите пункт "Развертывание". IDE компилирует исходный код, запускает сервер GlassFish и выполняет развертывание файла WAR проекта на сервере. При открытии окна "Службы" можно просмотреть развернутую веб-службу  <code>FlowerService</code>  в узле "Приложения" сервера.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Важно!</strong> Требуется GlassFish Server Open Source Edition 3.1 или более поздняя версия.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deployed-service.png" alt="deployed service">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Разверните узел Web Services ("Веб-службы") проекта. Щелкните правой кнопкой мыши элемент FlowerService и выберите пункт "Тестировать веб-службу".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/test-ws-node.png" alt="test ws node">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В браузере откроется средство тестирования веб-службы. Введите текст "rose" в поле параметра  <code>getFlower</code> .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ws-tester.png" alt="ws tester">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Нажмите кнопку  <code>getFlower</code> . Среда IDE выведет в браузере данные о вызове. Обратите внимание на область возврата метода: там расположен шифр. Однако на экране должно быть представлено изображение, а не последовательность символов. Поскольку  <code>java.awt.Image</code>  не является допустимым типом схемы, необходимо вручную настроить файл схемы для возврата двоичных данных изображения/jpeg. Эта процедура рассматривается в следующем учебном курсе.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ws-tester-badschema.png" alt="ws tester badschema">
</div>
</div>
<div class="paragraph">
<p>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_что_дальше">Что дальше?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="./flower_wsdl_schema.html">+ Изменение файлов схемы и WSDL для передачи двоичных данных+</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20Flower%20Coding%20WS%20EE6">Отправить отзыв по этому учебному курсу</a></p>
</div>
<div class="paragraph">
<p>Для отправки комментариев и предложений, получения поддержки и новостей о последних разработках, связанных с Java EE IDE NetBeans <a href="../../../community/lists/top.html">присоединяйтесь к списку рассылки nbj2ee@netbeans.org</a>.</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/websvc/flower-code-ws_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
