
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>第 6 课：在数据库中添加新的愿望</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="第 6 课：在数据库中添加新的愿望 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 第 6 课：在数据库中添加新的愿望">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 12.0</h1>
            <p><a class="button success" href="/download/nb113/index.html">Find out more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">第 6 课：在数据库中添加新的愿望</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_zh_CN.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_application_source_code_from_the_previous_lesson">来自上一课的应用程序源代码</a></li>
<li><a href="#_submitting_a_new_wish">提交新的愿望</a>
<ul class="sectlevel2">
<li><a href="#add-wish-ui-elements">添加用户界面组件</a></li>
<li><a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">在提交失败后重新显示截止日期</a></li>
</ul>
</li>
<li><a href="#_verifying_the_wisher_s_logon">验证许愿者的登录</a></li>
<li><a href="#insert-new-wish">在数据库中插入新的愿望</a>
<ul class="sectlevel2">
<li><a href="#add-insert-wish">将 insert_wish 函数添加到 WishDB 中</a></li>
<li><a href="#add-format-date-for-sql">将 format_date_for_sql 函数添加到 WishDB 中</a></li>
<li><a href="#validateAndEnterWishToDatabase">在数据库中输入新的愿望记录</a></li>
<li><a href="#_displaying_error_messages">显示错误消息</a></li>
</ul>
</li>
<li><a href="#_returning_to_the_front_index_php_page">返回到主页 index.php</a></li>
<li><a href="#_testing_the_add_wish_functionality">测试添加愿望功能</a></li>
<li><a href="#_application_source_code_after_the_current_lesson_is_completed">完成当前课程后的应用程序源代码</a></li>
<li><a href="#_next_steps">后续步骤</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>在本课中，将使用以下两个功能扩展应用程序功能：</p>
</div>
<div class="paragraph">
<p>要实现该功能，请编辑  <code>editWishList.php</code>  文件并创建新文件  <code>editWish.php</code> 。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l6.png" alt="page flow diagram l6">
</div>
</div>
<div class="paragraph">
<p>当前文档是<a href="wish-list-tutorial-main-page.html">在适用于 PHP 的 NetBeans IDE 中创建 CRUD 应用程序</a>教程的一部分。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_from_the_previous_lesson">来自上一课的应用程序源代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL 用户：单击<a href="https://netbeans.org/files/documents/4/1931/lesson5.zip">此处</a>以下载源代码，该代码反映了在完成上一课之后的项目状态。</p>
</div>
<div class="paragraph">
<p>Oracle 数据库用户：单击<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson5.zip">此处</a>以下载源代码，该代码反映了在完成上一课之后的项目状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_submitting_a_new_wish">提交新的愿望</h2>
<div class="sectionbody">
<div class="paragraph">
<p>用户可使用以下步骤提交新的愿望：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用户进行登录，切换到  <code>editWishList.php</code>  页，然后按 "Add Wish" 按钮。 <code>editWish.php</code>  页打开，并显示 HTML 窗体。</p>
</li>
<li>
<p>用户在 HTML 窗体中输入愿望说明，可能还会输入他/她希望实现愿望的日期，然后按 "Save Changes" 按钮。</p>
</li>
<li>
<p>如果提交窗体而未输入愿望说明，用户将返回到窗体进行重试。如果用户提交了截止日期而没有提供说明，在重新加载窗体时，将重新显示该日期。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>要为用户实现此过程，请在应用程序中添加以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#add-wish-ui-elements">用户界面组件</a>，包含添加愿望的 HTML 窗体以及  `editWishList.php ` 中将用户重定向到该窗体的按钮。</p>
</li>
<li>
<p>在提交不完整的窗体时<a href="#_returning_to_the_front_index_php_page">重新显示截止日期</a>的代码。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-wish-ui-elements">添加用户界面组件</h3>
<div class="paragraph">
<p><strong>添加功能以添加新的愿望：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>实现 "Add Wish" 按钮。在  <code>editWishList.php</code>  文件的 PHP 块下面添加以下 HTML 代码：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="addNewWish" action="editWish.php"&gt;
            &lt;input type="submit" value="Add Wish"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>*注：*您可以忽略来自 HTML 验证器的警告。</p>
</div>
<div class="paragraph">
<p>窗体包含  <code>submit</code>  类型的 "Add Wish" 输入字段。该字段实现 "Add Wish" 按钮。当用户单击 "Add Wish" 时，他们将重定向到  <code>editWish.php</code>  页。由于没有通过该窗体传输任何数据，因此，不会使用服务器请求方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 addNewWish 窗体上面添加一个表以显示许愿者的现有愿望。代码类似于  <code>wishlist.php</code> 。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['DESCRIPTION']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['DUE_DATE']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    oci_free_statement($stid);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Source Files"（源文件）文件夹中创建  <code>editWish.php</code>  PHP 文件。</p>
</li>
<li>
<p>在  <code>editWish.php</code>  中，实现 "Add Wish" 窗体。在 &lt;? php ?&gt; 块下键入或粘贴以下代码：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;

&lt;html&gt;
    &lt;head&gt;

        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="editWish" action="editWish.php" method="POST"&gt;
            Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
            When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;
            &lt;input type="submit" name="saveWish" value="Save Changes"/&gt;
            &lt;input type="submit" name="back" value="Back to the List"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>"Add Wish" 窗体包含：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>两个空文本字段，用于输入愿望说明和截止日期。</p>
</li>
<li>
<p>在输入字段旁边输出的文本。</p>
</li>
<li>
<p>表示 "Save Changes" 按钮的  <code>submit</code>  字段</p>
</li>
<li>
<p>表示 "Back to the List" 按钮的  <code>submit</code>  字段，用于返回到  <code>editWishList.php</code>  页</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在按 "Add Wish" 按钮后，窗体将通过请求方法 POST 将输入的数据提交到同一页面，即  <code>editWish.php</code> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="_redisplaying_the_due_date_after_an_unsuccessful_submission">在提交失败后重新显示截止日期</h3>
<div class="paragraph">
<p>如果用户在 "Add Wish" 窗体中未填写说明，则会显示一条错误消息，并且用户会返回到  <code>editWish.php</code>  页。当用户返回到  <code>editWish.php</code>  时，"Add Wish" 窗体应显示  <code>dueDate</code>  值（如果已输入）。在当前的窗体实现中，这两个字段始终为空。要保留输入的值，您需要将新愿望数据保存到数组中。该数组包含两个名为  <code>description</code>  和  <code>due_date</code>  的元素。然后，您需要更改 "Add Wish" 窗体，使其能够从数组中检索  <code>dueDate</code>  字段值。</p>
</div>
<div class="paragraph">
<p>*注：*未输入说明时，重新加载输入窗体的代码包含在<a href="#_verifying_the_wisher_s_logon">用于验证数据并将其输入到数据库的代码</a>中。本部分未介绍该代码。本部分中的代码仅保留  <code>dueDate</code>  值，以便在重新加载窗体时显示该值。</p>
</div>
<div class="paragraph">
<p><strong>在用户提交输入窗体失败后重新显示该窗体：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在  <code>editWish.php</code>  的 HTML &lt;body&gt; 元素内，紧靠输入窗体上面键入或粘贴以下代码块：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php
if ($_SERVER['REQUEST_METHOD'] == "POST")
    $wish = array("description" =&gt; $_POST['wish'],
                        "due_date" =&gt; $_POST['dueDate']);
else
    $wish = array("description" =&gt; "",
                        "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码检查使用哪个请求服务器方法传输数据，并创建一个名为 $wish 的数组。如果该方法是 POST（表示在尝试保存具有空说明的愿望失败后显示输入窗体），则  <code>description</code>  和  <code>due_date</code>  元素接受通过 POST 传输的值。</p>
</div>
<div class="paragraph">
<p>如果该方法不是 POST（表示在重定向窗体后第一次显示输入窗体），则  <code>editWishList.php</code>  页以及  <code>description</code>  和  <code>due_date</code>  元素均为空。</p>
</div>
<div class="paragraph">
<p>*注：*在这两种情况下，说明均为空。唯一的区别是  <code>dueDate</code> 。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>更新 "Add Wish" 窗体，以便从  <code>$wish</code>  数组中检索其输入字段的值。将 "Add Wish" 窗体中的行：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>替换为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="&lt;?php echo $wish['description'];?&gt;" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value="&lt;?php echo $wish['due_date']; ?&gt;"/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_wisher_s_logon">验证许愿者的登录</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在  <code>editWish.php</code>  文件中，在文件顶部的 &lt;? php ?&gt; 块中输入以下会话处理代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">session_start();
if (!array_key_exists("user", $_SESSION)) {
    header('Location: index.php');
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码将会：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>打开 $_SESSION 数组以检索数据。</p>
</li>
<li>
<p>验证 $_SESSION 数组是否包含具有标识符 "user" 的元素。</p>
</li>
<li>
<p>如果检查失败（表示用户未登录），则将应用程序重定向到主页 index.php 并取消 PHP 处理。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要检查会话处理是否正常工作，请从 IDE 中运行 editWish.php 文件。index.php 页打开，因为没有通过会话将用户传输到 editWish.page。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="insert-new-wish">在数据库中插入新的愿望</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在用户提交新的愿望后，应用程序需要将愿望添加到“愿望”数据库中。要实现该功能，请在应用程序中添加以下代码：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>向  <code>db.php</code>  的  <code>WishDB</code>  类中添加另外两个辅助函数。</p>
</li>
<li>
<p>一个函数将新记录添加到 wishes 表中。</p>
</li>
<li>
<p>另一个函数将日期转换为 MySQL 数据库服务器支持的格式。</p>
</li>
<li>
<p>在  <code>editWish.php</code>  中添加代码，以使用  <code>WishDB</code>  中的新辅助函数在数据库中输入新的愿望。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-insert-wish">将 insert_wish 函数添加到 WishDB 中</h3>
<div class="paragraph">
<p>该函数要求将许愿者 ID、新愿望说明和愿望截止日期作为输入参数，并在数据库的新记录中输入该数据。该函数不会返回任何值。</p>
</div>
<div class="paragraph">
<p>打开  <code>db.php `  并将  `insert_wish</code>  函数添加到  <code>WishDB</code>  类中：</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($this-&gt;format_date_for_sql($duedate)==null){
       $this-&gt;query("INSERT INTO wishes (wisher_id, description)" .
            " VALUES (" . $wisherID . ", '" . $description . "')");
    } else
        $this-&gt;query("INSERT INTO wishes (wisher_id, description, due_date)" .
            " VALUES (" . $wisherID . ", '" . $description . "', "
            . $this-&gt;format_date_for_sql($duedate) . ")");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $query = "INSERT INTO wishes (wisher_id, description, due_date) VALUES (:wisher_id_bv, :desc_bv, to_date(:due_date_bv, 'YYYY-MM-DD'))";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wisher_id_bv', $wisherID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);
    oci_free_statement($stid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码调用 format_date_for_sql 函数，以将输入的截止日期转换为数据库服务器可以处理的格式。然后，执行 INSERT INTO wishes (wisher_id, description, due_date) 查询以在数据库中输入新的愿望。</p>
</div>
</div>
<div class="sect2">
<h3 id="add-format-date-for-sql">将 format_date_for_sql 函数添加到 WishDB 中</h3>
<div class="paragraph">
<p>将  <code>format_date_for_sql</code>  函数添加到  <code>db.php</code>  的  <code>WishDB</code>  类中。该函数需要一个字符串，并将日期作为输入参数。该函数返回具有数据库服务器可处理的格式的日期；如果输入字符串为空，则返回 <code>空值</code> 。</p>
</div>
<div class="paragraph">
<p>*注：*本示例中的函数使用 PHP  <code>date_parse</code>  函数。该函数仅适用于英语语言的日期（如 December 25, 2010）和阿拉伯数字。专业 Web 站点使用日期选取器。</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts["year"] * 10000 + $dateParts["month"] * 100 + $dateParts["day"];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts['year'] * 10000 + '-' + $dateParts['month'] * 100 + '-' + $dateParts['day'];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果输入字符串为空，则代码返回空值。否则，将  <code>$date</code>  作为输入参数以调用内部  <code>date_parse</code>  函数。 <code>date_parse</code>  函数返回一个数组，其中包含三个名为  <code>$dateParts["year"]</code> 、 <code>$dateParts["month"]</code>  和  <code>$dateParts["day"]</code>  的元素。最终输出字符串由  <code>$dateParts</code>  数组元素组成。</p>
</div>
<div class="paragraph">
<p><strong>重要说明：</strong> <code>date_parse</code>  函数仅识别英语日期。例如，它解析 "February 2, 2016" 而不解析 "2 Unora, 2016"。</p>
</div>
<div class="paragraph">
<p>*Oracle 数据库用户注意事项：*唯一的格式要求是， <code>return $dateParts&#8230;&#8203;</code>  语句中的日期格式应与  <code>insert_wish</code>  查询的  <code>to_date</code>  SQL 函数中的日期格式相匹配。</p>
</div>
</div>
<div class="sect2">
<h3 id="validateAndEnterWishToDatabase">在数据库中输入新的愿望记录</h3>
<div class="paragraph">
<p>现在，您已开发了辅助函数，接下来便可添加代码以验证新的愿望数据；如果数据有效，则将数据输入到数据库中。如果数据无效，代码必须重新加载 "Add Wish" 窗体。如果数据无效的原因是没有输入说明，但输入了截止日期，则会保存截止日期并在重新加载窗体时重新显示该日期，您<a href="#_returning_to_the_front_index_php_page">以前开发的</a>代码实现了该功能。</p>
</div>
<div class="paragraph">
<p>在顶部 &lt;? php?&gt; 块（属于  <code>editWish.php</code> ）中会话处理代码下面输入以下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">require_once("Includes/db.php");
$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION['user']);

$wishDescriptionIsEmpty = false;
if ($_SERVER['REQUEST_METHOD'] == "POST"){
    if (array_key_exists("back", $_POST)) {
        header('Location: editWishList.php' );
        exit;
    } else
    if ($_POST['wish'] == "") {
        $wishDescriptionIsEmpty =  true;
    } else {
        WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST['wish'], $_POST['dueDate']);
        header('Location: editWishList.php' );
        exit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码执行以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>允许使用  <code>db.php</code>  文件</p>
</li>
<li>
<p>获取或创建  <code>WishDB</code>  类实例</p>
</li>
<li>
<p>通过调用  <code>get_wisher_id_by_name</code>  函数，检索尝试添加愿望的许愿者的 ID</p>
</li>
<li>
<p>初始化  <code>$wishDescriptionIsEmpty</code>  标志，该标志将在以后显示错误消息时使用。</p>
</li>
<li>
<p>检查请求方法是否为 POST，这意味着数据是从窗体中提交的，目的是在  <code>editWish.php</code>  页中输入愿望数据。</p>
</li>
<li>
<p>检查  <code>$_POST</code>  数组是否包含具有 "back" 键的元素</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果  <code>$_POST</code>  数组包含具有 "back" 键的元素，则在提交窗体之前按了 "Back to the List" 按钮。在这种情况下，代码会将用户重定向到  <code>editWishList.php</code> ，而不保存在字段中输入的任何数据并停止 PHP 处理。</p>
</div>
<div class="paragraph">
<p>如果 $_POST 数组_不_包含具有 "back" 键的元素，则数据是通过按 "Save Changes" 按钮提交的。在这种情况下，代码验证是否填写了愿望说明。该代码的工作方式是，检查 $_POST 数组中具有 "wish" 键的元素是否为空；如果该键为空，则将 $wishDescriptionIsEmpty 标志更改为 true。请注意，不会在 PHP 块中执行其他代码，将重新加载 "Add Wish" 窗体。</p>
</div>
<div class="paragraph">
<p>如果未按 "Back to the List" 按钮但填写了愿望说明，代码将调用  <code>insert_wish</code>  函数并将许愿者 ID、说明和愿望截止日期作为输入参数。然后，代码将用户重定向到  <code>editWishList.php</code>  页并停止 PHP 处理。</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_error_messages">显示错误消息</h3>
<div class="paragraph">
<p>如果用户尝试保存愿望，但没有输入愿望说明，则一定会显示错误消息。
在 HTML 输入窗体的 "Describe your wish" 输入字段下输入以下 &lt;? php?&gt; 块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php
if ($wishDescriptionIsEmpty)
    echo "Please enter description&lt;br/&gt;";
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果  <code>$wishDescriptionIsEmpty</code>  标志为 true，则会显示错误消息。该标志是在输入窗体验证期间处理的。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_returning_to_the_front_index_php_page">返回到主页 index.php</h2>
<div class="sectionbody">
<div class="paragraph">
<p>用户应该能够随时按某个按钮返回到应用程序主页。
要实现该功能，请在  <code>editWishList.php</code>  文件中的结束 &lt;/body&gt; 标记前面输入以下 HTML 输入窗体：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;form name="backToMainPage" action="index.php"&gt;&lt;input type="submit" value="Back To Main Page"/&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一按下 "Back to Main Page" 按钮，该窗体便将用户重定向到主页 index.php。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_add_wish_functionality">测试添加愿望功能</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行应用程序。在  <code>index.php</code>  页上，填写以下字段：在 "Username" 字段中输入 "Tom"，在 "Password" 字段中输入 "tomcat"。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>按 "Edit My Wish List" 按钮。 <code>editWishList.php</code>  页打开。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-add-wish.png" alt="edit wish list add wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>按 "Back to Main Page" 按钮。 <code>index.php</code>  页打开。</p>
</li>
<li>
<p>以 Tom 身份登录，然后再次按 "Edit My Wish List" 按钮。 <code>editWishList.php</code>  页打开。</p>
</li>
<li>
<p>按 "Add Wish" 按钮。 <code>editWish.php</code>  页打开。填写窗体。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-wish.png" alt="new wish">
</div>
</div>
<div class="paragraph">
<p>按 "Back to the List" 按钮。 <code>editWishList.php</code>  页打开，但未添加输入的愿望。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>再次按 "Add Wish" 按钮。 <code>editWish.php</code>  页打开。填写截止日期并将说明保留空白。按 "Save Changes" 按钮。 <code>editWish.php</code>  页将显示输入窗体，其中包含一条错误消息和填写的截止日期。</p>
</li>
<li>
<p>再次按 "Add Wish" 按钮。 <code>editWish.php</code>  页打开。填写窗体，然后按 "Save Changes" 按钮。 <code>editWishList.php</code>  页将显示更新的愿望列表。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-updated.png" alt="edit wish list updated">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_after_the_current_lesson_is_completed">完成当前课程后的应用程序源代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL 用户：单击<a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
<div class="paragraph">
<p>Oracle 数据库用户：单击<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">后续步骤</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson5.html">&lt;&lt; 上一课</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson7.html">下一课 &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">返回到教程主页</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%206:%20Writing%20New%20DB%20Entry">发送有关此教程的反馈意见</a></p>
</div>
<div class="paragraph">
<p>要发送意见和建议、获得支持以及随时了解 NetBeans IDE PHP 开发功能的最新开发情况，请<a href="../../../community/lists/top.html">加入 users@php.netbeans.org 邮件列表</a>。</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">返回至 PHP 学习资源</a></p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_zh_CN.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
