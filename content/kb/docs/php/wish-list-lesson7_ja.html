
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>PHPを使用するデータベース駆動型アプリケーションの作成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PHPを使用するデータベース駆動型アプリケーションの作成 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, PHPを使用するデータベース駆動型アプリケーションの作成">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 11.2</h1>
            <p><a class="button success" href="/download/nb112/index.html">Find out more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">PHPを使用するデータベース駆動型アプリケーションの作成</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_ja.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel0">
<li><a href="#_レッスン7_データベース内のエントリの更新および削除">レッスン7: データベース内のエントリの更新および削除</a>
<ul class="sectlevel1">
<li><a href="#_前のレッスンからのアプリケーション_ソース_コード">前のレッスンからのアプリケーション・ソース・コード</a></li>
<li><a href="#_ウィッシュの編集">ウィッシュの編集</a>
<ul class="sectlevel2">
<li><a href="#_edit_ボタンの実装">「Edit」ボタンの実装</a></li>
<li><a href="#_code_wish_code_配列の拡張"><code>$wish</code> 配列の拡張</a></li>
<li><a href="#_html入力フォームの更新">HTML入力フォームの更新</a></li>
<li><a href="#_データベース内のウィッシュの更新">データベース内のウィッシュの更新</a></li>
</ul>
</li>
<li><a href="#_ウィッシュの編集機能のテスト">ウィッシュの編集機能のテスト</a></li>
<li><a href="#_ウィッシュの削除">ウィッシュの削除</a></li>
<li><a href="#_ウィッシュの削除機能のテスト">ウィッシュの削除機能のテスト</a></li>
<li><a href="#_現在のレッスン完了後のアプリケーション_ソース_コード">現在のレッスン完了後のアプリケーション・ソース・コード</a></li>
<li><a href="#_次の手順">次の手順</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_レッスン7_データベース内のエントリの更新および削除" class="sect0">レッスン7: データベース内のエントリの更新および削除</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="wish-list-tutorial-main-page.html">PHPを使用するデータベース駆動型アプリケーションの作成 - メイン・ページ</a>
2.
データベースの作成</p>
</li>
<li>
<p><a href="wish-list-lesson1.html">MySQLデータベースの作成</a></p>
</li>
<li>
<p><a href="wish-list-oracle-lesson1.html">Oracleデータベース表の作成</a>
3.
<a href="wish-list-lesson2.html">アプリケーションの設計。データベースからの読取り</a></p>
</li>
<li>
<p><a href="wish-list-lesson3.html">新規アプリケーション・ユーザーの作成</a></p>
</li>
<li>
<p><a href="wish-list-lesson4.html">コードの最適化</a></p>
</li>
<li>
<p><a href="wish-list-lesson5.html">セキュリティの追加。アプリケーション・ユーザー・ログオンの実装</a></p>
</li>
<li>
<p><a href="wish-list-lesson6.html">データベースへの新しいウィッシュの追加</a>
8.
<strong>&#8658; データベース内のエントリの更新および削除</strong></p>
</li>
<li>
<p><a href="wish-list-lesson8.html">CSSテクノロジを使用したアプリケーションの外観の改良</a></p>
</li>
<li>
<p><a href="wish-list-lesson9.html">リモートWebサーバーへのアプリケーションのデプロイ</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="paragraph">
<p>このレッスンでは、次の2つの機能を使用してアプリケーションの機能を拡張します。</p>
</div>
<div class="paragraph">
<p>これらの機能を実装するには、 <code>editWishList.php</code> ファイルと <code>editWish.php</code> ファイルを編集します。また、 <code>deleteWish.php</code> という名前の新しいファイルも作成します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l7.png" alt="page flow diagram l7">
</div>
</div>
<div class="paragraph">
<p>現在のドキュメントは、PHP向けのNetBeans IDEでのCRUDアプリケーションの作成というPHPチュートリアルの一部です。</p>
</div>
<div class="sect1">
<h2 id="_前のレッスンからのアプリケーション_ソース_コード">前のレッスンからのアプリケーション・ソース・コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQLユーザー: 前のレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">ここ</a>をクリックします。</p>
</div>
<div class="paragraph">
<p>Oracleデータベース・ユーザー: 前のレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">ここ</a>をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ウィッシュの編集">ウィッシュの編集</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この機能は、次のユース・ケースをサポートしています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>editWishList.php</code> ページで、ユーザーがウィッシュの右にある「Edit」ボタンを押す。選択したウィッシュのデータがある <code>editWish.php</code> ページが開く。</p>
</li>
<li>
<p>ユーザーがウィッシュの説明または期日(あるいはその両方)を変更し、「Save Changes」ボタンを押す。</p>
</li>
<li>
<p>説明が入力されて_いない_場合、エラー・メッセージが表示され、ユーザーが <code>editWish.php</code> ページに戻される。</p>
</li>
<li>
<p>説明が入力されている場合、アプリケーションはウィッシュが更新される <code>editWishList.php</code> ページに戻る。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>この実装は、次の手順から構成されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#addEditButton">editWishListページに「Edit」ボタンを追加する</a></p>
</li>
<li>
<p><a href="#wishArrayUpdate">editWish.phpページで、ウィッシュのデータを格納する配列$wishを更新する</a></p>
</li>
<li>
<p><a href="#updateInputForm">editWish.phpページの入力フォームを更新する</a></p>
</li>
<li>
<p><a href="#updateWishRecord">送信されたデータを検証し、データベース内のウィッシュを更新する</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_edit_ボタンの実装">「Edit」ボタンの実装</h3>
<div class="literalblock">
<div class="content">
<pre>``editWishList.php`` では、ウィッシャのウィッシュを含む表は、ウィッシュがデータベースから選択されるときに、ウィッシュを含む行を表示するループ( ``while`` 文)によって実装されています。行の一番右のセルとして「Edit」ボタンを追加します。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTML入力フォームを使用してウィッシュのIDを転送するには、そのIDを変数に格納します。次のコード行を <code>while</code> ループの末尾に入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">while ($row = ...) {echo ...echo ...*$wishID = $row["id"];*}
?&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>編集ボタンを実装します。editWishフォームを使用して、終了の&lt;/table&gt;タグの前に別の表のセルを追加します。このフォームには、ボタン・コンポーネントと、ボタンがクリックされたときに <code>$wishID</code> の値を送信する非表示コンポーネントが含まれています。(MySQLデータベース用のコードが示されていますが、追加されるコードはOracleデータベースの場合も同じで、同じ場所になります。)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">   Hello &lt;?php echo $_SESSION["user"]; ?&gt;&lt;br/&gt;&lt;table border="black"&gt;&lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;&lt;?phprequire_once("Includes/db.php");$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);$result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);while ($row = mysqli_fetch_array($result)) {echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";}mysqli_free_result($result);?&gt;
            *&lt;td&gt;
                &lt;form name="editWish" action="editWish.php" method="GET"&gt;
                    &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
                    &lt;input type="submit" name="editWish" value="Edit"&gt;
                    &lt;/form&gt;
            &lt;/td&gt;*&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>while</code> ループを変更して<a href="http://www.php.net/manual/en/control-structures.alternative-syntax.php">代替構文</a>を使用します。これにより、 <code>while</code> ループ内のHTMLブロックを実行しやすくなります。代替の <code>while</code> ループ構文では、開始の中括弧{がコロン(:)に置き換えられ、終了の中括弧}が <code>endwhile;</code> 文に置き換えられます。開始の中括弧をコロンに置き換え、終了の中括弧を削除し、 <code>endwhile;</code> 文を使用して終了の&lt;/table&gt;タグの前に新しいPHPブロックを追加します。これにより、新しい表のセルが <code>while</code> ループに組み込まれます。結果または文を解放するコードを <code>endwhile;</code> 文の後に移動します。(ここでも、MySQL用のコードが示されていますが、コード変更および場所はOracleデータベースの場合も同じです。)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))[.line-through]#{#*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";[.line-through]#    }mysqli_free_result($result);#?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
*    &lt;?php
    endwhile;
    mysqli_free_result($result);
    ?&gt;*
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.
表の行の構文を修正します。行を終了する&lt;/tr&gt;\n文字を、期日のecho文から <code>endwhile;</code> のすぐ上の新しいecho文に移動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;[.line-through]#&lt;/tr&gt;\n#";?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    *echo "&lt;/tr&gt;\n";*
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.
 <code>while</code> ループ内に「Edit」ボタンを持つフォームを含む表の全体は、次のようになります。</p>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_wish_code_配列の拡張"><code>$wish</code> 配列の拡張</h3>
<div class="literalblock">
<div class="content">
<pre>``editWishList.php`` ページで「Edit」ボタンを押すと、選択したウィッシュのIDがサーバー・リクエスト・メソッドGETを介して ``editWish.php`` ページに転送されます。ウィッシュのIDを格納するには、 ``$wish`` 配列に新しい要素を追加する必要があります。</pre>
</div>
</div>
<div class="paragraph">
<p>新しいウィッシュを追加するときに、それを保存しようとして失敗した後で、 <code>editWishList.php</code> ページと <code>editWish.php</code> ページの両方から入力フォームにアクセスできます。データを転送するサーバー・リクエスト・メソッドによって、ケースが識別されます。GETは、ユーザーが「Edit Wish」を押して最初にページに達するときに、フォームが表示されることを示します。POSTは、説明なしでウィッシュを保存しようとした後、ユーザーがフォームにリダイレクトされることを示します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``editWish.php`` 内で、HTML &lt;body&gt;内の ``EditWish`` 入力フォームの上にあるPHPブロックを、 ``$wish`` 配列の拡張されたコードで置き換えます。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?phpif ($_SERVER["REQUEST_METHOD"] == "POST")$wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
        $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);else if (array_key_exists("wishID", $_GET))$wish = mysqli_fetch_array(WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]));else$wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php
if ($_SERVER["REQUEST_METHOD"] == "POST")
    $wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
            $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);
else if (array_key_exists("wishID", $_GET)) {
    $stid = WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]);
    $row = oci_fetch_array($stid, OCI_ASSOC);
    $wish = array("id" =&gt; $row["ID"], "description" =&gt;
                $row["DESCRIPTION"], "due_date" =&gt; $row["DUE_DATE"]);
    oci_free_statement($stid);
} else
$wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは、 <code>id</code> 、 <code>description</code> 、および <code>due_date</code> の3つの要素を持つ <code>$wish</code> 配列を初期化します。これらの要素の値はサーバー・リクエスト・メソッドに依存します。サーバー・リクエスト・メソッドがPOSTの場合、値は入力フォームから受け取ります。また、サーバー・リクエスト・メソッドがGETで、$_GET配列にキー「wishID」を持つ要素が含まれている場合、値は関数get_wish_by_wish_idによってデータベースから取得されます。最後に、サーバー・リクエスト・メソッドがPOSTおよびGET以外の場合、つまり新しいウィッシュの追加のユース・ケースが行われた場合、要素は空になります。</p>
</div>
<div class="paragraph">
<p>前述のコードは、ウィッシュを作成および編集するケースをカバーしています。また、入力フォームを両方のケースに使用できるように、入力フォームを更新する必要があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_html入力フォームの更新">HTML入力フォームの更新</h3>
<div class="paragraph">
<p>現時点では、新しいウィッシュを作成するとき、ウィッシュIDがなくても入力フォームは機能します。既存のウィッシュを編集する場合にフォームが機能するようにするには、ウィッシュのIDを転送するための非表示フィールドを追加する必要があります。非表示フィールドの値は、$wish配列から取得されます。新しいウィッシュの作成中、この値は空の文字列です。ウィッシュが編集される場合、非表示フィールドの値がウィッシュのIDに変わります。この非表示フィールドを作成するには、 <code>editWish.php</code> の <code>EditWish</code> 入力フォームの先頭に次の行を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ["id"];?&gt;" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データベース内のウィッシュの更新">データベース内のウィッシュの更新</h3>
<div class="paragraph">
<p>入力データを確認してウィッシュをデータベースに挿入するコードを更新する必要があります。現在のコードは、新しいウィッシュを作成するケースと既存のウィッシュを更新するケースを区別しません。現在の実装では、コードが入力フォームから転送されたウィッシュIDの値を確認しないため、新しいレコードは常にデータベースに追加されます。</p>
</div>
<div class="paragraph">
<p>次の機能を追加する必要があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>転送された要素「wishID」が空の文字列の場合、新しいウィッシュを作成する。</p>
</li>
<li>
<p>また、要素「wishID」が空の文字列でない場合、ウィッシュを更新する。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ウィッシュが新規であるかどうかを確認し、新規でない場合はウィッシュを更新するようにeditWish.phpを更新するには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>update_wish</code> 関数を <code>db.php</code> に追加します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function update_wish($wishID, $description, $duedate){
    $description = $this-&gt;real_escape_string($description);if ($duedate==''){$this-&gt;query("UPDATE wishes SET description = '" . $description . "',due_date = NULL WHERE id = " . $wishID);} else$this-&gt;query("UPDATE wishes SET description = '" . $description ."', due_date = " . $this-&gt;format_date_for_sql($duedate). " WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function update_wish($wishID, $description, $duedate) {
    $query = "UPDATE wishes SET description = :desc_bv, due_date = to_date(:due_date_bv,
              'YYYY-MM-DD')  WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.
 <code>get_wish_by_wish_id</code> 関数を <code>db.php</code> に追加します。</p>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function get_wish_by_wish_id ($wishID) {return $this-&gt;query("SELECT id, description, due_date FROM wishes WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function get_wish_by_wish_id($wishID) {
    $query = "SELECT id, description, due_date FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
    return $stid;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>editWish.php</code> のメインとなる先頭のPHPブロックで、最後の`else`文に条件を追加します。これはデータベースにウィッシュを挿入する <code>else</code> 文です。これを <code>else if</code> 文に変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">else if ($_POST["wishID"]=="") {WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST["wish"], $_POST["dueDate"]);header('Location:  ``editWishList.php`` ' );exit;}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>別の <code>else if</code> 文を、前に編集した文の下に入力するか、または貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">else if ($_POST["wishID"]!="") {WishDB::getInstance()-&gt;update_wish($_POST["wishID"], $_POST["wish"], $_POST["dueDate"]);header('Location:  ``editWishList.php`` ' );exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは、 <code>$_POST</code> 配列内の <code>wishID</code> 要素が空の文字列ではないことを確認します(これは、ユーザーが「Edit」ボタンを押すことによって <code>editWishList.php</code> ページからリダイレクトされたこと、および、ユーザーがウィッシュの説明を入力していたことを意味します)。確認が成功すると、コードは入力パラメータ <code>wishID</code> 、 <code>description</code> 、および <code>dueDate</code> を使用して関数 <code>update_wish</code> をコールします。これらのパラメータは、HTML入力フォームからPOSTメソッドを介して受け取ります。 <code>update_wish</code> がコールされた後、アプリケーションは <code>editWishList.php</code> ページにリダイレクトされ、PHP処理は取り消されます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ウィッシュの編集機能のテスト">ウィッシュの編集機能のテスト</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アプリケーションを実行します。index.phpページで、「Username」フィールドに「Tom」、「Password」フィールドに「tomcat」と入力します。
image::images/user-logon-to-edit-wish-list.png[]</p>
</li>
<li>
<p>「Edit My Wish List」ボタンを押します。 <code>editWishList.php</code> ページが開きます。
image::images/edit-wish-list-edit-wish.png[]</p>
</li>
<li>
<p>「Icecream」の横の「Edit」をクリックします。 <code>editWish.php</code> ページが開きます。
image::images/edit-wish.png[]</p>
</li>
<li>
<p>フィールドを編集して「Back to the List」を押します。 <code>editWishList.php</code> ページが開きますが、変更は保存されていません。</p>
</li>
<li>
<p>「Icecream」の横の「Edit」を押します。「Describe your wish」フィールドをクリアして「Save Changes」を押します。エラー・メッセージが表示されます。
image::images/editWishEmptyDescription.png[]</p>
</li>
<li>
<p>「Describe your wish」フィールドに「Chocolate icecream」と入力し、「Save Changes」を押します。 <code>editWishList.php</code> ページが開き、更新されたリストが表示されます。
image::images/editWishListWishAdded.png[]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ウィッシュの削除">ウィッシュの削除</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ウィッシュの作成、読取り、更新ができるようになったので、ウィッシュを削除するメソッドを追加します。</p>
</div>
<div class="paragraph">
<p><strong>ユーザーがウィッシュを削除できるようにするには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>delete_wish</code> 関数を <code>db.php</code> に追加します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">function delete_wish ($wishID){$this-&gt;query("DELETE FROM wishes WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function delete_wish($wishID) {
    $query = "DELETE FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>deleteWish.php</code> という名前の新しいPHPファイルを作成し、次のコードを&lt;?php?&gt;ブロック内に入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">require_once("Includes/db.php");WishDB::getInstance()-&gt;delete_wish ($_POST["wishID"]);header('Location:  ``editWishList.php`` ' );</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードにより、 <code>db.php</code> ファイルが使用できるようになります。入力パラメータとして <code>wishID</code> を使用し、WishDBのインスタンスから <code>delete_wish</code> 関数をコールします。最後に、アプリケーションが <code>editWishList.php</code> ページにリダイレクトされます。
3. 「Delete」ボタンを実装するには、別のHTML表のセルを、 <code>editWishList.php</code> の <code>while</code> ループの内部で、 <code>editWish</code> ボタンのコード・ブロックのすぐ下に追加します。HTML入力フォームには、 <code>wishID</code> 用の非表示フィールドと、「Delete」というラベルが付いた送信ボタンが含まれています。(MySQLデータベース用のコードが示されていますが、追加されるコードはOracleデータベースの場合も同じで、同じ場所になります。)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;[.line-through]#&lt;/tr&gt;\n#";?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    *&lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;*
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``while`` ループ内に「Edit」ボタンを持つフォームを含む表の全体は、次のようになります。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description") . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ウィッシュの削除機能のテスト">ウィッシュの削除機能のテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>機能が正しく実装されたことを確認するには、 <code>editWishList.php</code> ページで任意の項目の横にある「Delete」を押します。その項目がリストに表示されなくなります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deleteWish.png" alt="deleteWish">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_現在のレッスン完了後のアプリケーション_ソース_コード">現在のレッスン完了後のアプリケーション・ソース・コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQLユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/files/documents/4/1933/lesson7.zip">ここ</a>をクリックします。</p>
</div>
<div class="paragraph">
<p>Oracleデータベース・ユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson7.zip">ここ</a>をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_次の手順">次の手順</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson6.html">&lt;&lt; 前のレッスン</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson8.html">次のレッスン&gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">チュートリアルのメイン・ページに戻る</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%207:%20Updating%20and%20Deleting%20DB%20Entries">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">users@php.netbeans.orgメーリング・リストに登録する</a>ことによって、NetBeans IDE PHP開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">PHPの学習に戻る</a></p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_ja.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
