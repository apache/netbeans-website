
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>レッスン6: データベースへの新しいウィッシュの追加</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="レッスン6: データベースへの新しいウィッシュの追加 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, レッスン6: データベースへの新しいウィッシュの追加">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">レッスン6: データベースへの新しいウィッシュの追加</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_application_source_code_from_the_previous_lesson">前のレッスンからのアプリケーション・ソース・コード</a></li>
<li><a href="#_submitting_a_new_wish">新規ウィッシュの送信</a>
<ul class="sectlevel2">
<li><a href="#add-wish-ui-elements">ユーザー・インタフェース・コンポーネントの追加</a></li>
<li><a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">送信に失敗した後の期日の再表示</a></li>
</ul>
</li>
<li><a href="#_verifying_the_wisher_s_logon">ウィッシャのログオンの確認</a></li>
<li><a href="#insert-new-wish">データベースへの新しいウィッシュの挿入</a>
<ul class="sectlevel2">
<li><a href="#add-insert-wish">WishDBへのinsert_wish関数の追加</a></li>
<li><a href="#add-format-date-for-sql">WishDBへのformat_date_for_sql関数の追加</a></li>
<li><a href="#validateAndEnterWishToDatabase">データベースへの新規ウィッシュ・レコードの入力</a></li>
<li><a href="#_displaying_error_messages">エラー・メッセージの表示</a></li>
</ul>
</li>
<li><a href="#_returning_to_the_front_index_php_page">最初のindex.phpページへの復帰</a></li>
<li><a href="#_testing_the_add_wish_functionality">ウィッシュの追加機能のテスト</a></li>
<li><a href="#_application_source_code_after_the_current_lesson_is_completed">現在のレッスン完了後のアプリケーション・ソース・コード</a></li>
<li><a href="#_next_steps">次の手順</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このレッスンでは、次の2つの機能を使用してアプリケーションの機能を拡張します。</p>
</div>
<div class="paragraph">
<p>この機能を実装するには、 <code>editWishList.php</code> ファイルを編集し、新しいファイル <code>editWish.php</code> を作成します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l6.png" alt="page flow diagram l6">
</div>
</div>
<div class="paragraph">
<p>現在のドキュメントは、<a href="wish-list-tutorial-main-page.html">PHP向けのNetBeans IDEでのCRUDアプリケーションの作成</a>というチュートリアルの一部です。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_from_the_previous_lesson">前のレッスンからのアプリケーション・ソース・コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQLユーザー: 前のレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/files/documents/4/1931/lesson5.zip">ここ</a>をクリックします。</p>
</div>
<div class="paragraph">
<p>Oracleデータベース・ユーザー: 前のレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson5.zip">ここ</a>をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_submitting_a_new_wish">新規ウィッシュの送信</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ユーザーは、次の手順で新しいウィッシュを送信します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユーザーは、ログインして <code>editWishList.php</code> ページに切り替え、「Add Wish」ボタンを押します。 <code>editWish.php</code> ページが開き、HTMLフォームが表示されます。</p>
</li>
<li>
<p>HTMLフォームで、ユーザーはウィッシュの説明と、必要に応じてウィッシュが必要な期日を入力し、「Save Changes」ボタンをクリックします。</p>
</li>
<li>
<p>ウィッシュの説明を入力せずにフォームを送信すると、ユーザーはもう一度実行するようにフォームに戻されます。ユーザーが説明なしで期日を送信した場合、その日付はフォームが再ロードされるときに再表示されます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ユーザーがこの手順を実行できるようにするには、アプリケーションに次の機能を追加します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ウィッシュを追加するためのHTMLフォームと、ユーザーをフォームにリダイレクトする <code>editWishList.php</code> のボタンで構成された<a href="#add-wish-ui-elements">ユーザー・インタフェース・コンポーネント</a>。</p>
</li>
<li>
<p>不完全なフォームが送信された場合に、<a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">期日を再表示</a>するためのコード。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-wish-ui-elements">ユーザー・インタフェース・コンポーネントの追加</h3>
<div class="paragraph">
<p><strong>新規ウィッシュを追加するための機能を追加するには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Add Wish」ボタンを実装します。 <code>editWishList.php</code> ファイルで、次のHTMLコードをPHPブロックの下に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
    &lt;head&gt;

       &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="addNewWish" action="editWish.php"&gt;
            &lt;input type="submit" value="Add Wish"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>注意:</strong> HTMLバリデータからの警告は無視できます。</p>
</div>
<div class="paragraph">
<p>フォームには、 <code>submit</code> 型の「Add Wish」入力フィールドが含まれています。このフィールドは「Add Wish」ボタンを実装します。ユーザーが「Add Wish」をクリックすると、 <code>editWish.php</code> ページにリダイレクトされます。データはこのフォームを介して転送されないため、サーバー・リクエスト・メソッドは使用されません。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ウィッシャの既存のウィッシュを表示する表をaddNewWishフォームの上に追加します。コードは <code>wishlist.php</code> と似ています。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)) {echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['DESCRIPTION']) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row['DUE_DATE']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「ソース・ファイル」フォルダで <code>editWish.php</code>  PHPファイルを作成します。</p>
</li>
<li>
<p><code>editWish.php</code> でAdd Wishフォームを実装します。次のコードを&lt;?php?&gt;ブロックの下に入力するか、または貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;

&lt;html&gt;
    &lt;head&gt;

        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="editWish" action="editWish.php" method="POST"&gt;
            Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
            When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;
            &lt;input type="submit" name="saveWish" value="Save Changes"/&gt;
            &lt;input type="submit" name="back" value="Back to the List"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add Wishフォームには、次が含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ウィッシュの説明と期日を入力するための、2つの空のテキスト・フィールド。</p>
</li>
<li>
<p>入力フィールドの横に出力されるテキスト。</p>
</li>
<li>
<p>「Save Changes」ボタンを表す <code>submit</code> フィールド。</p>
</li>
<li>
<p><code>editWishList.php</code> ページに戻るための「Back to the List」ボタンを表す <code>submit</code> フィールド。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>「Add Wish」ボタンを押すと、フォームはリクエスト・メソッドPOSTを介して、入力したデータを同じ <code>editWish.php</code> ページに送信します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_redisplaying_the_due_date_after_an_unsuccessful_submission">送信に失敗した後の期日の再表示</h3>
<div class="paragraph">
<p>ユーザーがAdd Wishフォームに説明を入力しなかった場合、エラー・メッセージが表示され、ユーザーは <code>editWish.php</code> ページに戻ります。ユーザーが <code>editWish.php</code> に戻ると、 <code>dueDate</code> を入力していた場合はAdd Wishフォームにその値が表示されます。現在のフォームの実装では、両方のフィールドは常に空です。入力した値を保持するには、新しいウィッシュのデータを配列に保存する必要があります。配列は <code>description</code> と <code>due_date</code> という名前の2つの要素で構成されます。配列から <code>dueDate</code> フィールドの値を取得するように、Add Wishフォームを変更する必要があります。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> 説明が入力されていない場合に入力フォームを再ロードするコードは、<a href="#_verifying_the_wisher_s_logon">データを検証してデータベースに入力するコード</a>に含まれています。このコードについては、この項では説明しません。この項のコードは、フォームが再ロードされた場合に <code>dueDate</code> の値が表示されるように、その値を保持するのみです。</p>
</div>
<div class="paragraph">
<p><strong>ユーザーが入力フォームの送信に失敗した場合に入力フォームを再表示するには:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>次のコード・ブロックを、 <code>editWish.php</code> のHTML &lt;body&gt;要素内で、入力フォームの直前に入力するか、または貼り付けます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($_SERVER['REQUEST_METHOD'] == "POST")
    $wish = array("description" =&gt; $_POST['wish'],
                        "due_date" =&gt; $_POST['dueDate']);
else
    $wish = array("description" =&gt; "",
                        "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは、データの転送にどのサーバー・リクエスト・メソッドが使用されたかを確認し、$wishという名前の配列を作成します。メソッドがPOSTの場合、つまり説明が空の状態でウィッシュを保存しようとして失敗した後に入力フォームが表示される場合、 <code>description</code> と <code>due_date</code> の要素はPOSTを介して転送された値を受け取ります。</p>
</div>
<div class="paragraph">
<p>メソッドがPOSTでない場合、つまり <code>editWishList.php</code> ページからのリダイレクト後に初めて入力フォームが表示される場合、 <code>description</code> と <code>due_date</code> の要素は空です。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> どちらの場合も説明は空です。 <code>dueDate</code> が異なるのみです。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Wishフォームの入力フィールドの値が <code>$wish</code> 配列から取得されるように、Add Wishフォームを更新します。Add Wishフォームの次の行が対象です。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>次と置き換えます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="&lt;?php echo $wish['description'];?&gt;" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value="&lt;?php echo $wish['due_date']; ?&gt;"/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_wisher_s_logon">ウィッシャのログオンの確認</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>`editWish.php` ファイルで、ファイルの先頭の&lt;? &gt;ブロック内に次のセッション処理コードを入力します。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">session_start();
if (!array_key_exists("user", $_SESSION)) {
    header('Location: index.php');
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは次を実行します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>データを取得するために$_SESSION配列を開く。</p>
</li>
<li>
<p>配列$_SESSIONに、識別子が「user」の要素が含まれていることを確認する。</p>
</li>
<li>
<p>確認に失敗した場合、つまりユーザーがログオンしていない場合、最初のindex.phpページにアプリケーションがリダイレクトされ、PHPの処理が取り消される。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>セッション処理が正しく動作していることを確認するには、IDEからeditWish.phpファイルを実行します。セッションを介してeditWish.pageページにユーザーが転送されていないため、index.phpページが開きます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="insert-new-wish">データベースへの新しいウィッシュの挿入</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ユーザーが新しいウィッシュを送信した後、アプリケーションはそのウィッシュを「wishes」データベースに追加する必要があります。この機能を有効にするには、次のコードをアプリケーションに追加します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>db.php</code> の <code>WishDB</code> クラスに、補助関数をさらに2つ追加する。</p>
</li>
<li>
<p>1つの関数は、wishes表に新しいレコードを追加します。</p>
</li>
<li>
<p>もう1つの関数は、日付をMySQLデータベース・サーバーがサポートする形式に変換します。</p>
</li>
<li>
<p><code>WishDB</code> の新しい補助関数を使用してデータベースに新しいウィッシュを入力するコードを、 <code>editWish.php</code> に追加する。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-insert-wish">WishDBへのinsert_wish関数の追加</h3>
<div class="paragraph">
<p>この関数は、入力パラメータとして、ウィッシャのID、新しいウィッシュの説明、およびそのウィッシュの期日を必要とし、このデータをデータベースの新規レコードに入力します。この関数は値を返しません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`db.php` を開き、関数 `insert_wish` を `WishDB` クラスに追加します。</pre>
</div>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($this-&gt;format_date_for_sql($duedate)==null){
       $this-&gt;query("INSERT INTO wishes (wisher_id, description)" .
            " VALUES (" . $wisherID . ", '" . $description . "')");
    } else
        $this-&gt;query("INSERT INTO wishes (wisher_id, description, due_date)" .
            " VALUES (" . $wisherID . ", '" . $description . "', "
            . $this-&gt;format_date_for_sql($duedate) . ")");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $query = "INSERT INTO wishes (wisher_id, description, due_date) VALUES (:wisher_id_bv, :desc_bv, to_date(:due_date_bv, 'YYYY-MM-DD'))";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wisher_id_bv', $wisherID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);
    oci_free_statement($stid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは関数format_date_for_sqlをコールし、入力した期日をデータベース・サーバーが処理できる形式に変換します。次に、問合せINSERT INTO wishes (wisher_id, description, due_date)を実行し、新しいウィッシュをデータベースに入力します。</p>
</div>
</div>
<div class="sect2">
<h3 id="add-format-date-for-sql">WishDBへのformat_date_for_sql関数の追加</h3>
<div class="paragraph">
<p>関数 <code>format_date_for_sql</code> を <code>db.php</code> 内の <code>WishDB</code> クラスに追加します。この関数は、入力パラメータとして日付の入った文字列を必要とします。この関数は、データベース・サーバーが処理できる形式で日付を返すか、または入力文字列が空の場合は <code>null</code> を返します。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> この例の関数は、PHP  <code>date_parse</code> 関数を使用します。この関数は、「December 25, 2010」などの英語の日付でのみ機能し、アラビア数字専用です。高度なWebサイトでは日付ピッカーを使用します。</p>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts["year"] * 10000 + $dateParts["month"] * 100 + $dateParts["day"];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts['year'] * 10000 + '-' + $dateParts['month'] * 100 + '-' + $dateParts['day'];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>入力文字列が空の場合、このコードはNULLを返します。それ以外の場合は、入力パラメータとして <code>$date</code> を使用する内部の <code>date_parse</code> 関数がコールされます。 <code>date_parse</code> 関数は、 <code>$dateParts["year"]</code> 、 <code>$dateParts["month"]</code> 、および <code>$dateParts["day"]</code> の3つの要素から構成される配列を返します。最終的な出力文字列は、 <code>$dateParts</code> 配列の要素で構成されます。</p>
</div>
<div class="paragraph">
<p><strong>重要:</strong>  <code>date_parse</code> 関数は英語の日付のみ認識します。たとえば、「February 2, 2016」は解析しますが、「2 Unora, 2016」は解析しません。</p>
</div>
<div class="paragraph">
<p><strong>Oracleデータベース・ユーザーへの注意:</strong> 形式の要件は、 <code>return$dateParts&#8230;&#8203;</code> 文の日付の形式が、 <code>insert_wish</code> 問合せの <code>to_date</code>  SQL関数の日付形式と一致することのみです。</p>
</div>
</div>
<div class="sect2">
<h3 id="validateAndEnterWishToDatabase">データベースへの新規ウィッシュ・レコードの入力</h3>
<div class="paragraph">
<p>補助関数の開発が完了したので、新規ウィッシュ・データを検証するコードを追加し、データが有効である場合は、そのデータをデータベースに入力します。データが有効でない場合、コードはAdd Wishフォームを再ロードする必要があります。期日が入力されているが説明が入力されていないためにデータが無効な場合、フォームが再ロードされるときに、<a href="#_returning_to_the_front_index_php_page">以前に開発したコード</a>によって期日が保存され、再表示されます。</p>
</div>
<div class="paragraph">
<p>次のコードを、先頭の&lt;?php?&gt;ブロック( <code>editWish.php</code> 内)のセッション処理コードの下に入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">require_once("Includes/db.php");
$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION['user']);

$wishDescriptionIsEmpty = false;
if ($_SERVER['REQUEST_METHOD'] == "POST"){
    if (array_key_exists("back", $_POST)) {
        header('Location: editWishList.php' );
        exit;
    } else
    if ($_POST['wish'] == "") {
        $wishDescriptionIsEmpty =  true;
    } else {
        WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST['wish'], $_POST['dueDate']);
        header('Location: editWishList.php' );
        exit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコードは次の関数を実行します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>db.php</code> ファイルの使用を有効にする。</p>
</li>
<li>
<p>クラス <code>WishDB</code> のインスタンスを取得または作成する。</p>
</li>
<li>
<p>関数 <code>get_wisher_id_by_name</code> をコールして、ウィッシュを追加しようとしているウィッシャのIDを取得する。</p>
</li>
<li>
<p><code>$wishDescriptionIsEmpty</code> フラグを初期化する(これは、後でエラー・メッセージの表示に使用されます)。</p>
</li>
<li>
<p>リクエスト・メソッドがPOSTであることを確認する(これは、このデータが <code>editWish.php</code> ページ自身のウィッシュ・データを入力するためのフォームから送信されたことを意味します)。</p>
</li>
<li>
<p><code>$_POST</code> 配列が「back」キーを持つ要素を含んでいるかどうかを確認する。</p>
<div class="literalblock">
<div class="content">
<pre>`$_POST` 配列が「back」キーを持つ要素を含んでいる場合、フォームを送信する前に「Back to the List」ボタンが押されます。この場合、コードは、フィールドに入力されたデータを保存せずにユーザーを `editWishList.php` にリダイレクトし、PHP処理を停止します。</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>$_POST配列が「back」キーを持つ要素を含んで_いない_場合、データは「Save Changes」ボタンを押すことによって送信されます。この場合、コードは、ウィッシュの説明が入力されているかどうかを検証します。コードは、$_POST配列内の「wish」キー持つ要素が空であるかどうかを確認し、キーが空の場合は$wishDescriptionIsEmptyフラグをtrueに変更します。PHPブロックのコードがさらに実行されることはなく、Add Wishフォームが再ロードされます。</p>
</div>
<div class="paragraph">
<p>「Back to the List」ボタンが押されず、ウィッシュの説明が入力されている場合、コードは入力パラメータとしてウィッシャのID、ウィッシュの説明、およびウィッシュの期日を持つ関数 <code>insert_wish</code> をコールします。コードはユーザーを <code>editWishList.php</code> ページにリダイレクトし、PHP処理を停止します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_error_messages">エラー・メッセージの表示</h3>
<div class="paragraph">
<p>ユーザーがウィッシュの説明を入力せずにウィッシュを保存しようとした場合、エラー・メッセージが表示されます。
次の&lt;?php?&gt;ブロックを、HTML入力フォーム内の「Describe your wish」入力フィールドの下に入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($wishDescriptionIsEmpty)
    echo "Please enter description&lt;br/&gt;";
?&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`$wishDescriptionIsEmpty` フラグがtrueの場合は、エラー・メッセージが表示されます。フラグは、入力フォームの検証時に処理されます。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_returning_to_the_front_index_php_page">最初のindex.phpページへの復帰</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ボタンを押すことによって、ユーザーがいつでもアプリケーションの最初のページに戻ることができるようにします。
この機能を実装するには、次のHTML入力フォームを <code>editWishList.php</code> ファイルの終了&lt;/body&gt;タグの前に入力します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form name="backToMainPage" action="index.php"&gt;&lt;input type="submit" value="Back To Main Page"/&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>「Back to Main Page」ボタンを押すと、フォームは、ユーザーを最初のindex.phpページにリダイレクトします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_add_wish_functionality">ウィッシュの追加機能のテスト</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アプリケーションを実行します。 <code>index.php</code> ページで、「Username」フィールドに「Tom」、「Password」フィールドに「tomcat」と入力します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Edit My Wish List」ボタンを押します。 <code>editWishList.php</code> ページが開きます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-add-wish.png" alt="edit wish list add wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「Back to Main Page」ボタンを押します。 <code>index.php</code> ページが開きます。</p>
</li>
<li>
<p>「Tom」としてログオンし、もう一度「Edit My Wish List」ボタンを押します。 <code>editWishList.php</code> ページが開きます。</p>
</li>
<li>
<p>「Add Wish」ボタンを押します。 <code>editWish.php</code> ページが開きます。フォームに入力します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-wish.png" alt="new wish">
</div>
</div>
<div class="paragraph">
<p>「Back to the List」ボタンを押します。 <code>editWishList.php</code> ページが開きますが、入力したウィッシュは追加されていません。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>再度「Add Wish」ボタンを押します。 <code>editWish.php</code> ページが開きます。期日を入力し、説明を空のままにします。「Save Changes」ボタンを押します。 <code>editWish.php</code> ページには、エラー・メッセージが表示され、期日が入力されている状態の入力フォームが表示されます。</p>
</li>
<li>
<p>再度「Add Wish」ボタンを押します。 <code>editWish.php</code> ページが開きます。フォームに入力し、「Save Changes」ボタンを押します。 <code>editWishList.php</code> ページに更新されたウィッシュのリストが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-updated.png" alt="edit wish list updated">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_after_the_current_lesson_is_completed">現在のレッスン完了後のアプリケーション・ソース・コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQLユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">ここ</a>をクリックします。</p>
</div>
<div class="paragraph">
<p>Oracleデータベース・ユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">ここ</a>をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">次の手順</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson5.html">&lt;&lt; 前のレッスン</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson7.html">次のレッスン&gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">チュートリアルのメイン・ページに戻る</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%206:%20Writing%20New%20DB%20Entry">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">users@php.netbeans.orgメーリング・リストに登録する</a>ことによって、NetBeans IDE PHP開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">PHPの学習に戻る</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
