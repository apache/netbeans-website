
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Урок 6. Добавление нового пожелания в базу данных</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Урок 6. Добавление нового пожелания в базу данных - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Урок 6. Добавление нового пожелания в базу данных">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 12.4</h1>
            <p><a class="button success" href="/download/nb124/nb124.html">Find out more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">Урок 6. Добавление нового пожелания в базу данных</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_ru.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_application_source_code_from_the_previous_lesson">Исходный код приложения из предыдущего урока</a></li>
<li><a href="#_submitting_a_new_wish">Отправка нового пожелания</a>
<ul class="sectlevel2">
<li><a href="#add-wish-ui-elements">Добавление компонентов пользовательского интерфейса</a></li>
<li><a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">Повторное отображение срока выполнения после неудавшейся отправки</a></li>
</ul>
</li>
<li><a href="#_verifying_the_wisher_s_logon">Проверка входа пользователя</a></li>
<li><a href="#insert-new-wish">Вставка нового пожелания в базу данных</a>
<ul class="sectlevel2">
<li><a href="#add-insert-wish">Добавление функции insert_wish в класс WishDB</a></li>
<li><a href="#add-format-date-for-sql">Добавление функции format_date_for_sql в класс WishDB</a></li>
<li><a href="#validateAndEnterWishToDatabase">Ввод в базу данных новой записи с пожеланием</a></li>
<li><a href="#_displaying_error_messages">Отображение сообщений об ошибках</a></li>
</ul>
</li>
<li><a href="#_returning_to_the_front_index_php_page">Возврат к первой странице "index.php"</a></li>
<li><a href="#_testing_the_add_wish_functionality">Тестирование функциональной возможности добавления пожелания</a></li>
<li><a href="#_application_source_code_after_the_current_lesson_is_completed">Исходный код приложения на момент завершения текущего урока</a></li>
<li><a href="#_next_steps">Что дальше?</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом уроке функциональные возможности приложения будут расширены двумя компонентами:</p>
</div>
<div class="paragraph">
<p>Для реализации этих функциональных возможностей следует изменить файл  <code>editWishList.php</code>  и создать новый файл  <code>editWish.php</code> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l6.png" alt="page flow diagram l6">
</div>
</div>
<div class="paragraph">
<p>Текущий документ является частью краткого учебного курса <a href="wish-list-tutorial-main-page.html">Создание приложения CRUD в IDE NetBeans для PHP</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_from_the_previous_lesson">Исходный код приложения из предыдущего урока</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для пользователей MySQL: щелкните <a href="https://netbeans.org/files/documents/4/1931/lesson5.zip">+ здесь+</a>, чтобы загрузить исходный код, отражающий состояние проекта после завершения предыдущего урока.</p>
</div>
<div class="paragraph">
<p>Для пользователей баз данных Oracle: перейдите по <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson5.zip">этой</a> для загрузки исходного кода, описывающего состояние проекта на момент завершения предыдущего урока.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_submitting_a_new_wish">Отправка нового пожелания</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Пользователь выполняет отправку нового пожелания путем выполнения следующих действий:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Пользователь входит в систему, переключается на страницу  <code>editWishList.php</code>  и нажимает кнопку "Add Wish". Откроется страница  <code>editWish.php</code> , на которой отображается форма HTML.</p>
</li>
<li>
<p>В форме HTML пользователь вводит описание пожелания и, возможно, дату, до наступления которой пожелание должно быть выполнено, а затем нажимает кнопку "Save Changes".</p>
</li>
<li>
<p>Если форма отправляется без описания пожелания, то выполняется возврат к этой же форме для повторной попытки ввода. Если пользователь указал срок выполнения пожелания, но не ввел описание, то при перезагрузке формы эти данные вновь отображаются.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Для предоставления пользователю возможности использования этой процедуры необходимо добавить к приложению следующие функциональные возможности:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#add-wish-ui-elements">Компоненты интерфейса пользователя</a>, состоящие из формы HTML для добавления пожелания и кнопки на странице  `editWishList.php ` , перенаправляющей пользователя в форму.</p>
</li>
<li>
<p>Код для <a href="#inputFormAfterunsuccessfulSave">повторного отображения срока выполнения</a>, если была отправлена неполная форма.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-wish-ui-elements">Добавление компонентов пользовательского интерфейса</h3>
<div class="paragraph">
<p><strong>Для реализации функции добавления нового пожелания выполните следующее:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создайте кнопку "Add Wish". В файле  <code>editWishList.php</code>  ниже блока PHP добавьте следующий код HTML.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="addNewWish" action="editWish.php"&gt;
            &lt;input type="submit" value="Add Wish"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> Можно пропустить предупреждения от средства проверки HTML.</p>
</div>
<div class="paragraph">
<p>Форма содержит поле ввода "Add Wish" типа  <code>submit</code> . Это поле реализует кнопку "Add Wish". При нажатии кнопки "Add Wish" пользователь перенаправляется на страницу  <code>editWish.php</code> . Метод запроса к серверу не используется, т.к. данные посредством этой формы не передаются.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Выше формы addNewWish добавьте таблицу, в которой отображаются пожелания данного лица. Этот код сходен с кодом  <code>wishlist.php</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['DESCRIPTION']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['DUE_DATE']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    oci_free_statement($stid);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В папке исходных файлов создайте файл PHP  <code>editWish.php</code> .</p>
</li>
<li>
<p>На станице  <code>editWish.php</code>  реализуйте форму "Add Wish". Введите или вставьте следующий код под блоком &lt;? php ? &gt;:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;

&lt;html&gt;
    &lt;head&gt;

        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="editWish" action="editWish.php" method="POST"&gt;
            Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
            When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;
            &lt;input type="submit" name="saveWish" value="Save Changes"/&gt;
            &lt;input type="submit" name="back" value="Back to the List"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Форма "Add Wish" содержит следующие элементы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Два пустых текстовых поля для ввода пожелания и срока выполнения.</p>
</li>
<li>
<p>Текст, который будет напечатан рядом с полями ввода.</p>
</li>
<li>
<p>Поле  <code>submit</code> , представляющее кнопку "Save Changes"</p>
</li>
<li>
<p>Поле  <code>submit</code> , представляющее кнопку "Back to the List" для возврата к странице  <code>editWishList.php</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>После нажатия кнопки "Add Wish" форма отправляет введенные данные на ту же страницу  <code>editWish.php</code>  с использованием метода "Request" "POST".</p>
</div>
</div>
<div class="sect2">
<h3 id="_redisplaying_the_due_date_after_an_unsuccessful_submission">Повторное отображение срока выполнения после неудавшейся отправки</h3>
<div class="paragraph">
<p>Если пользователь не указал описание в форме "Add Wish", то появится сообщение об ошибке, и будет выполнен возврат к странице  <code>editWish.php</code> . В случае возврата пользователя к странице  <code>editWish.php</code>  в форме "Add Wish" должно отображаться значение  <code>dueDate</code>  (если оно было до этого введено). В текущей реализации формы оба поля остаются пустыми. Для того чтобы введенные значения остались в полях, необходимо сохранить данные нового пожелания в массиве. Массив будет состоять из двух элементов с именами  <code>description</code>  и  <code>due_date</code> . Затем следует изменить форму "Add Wish" таким образом, чтобы в нее из массива извлекалось значение поля  <code>dueDate</code> .</p>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> Код, перезагружающий форму ввода, если описание не введено в <a href="#validateAndEnterWishToDatabase">код, проверяющий данные и вводит их в базу данных</a>. Этот код не рассматривается в этом разделе. В соответствии с кодом в этом разделе значение  <code>dueDate</code>  будет отображаться в поле в случае перезагрузки формы.</p>
</div>
<div class="paragraph">
<p><strong>Для обеспечения повторного вывода формы ввода после неудачной отправки формы пользователем необходимо выполнить следующее:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Введите или вставьте следующий блок кода в элемент HTML &lt;body&gt; на странице  <code>editWish.php</code>  непосредственно над формой ввода:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($_SERVER['REQUEST_METHOD'] == "POST")
    $wish = array("description" =&gt; $_POST['wish'],
                        "due_date" =&gt; $_POST['dueDate']);
else
    $wish = array("description" =&gt; "",
                        "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В соответствии с кодом определяется тот метод "Request Server", который использовался для передачи данных, а также создается массив с именем $wish. Если использовался метод "POST" (что означает, что входная форма отображается после неудачной попытки сохранить пожелание с пустым описанием), то элементы  <code>description</code>  и  <code>due_date</code>  принимают значения, переданные с использованием метода "POST".</p>
</div>
<div class="paragraph">
<p>Если использовался другой метод (что означает, что входная форма отображается впервые после переадресации со страницы  <code>editWishList.php</code> ), то элементы  <code>description</code>  и  <code>due_date</code>  являются пустыми.</p>
</div>
<div class="paragraph">
<p>*Примечание.*В любом случае описание пустое. Единственным отличием является  <code>dueDate</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Обновите форму "Add Wish" таким образом, чтобы значения ее полей ввода были извлечены из массива  <code>$wish</code> . Замените строки форме "Add Wish":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>следующим блоком кода:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="&lt;?php echo $wish['description'];?&gt;" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value="&lt;?php echo $wish['due_date']; ?&gt;"/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_wisher_s_logon">Проверка входа пользователя</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В файле  <code>editWish.php</code>  введите следующий код обработки сеанса в блоке &lt;? php ? &gt; в начале файла:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">session_start();
if (!array_key_exists("user", $_SESSION)) {
    header('Location: index.php');
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для извлечения данных открывается массив "$_SESSION".</p>
</li>
<li>
<p>Выполняется проверка того, что массив "$_SESSION" содержит элемент с идентификатором "user".</p>
</li>
<li>
<p>При неудачном завершении проверки (что означает, что пользователь не зарегистрирован) выполняется перенаправление на первую страницу "index.php" и обработка кода PHP прерывается.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Для проверки правильности обработки сеанса запустите из среды IDE файл "editWish.php". Откроется страница index.php, поскольку в сеансе ни один пользователь не был перемещен на страницу editWish.page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="insert-new-wish">Вставка нового пожелания в базу данных</h2>
<div class="sectionbody">
<div class="paragraph">
<p>После подтверждения пользователем нового пожелания приложение добавляет пожелание к базе данных "Wishes". Для включения этой функциональной возможности вставьте в приложение следующий код:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Добавьте еще две дополнительных функции к классу  <code>WishDB</code>  в  <code>db.php</code> .</p>
</li>
<li>
<p>Первая функция добавляет новую запись в таблицу пожеланий.</p>
</li>
<li>
<p>Вторая функция преобразовывает даты в формат, поддерживаемый сервером баз данных MySQL.</p>
</li>
<li>
<p>Добавьте к  <code>editWish.php</code>  код, который будет использовать новые вспомогательные функции в  <code>WishDB</code>  для ввода нового пожелания в базу данных.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-insert-wish">Добавление функции insert_wish в класс WishDB</h3>
<div class="paragraph">
<p>Эта функция требует в качестве входных параметров идентификатор пользователя, описание нового пожелания и срок выполнения пожелания, после чего добавляет эти данные к базе данных как новую запись. Функция не возвращает какого-либо значения.</p>
</div>
<div class="paragraph">
<p>Откройте  <code>db.php `  и добавьте функцию  `insert_wish</code>  в класс  <code>WishDB</code> .</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($this-&gt;format_date_for_sql($duedate)==null){
       $this-&gt;query("INSERT INTO wishes (wisher_id, description)" .
            " VALUES (" . $wisherID . ", '" . $description . "')");
    } else
        $this-&gt;query("INSERT INTO wishes (wisher_id, description, due_date)" .
            " VALUES (" . $wisherID . ", '" . $description . "', "
            . $this-&gt;format_date_for_sql($duedate) . ")");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $query = "INSERT INTO wishes (wisher_id, description, due_date) VALUES (:wisher_id_bv, :desc_bv, to_date(:due_date_bv, 'YYYY-MM-DD'))";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wisher_id_bv', $wisherID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);
    oci_free_statement($stid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В этом коде вызывается функция format_date_for_sql для преобразования введенного срока выполнения в формат, который может быть обработан сервером базы данных. Затем для ввода нового пожелания в базу данных выполняется запрос "INSERT INTO wishes (wisher_id, description, due_date)".</p>
</div>
</div>
<div class="sect2">
<h3 id="add-format-date-for-sql">Добавление функции format_date_for_sql в класс WishDB</h3>
<div class="paragraph">
<p>В файле  <code>db.php</code>  добавьте в класс  <code>WishDB</code>  функцию  <code>format_date_for_sql</code> . Для выполнения функции качестве входного параметра требуется строка, в которой указана дата. Эта функция возвращает дату в формате, который может быть обработан сервером базы данных, или  <code>null</code> , если входная строка пустая.</p>
</div>
<div class="paragraph">
<p><strong>Примечание.</strong> Функция в этом примере использует функцию PHP  <code>date_parse</code> . Эта функция работает только с англоязычными датами, такими как "December 25, 2010", и только с арабскими цифрами. На профессиональном веб-сайте следует использовать управляющий элемент выбора даты.</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts["year"] * 10000 + $dateParts["month"] * 100 + $dateParts["day"];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts['year'] * 10000 + '-' + $dateParts['month'] * 100 + '-' + $dateParts['day'];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>При пустой входной строке код возвращает значение "NULL". В противном случае внутренняя функция  <code>date_parse</code>  вызывается с входным параметром  <code>$date</code> . Функция  <code>date_parse</code>  возвращает массив, состоящий из трех элементов с именами  <code>$dateParts["year"]</code> ,  <code>$dateParts["month"]</code>  и  <code>$dateParts["day"]</code> . Окончательная строка вывода создается из элементов массива  <code>$dateParts</code> .</p>
</div>
<div class="paragraph">
<p><strong>Важно!</strong> Функция  <code>date_parse</code>  распознает только англоязычные даты. Например, она воспринимает и интерпретирует дату "February 2, 2016" но не дату "2 Unora, 2016".</p>
</div>
<div class="paragraph">
<p><strong>Примечание для пользователей базы данных Oracle.</strong> Единственное требование, предъявляемое к формату, состоит в том, что формат даты в операторе  <code>return $dateParts&#8230;&#8203;</code>  должен совпадать с форматом даты в функции SQL  <code>to_date</code>  из запроса  <code>insert_wish</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="validateAndEnterWishToDatabase">Ввод в базу данных новой записи с пожеланием</h3>
<div class="paragraph">
<p>На этом этапе, после окончания разработки дополнительных функций, добавьте код для проверки допустимости данных нового пожелания и ввода данных в базу данных при их корректности. Если данные некорректны, то должна быть выполнена перезагрузка формы "Add Wish". Если данные некорректны, поскольку отсутствует описание пожелания, но при этом указан срок выполнения пожелания, введенные данные сохраняются в поле и отображаются в случае перезагрузке формы благодаря <a href="#inputFormAfterunsuccessfulSave">предварительно написанному </a>коду.</p>
</div>
<div class="paragraph">
<p>В верхний блок &lt;? php ? &gt; файла  <code>editWish.php</code>  введите ниже кода обработки сеанса следующий код.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">require_once("Includes/db.php");
$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION['user']);

$wishDescriptionIsEmpty = false;
if ($_SERVER['REQUEST_METHOD'] == "POST"){
    if (array_key_exists("back", $_POST)) {
        header('Location: editWishList.php' );
        exit;
    } else
    if ($_POST['wish'] == "") {
        $wishDescriptionIsEmpty =  true;
    } else {
        WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST['wish'], $_POST['dueDate']);
        header('Location: editWishList.php' );
        exit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код выполняет следующие функции:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>активация использования файла  <code>db.php</code> ;</p>
</li>
<li>
<p>получение или создание экземпляра класса  <code>WishDB</code> ;</p>
</li>
<li>
<p>извлечение идентификатора пользователя, осуществляющего попытку добавления пожелания путем вызова функции  <code>get_wisher_id_by_name</code> ;</p>
</li>
<li>
<p>инициализация флага  <code>$wishDescriptionIsEmpty</code> , который будет использован позже для отображения сообщений об ошибках;</p>
</li>
<li>
<p>проверка того, что используется метод запроса "POST" (соответствует передаче данных из формы для ввода данных пожелания непосредственно на странице  <code>editWish.php</code> );</p>
</li>
<li>
<p>проверка того, содержит ли массив  <code>$_POST</code>  элемент с ключом "back".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Если массив  <code>$_POST</code>  содержит элемент с ключом "back", то перед передачей формы была нажата кнопка "Back to the List". В этом случае осуществляется перенаправление на страницу  <code>editWishList.php</code>  без сохранения данных, введенных в полях, и прекращается обработка блока PHP.</p>
</div>
<div class="paragraph">
<p>Если массив $<em>POST _не</em> содержит элемент с ключом "back", то данные были переданы путем нажатия кнопки "Save Changes". В этом случае в соответствии с кодом выполняется проверка наличия описания пожелания. Это реализуется путем проверки того, является ли элемент с ключом "wish" в массиве "$_POST" пустым. Если ключ пуст, значение флага $wishDescriptionIsEmpty изменяется на "true". Следует отметить, что если выполнение дальнейшего кода в блоке PHP прерывается, форма "Add Wish" перезагружается.</p>
</div>
<div class="paragraph">
<p>Если не была нажата кнопка "Back to the List", но при этом указано описание пожелания, то код вызывает функцию  <code>insert_wish</code>  с идентификатором пользователя, описанием и сроком выполнения пожелания в качестве входных параметров. Затем код перенаправляет пользователя на страницу  <code>editWishList.php</code>  и прекращает обработку PHP.</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_error_messages">Отображение сообщений об ошибках</h3>
<div class="paragraph">
<p>При попытке пользователя сохранить пожелание без описания должно отобразиться сообщение об ошибке.
Введите следующий блок &lt;? php ? &gt; в форме ввода HTML ниже поля ввода "Describe your wish":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($wishDescriptionIsEmpty)
    echo "Please enter description&lt;br/&gt;";
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сообщение об ошибке отображается в случае значения "true" для флага  <code>$wishDescriptionIsEmpty</code> . Флаг обрабатывается в течение проверки допустимости формы ввода.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_returning_to_the_front_index_php_page">Возврат к первой странице "index.php"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Пользователь должен иметь возможность, нажав кнопку, в любой момент вернуться на первую страницу приложения.
Для реализации этих функции введите следующую форму ввода HTML в файл  <code>editWishList.php</code>  перед закрывающим тегом &lt;/body&gt;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form name="backToMainPage" action="index.php"&gt;&lt;input type="submit" value="Back To Main Page"/&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Форма перенаправляет пользователя на первую страницу "index.php" после нажатия кнопки "Back to Main Page".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_add_wish_functionality">Тестирование функциональной возможности добавления пожелания</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Запустите приложение. На странице  <code>index.php</code>  заполните следующие поля: в поле "Username" введите "Tom", в поле "Password" введите "tomcat".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите кнопку "Edit My Wish List". Откроется страница  <code>editWishList.php</code> .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-add-wish.png" alt="edit wish list add wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Нажмите кнопку "Back to Main Page". Откроется страница  <code>index.php</code> .</p>
</li>
<li>
<p>Войдите в систему под именем "Tom" и снова нажмите кнопку "Edit My Wish List". Откроется страница  <code>editWishList.php</code> .</p>
</li>
<li>
<p>Нажмите кнопку "Add Wish". Откроется страница  <code>editWish.php</code> . Заполните форму.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-wish.png" alt="new wish">
</div>
</div>
<div class="paragraph">
<p>Нажмите кнопку "Back to the List". Откроется страница  <code>editWishList.php</code> , но новое пожелание в списке отсутствует.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Снова нажмите кнопку "Add Wish". Откроется страница  <code>editWish.php</code> . Укажите срок выполнения пожелания, а поле описания оставьте пустым. Нажмите кнопку "Save Changes". На странице  <code>editWish.php</code>  отображается форма ввода с сообщением об ошибке и заполненным полем срока выполнения пожелания.</p>
</li>
<li>
<p>Снова нажмите кнопку "Add Wish". Откроется страница  <code>editWish.php</code> . Заполните форму и нажмите кнопку "Save Changes". На странице  <code>editWishList.php</code>  отображается обновленный список пожеланий.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-updated.png" alt="edit wish list updated">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_after_the_current_lesson_is_completed">Исходный код приложения на момент завершения текущего урока</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для пользователей MySQL: щелкните <a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">здесь</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
<div class="paragraph">
<p>Для пользователей Oracle Database: щелкните <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">здесь</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Что дальше?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson5.html">&lt;&lt;Предыдущий урок</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson7.html">Следующий урок &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">Назад на главную страницу руководства</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%206:%20Writing%20New%20DB%20Entry">Отправить отзыв по этому учебному курсу</a></p>
</div>
<div class="paragraph">
<p>Для отправки комментариев и предложений, получения поддержки и новостей о последних разработках, связанных с PHP IDE NetBeans <a href="../../../community/lists/top.html">присоединяйтесь к списку рассылки users@php.netbeans.org</a>.</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">Возврат к учебной карте PHP</a></p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_ru.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2020 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
