
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Создание приложения на основе базы данных на языке PHP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Создание приложения на основе базы данных на языке PHP - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Создание приложения на основе базы данных на языке PHP">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans (incubating)</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/nb110/nb110.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 11.0</h1>
            <p><a class="button success" href="/download/nb110/nb110.html">Read more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">Создание приложения на основе базы данных на языке PHP</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/incubator-netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_ru.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel0">
<li><a href="#_Урок_7_Обновление_и_удаление_записей_в_базе_данных">Урок 7. Обновление и удаление записей в базе данных</a>
<ul class="sectlevel1">
<li><a href="#_Исходный_код_приложения_из_предыдущего_урока">Исходный код приложения из предыдущего урока</a></li>
<li><a href="#_Редактирование_пожелания">Редактирование пожелания</a>
<ul class="sectlevel2">
<li><a href="#_Реализация_кнопки_edit">Реализация кнопки "Edit"</a></li>
<li><a href="#_Расширение_массива_code_wish_code">Расширение массива  <code>$wish</code></a></li>
<li><a href="#_Обновление_формы_ввода_html">Обновление формы ввода HTML</a></li>
<li><a href="#_Обновление_пожелания_в_базе_данных">Обновление пожелания в базе данных</a></li>
</ul>
</li>
<li><a href="#_Тестирование_функциональной_возможности_редактирования_пожелания">Тестирование функциональной возможности редактирования пожелания</a></li>
<li><a href="#_Удаление_пожелания">Удаление пожелания</a></li>
<li><a href="#_Тестирование_функциональной_возможности_удаления_пожелания">Тестирование функциональной возможности удаления пожелания</a></li>
<li><a href="#_Исходный_код_приложения_на_момент_завершения_текущего_урока">Исходный код приложения на момент завершения текущего урока</a></li>
<li><a href="#_Что_дальше">Что дальше?</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_Урок_7_Обновление_и_удаление_записей_в_базе_данных" class="sect0">Урок 7. Обновление и удаление записей в базе данных</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="wish-list-tutorial-main-page.html">Создание приложения на основе базы данных с помощью языка PHP – главная страница</a>
2.
Создание базы данных</p>
</li>
<li>
<p><a href="wish-list-lesson1.html">Создание базы данных MySQL</a></p>
</li>
<li>
<p><a href="wish-list-oracle-lesson1.html">Создание таблиц базы данных Oracle</a>
3.
<a href="wish-list-lesson2.html">Проектирование приложения. Чтение из базы данных</a></p>
</li>
<li>
<p><a href="wish-list-lesson3.html">Создание нового пользователя приложения</a></p>
</li>
<li>
<p><a href="wish-list-lesson4.html">Усовершенствование кода</a></p>
</li>
<li>
<p><a href="wish-list-lesson5.html">Добавление функций безопасности. Реализация входа пользователя в приложение</a></p>
</li>
<li>
<p><a href="wish-list-lesson6.html">Добавление нового пожелания в базу данных</a>
8.
<strong>&#8658; Обновление и удаление записей в базе данных</strong></p>
</li>
<li>
<p><a href="wish-list-lesson8.html">Усовершенствование внешнего вида приложения с использованием технологии CSS</a></p>
</li>
<li>
<p><a href="wish-list-lesson9.html">Развертывание приложения на удаленном веб-сервере</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. Содержимое этой страницы применимо к IDE NetBeans 7.2, 7.3, 7.4 и 8.0</div>
</div>
<div class="paragraph">
<p>В этом уроке функциональные возможности приложения будут расширены двумя компонентами:</p>
</div>
<div class="paragraph">
<p>Для реализации этих функций следует изменить файлы  <code>editWishList.php</code>  и  <code>editWish.php</code> . Кроме этого, следует создать новый файл с именем  <code>deleteWish.php</code> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l7.png" alt="page flow diagram l7">
</div>
</div>
<div class="paragraph">
<p>Текущий документ является частью краткого учебного курса "Создание приложения CRUD в IDE NetBeans для PHP".</p>
</div>
<div class="sect1">
<h2 id="_Исходный_код_приложения_из_предыдущего_урока">Исходный код приложения из предыдущего урока</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для пользователей MySQL: перейдите по <a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">этой ссылке</a> для загрузки исходного кода, описывающего состояние проекта на момент завершения предыдущего урока.</p>
</div>
<div class="paragraph">
<p>Для пользователей баз данных Oracle: перейдите по <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">этой</a> для загрузки исходного кода, описывающего состояние проекта на момент завершения предыдущего урока.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Редактирование_пожелания">Редактирование пожелания</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Функциональные возможности поддерживают следующий вариант использования:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>На странице  <code>editWishList.php</code>  пользователь нажимает кнопку "Edit" справа от пожелания. Откроется страница  <code>editWish.php</code>  с данными выбранного пожелания.</p>
</li>
<li>
<p>Пользователь изменяет описание и/или срок выполнения пожелания, а затем нажимает кнопку "Save Changes".</p>
</li>
<li>
<p>Если описание <em>не</em> заполнено, то выводится сообщение об ошибке, после чего выполняется возврат к странице  <code>editWish.php</code> .</p>
</li>
<li>
<p>Если описание заполнено, то выполняется возврат к странице  <code>editWishList.php</code> , на которой можно обновить данные пожелания.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Реализация состоит из следующих действий:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#addEditButton">Добавление кнопки "Edit" на страницу "editWishList"</a></p>
</li>
<li>
<p><a href="#wishArrayUpdate">На странице editWish.php — обновление массива $wish для хранения данных пожеланий</a></p>
</li>
<li>
<p><a href="#updateInputForm">Обновление формы ввода на странице editWish.php</a></p>
</li>
<li>
<p><a href="#updateWishRecord">Проверка правильности переданных данных и обновление пожелания в базе данных</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_Реализация_кнопки_edit">Реализация кнопки "Edit"</h3>
<div class="paragraph">
<p>Таблица  <code>editWishList.php</code>  (таблица, включающая все пожелания, созданные пользователем) реализуется с помощью цикла (оператор  <code>while</code> ), который выводит на экран строки с пожеланиями, в то время как пожелания выбираются из базы данных. Добавьте кнопку "Edit" как крайнюю правую ячейку в ряду.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для обеспечения передачи идентификатора пожелания посредством формы ввода HTML он должен быть сохранен в виде переменной. Введите следующую строку кода в конце цикла  <code>while </code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">while ($row = ...) {echo ...echo ...*$wishID = $row["id"];*}
?&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создайте кнопку правки. С помощью формы editWish добавьте еще одну ячейку таблицы перед закрывающим тегом &lt;/table&gt;. Эта форма содержит компонент кнопки и скрытый компонент, который при нажатии кнопки отправляет значение  <code>$wishID</code> . (Показан код для базы данных MySQL, но добавлен тот же код и в то же место, что и для базы данных Oracle.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">   Hello &lt;?php echo $_SESSION["user"]; ?&gt;&lt;br/&gt;&lt;table border="black"&gt;&lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;&lt;?phprequire_once("Includes/db.php");$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);$result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);while ($row = mysqli_fetch_array($result)) {echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";}mysqli_free_result($result);?&gt;
            *&lt;td&gt;
                &lt;form name="editWish" action="editWish.php" method="GET"&gt;
                    &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
                    &lt;input type="submit" name="editWish" value="Edit"&gt;
                    &lt;/form&gt;
            &lt;/td&gt;*&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Измените цикл  <code>while</code> , чтобы использовать <a href="http://www.php.net/manual/en/control-structures.alternative-syntax.php">альтернативный синтаксис</a>. Это облегчает выполнение блоков HTML внутри цикла  <code>while</code> . В альтернативном синтаксисе цикла  <code>while</code>  открывающая фигурная скобка "{" заменяется двоеточием ":", а завершающая фигурная скобка "}" заменяется оператором  <code>endwhile;</code> . Замените открывающую фигурную скобку двоеточием, удалите закрывающую фигурную скобку и перед закрывающим тегом &lt;/table&gt; добавьте новый блок PHP с оператором  <code>endwhile;</code> . Это приводит к добавлению новой ячейки таблицы в цикле  <code>while</code> . Переместите код оператора free result/free на место после оператора  <code>endwhile;</code> . (И вновь приведен код для MySQL, но изменение кода и его местоположение точно такие же, как для базы данных Oracle.)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))[.line-through]#{#*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";[.line-through]#    }mysqli_free_result($result);#?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
*    &lt;?php
    endwhile;
    mysqli_free_result($result);
    ?&gt;*
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.
Исправьте синтаксис для строки таблицы. Переместите закрывающие строку символы &lt;/tr&gt;\n из оператора echo для срока выполнения в новый оператор echo непосредственно над оператором  <code>endwhile;</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;[.line-through]#&lt;/tr&gt;\n#";?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    *echo "&lt;/tr&gt;\n";*
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.
Код для таблицы, включая форму с кнопкой "Edit" (Изменить), в цикле  <code>while </code>  выглядит следующим образом.</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_Расширение_массива_code_wish_code">Расширение массива  <code>$wish</code></h3>
<div class="paragraph">
<p>После нажатия кнопки "Edit" на странице  <code>editWishList.php</code>  идентификатор выбранного пожелания передается на страницу  <code>editWish.php</code>  с использованием метода запроса к серверу "GET". Для сохранения идентификатора пожелания следует добавить новый элемент к массиву  <code>$wish</code> .</p>
</div>
<div class="paragraph">
<p>Так же, как и при добавлении нового пожелания, в случае неудачной попытки сохранения можно перейти в форму ввода может как со страницы  <code>editWishList.php</code> , так и со страницы  <code>editWish.php</code> . Отличие между вариантами заключается в методе запроса к серверу, посредством которого осуществляется передача данных. Метод "GET" указывает, что форма отображается при первом переходе пользователя на эту страницу при нажатии на кнопку "Edit Wish". Метод POST указывает на то, что пользователь был перенаправлен в форму после попытки сохранения пожелания без описания.</p>
</div>
<div class="paragraph">
<p>В файле  <code>editWish.php</code>  замените блок PHP в HTML &lt;body&gt; выше формы ввода  <code>EditWish</code>  на расширенный код для массива  <code>$wish</code> .</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?phpif ($_SERVER["REQUEST_METHOD"] == "POST")$wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
        $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);else if (array_key_exists("wishID", $_GET))$wish = mysqli_fetch_array(WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]));else$wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php
if ($_SERVER["REQUEST_METHOD"] == "POST")
    $wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
            $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);
else if (array_key_exists("wishID", $_GET)) {
    $stid = WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]);
    $row = oci_fetch_array($stid, OCI_ASSOC);
    $wish = array("id" =&gt; $row["ID"], "description" =&gt;
                $row["DESCRIPTION"], "due_date" =&gt; $row["DUE_DATE"]);
    oci_free_statement($stid);
} else
$wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код инициализирует массив  <code>$wish</code>  с тремя элементами –  <code>id</code> ,  <code>description</code>  и  <code>due_date</code> . Значения этих элементов зависят от метода запроса к серверу. Если используется метод запроса к серверу "POST", то значения извлекаются из формы ввода. В противном случае, если используется метод запроса к серверу "GET", и при этом массив "$_GET" содержит элемент с ключом "wishID", значения извлекаются из базы данных функцией "get_wish_by_wish_id". Наконец, если не используется ни один из методов запроса ("POST" или "GET"), то это означает вариант добавления нового пожелания, т.е. что элементы пусты.</p>
</div>
<div class="paragraph">
<p>Указанный код включает все варианты создания и редактирования желаний. Теперь следует обновить код формы ввода таким образом, чтобы она подходила для обоих вариантов.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Обновление_формы_ввода_html">Обновление формы ввода HTML</h3>
<div class="paragraph">
<p>Пока форма ввода работает в том случае, когда требуется создать новое пожелание и отсутствует идентификатор пожелания. Чтобы форма работала в том случае, когда требуется редактировать существующее пожелание, необходимо добавить скрытое поле для передачи идентификатора пожелания. Значение этого скрытого поля должно извлекаться из массива $wish. На этапе создания нового пожелания значению должна соответствовать пустая строка. При редактировании пожелания значение скрытого поля должно измениться на идентификатор пожелания. Для создания скрытого поля добавьте следующую строку вверху формы ввода  <code>EditWish</code>  в файле  <code>editWish.php</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ["id"];?&gt;" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_Обновление_пожелания_в_базе_данных">Обновление пожелания в базе данных</h3>
<div class="paragraph">
<p>Теперь необходимо обновить код, который проверяет входные данные и вставляет пожелание в базу данных. Текущий код не различает варианты создания нового пожелания и обновления существующего. В текущей реализации к базе данных в любом случае добавляется новая запись, так как код не проверяет значение идентификатора пожелания, передаваемого из формы ввода.</p>
</div>
<div class="paragraph">
<p>Необходимо добавить следующие функции:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Если передаваемый элемент "wishID" является пустой строкой, то должно быть создано новое пожелание.</p>
</li>
<li>
<p>В противном случае, если элемент "wishID" не является пустой строкой, то пожелание должно быть обновлено.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Для обновления файла editWish.php для выполнения проверки того, является ли пожелание новым или требуется его обновить, необходимо выполнить следующее:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте функцию  <code>update_wish</code>  к  <code>db.php</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function update_wish($wishID, $description, $duedate){
    $description = $this-&gt;real_escape_string($description);if ($duedate==''){$this-&gt;query("UPDATE wishes SET description = '" . $description . "',due_date = NULL WHERE id = " . $wishID);} else$this-&gt;query("UPDATE wishes SET description = '" . $description ."', due_date = " . $this-&gt;format_date_for_sql($duedate). " WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function update_wish($wishID, $description, $duedate) {
    $query = "UPDATE wishes SET description = :desc_bv, due_date = to_date(:due_date_bv,
              'YYYY-MM-DD')  WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.
Добавьте функцию  <code>get_wish_by_wish_id</code>  к  <code>db.php</code> .</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function get_wish_by_wish_id ($wishID) {return $this-&gt;query("SELECT id, description, due_date FROM wishes WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function get_wish_by_wish_id($wishID) {
    $query = "SELECT id, description, due_date FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
    return $stid;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В главный метод, в верхний блок PHP файла  <code>editWish.php</code> , добавьте условие к последнему оператору <code>else</code>. Именно этот оператор  <code>else</code>  вставляет пожелание в базу данных. Замените его на оператор  <code>else if</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">else if ($_POST["wishID"]=="") {WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST["wish"], $_POST["dueDate"]);header('Location:  ``editWishList.php`` ' );exit;}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Введите или вставьте другой оператор  <code>else if</code>  после только что отредактированного:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">else if ($_POST["wishID"]!="") {WishDB::getInstance()-&gt;update_wish($_POST["wishID"], $_POST["wish"], $_POST["dueDate"]);header('Location:  ``editWishList.php`` ' );exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код выполняет проверку того, что элемент  <code>wishID</code>  в массиве  <code>$_POST</code>  не является пустой строкой (что означает перенаправление со страницы  <code>editWishList.php</code>  путем нажатия кнопки "Edit"), а также что пользователь указал описание пожелания. Если проверка выполнена успешно, код вызывает функцию  <code>update_wish</code>  с входными параметрами  <code>wishID</code> ,  <code>description</code>  и  <code>dueDate</code> .Эти параметры получены от формы ввода HTML с помощью метода POST. После вызова  <code>update_wish</code>  осуществляется переход на страницу  <code>editWishList.php</code> , и обработка блока PHP прерывается.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Тестирование_функциональной_возможности_редактирования_пожелания">Тестирование функциональной возможности редактирования пожелания</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Запустите приложение. На странице "index.php" заполните следующие поля: в поле "Username" введите "Tom", в поле "Password" введите "tomcat".
image::images/user-logon-to-edit-wish-list.png[]</p>
</li>
<li>
<p>Нажмите кнопку "Edit My Wish List". Откроется страница  <code>editWishList.php</code> .
image::images/edit-wish-list-edit-wish.png[]</p>
</li>
<li>
<p>Нажмите кнопку "Edit" рядом с пожеланием "Icecream". Откроется страница  <code>editWish.php</code> .
image::images/edit-wish.png[]</p>
</li>
<li>
<p>Отредактируйте поля и нажмите кнопку "Back to the List". Откроется страница  <code>editWishList.php</code> , однако изменения не сохранены.</p>
</li>
<li>
<p>Нажмите кнопку "Edit" рядом с "Icecream". Очистите поле "Describe your wish" и нажмите кнопку "Save Changes". Появится сообщение об ошибке.
image::images/editWishEmptyDescription.png[]</p>
</li>
<li>
<p>Введите "Chocolate icecream" в поле "Describe your wish" и нажмите "Save Changes". Откроется страница  <code>editWishList.php</code>  с обновленным списком пожеланий.
image::images/editWishListWishAdded.png[]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Удаление_пожелания">Удаление пожелания</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Теперь, научившись создавать, читать и обновлять пожелания, добавьте метод для удаления пожелания.</p>
</div>
<div class="paragraph">
<p><strong>Для предоставления пользователю возможности удаления пожелания необходимо выполнить следующее:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте функцию  <code> delete_wish</code>  к  <code>db.php</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">function delete_wish ($wishID){$this-&gt;query("DELETE FROM wishes WHERE id = " . $wishID);}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public function delete_wish($wishID) {
    $query = "DELETE FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Создайте новый файл PHP с именем  <code>deleteWish.php</code>  и введите следующий код в блок &lt;? php ? &gt;:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">require_once("Includes/db.php");WishDB::getInstance()-&gt;delete_wish ($_POST["wishID"]);header('Location:  ``editWishList.php`` ' );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код обращается к файлу  <code>db.php</code> . Затем выполняется вызов функции  <code>delete_wish</code>  из экземпляра WishDB со значением  <code>wishID</code>  в качестве входного параметра. Наконец, выполняется перенаправление на страницу  <code>editWishList.php</code> .
3. Для реализации кнопки "Delete" (Удалить) добавьте еще одну ячейку таблицы HTML к циклу  <code>while</code>  в файле  <code>editWishList.php</code> , непосредственно ниже блока кода для кнопки  <code>editWish</code> . Форма ввода HTML содержит скрытое поле для  <code>wishID</code>  и кнопу отправки данных с надписью "Delete". (Показан код для базы данных MySQL, но добавлен тот же код и в то же место, что и для базы данных Oracle.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">    while ($row = mysqli_fetch_array($result))*:*echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;[.line-through]#&lt;/tr&gt;\n#";?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo  ``$wish`` ID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    *&lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;*
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Код для таблицы, включая форму с кнопкой "Edit" (Изменить), в цикле  <code>while </code>  выглядит следующим образом.</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description") . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Тестирование_функциональной_возможности_удаления_пожелания">Тестирование функциональной возможности удаления пожелания</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для проверки правильности реализации этой функциональной возможности нажмите "Delete" рядом с любым элементом на странице  <code>editWishList.php</code> . Элемент удаляется из списка.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deleteWish.png" alt="deleteWish">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Исходный_код_приложения_на_момент_завершения_текущего_урока">Исходный код приложения на момент завершения текущего урока</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для пользователей MySQL: щелкните <a href="https://netbeans.org/files/documents/4/1933/lesson7.zip">здесь</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
<div class="paragraph">
<p>Для пользователей Oracle Database: щелкните <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson7.zip">здесь</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Что_дальше">Что дальше?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson6.html">&lt;&lt;Предыдущий урок</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson8.html">Следующий урок &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">Назад на главную страницу руководства</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%207:%20Updating%20and%20Deleting%20DB%20Entries">Отправить отзыв по этому учебному курсу</a></p>
</div>
<div class="paragraph">
<p>Для отправки комментариев и предложений, получения поддержки и новостей о последних разработках, связанных с PHP IDE NetBeans <a href="../../../community/lists/top.html">присоединяйтесь к списку рассылки users@php.netbeans.org</a>.</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">Возврат к учебной карте PHP</a></p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/incubator-netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/incubator-netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_ru.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1>About</h1>
                <ul>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                    <li><a href="https://incubator.apache.org/projects/netbeans.html">Incubation Status</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <p><a href="https://incubator.apache.org/" alt="Apache Incubator"><img src='/images/incubator_feather_egg_logo_bw_crop.png' title='Apache Incubator'></img></a></p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache NetBeans is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
            <p>Apache Incubator, Apache, Apache NetBeans, NetBeans, the Apache feather logo, the Apache NetBeans logo, and the Apache Incubator project logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
