
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>第 7 课：更新和删除数据库中的条目</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="第 7 课：更新和删除数据库中的条目 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 第 7 课：更新和删除数据库中的条目">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">第 7 课：更新和删除数据库中的条目</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_来自上一课的应用程序源代码">来自上一课的应用程序源代码</a></li>
<li><a href="#_编辑愿望">编辑愿望</a>
<ul class="sectlevel2">
<li><a href="#_实现_edit_按钮">实现 "Edit" 按钮</a></li>
<li><a href="#_扩充_wish_数组">扩充  <code>$wish</code>  数组</a></li>
<li><a href="#_更新_html_输入窗体">更新 HTML 输入窗体</a></li>
<li><a href="#_更新数据库中的愿望">更新数据库中的愿望</a></li>
</ul>
</li>
<li><a href="#_测试编辑愿望功能">测试编辑愿望功能</a></li>
<li><a href="#_删除愿望">删除愿望</a></li>
<li><a href="#_测试删除愿望功能">测试删除愿望功能</a></li>
<li><a href="#_完成当前课程后的应用程序源代码">完成当前课程后的应用程序源代码</a></li>
<li><a href="#_后续步骤">后续步骤</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>在本课中，将使用以下两个功能扩展应用程序功能：</p>
</div>
<div class="paragraph">
<p>要实现这些功能，请编辑  <code>editWishList.php</code>  和  <code>editWish.php</code>  文件。您还会创建一个名为  <code>deleteWish.php</code>  的新文件。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l7.png" alt="page flow diagram l7">
</div>
</div>
<div class="paragraph">
<p>当前文档是“在适用于 PHP 的 NetBeans IDE 中创建 CRUD 应用程序”教程的一部分。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_来自上一课的应用程序源代码">来自上一课的应用程序源代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL 用户：单击<a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">此处</a>以下载源代码，该代码反映了在完成上一课之后的项目状态。</p>
</div>
<div class="paragraph">
<p>Oracle 数据库用户：单击<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">此处</a>以下载源代码，该代码反映了在完成上一课之后的项目状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_编辑愿望">编辑愿望</h2>
<div class="sectionbody">
<div class="paragraph">
<p>该功能支持以下用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在  <code>editWishList.php</code>  页上，用户按愿望右侧的 "Edit" 按钮。包含选定愿望数据的  <code>editWish.php</code>  页打开。</p>
</li>
<li>
<p>用户更改愿望说明和/或截止日期，然后按 "Save Changes" 按钮。</p>
</li>
<li>
<p>如果_未_填写说明，则会显示一条错误消息，且用户将返回到  <code>editWish.php</code>  页。</p>
</li>
<li>
<p>如果填写了说明，应用程序将返回到  <code>editWishList.php</code>  页，将在其中更新愿望。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>该实现包括以下步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_implementing_the_edit_button">在 editWishList 页上添加 "Edit" 按钮</a></p>
</li>
<li>
<p><a href="#_expanding_the_code_wish_code_array">在 editWish.php 页上更新 $wish 数组以存储愿望数据</a></p>
</li>
<li>
<p><a href="#_updating_the_html_input_form">在 editWish.php 页上更新输入窗体</a></p>
</li>
<li>
<p><a href="#_updating_the_wish_in_the_database">验证提交的数据并更新数据库中的愿望</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_实现_edit_按钮">实现 "Edit" 按钮</h3>
<div class="paragraph">
<p>在  <code>editWishList.php</code>  中，通过一个循环（ <code>while</code>  语句）实现包含许愿者愿望的表；从数据库中选择愿望时，该循环将显示包含愿望的行。添加 "Edit" 按钮作为行中最右侧的单元格。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>要通过 HTML 输入窗体传输愿望 ID，请将其存储在变量中。在  `while ` 循环末尾，输入以下代码行：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">while ($row = mysqli_fetch_array($result)):
    echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
    echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
    $wishID = $row['id'];
    echo "&lt;td&gt;WishID=" . $wishID . "&lt;/td&gt;";
    //The loop is left open
    ?&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>实现 "Edit" 按钮。在结束 &lt;/table&gt; 标记前面，使用 editWish 窗体添加另一个窗体元格。该窗体包含一个按钮组件和一个隐藏组件；在单击该按钮时，该隐藏组件将发送  <code>$wishID</code>  值。（显示的是 MySQL 数据库代码，但为 Oracle 数据库添加的代码是相同的并位于相同的位置。）</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Hello &lt;?php echo $_SESSION["user"]; ?&gt;&lt;br/&gt;
&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"&gt;
            &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>更改  <code>while</code>  循环以使用<a href="http://www.php.net/manual/en/control-structures.alternative-syntax.php">替代语法</a>。这可简化在  <code>while</code>  循环中执行 HTML 块的过程。在替代  <code>while</code>  循环语法中，左花括号 { 将替换为冒号 (:)，右花括号 } 将替换为  <code>endwhile;</code>  语句。将左花括号替换为冒号，删除右花括号，然后在结束 &lt;/table&gt; 标记前面使用  <code>endwhile;</code>  语句添加一个新 PHP 块。这会将新表单元格包含在  <code>while</code>  循环中。将释放结果/释放语句代码移到  <code>endwhile;</code>  语句后面。（同样，显示的是 MySQL 数据库代码，但 Oracle 数据库的代码更改和位置是相同的。）</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">   while ($row = mysqli_fetch_array($result)){:
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>.
修复表行语法。将行结束 &lt;/tr&gt;\n 字符从截止日期回显语句移到新回显语句（紧靠  <code>endwhile;</code>  上面）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">    while ($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>.
整个表（包括将 "Edit" 按钮放在  <code>while</code>  循环内的窗体）现在显示如下：</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_扩充_wish_数组">扩充  <code>$wish</code>  数组</h3>
<div class="paragraph">
<p>在  <code>editWishList.php</code>  页上按 "Edit" 按钮时，选定愿望的 ID 将通过服务器请求方法 GET 传输到  <code>editWish.php</code>  页。要存储愿望 ID，您需要在  <code>$wish</code>  数组中添加新元素。</p>
</div>
<div class="paragraph">
<p>与添加新愿望一样，保存尝试失败后可以从  <code>editWishList.php</code>  页和  <code>editWish.php</code>  页访问输入窗体。因此，可通过传输数据时使用的服务器请求方法来区分这两种情况。GET 表示在用户第一次通过按 "Edit Wish" 访问页面时显示窗体。POST 表示在尝试保存没有说明的愿望后将用户重定向到窗体。</p>
</div>
<div class="paragraph">
<p>在  <code>editWish.php</code>  中，将  <code>EditWish</code>  输入窗体上面 HTML &lt;body&gt; 中的 PHP 块替换为扩展的  <code>$wish</code>  数组代码。</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($_SERVER["REQUEST_METHOD"] == "POST")
    $wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
            $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);
else if (array_key_exists("wishID", $_GET))
    $wish = mysqli_fetch_array(WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]));
else
    $wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($_SERVER["REQUEST_METHOD"] == "POST")
    $wish = array("id" =&gt; $_POST["wishID"], "description" =&gt;
                $_POST["wish"], "due_date" =&gt; $_POST["dueDate"]);
else if (array_key_exists("wishID", $_GET)) {
    $stid = WishDB::getInstance()-&gt;get_wish_by_wish_id($_GET["wishID"]);
    $row = oci_fetch_array($stid, OCI_ASSOC);
    $wish = array("id" =&gt; $row["ID"], "description" =&gt;
                $row["DESCRIPTION"], "due_date" =&gt; $row["DUE_DATE"]);
    oci_free_statement($stid);
} else
    $wish = array("id" =&gt; "", "description" =&gt; "", "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码使用以下三个元素初始化  <code>$wish</code>  数组： <code>id</code> 、 <code>description</code>  和  <code>due_date</code> 。这些元素的值取决于服务器请求方法。如果服务器请求方法是 POST，则从输入窗体中接收这些值。否则，如果服务器请求方法是 GET，并且 $_GET 数组包含具有 "wishID" 键的元素，则通过 get_wish_by_wish_id 函数从数据库中检索这些值。最后，如果服务器请求方法既不是 "POST" 也不是 "GET"（表示是“添加新的愿望”用例），则这些元素为空。</p>
</div>
<div class="paragraph">
<p>前面的代码涉及创建和编辑愿望的用例。现在，您需要更新输入窗体，以便将其用于这两种情况。</p>
</div>
</div>
<div class="sect2">
<h3 id="_更新_html_输入窗体">更新 HTML 输入窗体</h3>
<div class="paragraph">
<p>目前，输入窗体适用于以下情况：您要创建新的愿望，并且没有愿望 ID。要使窗体适用于编辑现有愿望的情况，您需要添加一个隐藏字段以传输愿望 ID。必须从 $wish 数组中检索隐藏字段的值。在创建新的愿望期间，该值必须是一个空字符串。如果编辑了愿望，则必须将隐藏字段的值更改为愿望 ID。要创建该隐藏字段，请在  <code>editWish.php</code>  中的  <code>EditWish</code>  输入窗体上面添加以下行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;input type="hidden" name="wishID" value="&lt;?php echo  `$wish` ["id"];?&gt;" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_更新数据库中的愿望">更新数据库中的愿望</h3>
<div class="paragraph">
<p>现在，您需要更新用于验证输入数据和将愿望插入到数据库的代码。当前代码不区分创建新的愿望和更新现有愿望的情况。在当前实现中，始终将新记录添加到数据库中，因为该代码不验证从输入窗体传输的愿望 ID 值。</p>
</div>
<div class="paragraph">
<p>您需要添加以下函数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果传输的元素 "wishID" 是一个空字符串，则创建一个新愿望。</p>
</li>
<li>
<p>否则，如果元素 "wishID" 不是空字符串，则更新该愿望。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>更新 editWish.php 以验证愿望是否为新愿望并在愿望不是新愿望时进行更新：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将  <code>update_wish</code>  函数添加到  <code>db.php</code>  中。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">public function update_wish($wishID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($duedate==''){
        $this-&gt;query("UPDATE wishes SET description = '" . $description . "',
            due_date = NULL WHERE id = " . $wishID);
    } else
        $this-&gt;query("UPDATE wishes SET description = '" . $description .
            "', due_date = " . $this-&gt;format_date_for_sql($duedate)
            . " WHERE id = " . $wishID);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">public function update_wish($wishID, $description, $duedate) {
    $query = "UPDATE wishes SET description = :desc_bv, due_date = to_date(:due_date_bv, 'YYYY-MM-DD')
                WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>.
将  <code>get_wish_by_wish_id</code>  函数添加到  <code>db.php</code>  中。</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">public function get_wish_by_wish_id ($wishID) {
    return $this-&gt;query("SELECT id, description, due_date FROM wishes WHERE id = " . $wishID);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">public function get_wish_by_wish_id($wishID) {
    $query = "SELECT id, description, due_date FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
    return $stid;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在  <code>editWish.php</code>  顶部的主 PHP 块中，在最终的 <code>else</code> 语句中添加一个条件。这是将愿望插入到数据库的  <code>else</code>  语句。将其更改为  <code>else if</code>  语句：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">else if ($_POST["wishID"]=="") {
    WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST["wish"], $_POST["dueDate"]);
    header('Location: editWishList.php' );
    exit;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在刚编辑的语句下面，键入或粘贴另一个  <code>else if</code>  语句：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">else if ($_POST["wishID"]!="") {
    WishDB::getInstance()-&gt;update_wish($_POST["wishID"], $_POST["wish"], $_POST["dueDate"]);
    header('Location: editWishList.php' );
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码检查  <code>$_POST</code>  数组中的  <code>wishID</code>  元素是否为空字符串，这意味着通过按 "Edit" 按钮从  <code>editWishList.php</code>  页重定向了用户，并且用户填写了愿望说明。如果检查成功，则该代码将使用输入参数  <code>wishID</code> 、 <code>description</code>  和  <code>dueDate</code>  调用函数  <code>update_wish</code> 。通过 POST 方法从 HTML 输入窗体接收这些参数。在调用  <code>update_wish</code>  后，应用程序将重定向到  <code>editWishList.php</code>  页并取消 PHP 处理。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试编辑愿望功能">测试编辑愿望功能</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行应用程序。在 index.php 页上，填写以下字段：在 "Username" 字段中输入 "Tom"，在 "Password" 字段中输入 "tomcat"。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>按 "Edit My Wish List" 按钮。 <code>editWishList.php</code>  页打开。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-edit-wish.png" alt="edit wish list edit wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>单击 Icecream 旁边的 "Edit"。 <code>editWish.php</code>  页打开。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish.png" alt="edit wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>编辑这些字段，然后按 "Back to the List"。 <code>editWishList.php</code>  页打开，但未保存更改。</p>
</li>
<li>
<p>按 Icecream 旁边的 "Edit"。清除 "Describe your wish" 字段，然后按 "Save Changes"。将显示一条错误消息。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/editWishEmptyDescription.png" alt="editWishEmptyDescription">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Describe your wish" 字段中输入 Chocolate icecream，然后按 "Save Changes"。 <code>editWishList.php</code>  页打开，并更新列表。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/editWishListWishAdded.png" alt="editWishListWishAdded">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_删除愿望">删除愿望</h2>
<div class="sectionbody">
<div class="paragraph">
<p>现在，您可以创建、读取和更新愿望，添加一个用于删除愿望的方法。</p>
</div>
<div class="paragraph">
<p><strong>允许用户删除愿望：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将  <code>delete_wish</code>  函数添加到  <code>db.php</code>  中。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function delete_wish ($wishID){
    $this-&gt;query("DELETE FROM wishes WHERE id = " . $wishID);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">public function delete_wish($wishID) {
    $query = "DELETE FROM wishes WHERE id = :wish_id_bv";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wish_id_bv', $wishID);
    oci_execute($stid);
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建一个名为  <code>deleteWish.php</code>  的新 PHP 文件，然后在 &lt;? php ?&gt; 块下键入或粘贴以下代码：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">require_once("Includes/db.php");
WishDB::getInstance()-&gt;delete_wish ($_POST["wishID"]);
header('Location: editWishList.php' );</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码允许使用  <code>db.php</code>  文件。然后，它会从 WishDB 实例中调用  <code>delete_wish</code>  函数，并将  <code>wishID</code>  作为输入参数。最后，应用程序将重定向到  <code>editWishList.php</code>  页。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>要实现 "Delete" 按钮，请在  <code>editWishList.php</code>  的  <code>while</code>  循环中添加另一个 HTML 表单元格，紧靠  <code>editWish</code>  按钮的代码块下面。HTML 输入窗体包含  <code>wishID</code>  隐藏字段以及一个标记为 "Delete" 的提交按钮。（显示的是 MySQL 数据库代码，但为 Oracle 数据库添加的代码是相同的并位于相同的位置。）</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">    while ($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
           &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"&gt;
           &lt;input type="submit" name="editWish" value="Edit"&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>整个表（包括将 "Edit" 按钮放在  <code>while</code>  循环内的窗体）现在显示如下：</p>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while($row = mysqli_fetch_array($result)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;";
        $wishID = $row["id"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;&lt;th&gt;Item&lt;/th&gt;&lt;th&gt;Due Date&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    require_once("Includes/db.php");
    $wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION["user"]);
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)):
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;";
        $wishID = $row["ID"];
    ?&gt;
    &lt;td&gt;
        &lt;form name="editWish" action="editWish.php" method="GET"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="editWish" value="Edit"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;form name="deleteWish" action="deleteWish.php" method="POST"&gt;
            &lt;input type="hidden" name="wishID" value="&lt;?php echo $wishID; ?&gt;"/&gt;
            &lt;input type="submit" name="deleteWish" value="Delete"/&gt;
        &lt;/form&gt;
    &lt;/td&gt;
    &lt;?php
    echo "&lt;/tr&gt;\n";
    endwhile;
    oci_free_statement($stid);
   ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试删除愿望功能">测试删除愿望功能</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要检查是否正确实现了该功能，请在  <code>editWishList.php</code>  页上按任何项目旁边的 "Delete"。该项目将不再出现在列表中。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/deleteWish.png" alt="deleteWish">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_完成当前课程后的应用程序源代码">完成当前课程后的应用程序源代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL 用户：单击<a href="https://netbeans.org/files/documents/4/1933/lesson7.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
<div class="paragraph">
<p>Oracle 数据库用户：单击<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson7.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_后续步骤">后续步骤</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson6.html">&lt;&lt; 上一课</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson8.html">下一课 &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">返回到教程主页</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%207:%20Updating%20and%20Deleting%20DB%20Entries">发送有关此教程的反馈意见</a></p>
</div>
<div class="paragraph">
<p>要发送意见和建议、获得支持以及随时了解 NetBeans IDE PHP 开发功能的最新开发情况，请<a href="../../../community/lists/top.html">加入 users@php.netbeans.org 邮件列表</a>。</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">返回至 PHP 学习资源</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson7_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
