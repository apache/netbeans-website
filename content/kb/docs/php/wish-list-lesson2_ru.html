
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Урок 2. Проектирование приложения. Чтение из базы данных</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Урок 2. Проектирование приложения. Чтение из базы данных - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Урок 2. Проектирование приложения. Чтение из базы данных">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Урок 2. Проектирование приложения. Чтение из базы данных</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_создание_проекта_php">Создание проекта PHP</a></li>
<li><a href="#_определение_блок_схемы_страницы">Определение блок-схемы страницы</a></li>
<li><a href="#_добавление_формы_к_index_php">Добавление формы к index.php</a></li>
<li><a href="#_создание_wishlist_php_и_тестирование_приложения">[[Создание wishlist.php и тестирование приложения]]</a></li>
<li><a href="#_установка_подключения_и_получение_идентификатора_автора_пожеланий">Установка подключения и получение идентификатора автора пожеланий</a></li>
<li><a href="#_отображение_таблицы_пожеланий">Отображение таблицы пожеланий</a></li>
<li><a href="#_исходный_код_приложения_на_момент_завершения_текущего_урока">Исходный код приложения на момент завершения текущего урока</a></li>
<li><a href="#_что_дальше">Что дальше?</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом уроке рассматривается создание и настройка проекта PHP для разработки приложения, создание списка страниц в приложении и определение отношений между ними. Кроме того, основная функциональность разрабатывается и тестируется на данных, введенных в пример базы данных в уроке 1.</p>
</div>
<div class="paragraph">
<p>Создаваемый в этом уроке код PHP выполняет следующие функции.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Получает имя лица, введенного пользователем.</p>
</li>
<li>
<p>Проверяет наличие этого лица в базе данных. Если лицо отсутствует в базе данных, выполняется выход с сообщением об ошибке.</p>
</li>
<li>
<p>Отображение таблицы пожеланий этого лица.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Текущий документ является частью краткого учебного курса "Создание приложения, управляемого базой данных, в IDE NetBeans для PHP".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_проекта_php">Создание проекта PHP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Выберите 'Файл' &gt; 'Создать проект' (Ctrl-Shift-N в Windows и Linux, ⌘-Shift-N в ОС Mac). Создайте новый проект PHP с именем "wishlist". После создания проекта PHP по умолчанию он будет содержать файл индекса  <code>index.php</code> . Для получения информации о создании и настройке проекта PHP см. <a href="project-setup.html">Настройка проекта PHP</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_определение_блок_схемы_страницы">Определение блок-схемы страницы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В рамках приложения возможны следующие варианты использования:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Пользователь просматривает список "Wish list" другого пользователя.</p>
</li>
<li>
<p>Пользователь регистрируется в качестве нового пользователя.</p>
</li>
<li>
<p>Пользователь входит в систему и создает собственный список пожеланий "Wish list".</p>
</li>
<li>
<p>Пользователь входит в систему и редактирует свой список пожеланий.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Для реализации этих базовых функциональных возможностей потребуется добавить следующие файлы PHP.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Первая страница index.php для входа в систему, регистрации и перехода к спискам "Wish list" других пользователей.</p>
</li>
<li>
<p>Страница wishlist.php для просмотра списка "Wish list" конкретного пользователя.</p>
</li>
<li>
<p>Страница createNewWisher.php для регистрации в качестве автора пожеланий.</p>
</li>
<li>
<p>Страница editWishList.php для редактирования списка его владельцем.</p>
</li>
<li>
<p>Страница editWish.php для создания и редактирования пожеланий.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram.png" alt="page flow diagram">
</div>
</div>
<div class="paragraph">
<p>После выполнения предварительных действий можно приступить к реализации базовой функциональности приложения. Начать следует с просмотра списка "Wish list" одного из пользователей. Для этой функции не требуется выполнять проверку допустимости, ее можно легко протестировать, поскольку в базу данных уже внесены тестовые данные. Функциональность компонента реализуются на двух страницах – index.php и wishlist.php.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_добавление_формы_к_index_php">Добавление формы к index.php</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Файл index.php не содержит код PHP, таким образом, можно просто удалить следующий блок:</p>
</div>
<div class="paragraph">
<p>Файл  <code>index.php</code>  используется в двух целях.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Отображение страницы с элементами управления для ввода данных.</p>
</li>
<li>
<p>Передача введенных данных в другой файл PHP для обработки данных. В этом учебном курсе данные передаются в файл с именем  <code>wishlist.php</code> , который создается в следующем разделе.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Эти действия выполняются с использованием формы HTML. Каждая форма HTML содержит следующее.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Набор полей, соответствующих элементам управления на странице.</p>
</li>
<li>
<p>"Действие", выполняемое после отправки пользователем данных в форме. Действие представлено путем к странице для обработки данных.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Для добавления формы к index.php выполните следующее.</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Перейдите к окну "Проекты", разверните узел проекта и узел "Файлы исходного кода", затем дважды щелкните файл  <code>index.php</code> . Файл  <code>index.php</code>  откроется в основной области редактора IDE. Файл содержит шаблон для ввода кодов PHP и HTML.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Можно пропустить предупреждения от средства проверки HTML.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Удалите блок PHP. Файл index.php не содержит код PHP.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remove-php-block.png" alt="remove php block">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте "Палитру" из меню "Окно" или нажав Ctrl-Shift-8.</p>
</li>
<li>
<p>Из раздела <strong>Формы HTML</strong> палитры перетащите форму в раздел &lt;body&gt; файла  <code>index.php</code> .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/form-dnd.png" alt="form dnd">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откроется диалоговое окно "Вставить форму". В поле "Действие" введите путь к файлу, в которой форма будет передавать данные. В данном случае введите  <code>wishlist.php</code> . (Этот файл будет создан в том же местоположении, что и файл  <code>index.php</code> . См. <a href="#createNewFile">Создание wishlist.php и тестирование приложения</a>.) Выберите метод GET для передачи данных. Присвойте форме произвольное имя, например,  <code>wishList</code> . Нажмите кнопку "ОК" после выполнения действия.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-form-dialog.png" alt="insert form dialog">
</div>
</div>
<div class="paragraph">
<p>Теперь файл выглядит следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/blank-form.png" alt="blank form">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Между открывающим и закрывающим тегами формы введите текст "Показать список пожеланий: ".</p>
</li>
<li>
<p>Перетащите компонент "Ввод текста" из раздела <strong>Формы HTML</strong> палитры в пространство после текста "Показать список пожеланий: ". Откроется диалоговое окно "Вставка ввода текста".</p>
</li>
<li>
<p>Присвойте вводу название  <code>user</code> . Выберите тип ввода  <code>text</code> . Оставьте все поля пустыми и нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-text-input.png" alt="insert text input">
</div>
</div>
<div class="paragraph">
<p>Теперь файл выглядит следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/form-with-text-input.png" alt="form with text input">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Добавьте пустую сроку над тегом &lt;/form&gt;. В эту пустую строку перетащите компонент "Кнопка" из раздела * Формы HTML* палитры.</p>
</li>
<li>
<p>Откроется диалоговое окно "Вставить кнопку". Введите  <code>Go</code>  в поле "Метка" и нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-button-dialog.png" alt="insert button dialog">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Теперь форма выглядит так, как показанный ниже код, с одним отличием. В коде ниже атрибут  <code>method</code>  явно указан в теге &lt;form&gt;. IDE NetBeans не добавил атрибут метода к используемой форме, поскольку значением по умолчанию этого атрибута является GET. Однако явное указание атрибута  <code>method</code>  упрощает понимание кода.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="wishlist.php" method="GET" name="wishList"&gt;
    Show wish list of:
    &lt;input type="text" name="user" value=""/&gt;
    &lt;input type="submit" value="Go" /&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на следующие элементы формы.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Открывающий тег &lt;form&gt; содержит атрибут  <code>action</code> . Атрибут action указывает файл, в который форма передает данные. В данном случае файл имеет имя  <code>wishlist.php</code>  и находится в той же папке, что и файл  <code>index.php</code> . (Этот файл будет создан в разделе <a href="#createNewFile">Создание wishlist.php и тестирование приложения</a>.)</p>
</li>
<li>
<p>Открывающий тег &lt;form&gt; также содержит метод для применения к переданным данным (GET). PHP использует массив  <code>$_GET</code>  или  <code>$_POST</code>  для значений, переданных этой формой, в зависимости от значения атрибута  <code>method</code> . В данном случае PHP использует  <code>$_GET</code> .</p>
</li>
<li>
<p>Компонент ввода  <code>text</code> . Этот компонент — текстовое поле для ввода имени пользователя, список пожеланий которого необходимо просмотреть. Начальное значение текстового поля — пустая строка. Имя этого поля —  <code>user</code> . PHP использует имя поля при создании массива для значений поля. В данном случае массив для значений этого поля —  <code>htmlentities($_GET["user"])</code> .</p>
</li>
<li>
<p>Компонент ввода  <code>submit</code>  со значением "Go". Тип "submit" означает, что поле ввода отображается на странице как кнопка. Значение "Go" — это метка поля. При нажатии пользователем кнопки данные в компоненте  <code>text</code>  передаются в файл, указанный в атрибуте  <code>action</code> .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_wishlist_php_и_тестирование_приложения">[[Создание wishlist.php и тестирование приложения]]</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В разделе <a href="#transferDataFromIndexToWishlist">Добавление формы к index.php</a> была создана форма, с помощью которой пользователь отправляет имя лица, список пожеланий которого необходимо просмотреть. Имя передается странице  <code>wishlist.php</code> . Однако этой страницы не существует. Если выполнить  <code>index.php</code> , при отправке имени возникнет ошибка "404: Файл не найден". В этом разделе будет создан файл  <code>wishlist.php</code> , затем будет выполнено тестирование приложения.</p>
</div>
<div class="paragraph">
<p><strong>Для создания wishlist.php и тестирования приложения выполните следующее.</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В созданном проекте 'wishlist' щелкните правой кнопкой мыши узел 'Исходные файлы' и выберите 'Создать &gt; Файл PHP' в контекстном меню. Откроется мастер создания веб-страниц PHP.</p>
</li>
<li>
<p>Введите  <code>wishlist</code>  в поле "Имя файла" и нажмите кнопку "Готово".</p>
</li>
<li>
<p>Щелкните правой кнопкой мыши узел 'Источники' и выберите 'Выполнить проект' в контекстном меню или щелкните значок 'Выполнить главный проект' <span class="image"><img src="images/run-main-project-button.png" alt="run main project button"></span>на панели инструментов, если проект задан как главный.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/index-php-works.png" alt="index php works">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>В поле "Show wish list of" введите "Tom" и нажмите "Go". Появится пустая страница со следующим URL-адресом: <a href="http://localhost:90/Lesson2/wishlist.php?user=tom" class="bare">http://localhost:90/Lesson2/wishlist.php?user=tom</a>. Наличие этого URL-адреса означает, что главная страница функционирует правильно.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_установка_подключения_и_получение_идентификатора_автора_пожеланий">Установка подключения и получение идентификатора автора пожеланий</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе сначала к файлу  <code>wishlist.php</code>  будет добавлен код для создания подключения к базе данных. Затем будет добавлен код для получения идентификатора автора пожеланий, который был введен в форме  <code>index.php</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Дважды щелкните файл wishlist.php. Открывшийся шаблон отличается от index.php. Файл должен начинаться и заканчиваться тегами &lt;html&gt;&lt;/html&gt; и &lt;body&gt;&lt;/body&gt;, поскольку файл будет содержать также код HTML.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;title&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php
            // put your code here
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для отображения заголовка после тега открытия &lt;body&gt; и перед генерируемым тегом &lt;?php введите следующий блок кода:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php"> Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;";?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь код должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;body&gt;
    Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;"; ?&gt;
    &lt;?php
        // put your code here
    ?&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Блок кода PHP выводит на экран данные, которые поступают посредством метода GET в поле "user". Это данные передаются со страницы  <code>index.php</code> , где имя владельца списка "Wish list" – "Tom" – было введено в текстовом поле "user". Повторите действия, указанные на странице <a href="#createNewFile">Testing index.php</a>, для проверки того, что wishlist.php функционирует правильно.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-title-works.png" alt="wishlist php title works">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Удалите раздел в шаблоне блока PHP с комментарием. В этом месте введите или вставьте следующий код. Этот код открывает подключение к базе данных.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$con = mysqli_connect("localhost", "phpuser", "phpuserpw");
if (!$con) {
    exit('Connect Error (' . mysqli_connect_errno() . ') '. mysqli_connect_error());
}
//set the default client character
set mysqli_set_charset($con, 'utf-8');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
if (!$con) {
    $m = oci_error();
    exit('Connect Error ' . $m['message']);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В соответствии с кодом производится попытка подключения к базе данных и выдается сообщение об ошибке в случае неудачи.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Может потребоваться изменить подключение к базе данных в команде  <code>oci_connect</code> . Стандартный синтаксис — "hostname/service name". Подключение к базе данных Oracle XE в этом фрагменте — "localhost/XE" в соответствии с этим синтаксисом.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Автозавершение кода IDE NetBeans можно использовать для функций mysqli или OCI8.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/codecompletion.png" alt="]image::images/codecompletion-oci.png[">
</div>
</div>
<div class="paragraph">
<p>.
Под фрагментом кода, описывающим подключение к базе данных, в том же блоке PHP укажите следующий код. Этот код получает идентификатор автора пожеланий, чей список был запрошен. Если автор пожеланий отсутствует в базе данных, код уничтожает/завершает процесс и отображает сообщение об ошибке.</p>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">mysqli_select_db($con, "wishlist");
$user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));
$wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");
if (mysqli_num_rows($wisher) &lt; 1) {
    exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
}
$row = mysqli_fetch_row($wisher);
$wisherID = $row[0];
mysqli_free_result($wisher);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle.</strong> (Имейте в виду, что oci8 не имеет эквиваленту  <code>mysqli_num_rows</code> )</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$query = "SELECT id FROM wishers WHERE NAME = :user_bv";
$stid = oci_parse($con, $query);
$user = $_GET['user'];

oci_bind_by_name($stid, ':user_bv', $user);
oci_execute($stid);

//Because user is a unique value I only expect one row
$row = oci_fetch_array($stid, OCI_ASSOC);
if (!$row) {
    exit("The person " . $user . " is not found. Please check the spelling and try again" );
}
$wisherID = $row['ID'];
oci_free_statement($stid);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Осуществляется выбор данных из базы данных  <code>wishlist</code>  с помощью подключения $con. Критерием выбора является имя, полученное со страницы index.php как "user".</p>
</div>
<div class="paragraph">
<p>Синтаксис оператора SQL  <code>SELECT</code>  может быть кратко описан следующим образом:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>После выполнения оператора SELECT укажите поля, из которых должны быть получены данные. Все поля отмечены звездочкой (*).</p>
</li>
<li>
<p>После блока FROM укажите имя таблицы, из которой требуется извлечь данные.</p>
</li>
<li>
<p>Блок WHERE является необязательным. Укажите в нем условия фильтрации.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Запрос mysqli возвращает объект результата. OCI8 возвращает выполненное выражение. В любом случае выполняется выборка строки из результатов выполненного запроса и извлекается значение строки идентификатора, которое сохраняется в переменной  <code>$wisherID</code> .</p>
</div>
<div class="paragraph">
<p>Наконец, освобождается результат mysqli или оператор OCI8. Для физического закрытия подключения необходимо освободить все ресурсы, использующие подключение. В противном случае внутренняя система подсчета ссылок PHP сохранит нижележащее подключение к базе данным открытым, даже если  <code>$con</code>  неприменимо после вызова  <code>mysqli_close()</code>  или  <code>oci_close()</code> .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Для MySQL параметр  <code>htmlentities($_GET["user"])</code>  используется с с escape-символом для предотвращения SQL-инъекций. См. <a href="http://en.wikipedia.org/wiki/SQL_injection">статью энциклопедии Wikipedia о введении SQL +] и link:http://us3.php.net/mysql_real_escape_string[+документацию mysql_real_escape_string</a>. Несмотря на то, что в контексте этого руководства риск возникновения опасных атак внедрения SQL маловероятен, рекомендуется исключить из участия в запросах MySQL такие строки, которые могли бы быть подвержены подобной атаке. OCI8 позволяет избежать этого благодаря переменным привязки.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>На данный момент блок PHP готов. При использовании базы данных MySQL файл  <code>wishlist.php</code>  теперь выглядит следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;&lt;?php$con = mysqli_connect("localhost", "phpuser", "phpuserpw");
  if (!$con) {
     exit('Connect Error (' . mysqli_connect_errno() . ') '
            . mysqli_connect_error());
  }//set the default client character set
  mysqli_set_charset($con, 'utf-8');
  mysqli_select_db($con, "wishlist");
  $user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));
  $wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");
  if (mysqli_num_rows($wisher) &lt; 1) {
     exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
  }
  $row = mysqli_fetch_row($wisher);
  $wisherID = $row[0];
  mysqli_free_result($wisher);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>При использовании базы данных Oracle файл  <code>wishlist.php</code>  выглядит следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;
  &lt;?php
  $con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
  if (!$con) {
     $m = oci_error();
     exit('Connect Error ' . $m['message'];
     exit;
  }
  $query = "SELECT id FROM wishers WHERE name = :user_bv";
  $stid = oci_parse($con, $query);
  $user = htmlentities($_GET["user"]);
  oci_bind_by_name($stid, ':user_bv', $user);
  oci_execute($stid);//Because user is a unique value I only expect one row
  $row = oci_fetch_array($stid, OCI_ASSOC);
  if (!$row) {
     exit("The person " . $user . " is not found. Please check the spelling and try again" );
  }
  $wisherID = $row["ID"];
  oci_free_statement($stid);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если при тестировании приложения было неверно введено имя пользователя, появится следующее сообщение.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-title-user-not-found-works.png" alt="wishlist php title user not found works">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_отображение_таблицы_пожеланий">Отображение таблицы пожеланий</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет добавлен код для отображения таблицы HTML пожеланий, связанных с автором пожеланий. Автор пожеланий определяется идентификатором, полученным в коде предыдущего раздела.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Под блоком PHP введите или вставьте следующий блок кода HTML. Этот код открывает таблицу, указывает цвет ее границ (черный) и определяет вид заголовка таблицы, содержащего столбцы "Item" и "Due Date".</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Тег &lt;/table&gt; закрывает таблицу.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Введите следующий код блока PHP над закрывающим тегом &lt;/table&gt;.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Для базы данных MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
    $result = mysqli_query($con, "SELECT description, due_date FROM wishes WHERE wisher_id=" . $wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);mysqli_close($con);
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Для базы данных Oracle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
    $query = "SELECT description, due_date FROM wishes WHERE wisher_id = :id_bv";
    $stid = oci_parse($con, $query);
    oci_bind_by_name($stid, ":id_bv", $wisherID);
    oci_execute($stid);
	while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
	    echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
	}
    oci_free_statement($stid);
	oci_close($con);
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Внутри кода:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Посредством запроса SELECT пожелания со сроками их выполнения для указанного пользователя извлекаются в соответствии с идентификатором, который, в свою очередь был извлечен в действии 4; кроме того, пожелания и соответствующие сроки выполнения сохраняются в массиве $result.</p>
</li>
<li>
<p>С помощью цикла отдельные элементы массива $result выводятся на экран в качестве строк таблиц, пока массив непуст.</p>
</li>
<li>
<p>Теги &lt;tr&gt;&lt;/tr&gt; формируют строки, теги &lt;td&gt;&lt;/td&gt; – ячейки внутри строк, а после символа \n начинается новая строка.</p>
</li>
<li>
<p>Функция  <code>htmlentities</code>  преобразует все символы, имеющие эквивалентные сущности HTML, в сущности HTML. Это помогает предотвратить <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">межсайтовые сценарии</a>.</p>
</li>
<li>
<p>В конце функции освобождают все ресурсы (результаты mysqli и выражения OCI8) и закрывают подключение к базе данных. Имейте в виду, что для физического закрытия подключения необходимо освободить все ресурсы, использующие подключение. В противном случае внутренняя система подсчета ссылок PHP сохранит нижележащее подключение к базе данным открытым, даже если подключение неприменимо после вызова  <code>oci_close()</code>  или  <code>mysqli_close()</code> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>*Предостережение. *Убедитесь, что названия полей базы данных введены точно так, как они указаны при создании таблицы базы данных. Для Oracle по умолчанию названия столбцов возвращаются в верхнем регистре.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Для тестирования приложения выполните проект, как описано в разделе <a href="#createNewFile">Тестирование index.php</a>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-works.png" alt="wishlist php works">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_исходный_код_приложения_на_момент_завершения_текущего_урока">Исходный код приложения на момент завершения текущего урока</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для пользователей MySQL: щелкните <a href="https://netbeans.org/files/documents/4/1928/lesson2.zip">здесь</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
<div class="paragraph">
<p>Для пользователей Oracle Database: щелкните <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson2.zip">сюда</a> для загрузки исходного кода, отражающего состояние проекта по завершении данного урока.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_что_дальше">Что дальше?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson1.html">&lt;&lt;Предыдущий урок</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson3.html">Следующий урок &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">Назад на главную страницу учебного курса</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
