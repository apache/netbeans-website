
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>PHPを使用するデータベース駆動型アプリケーションの作成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PHPを使用するデータベース駆動型アプリケーションの作成 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, PHPを使用するデータベース駆動型アプリケーションの作成">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/nb110/nb110.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 11.0</h1>
            <p><a class="button success" href="/download/nb110/nb110.html">Read more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">PHPを使用するデータベース駆動型アプリケーションの作成</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_ja.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel0">
<li><a href="#_レッスン2_アプリケーションの設計_データベースからの読取り">レッスン2: アプリケーションの設計。データベースからの読取り</a>
<ul class="sectlevel1">
<li><a href="#_phpプロジェクトの作成">PHPプロジェクトの作成</a></li>
<li><a href="#_ページ_フロー図の定義">ページ・フロー図の定義</a></li>
<li><a href="#_index_phpへのフォームの追加">index.phpへのフォームの追加</a></li>
<li><a href="#_wishlist_phpの作成とアプリケーションのテスト">wishlist.phpの作成とアプリケーションのテスト</a></li>
<li><a href="#_接続の確立とウィッシャidの取得">接続の確立とウィッシャIDの取得</a></li>
<li><a href="#_ウィッシュ表の表示">ウィッシュ表の表示</a></li>
<li><a href="#_現在のレッスン完了後のアプリケーション_ソース_コード">現在のレッスン完了後のアプリケーション・ソース・コード</a></li>
<li><a href="#_次の手順">次の手順</a></li>
<li><a href="#_便利なリンク">便利なリンク</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_レッスン2_アプリケーションの設計_データベースからの読取り" class="sect0">レッスン2: アプリケーションの設計。データベースからの読取り</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="wish-list-tutorial-main-page.html">PHPを使用するデータベース駆動型アプリケーションの作成 - メイン・ページ</a>
2.
データベースの作成</p>
</li>
<li>
<p><a href="wish-list-lesson1.html">MySQLデータベースの作成</a></p>
</li>
<li>
<p><a href="wish-list-oracle-lesson1.html">Oracleデータベース表の作成</a>
3.
<strong>&#8658; アプリケーションの設計。データベースからの読取り</strong></p>
</li>
<li>
<p><a href="wish-list-lesson3.html">新規アプリケーション・ユーザーの作成</a></p>
</li>
<li>
<p><a href="wish-list-lesson4.html">コードの最適化</a></p>
</li>
<li>
<p><a href="wish-list-lesson5.html">セキュリティの追加。アプリケーション・ユーザー・ログオンの実装</a></p>
</li>
<li>
<p><a href="wish-list-lesson6.html">データベースへの新しいウィッシュの追加</a></p>
</li>
<li>
<p><a href="wish-list-lesson7.html">データベース内のエントリの更新および削除</a></p>
</li>
<li>
<p><a href="wish-list-lesson8.html">CSSテクノロジを使用したアプリケーションの外観の改良</a></p>
</li>
<li>
<p><a href="wish-list-lesson9.html">リモートWebサーバーへのアプリケーションのデプロイ</a></p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp-80-74-73.png" alt="netbeans stamp 80 74 73">
</div>
<div class="title">Figure 1. このページの内容は、NetBeans IDE 7.2、7.3、7.4および8.0に適用されます</div>
</div>
<div class="paragraph">
<p>このレッスンでは、アプリケーションを開発するためにPHPプロジェクトを作成および構成し、アプリケーション内のページのリストを作成して、それらの関係を定義します。また、基本的なアプリケーションの機能を開発し、レッスン1のサンプル・データベースに入力したデータに対してテストします。</p>
</div>
<div class="paragraph">
<p>このレッスンで記述するPHPコードは次の機能を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユーザーが入力した個人の名前を取得します。</p>
</li>
<li>
<p>その個人が実際にデータベース内に存在するかどうかを確認します。個人がデータベースに存在しない場合はエラー・メッセージを表示して終了します。</p>
</li>
<li>
<p>その個人のウィッシュ表を表示します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>現在のドキュメントは、PHP向けのNetBeans IDEでのデータベース駆動型アプリケーションの作成というチュートリアルの一部です。</p>
</div>
<div class="sect1">
<h2 id="_phpプロジェクトの作成">PHPプロジェクトの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>「ファイル」&gt;「新規プロジェクト」(WindowsおよびLinuxでは[Ctrl]-[Shift]-[N]、MacOSでは[⌘]-[Shift]-[N])を選択します。「wishlist」という名前の新しいPHPプロジェクトを作成します。PHPプロジェクトを作成すると、PHPプロジェクトにはデフォルトでインデックス・ファイル <code>index.php</code> が含まれます。PHPプロジェクトの作成と構成については、<a href="project-setup.html">PHPプロジェクトの設定</a>を参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ページ_フロー図の定義">ページ・フロー図の定義</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アプリケーションのスコープは、次のユース・ケースをカバーしています。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ユーザーが、個人のウィッシュ・リストを表示する。</p>
</li>
<li>
<p>ユーザーを新規ウィッシャとして登録する。</p>
</li>
<li>
<p>ユーザーがログインして自分のウィッシュ・リストを作成する。</p>
</li>
<li>
<p>ユーザーがログインして自分のウィッシュ・リストを編集する。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>この基本的な機能をカバーするには、次のPHPファイルを実装する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ログイン、登録、および他のユーザーのウィッシュ・リストに切り替えるためのフロント・ページであるindex.php。</p>
</li>
<li>
<p>特定のウィッシャのウィッシュ・リストを表示するためのwishlist.phpページ。</p>
</li>
<li>
<p>ウィッシャとして登録するためのcreateNewWisher.phpページ。</p>
</li>
<li>
<p>所有者がウィッシュ・リストを編集するためのeditWishList.phpページ。</p>
</li>
<li>
<p>ウィッシュを作成して編集するためのeditWish.phpページ。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram.png" alt="page flow diagram">
</div>
</div>
<div class="paragraph">
<p>準備手順が終了したので、アプリケーションの基本的な機能の実装を開始できます。ウィッシャのウィッシュ・リストの表示から始めます。この機能には検証が含まれていませんが、テスト・データをデータベースにすでに入力しているため、簡単にテストできます。この機能は、index.phpとwishlist.phpの2つのページに実装されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_index_phpへのフォームの追加">index.phpへのフォームの追加</h2>
<div class="sectionbody">
<div class="paragraph">
<p>index.phpファイルにはPHPコードが含まれていないため、簡単に次のブロックを除去できます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``index.php`` ファイルは2つの目的で使用されます。</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>データを入力するためのコントロールがあるページを表示する。</p>
</li>
<li>
<p>入力されたデータを、データが処理される別のPHPファイルに転送する。このチュートリアルでは、データは、次の項で作成およびコーディングする <code>wishlist.php</code> という名前のファイルに渡されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらのアクションはHTMLフォームを使用して実行されます。それぞれのHTMLフォームには次が含まれています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ページ上のコントロールに対応するフィールドのセット。</p>
</li>
<li>
<p>ユーザーがフォームのデータを送信した後に実行されるアクション。アクションは、データを処理するページへのパスによって表現されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>index.phpにフォームを追加するには、次を実行します。</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>「プロジェクト」ウィンドウに切り替え、プロジェクト・ノードおよび「ソース・ファイル」ノードを展開し、 <code>index.php</code> ファイルをダブルクリックします。 <code>index.php</code> ファイルがメインのIDEエディタ領域で開きます。ファイルには、HTMLおよびPHPコードを入力するためのテンプレートが含まれています。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>*注意: *HTMLバリデータからの警告は無視できます。</p>
</div>
<div class="paragraph">
<p>.
2. PHPブロックを除去します。index.phpファイルにはPHPコードは含まれません。
image::images/remove-php-block.png[]
3. 「ウィンドウ」メニューから、または[Ctrl]-[Shift]-[8]を押して「パレット」を開きます。
4. パレットの「<strong>HTMLフォーム</strong>」セクションで、「フォーム」を <code>index.php</code> の&lt;body&gt;セクションにドラッグ・アンド・ドロップします。
image::images/form-dnd.png[]
5. 「挿入フォーム」ダイアログが開きます。「アクション」フィールドで、フォームによるデータの転送先のファイルへのパスを入力します。このケースでは、「 <code>wishlist.php</code> 」と入力します。(このファイルは <code>index.php</code> と同じ場所に作成します。<a href="#createNewFile">wishlist.phpの作成とアプリケーションのテスト</a>を参照。)データを転送するためのGETメソッドを選択します。フォームに対して <code>wishList</code> などの任意の名前を付けます。完了したら、「OK」をクリックします。
image::images/insert-form-dialog.png[]</p>
</div>
<div class="paragraph">
<p>ファイルは次のようになっています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/blank-form.png" alt="blank form">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>フォームの開始タグと終了タグの間に、「Show wish list of: 」というテキストを入力します。</p>
</li>
<li>
<p>パレットの「<strong>HTMLフォーム</strong>」セクションから、「テキスト入力」コンポーネントを「Show wish list of: 」の後のスペースにドラッグします。「挿入テキスト入力」ダイアログが開きます。</p>
</li>
<li>
<p>入力に <code>user</code> という名前を付けます。入力タイプは「 <code>テキスト</code> 」を選択します。その他のすべてのフィールドを空白のままにし、「OK」をクリックします。
image::images/insert-text-input.png[]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ファイルは次のようになっています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/form-with-text-input.png" alt="form with text input">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>&lt;/form&gt; タグの上に空白行を追加します。この空白行に、パレットの「<strong>HTMLフォーム</strong>」セクションから「ボタン」コンポーネントをドラッグ・アンド・ドロップします。</p>
</li>
<li>
<p>「挿入ボタン」ダイアログが開きます。「ラベル」フィールドに「 <code>Go</code> 」と入力して「OK」をクリックします。
image::images/insert-button-dialog.png[]</p>
</li>
<li>
<p>フォームは次のようなコードになり、違いは1つです。次のコードでは、&lt;form&gt;タグ内の <code>method</code> 属性が明示的になっています。NetBeans IDEはメソッド属性をフォームに追加しませんでしたが、この理由はGETがこの属性のデフォルト値であるためです。ただし、 <code>method</code> 属性が明示的であれば、コードが理解しやすくなる場合があります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;form action="wishlist.php" method="GET" name="wishList"&gt;Show wish list of: &lt;input type="text" name="user" value=""/&gt;&lt;input type="submit" value="Go" /&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>フォームの次の要素に注意してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>開始の&lt;form&gt;タグには <code>action</code> 属性が含まれています。action属性は、フォームがデータを転送するファイルを指定します。このケースでは、ファイルの名前は <code>wishlist.php</code> で、 <code>index.php</code> と同じフォルダに存在します。(このファイルは、<a href="#createNewFile">wishlist.phpの作成とアプリケーションのテスト</a>の項で作成します。)</p>
</li>
<li>
<p>開始の&lt;form&gt;タグには、データの転送に適用されるメソッド(GET)も含まれています。PHPは <code>method</code> 属性の値に応じて、このフォームによって渡される値について <code>$_GET</code> または <code>$_POST</code> 配列を使用します。このケースでは、PHPは <code>$_GET</code> を使用します。</p>
</li>
<li>
<p><code>text</code> 入力コンポーネント。このコンポーネントは、表示するウィッシュ・リストのユーザー名を入力するためのテキスト・フィールドです。テキスト・フィールドの開始値は、空の文字列です。このフィールドの名前は <code>user</code> です。PHPはフィールドの値の配列を作成するとき、フィールドの名前を使用します。この場合、このフィールドの値の配列は、 <code>htmlentities($_GET["user"])</code> です。</p>
</li>
<li>
<p>値が「Go」の <code>submit</code> 入力コンポーネント。「submit」タイプは、入力フィールドがボタンとしてページに表示されることを意味します。値「Go」はボタンのラベルです。ユーザーがボタンをクリックすると、 <code>text</code> コンポーネント内のデータは <code>action</code> 属性で指定されるファイルに転送されます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wishlist_phpの作成とアプリケーションのテスト">wishlist.phpの作成とアプリケーションのテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#transferDataFromIndexToWishlist">index.phpへのフォームの追加</a>では、ユーザーが表示するウィッシュ・リストの所有者の名前をユーザーが送信するフォームを作成しました。名前は <code>wishlist.php</code> ページに渡されます。ただし、このページは存在しません。 <code>index.php</code> を実行すると、名前を送信したときに「404: File Not Found」エラーを受け取ります。この項では、 <code>wishlist.php</code> を作成し、アプリケーションをテストします。</p>
</div>
<div class="paragraph">
<p><strong>wishlist.phpを作成してアプリケーションをテストするには、次を実行します。</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>作成した「wishlist」プロジェクト内の「ソース・ファイル」ノードでマウスの右ボタンをクリックし、コンテキスト・メニューから「新規」&gt;「PHPのWebページ」を選択します。新規PHPのWebページ・ウィザードが開きます。</p>
</li>
<li>
<p>「ファイル名」フィールドに「 <code>wishlist</code> 」と入力し、「終了」をクリックします。</p>
</li>
<li>
<p>「ソース」ノードでマウスの右ボタンをクリックしてコンテキスト・メニューから「プロジェクトの実行」をするか、または、プロジェクトをメインとして設定している場合は、ツールバーの「メイン・プロジェクトの実行」アイコンimage::images/run-main-project-button.png[]をクリックします。
image::images/index-php-works.png[]</p>
</li>
<li>
<p>「Show wish list of:」編集ボックスに「Tom」と入力し、「Go」をクリックします。URLがhttp://localhost:90/Lesson2/wishlist.php?user=tomの空のページが表示されます。このURLは、メイン・ページが正しく動作していることを示します。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_接続の確立とウィッシャidの取得">接続の確立とウィッシャIDの取得</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では最初に、データベースへの接続を作成するコードを <code>wishlist.php</code> に追加します。次に、名前が <code>index.php</code> フォームに入力されたウィッシャのID番号を取得するコードを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>wishlist.phpファイルをダブルクリックします。表示されるテンプレートは、index.phpとは異なります。このファイルはHTMLコードも含むため、ファイルの開始と終わりに&lt;html&gt;&lt;/html&gt;タグおよび&lt;body&gt;&lt;/body&gt;タグがあります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;?php// put your code here?&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>タイトルを表示するには、開始の&lt;body&gt;タグの直後で、生成された&lt;?phpタグの前に次のコード・ブロックを入力します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php"> Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;";?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>コードは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;body&gt;Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;";?&gt;&lt;?php// put your code here&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>PHPコード・ブロックは、「user」フィールドの取得メソッド(GET)を介して受け取ったデータを表示します。このデータは、テキスト・フィールド「user」に、ウィッシュ・リストの所有者であるTomの名前が入力されている <code>index.php</code> から転送されます。wishlist.phpが正しく動作していることを確認するために、<a href="#createNewFile">index.phpのテスト</a>の手順を繰り返します。
image::images/wishlist-php-title-works.png[]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>テンプレートPHPブロックのコメント付きセクションを削除します。その場所に、次のコードを入力するか、または貼り付けます。このコードはデータベースへの接続を開きます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">$con = mysqli_connect("localhost", "phpuser", "phpuserpw");if (!$con) {exit('Connect Error (' . mysqli_connect_errno() . ') '. mysqli_connect_error());}//set the default client character set mysqli_set_charset($con, 'utf-8');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">$con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
if (!$con) {
    $m = oci_error();
    exit('Connect Error ' . $m['message']);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これはデータベースへの接続を開くためのコードで、エラーが発生した場合はエラー・メッセージが表示されます。</p>
</div>
<div class="paragraph">
<p><strong>Oracleデータベース・ユーザーへの注意:</strong>  <code>oci_connect</code> コマンド内のデータベース接続を変更することが必要になる場合があります。標準の構文は「ホスト名/サービス名」です。このスニペット内でのOracle XEデータベースへの接続は、この構文に従って「localhost/XE」です。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> mysqli関数またはOCI8関数のいずれかについて、NetBeans IDEのコード補完を使用できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/codecompletion.png" alt="]image::images/codecompletion-oci.png[">
</div>
</div>
<div class="paragraph">
<p>4.
コードの下にデータベースへの接続が開き、同じPHPブロックに次のコードを入力するか、または貼り付けます。このコードは、ウィッシュ・リストがリクエストされたウィッシャのIDを取得します。ウィッシャがデータベースに存在しない場合、コードはプロセスを終了し、エラー・メッセージを表示します。</p>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">mysqli_select_db($con, "wishlist");$user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));$wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");if (mysqli_num_rows($wisher) &lt; 1) {
    exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
}$row = mysqli_fetch_row($wisher);$wisherID = $row[0];mysqli_free_result($wisher);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong> (oci8には <code>mysqli_num_rows</code> と同等のものが存在しません)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">$query = "SELECT id FROM wishers WHERE NAME = :user_bv";
$stid = oci_parse($con, $query);
$user = $_GET['user'];

oci_bind_by_name($stid, ':user_bv', $user);
oci_execute($stid);

//Because user is a unique value I only expect one row
$row = oci_fetch_array($stid, OCI_ASSOC);
if (!$row) {
    exit("The person " . $user . " is not found. Please check the spelling and try again" );
}
$wisherID = $row['ID'];
oci_free_statement($stid);</code></pre>
</div>
</div>
<div class="paragraph">
<p>データは、$con接続を介して <code>wishlist</code> データベースから選択されます。選択の基準は、index.phpから「user」として受け取った名前です。</p>
</div>
<div class="paragraph">
<p>次に、SQL文「 <code>SELECT</code> 」の構文を簡単に説明します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SELECTの後に、データの取得元のフィールドを指定します。アスタリスク(*)はすべてのフィールドを表します。</p>
</li>
<li>
<p>FROM節の後に、データを取得する表の名前を指定します。</p>
</li>
<li>
<p>WHERE節はオプションです。フィルタ条件を指定します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>mysqli問合せは結果オブジェクトを返します。OCI8は実行された文を返します。いずれの場合も、実行された問合せの結果から1行をフェッチし、ID行の値を抽出し、それを変数 <code>$wisherID</code> に格納します。</p>
</div>
<div class="paragraph">
<p>最後に、mysqli結果またはOCI8文を解放します。接続が物理的に切断される前に、接続を使用するすべてのリソースを解放する必要があります。そうしないと、 <code>mysqli_close()</code> コールまたは <code>oci_close()</code> コールの後に <code>$con</code> が使用できない場合でも、PHPの内部参照カウント・システムは、ベースとなるDB接続を開き続けます。</p>
</div>
<div class="paragraph">
<p>*セキュリティ上の注意: *MySQLの場合、「 <code>htmlentities($_GET["user"])</code> 」パラメータは、SQLインジェクション攻撃を避けるためにエスケープされます。<a href="http://en.wikipedia.org/wiki/SQL_injection">SQLインジェクションに関するWikipedia</a>および<a href="http://us3.php.net/mysql_real_escape_string">mysql_real_escape_stringのドキュメント</a>を参照してください。このチュートリアルのコンテキストでは、有害なSQLインジェクションのリスクはありませんが、そのような攻撃のリスクになるようなMySQL問合せの文字列はエスケープすることをお薦めします。OCI8では、バインド変数によってこれを回避します。</p>
</div>
<div class="paragraph">
<p>PHPブロックはこれで完了です。MySQLデータベースを使用している場合、 <code>wishlist.php</code> ファイルは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;&lt;?php$con = mysqli_connect("localhost", "phpuser", "phpuserpw");
  if (!$con) {
     exit('Connect Error (' . mysqli_connect_errno() . ') '
            . mysqli_connect_error());
  }//set the default client character set
  mysqli_set_charset($con, 'utf-8');
  mysqli_select_db($con, "wishlist");
  $user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));
  $wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");
  if (mysqli_num_rows($wisher) &lt; 1) {
     exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
  }
  $row = mysqli_fetch_row($wisher);
  $wisherID = $row[0];
  mysqli_free_result($wisher);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Oracleデータベースを使用している場合、 <code>wishlist.php</code> ファイルは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;
  &lt;?php
  $con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
  if (!$con) {
     $m = oci_error();
     exit('Connect Error ' . $m['message'];
     exit;
  }
  $query = "SELECT id FROM wishers WHERE name = :user_bv";
  $stid = oci_parse($con, $query);
  $user = htmlentities($_GET["user"]);
  oci_bind_by_name($stid, ':user_bv', $user);
  oci_execute($stid);//Because user is a unique value I only expect one row
  $row = oci_fetch_array($stid, OCI_ASSOC);
  if (!$row) {
     exit("The person " . $user . " is not found. Please check the spelling and try again" );
  }
  $wisherID = $row["ID"];
  oci_free_statement($stid);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションのテストで無効なユーザーを入力すると、次のメッセージが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-title-user-not-found-works.png" alt="wishlist php title user not found works">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ウィッシュ表の表示">ウィッシュ表の表示</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この項では、ウィッシャに関連付けられたウィッシュのHTML表を表示するコードを追加します。ウィッシャは、前の項のコードで取得したIDによって識別されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>PHPブロックの下に、次のHTMLコード・ブロックを入力するか、または貼り付けます。このコードは、表を開き、境界線の色を指定し(黒)、「Item」列および「Due Date」列を持つ表ヘッダーを「描画」します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/table&gt;タグが表を閉じます。
2.
次のPHPコード・ブロックを、終了&lt;/table&gt;タグの前に入力します。</p>
</div>
<div class="paragraph">
<p><strong>MySQLデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php$result = mysqli_query($con, "SELECT description, due_date FROM wishes WHERE wisher_id=" . $wisherID);while ($row = mysqli_fetch_array($result)) {echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";}mysqli_free_result($result);mysqli_close($con);?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Oracleデータベースの場合:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-php" data-lang="php">&lt;?php$query = "SELECT description, due_date FROM wishes WHERE wisher_id = :id_bv";$stid = oci_parse($con, $query);oci_bind_by_name($stid, ":id_bv", $wisherID);oci_execute($stid);while ($row = oci_fetch_array($stid)) {echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;&lt;/tr&gt;\n";}oci_free_statement($stid);oci_close($con);?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>コード内は次のようになっています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SELECT問合せは、ウィッシャのID(ステップ4で取得済)を使用して、指定したウィッシャに対するウィッシュの期日およびウィッシュを取得し、そのウィッシュと期日を配列$resultに格納します。</p>
</li>
<li>
<p>ループは、$result配列が空でない間、この配列の項目を表の行として表示します。</p>
</li>
<li>
<p>&lt;tr&gt;&lt;/tr&gt;タグは行を形成し、&lt;td&gt;&lt;/td&gt;タグは行内のセルを形成し、\nは新しい行を開始します。</p>
</li>
<li>
<p><code>htmlentities</code> 関数は、HTMLエンティティと等価な意味を持つすべての文字を、HTMLエンティティに変換します。これは、<a href="http://en.wikipedia.org/wiki/Cross-site_scripting">クロスサイト・スクリプティング</a>の防止に役立ちます。</p>
</li>
<li>
<p>最後の関数はすべてのリソース(mysqli結果およびOCI8文)を解放し、データベース接続を切断します。接続が物理的に切断できるようになる前に、接続を使用するすべてのリソースを解放する必要があります。そうしないと、 <code>oci_close()</code> コールまたは <code>mysqli_close()</code> コールの後に接続が使用できない場合でも、PHPの内部参照カウント・システムは、ベースとなるDB接続を開き続けます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>*注意: *データベース表の作成時に指定したとおりに、データベース・フィールドの名前を入力していることを確認してください。Oracleの場合、列名はデフォルトで大文字で返されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アプリケーションをテストするには、<a href="#createNewFile">index.phpのテスト</a>の項の説明に従ってプロジェクトを実行します。
image::images/wishlist-php-works.png[]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_現在のレッスン完了後のアプリケーション_ソース_コード">現在のレッスン完了後のアプリケーション・ソース・コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQLユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/files/documents/4/1928/lesson2.zip">ここ</a>をクリックします。</p>
</div>
<div class="paragraph">
<p>Oracleデータベース・ユーザー: このレッスンが完了した後のプロジェクトの状態を反映したソース・コードをダウンロードするには、<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson2.zip">ここ</a>をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_次の手順">次の手順</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson1.html">&lt;&lt; 前のレッスン</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson3.html">次のレッスン&gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">チュートリアルのメイン・ページに戻る</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_便利なリンク">便利なリンク</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTML、PHP、およびMySQLやOracleデータベースの使用については、次を参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.w3schools.com/html/">+HTML Tutorial +</a></p>
</li>
<li>
<p><a href="http://www.htmlcodetutorial.com/">HTML Code Tutorial - Free Reference Guide for Help with HTML Tags</a></p>
</li>
<li>
<p><a href="http://www.w3schools.com/php/default.asp">PHP Tutorial</a></p>
</li>
<li>
<p><a href="http://www.tizag.com/phpT/">PHP Tutorial - Learn PHP</a></p>
</li>
<li>
<p><a href="http://www.killerphp.com/">PHP Video Tutorials</a></p>
</li>
<li>
<p><a href="http://dev.mysql.com/tech-resources/articles/mysql_intro.html">Getting Started with MySQL</a></p>
</li>
<li>
<p><a href="http://www.killerphp.com/">PHP / MySQL Tutorial</a></p>
</li>
<li>
<p><a href="http://www.php-mysql-tutorial.com/">PHP MySQL Tutorial</a></p>
</li>
<li>
<p><a href="http://php.net/manual/en/book.oci8.php">The Oracle OCI8 Manual</a></p>
</li>
<li>
<p><a href="http://blogs.oracle.com/opal/">Christopher JonesのOCI8ブログ</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%202:%20Designing%20the%20Application">このチュートリアルに関するご意見をお寄せください</a></p>
</div>
<div class="paragraph">
<p><a href="../../../community/lists/top.html">users@php.netbeans.orgメーリング・リストに登録する</a>ことによって、NetBeans IDE PHP開発機能に関するご意見やご提案を送信したり、サポートを受けたり、最新の開発情報を入手したりできます。</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">PHPの学習に戻る</a></p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_ja.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
