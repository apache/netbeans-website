
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>第 2 课：设计应用程序。从数据库读取数据</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="第 2 课：设计应用程序。从数据库读取数据 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, 第 2 课：设计应用程序。从数据库读取数据">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">第 2 课：设计应用程序。从数据库读取数据</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_创建_php_项目">创建 PHP 项目</a></li>
<li><a href="#_定义页面流程图">定义页面流程图</a></li>
<li><a href="#_将窗体添加到_index_php">将窗体添加到 index.php</a></li>
<li><a href="#_创建_wishlist_php_和测试应用程序">创建 wishlist.php 和测试应用程序</a></li>
<li><a href="#_建立连接和获取许愿者_id">建立连接和获取许愿者 ID</a></li>
<li><a href="#_显示愿望表">显示愿望表</a></li>
<li><a href="#_完成当前课程后的应用程序源代码">完成当前课程后的应用程序源代码</a></li>
<li><a href="#_后续步骤">后续步骤</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>在本课中，将创建和配置 PHP 项目以开发应用程序，在应用程序中创建一组页面，然后定义它们之间的关系。您还会开发基本应用程序功能，并针对在第 1 课的样例数据库中输入的数据测试该功能。</p>
</div>
<div class="paragraph">
<p>本课中编写的 PHP 代码执行以下功能：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>获取用户所键入的个人名字。</p>
</li>
<li>
<p>检查此人是否确实在数据库中。如果此人不在数据库中，则会退出并显示错误消息。</p>
</li>
<li>
<p>显示此人的愿望表。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>当前文档是“在适用于 PHP 的 NetBeans IDE 中创建数据库驱动的应用程序”教程的一部分。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建_php_项目">创建 PHP 项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>选择 "File"（文件）&gt; "New Project"（新建项目）（在 Linux 和 Windows 上为 Ctrl-Shift-N 组合键，在 MacOS 上为 ⌘-Shift-N 组合键）。创建一个名为 "wishlist" 的新 PHP 项目。默认情况下，在创建 PHP 项目时，它包含  <code>index.php</code>  索引文件。有关创建和配置 PHP 项目的信息，请参见<a href="project-setup.html">设置 PHP 项目</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_定义页面流程图">定义页面流程图</h2>
<div class="sectionbody">
<div class="paragraph">
<p>应用程序范围涵盖以下用例：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>用户查看某人的愿望列表。</p>
</li>
<li>
<p>用户注册为新许愿者。</p>
</li>
<li>
<p>用户登录并创建她/他的愿望列表。</p>
</li>
<li>
<p>用户登录并编辑他/她的愿望列表。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>要涵盖此基本功能，您需要实现以下 PHP 文件：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>主页 index.php，用于登录、注册和切换到其他用户的愿望列表。</p>
</li>
<li>
<p>wishlist.php 页，用于查看特定许愿者的愿望列表。</p>
</li>
<li>
<p>createNewWisher.php 页，用于注册为许愿者。</p>
</li>
<li>
<p>editWishList.php 页，用于按所有者编辑愿望列表。</p>
</li>
<li>
<p>editWish.php 页，用于创建和编辑愿望。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram.png" alt="page flow diagram">
</div>
</div>
<div class="paragraph">
<p>现在，您已完成了预备步骤，接下来便可开始实现基本应用程序功能了。从查看许愿者的愿望列表入手。该功能不涉及任何验证并且可以轻松进行测试，因为您已在数据库中输入了测试数据。将在两个页面（index.php 和 wishlist.php）上实现该功能。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_将窗体添加到_index_php">将窗体添加到 index.php</h2>
<div class="sectionbody">
<div class="paragraph">
<p>index.php 文件不包含任何 PHP 代码，因此，您可以方便地删除以下块：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``index.php``  文件有两个用途：</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>显示包含数据输入控件的页面。</p>
</li>
<li>
<p>将输入的数据传输到另一个 PHP 文件，并在其中处理该数据。在本教程中，数据将传送到一个名为  <code>wishlist.php</code>  的文件，将在下一节中创建该文件并进行编码。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些操作是使用 HTML 窗体执行的。每个 HTML 窗体包含：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>与页面上的控件对应的一组字段。</p>
</li>
<li>
<p>在用户提交窗体上的数据后执行的“操作”。该操作由处理数据的页面的路径表示。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>将窗体添加到 index.php：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>切换到 "Projects"（项目）窗口，展开项目节点和 "Source Files"（源文件）节点，然后双击  <code>index.php</code>  文件。将在主 IDE 编辑器区域中打开  <code>index.php</code>  文件。该文件包含一个用于输入 HTML 和 PHP 代码的模板。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您可以忽略来自 HTML 验证器的警告。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>删除 PHP 块。index.php 文件将不包含任何 PHP 代码。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remove-php-block.png" alt="remove php block">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从 "Window"（窗口）菜单中打开 "Palette"（组件面板），也可以按 Ctrl-Shift-8 组合键打开。</p>
</li>
<li>
<p>从 "Palette"（组件面板）的 <strong>HTML Forms</strong>（HTML 窗体）部分中，将一个窗体拖放至  <code>index.php</code>  的 &lt;body&gt; 部分中。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/form-dnd.png" alt="form dnd">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"Insert Form"（插入窗体）对话框即打开。在 "Action"（操作）字段中，键入窗体将数据传输到的文件的路径。在本示例中，键入  <code>wishlist.php</code> 。（将在与  <code>index.php</code>  相同的位置中创建该文件。请参见<a href="#createNewFile">创建 wishlist.php 和测试应用程序</a>。）选择 "GET" 方法以传输数据。为窗体指定任意名称，例如  <code>wishList</code> 。完成后单击 "OK"（确定）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-form-dialog.png" alt="insert form dialog">
</div>
</div>
<div class="paragraph">
<p>现在，该文件如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/blank-form.png" alt="blank form">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在窗体的开头和结尾标记之间，键入 "Show wish list of: " 文本。</p>
</li>
<li>
<p>从 "Palette"（组件面板）的 <strong>HTML Forms</strong>（HTML 窗体）部分中，将一个文本输入组件拖放至 "Show wish list of: " 文本后面的空白区域中。"Insert Text Input"（插入文本输入）对话框打开。</p>
</li>
<li>
<p>将输入命名为  <code>user</code> 。选择输入类型  <code>text</code> （文本）。将所有其他字段保留空白，然后单击 "OK"（确定）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-text-input.png" alt="insert text input">
</div>
</div>
<div class="paragraph">
<p>现在，该文件如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/form-with-text-input.png" alt="form with text input">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 &lt;/form&gt; 标记上面添加一个空行。从 "Palette"（组件面板）的 <strong>HTML Forms</strong>（HTML 窗体）部分中，将一个 "Button"（按钮）组件拖放至该空行中。</p>
</li>
<li>
<p>"Insert Button"（插入按钮）对话框打开。在 "Label"（标签）字段中键入  <code>Go</code> ，然后单击 "OK"（确定）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/insert-button-dialog.png" alt="insert button dialog">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>现在，该窗体类似于下面的代码，但有一点不同。在下面的代码中，&lt;form&gt; 标记中的  <code>method</code>  属性是显式的。NetBeans IDE 没有在窗体中添加 method 属性，因为 GET 是该属性的默认值。不过，如果  <code>method</code>  属性是显式的，您可以更轻松地理解代码。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form action="wishlist.php" method="GET" name="wishList"&gt;
    Show wish list of:
    &lt;input type="text" name="user" value=""/&gt;
    &lt;input type="submit" value="Go" /&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意以下窗体元素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>起始 &lt;form&gt; 标记包含  <code>action</code>  属性。action 属性指定窗体将数据传输到的文件。在本示例中，该文件命名为  <code>wishlist.php</code> ，并位于与  <code>index.php</code>  相同的文件夹中。（将在<a href="#createNewFile">创建 wishlist.php 和测试应用程序</a>部分中创建该文件。）</p>
</li>
<li>
<p>起始 &lt;form&gt; 标记还包含传输数据时应用的方法 (GET)。PHP 使用  <code>$_GET</code>  或  <code>$_POST</code>  数组存储该窗体传送的值，具体取决于  <code>method</code>  属性的值。在本示例中，PHP 使用  <code>$_GET</code> 。</p>
</li>
<li>
<p><code>text</code>  输入组件。该组件是一个文本字段，用于输入用户的名字以查看其愿望列表。该文本字段的起始值是一个空字符串。该字段的名称是  <code>user</code> 。在创建数组以存储该字段的值时，PHP 将使用该字段的名称。在本示例中，存储该字段值的数组是  <code>htmlentities($_GET["user"])</code> 。</p>
</li>
<li>
<p>具有 "Go" 值的  <code>submit</code>  输入组件。submit 类型表示，输入字段作为按钮显示在页面上。"Go" 值是按钮的标签。当用户单击该按钮时，会将  <code>text</code>  组件中的数据传输至  <code>action</code>  属性中指定的文件。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建_wishlist_php_和测试应用程序">创建 wishlist.php 和测试应用程序</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在<a href="#transferDataFromIndexToWishlist">将窗体添加到 index.php</a> 部分中，您创建了一个窗体，用户可以在其中提交某个人的名字以查看其愿望列表。该名字将传送到  <code>wishlist.php</code>  页。不过，此页面并不存在。如果运行  <code>index.php</code> ，在提交名字时，将会出现 "404: File Not Found"（404：找不到文件）错误。在本部分中，将创建  <code>wishlist.php</code> ，然后测试应用程序。</p>
</div>
<div class="paragraph">
<p><strong>创建 wishlist.php 和测试应用程序：</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在创建的 "wishlist" 项目中，在 "Source Files"（源文件）节点上单击鼠标右键，然后从上下文菜单中选择 "New"（新建）&gt; "PHP Web Page"（PHP Web 页）。此时将打开 "New PHP Web Page"（新建 PHP Web 页）向导。</p>
</li>
<li>
<p>在 "File Name"（文件名）字段中键入  <code>wishlist</code> ，然后按 "Finish"（完成）。</p>
</li>
<li>
<p>在 "Sources"（源）节点上单击鼠标右键并从上下文菜单中选择 "Run Project"（运行项目），或者单击工具栏上的 "Run Main Project"（运行主项目）图标 <span class="image"><img src="images/run-main-project-button.png" alt="run main project button"></span>（如果您将项目设置为了“主项目”）。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/index-php-works.png" alt="index php works">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 "Show wish list of:" 编辑框中，输入 Tom，然后单击 "Go"。将显示一个具有以下 URL 的空白页：http://localhost:90/Lesson2/wishlist.php?user=tom。该 URL 表示主页正常工作。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_建立连接和获取许愿者_id">建立连接和获取许愿者 ID</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本部分中，先在  <code>wishlist.php</code>  中添加代码以创建数据库连接。然后，添加代码以检索在  <code>index.php</code>  窗体中键入其名字的许愿者的 ID 号。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>双击 wishlist.php 文件。打开的模板与 index.php 不同。该文件以 &lt;html&gt;&lt;/html&gt; 和 &lt;body&gt;&lt;/body&gt; 标记开头和结尾，因为该文件还包含 HTML 代码。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;title&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php
            // put your code here
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>要显示标题，请在紧靠起始 &lt;body&gt; 标记后面以及生成的 &lt;?php 标记前面的位置输入以下代码块：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php"> Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;";?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，代码如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;body&gt;
    Wish List of &lt;?php echo htmlentities($_GET["user"])."&lt;br/&gt;"; ?&gt;
    &lt;?php
        // put your code here
    ?&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>PHP 代码块显示通过 "user" 字段中的 GET 方法接收的数据。在 "user" 文本字段中输入愿望列表所有者 Tom 的名字时，将从  <code>index.php</code>  中传输该数据。重复<a href="#createNewFile">测试 index.php</a> 中的步骤，以查看 wishlist.php 是否正常工作。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-title-works.png" alt="wishlist php title works">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在模板 PHP 块中删除注释部分。在该位置键入或粘贴以下代码。该代码打开数据库连接。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$con = mysqli_connect("localhost", "phpuser", "phpuserpw");
if (!$con) {
    exit('Connect Error (' . mysqli_connect_errno() . ') '. mysqli_connect_error());
}
//set the default client character
set mysqli_set_charset($con, 'utf-8');</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
if (!$con) {
    $m = oci_error();
    exit('Connect Error ' . $m['message']);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码尝试打开数据库连接；如果失败，则会显示一条错误消息。</p>
</div>
<div class="paragraph">
<p>*Oracle 数据库用户注意事项：*您可能需要在  <code>oci_connect</code>  命令中修改数据库连接。标准语法为 "hostname/service name"。按照该语法，此代码片段中的 Oracle XE 数据库连接是 "localhost/XE"。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您可以使用 NetBeans IDE 的代码完成功能完成 mysqli 或 OCI8 函数。
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/codecompletion.png" alt="]image::images/codecompletion-oci.png[">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在打开数据库连接的代码下面，在同一 PHP 块中键入或粘贴以下代码。该代码检索请求其愿望列表的许愿者的 ID。如果许愿者不在数据库中，代码将终止/退出该进程，然后显示一条错误消息。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">mysqli_select_db($con, "wishlist");
$user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));
$wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");
if (mysqli_num_rows($wisher) &lt; 1) {
    exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
}
$row = mysqli_fetch_row($wisher);
$wisherID = $row[0];
mysqli_free_result($wisher);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong>（请注意，oci8 没有等效的  <code>mysqli_num_rows</code> ）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">$query = "SELECT id FROM wishers WHERE NAME = :user_bv";
$stid = oci_parse($con, $query);
$user = $_GET['user'];

oci_bind_by_name($stid, ':user_bv', $user);
oci_execute($stid);

//Because user is a unique value I only expect one row
$row = oci_fetch_array($stid, OCI_ASSOC);
if (!$row) {
    exit("The person " . $user . " is not found. Please check the spelling and try again" );
}
$wisherID = $row['ID'];
oci_free_statement($stid);</code></pre>
</div>
</div>
<div class="paragraph">
<p>将通过 $con 连接从  <code>wishlist</code>  数据库中选择数据。选择条件是从 index.php 中作为 "user" 接收的名字。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``SELECT``  SQL 语句的语法可以简述如下：</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>在 SELECT 后面，指定要从中获取数据的字段。星号 (*) 表示所有字段。</p>
</li>
<li>
<p>在 FROM 子句后面，指定必须从中检索数据的表的名称。</p>
</li>
<li>
<p>WHERE 子句是可选的。将在其中指定过滤条件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>mysqli 查询返回结果对象。OCI8 返回执行的语句。在这两种情况下，将从执行的查询结果中获取一行，并提取 ID 行的值以将其存储在  <code>$wisherID</code>  变量中。</p>
</div>
<div class="paragraph">
<p>最后，释放 mysqli 结果或 OCI8 语句。在实际关闭连接之前，您需要释放使用该连接的所有资源。否则，PHP 的内部引用计数系统会让基本 DB 连接保持打开，即使  <code>$con</code>  在  <code>mysqli_close()</code>  或  <code>oci_close()</code>  调用后无法使用。</p>
</div>
<div class="paragraph">
<p>*安全注意事项：*对于 MySQL，将转义  <code>htmlentities($_GET["user"])</code>  参数以防止 SQL 注入攻击。请参见<a href="http://en.wikipedia.org/wiki/SQL_injection">有关 SQL 注入的维基百科</a>和 <a href="http://us3.php.net/mysql_real_escape_string">mysql_real_escape_string 文档</a>。虽然在本教程的上下文中，您不会遇到有害 SQL 注入的风险，但最佳做法是转义存在此类攻击风险的 MySQL 查询中的字符串。OCI8 是通过绑定变量避免的。</p>
</div>
<div class="paragraph">
<p>此 PHP 块现已完成。如果使用的是 MySQL 数据库，则会看到  <code>wishlist.php</code>  文件现在如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;&lt;?php$con = mysqli_connect("localhost", "phpuser", "phpuserpw");
  if (!$con) {
     exit('Connect Error (' . mysqli_connect_errno() . ') '
            . mysqli_connect_error());
  }//set the default client character set
  mysqli_set_charset($con, 'utf-8');
  mysqli_select_db($con, "wishlist");
  $user = mysqli_real_escape_string($con, htmlentities($_GET["user"]));
  $wisher = mysqli_query($con, "SELECT id FROM wishers WHERE name='" . $user . "'");
  if (mysqli_num_rows($wisher) &lt; 1) {
     exit("The person " . htmlentities($_GET["user"]) . " is not found. Please check the spelling and try again");
  }
  $row = mysqli_fetch_row($wisher);
  $wisherID = $row[0];
  mysqli_free_result($wisher);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用的是 Oracle 数据库，则会看到  <code>wishlist.php</code>  文件现在如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Wish List of &lt;?php echo htmlentities($_GET["user"]) . "&lt;br/&gt;"; ?&gt;
  &lt;?php
  $con = oci_connect("phpuser", "phpuserpw", "localhost/XE", "AL32UTF8");
  if (!$con) {
     $m = oci_error();
     exit('Connect Error ' . $m['message'];
     exit;
  }
  $query = "SELECT id FROM wishers WHERE name = :user_bv";
  $stid = oci_parse($con, $query);
  $user = htmlentities($_GET["user"]);
  oci_bind_by_name($stid, ':user_bv', $user);
  oci_execute($stid);//Because user is a unique value I only expect one row
  $row = oci_fetch_array($stid, OCI_ASSOC);
  if (!$row) {
     exit("The person " . $user . " is not found. Please check the spelling and try again" );
  }
  $wisherID = $row["ID"];
  oci_free_statement($stid);
  ?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果测试应用程序并输入无效的用户，则会显示以下消息。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-title-user-not-found-works.png" alt="wishlist php title user not found works">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_显示愿望表">显示愿望表</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本部分中，将添加代码以显示与许愿者关联的 HTML 愿望表。许愿者是由在上一节的代码中检索的 ID 标识的。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 PHP 块下面，键入或粘贴以下 HTML 代码块。该代码打开一个表，指定其边框颜色（黑色），然后使用 "Item" 和 "Due Date" 列“绘制”表标题。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;/table&gt;</code> 标记用于结束表。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在结束 &lt;/table&gt; 标记上面，输入以下 PHP 代码块。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>对于 MySQL 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
    $result = mysqli_query($con, "SELECT description, due_date FROM wishes WHERE wisher_id=" . $wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["description"]) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row["due_date"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);mysqli_close($con);
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>对于 Oracle 数据库：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
    $query = "SELECT description, due_date FROM wishes WHERE wisher_id = :id_bv";
    $stid = oci_parse($con, $query);
    oci_bind_by_name($stid, ":id_bv", $wisherID);
    oci_execute($stid);
	while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row["DESCRIPTION"]) . "&lt;/td&gt;";
	    echo "&lt;td&gt;" . htmlentities($row["DUE_DATE"]) . "&lt;/td&gt;&lt;/tr&gt;\n";
	}
    oci_free_statement($stid);
	oci_close($con);
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在代码中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SELECT 查询按在步骤 4 中检索的 ID 检索指定许愿者的愿望和截止日期，然后将愿望和截止日期存储在 $result 数组中。</p>
</li>
<li>
<p>当 $result 数组不为空时，一个循环将该数组的项目作为表行进行显示。</p>
</li>
<li>
<p>&lt;tr&gt;&lt;/tr&gt; 标记窗体行，&lt;td&gt;&lt;/td&gt; 标记行中的窗体单元格，\n 开始一个新行。</p>
</li>
<li>
<p><code>htmlentities</code>  函数将具有等效 HTML 实体的所有字符转换为 HTML 实体。这有助于防止<a href="http://en.wikipedia.org/wiki/Cross-site_scripting">跨站点脚本</a>。</p>
</li>
<li>
<p>结尾的函数释放所有资源（mysqli 结果和 OCI8 语句）并关闭数据库连接。注意，在实际关闭连接之前，您需要释放使用该连接的所有资源。否则，PHP 的内部引用计数系统会让基本 DB 连接保持打开，即使在  <code>oci_close()</code>  或  <code>mysqli_close()</code>  调用后无法使用连接。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>*警告：*确保键入的数据库字段名称与创建数据库表期间指定的名称完全相同。对于 Oracle，默认返回大写的列名。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>要测试应用程序，请按<a href="#createNewFile">测试 index.php</a> 部分所述运行项目。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wishlist-php-works.png" alt="wishlist php works">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_完成当前课程后的应用程序源代码">完成当前课程后的应用程序源代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MySQL 用户：单击<a href="https://netbeans.org/files/documents/4/1928/lesson2.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
<div class="paragraph">
<p>Oracle 数据库用户：单击<a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson2.zip">此处</a>以下载源代码，该代码反映了在完成课程后的项目状态。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_后续步骤">后续步骤</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson1.html">&lt;&lt; 上一课</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson3.html">下一课 &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">返回到教程主页</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson2_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
