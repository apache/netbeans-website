
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Lição 6: Adicionado um Novo Desejo ao Banco de Dados</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lição 6: Adicionado um Novo Desejo ao Banco de Dados - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans, Tutorials, Lição 6: Adicionado um Novo Desejo ao Banco de Dados">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Lição 6: Adicionado um Novo Desejo ao Banco de Dados</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_pt_BR.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_application_source_code_from_the_previous_lesson">Código-fonte da Aplicação da Lição Anterior</a></li>
<li><a href="#_submitting_a_new_wish">Enviando um Novo Desejo</a>
<ul class="sectlevel2">
<li><a href="#add-wish-ui-elements">Adicionando os Componentes da Interface do Usuário</a></li>
<li><a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">Reexibindo a Data de Vencimento Após um Envio Malsucedido</a></li>
</ul>
</li>
<li><a href="#_verifying_the_wisher_s_logon">Verificando o Log-in do Wisher</a></li>
<li><a href="#insert-new-wish">Inserindo o Novo Desejo no Banco de Dados</a>
<ul class="sectlevel2">
<li><a href="#add-insert-wish">Adicionando a função insert_wish ao WishDB</a></li>
<li><a href="#add-format-date-for-sql">Adicionando a função format_date_for_sql ao WishDB</a></li>
<li><a href="#validateAndEnterWishToDatabase">Inserindo o Registro do Novo Desejo no Banco de Dados</a></li>
<li><a href="#_displaying_error_messages">Exibindo Mensagens de Erro</a></li>
</ul>
</li>
<li><a href="#_returning_to_the_front_index_php_page">Retornando à Página Inicial index.php</a></li>
<li><a href="#_testing_the_add_wish_functionality">Testando a Funcionalidade Adicionar Desejo</a></li>
<li><a href="#_application_source_code_after_the_current_lesson_is_completed">O código-fonte da Aplicação após a Lição Atual está Concluído</a></li>
<li><a href="#_next_steps">Próximas Etapas</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Nesta lição, você expande a funcionalidade da aplicação com duas funcionalidades:</p>
</div>
<div class="paragraph">
<p>Para implementar essa funcionalidade, edite o arquivo  <code>editWishList.php</code>  e crie um novo arquivo  <code>editWish.php</code> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/page-flow-diagram-l6.png" alt="page flow diagram l6">
</div>
</div>
<div class="paragraph">
<p>O documento atual é uma parte do tutorial Criando uma Aplicação CRUD no NetBeans IDE para PHP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_from_the_previous_lesson">Código-fonte da Aplicação da Lição Anterior</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usuários MySQL: clique <a href="https://netbeans.org/files/documents/4/1931/lesson5.zip">aqui</a> para fazer o download do código-fonte que reflete o estado do projeto depois que a lição anterior for concluída.</p>
</div>
<div class="paragraph">
<p>Usuários do banco de dados Oracle: clique <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson5.zip">aqui</a> para fazer o download do código-fonte que reflete o estado do projeto depois que a lição anterior for concluída.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_submitting_a_new_wish">Enviando um Novo Desejo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O usuário envia um novo desejo nas seguintes etapas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>O usuário faz log-in, alterna para a página  <code>editWishList.php</code>  e pressiona o botão Adicionar Desejo. A página  <code>editWish.php</code>  abre, exibindo um form HTML.</p>
</li>
<li>
<p>No form HTML, o usuário insere uma descrição de um desejo e, possivelmente, a data quando deseja recebê-lo e pressiona o botão Salvar Alterações.</p>
</li>
<li>
<p>Se um form for enviado sem uma descrição do desejo, o usuário retorna ao form para tentar novamente. Caso o usuário tenha enviado uma data de vencimento mas nenhuma descrição, essa data é exibida novamente quando o form é recarregado.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para ativar esse procedimento para o usuário, adicione a seguinte funcionalidade à aplicação:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#add-wish-ui-elements">Componentes da interface do usuário</a>, consistindo em um form HTML para adicionar desejos e um botão em  `editWishList.php ` que redireciona o usuário para o form.</p>
</li>
<li>
<p>Código para <a href="#_redisplaying_the_due_date_after_an_unsuccessful_submission">reexibir a data de vencimento</a> se um form incompleto for enviado.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-wish-ui-elements">Adicionando os Componentes da Interface do Usuário</h3>
<div class="paragraph">
<p><strong>Para adicionar funcionalidade para a adição um novo desejo:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implementar o botão Adicionar Desejo. No arquivo  <code>editWishList.php</code> , adicione o seguinte código HTML abaixo do bloco PHP:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="addNewWish" action="editWish.php"&gt;
            &lt;input type="submit" value="Add Wish"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> você pode ignorar as advertências do validador HTML.</p>
</div>
<div class="paragraph">
<p>O form contém um campo de entrada "Adicionar Desejo" do tipo  <code>submit</code> . Este campo implementa o botão "Adicionar desejo". Quando o usuário clica em Adicionar Desejo, ele é redirecionado para a página  <code>editWish.php</code> . Como nenhum dado é transferido usando esse form, nenhum método de Solicitação do Servidor é usado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adicione uma tabela acima do form addNewWish que exibe os desejos existentes para o wisher. O código é semelhante ao código  <code>wishlist.php</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados MySQL:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $result = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = mysqli_fetch_array($result)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['description']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['due_date']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    mysqli_free_result($result);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados Oracle:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;table border="black"&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;Due Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php
    $stid = WishDB::getInstance()-&gt;get_wishes_by_wisher_id($wisherID);
    while ($row = oci_fetch_array($stid)) {
        echo "&lt;tr&gt;&lt;td&gt;" . htmlentities($row['DESCRIPTION']) . "&lt;/td&gt;";
        echo "&lt;td&gt;" . htmlentities($row['DUE_DATE']) . "&lt;/td&gt;&lt;/tr&gt;\n";
    }
    oci_free_statement($stid);
    ?&gt;
&lt;/table&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crie o arquivo PHP  <code>editWish.php</code>  na pasta Código-fonte.</p>
</li>
<li>
<p>Em  <code>editWish.php</code> , implemente o form Adicionar Desejo. Digite ou cole o seguinte código abaixo do bloco &lt;? php?&gt;:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;

&lt;html&gt;
    &lt;head&gt;

        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form name="editWish" action="editWish.php" method="POST"&gt;
            Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
            When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;
            &lt;input type="submit" name="saveWish" value="Save Changes"/&gt;
            &lt;input type="submit" name="back" value="Back to the List"/&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O form Adicionar Desejo contém:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dois campos de texto vazios para inserção da descrição e a data de vencimento do desejo.</p>
</li>
<li>
<p>Textos a serem impressos ao lado dos campos de entrada.</p>
</li>
<li>
<p>Um campo  <code>submit</code>  que representa um botão Salvar Alterações</p>
</li>
<li>
<p>Um campo  <code>submit</code>  que representa um botão Voltar à Lista para retornar à página  <code>editWishList.php</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quando o botão Adicionar Desejo é pressionado, o form envia os dados inseridos para a mesma página,  <code>editWish.php</code> , usando o método de Solicitação POST.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redisplaying_the_due_date_after_an_unsuccessful_submission">Reexibindo a Data de Vencimento Após um Envio Malsucedido</h3>
<div class="paragraph">
<p>Se o usuário não preencher uma descrição no form Adicionar Desejo, uma mensagem de erro é exibida e o usuário retorna à página  <code>editWish.php</code> . Quando o usuário retorna ao  <code>editWish.php</code> , o form Adicionar Desejo deve mostrar o valor de  <code>dueDate</code>  caso ele tenha sido inserido. Na implementação atual do form, ambos os campos estão sempre vazios. Para manter os valores inseridos, você precisa salvar os dados do novo desejo em um array. O array consistirá em dois elementos chamados  <code>description</code>  e  <code>due-date</code> . Em seguida, você precisa alterar o form Adicionar Desejo, para que ele recupere o valor do campo  <code>dueDate</code>  do array.</p>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> O código que recarrega o form de entrada, caso nenhuma descrição tenha sido inserida, é incluído no <a href="#_verifying_the_wisher_s_logon">código que valida os dados e insere-os no banco de dados</a>. Esse código não é descrito nesta seção. O código desta seção preserva somente o valor de  <code>dueDate</code>  para que ele seja exibido se o form for recarregado.</p>
</div>
<div class="paragraph">
<p><strong>Para reexibir o form de entrada depois que o usuário o envia sem êxito:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Digite ou cole o bloco de código seguinte dentro do elemento HTML &lt;body&gt; de  <code>editWish.php</code> , diretamente acima do form de entrada:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($_SERVER['REQUEST_METHOD'] == "POST")
    $wish = array("description" =&gt; $_POST['wish'],
                        "due_date" =&gt; $_POST['dueDate']);
else
    $wish = array("description" =&gt; "",
                        "due_date" =&gt; "");
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código verifica qual método de Solicitação de Servidor foi usado para transferir os dados e cria um array chamado $wish. Se o método for POST, o que significa que o form de entrada é exibido depois de uma tentativa malsucedida de salvar um desejo com uma descrição vazia, os elementos  <code>description</code>  e  <code>due_date</code>  aceitam os valores transferidos pelo POST.</p>
</div>
<div class="paragraph">
<p>Se o método não for POST, o que significa que o form de entrada é exibido pela primeira vez depois do redirecionamento do form para a página  <code>editWishList.php</code> , os elementos  <code>description</code>  e  <code>due_date</code>  ficam vazios.</p>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> Em ambos os casos a descrição fica vazia. Há diferença apenas em  <code>dueDate</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Atualize o form Adicionar Desejo para que os valores de seus campos de entrada sejam recuperados do array  <code>$wish</code> . Substitua as linhas no form Adicionar Desejo:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value=""/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>com:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">Describe your wish: &lt;input type="text" name="wish"  value="&lt;?php echo $wish['description'];?&gt;" /&gt;&lt;br/&gt;
When do you want to get it? &lt;input type="text" name="dueDate" value="&lt;?php echo $wish['due_date']; ?&gt;"/&gt;&lt;br/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_the_wisher_s_logon">Verificando o Log-in do Wisher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No arquivo  <code>editWish.php</code> , insira o seguinte código de manipulação de sessão dentro do bloco &lt;? php?&gt; na parte superior do arquivo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">session_start();
if (!array_key_exists("user", $_SESSION)) {
    header('Location: index.php');
    exit;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Abre o array $_SESSION para recuperar dados.</p>
</li>
<li>
<p>Verifica se o array $_SESSION contém um elemento com o identificador "user".</p>
</li>
<li>
<p>Se a verificação falhar, o que significa que o usuário não está conectado, redireciona a aplicação para a página inicial index.php e cancela o processamento de PHP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para verificar se a manipulação da sessão funciona corretamente, execute o arquivo editWish.php no IDE. A página index.php é aberta, pois nenhum usuário foi transferido para o editWish.page usando uma sessão.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="insert-new-wish">Inserindo o Novo Desejo no Banco de Dados</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depois que o usuário envia um novo desejo, a aplicação precisa adicionar o desejo ao banco de dados "desejos". Para ativar essa funcionalidade, adicione o seguinte código à aplicação:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adicione mais duas funções auxiliares à classe  <code>WishDB</code>  em  <code>db.php</code> .</p>
</li>
<li>
<p>Uma função adiciona um novo registro à tabela de desejos.</p>
</li>
<li>
<p>A outra função converte as datas para o formato aceito pelo servidor de bancos de dados MySQL.</p>
</li>
<li>
<p>Adicione o código ao  <code>editWish.php</code> , que usará as novas funções auxiliares em  <code>WishDB</code>  para inserir o novo desejo no banco de dados.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="add-insert-wish">Adicionando a função insert_wish ao WishDB</h3>
<div class="paragraph">
<p>Essa função requer o wisher ID, uma descrição do novo desejo e a data de vencimento do desejo como parâmetros de entrada e insere esses dados no banco de dados em um novo registro. A função não retorna valores.</p>
</div>
<div class="paragraph">
<p>Abra o  <code>db.php `  e adicione a função  `insert_wish</code>  na classe  `WishDB ` :</p>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados MySQL</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $description = $this-&gt;real_escape_string($description);
    if ($this-&gt;format_date_for_sql($duedate)==null){
       $this-&gt;query("INSERT INTO wishes (wisher_id, description)" .
            " VALUES (" . $wisherID . ", '" . $description . "')");
    } else
        $this-&gt;query("INSERT INTO wishes (wisher_id, description, due_date)" .
            " VALUES (" . $wisherID . ", '" . $description . "', "
            . $this-&gt;format_date_for_sql($duedate) . ")");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados Oracle:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function insert_wish($wisherID, $description, $duedate) {
    $query = "INSERT INTO wishes (wisher_id, description, due_date) VALUES (:wisher_id_bv, :desc_bv, to_date(:due_date_bv, 'YYYY-MM-DD'))";
    $stid = oci_parse($this-&gt;con, $query);
    oci_bind_by_name($stid, ':wisher_id_bv', $wisherID);
    oci_bind_by_name($stid, ':desc_bv', $description);
    oci_bind_by_name($stid, ':due_date_bv', $this-&gt;format_date_for_sql($duedate));
    oci_execute($stid);
    oci_free_statement($stid);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código chama a função format_date_for_sql para converter a data de vencimento inserida para um formato que pode ser processado pelo servidor do banco de dados. Em seguida, a consulta INSERT INTO wishes (wisher_id, description, due_date) é executada para inserir o novo desejo no banco de dados.</p>
</div>
</div>
<div class="sect2">
<h3 id="add-format-date-for-sql">Adicionando a função format_date_for_sql ao WishDB</h3>
<div class="paragraph">
<p>Adicione a função  <code>format_date_for_sql</code>  à classe  <code>WishDB</code>  em  <code>db.php</code> . A função exige uma string com uma data como parâmetro de entrada. A função retorna uma data no formato que pode ser processado pelo servidor de banco de dados ou  <code>null</code>  se a string de entrada estiver vazia.</p>
</div>
<div class="paragraph">
<p><strong>Observação:</strong> a função nesse exemplo usa a função  <code>date_parse</code>  PHP. Essa função funciona apenas com datas em Inglês, como December 25, 2010 e apenas com algarismos arábicos. Um site profissional deve usar um selecionador de data.</p>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados MySQL:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts["year"] * 10000 + $dateParts["month"] * 100 + $dateParts["day"];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Para o banco de dados Oracle:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">function format_date_for_sql($date) {
    if ($date == "")
        return null;
    else {
        $dateParts = date_parse($date);
        return $dateParts['year'] * 10000 + '-' + $dateParts['month'] * 100 + '-' + $dateParts['day'];
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se a string de entrada estiver vazia, o código retorna NULL (nulo). Caso contrário, a função  <code>date_parse</code>  interna é chamada com  <code>$date</code>  como parâmetro de entrada. A função  <code>date_parse</code>  retorna um array que consiste em três elementos chamados  <code>$dateParts["ano"]</code> ,  <code>$dateParts["mês"]</code>  e  <code>$dateParts["dia"]</code> . A string de saída final é construída com base nos elementos do array  <code>$dateParts</code> .</p>
</div>
<div class="paragraph">
<p><strong>Importante:</strong> a função  <code>date_parse</code>  reconhece apenas datas em Inglês. Por exemplo, faz parsing para "February 2, 2016" mas não para "2 Unora, 2016".</p>
</div>
<div class="paragraph">
<p>*Observação para usuários do banco de dados Oracle: * o único formato necessário é que o formato da data na instrução  <code>return $dateParts&#8230;&#8203;</code>  coincida com o formato da data na função SQL  <code>to_date</code>  na consulta  <code>insert_wish</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="validateAndEnterWishToDatabase">Inserindo o Registro do Novo Desejo no Banco de Dados</h3>
<div class="paragraph">
<p>Agora que você desenvolveu as funções auxiliares, adicione o código para validar os novos dados do desejo e insira os dados para o banco de dados, se eles forem válidos. Se os dados não forem válidos, o código deve recarregar o form Adicionar Desejo. Se os dados forem inválidos porque nenhuma descrição foi inserida, mas existe uma data de vencimento, a data de vencimento é salva e reexibida quando o form é recarregado, graças ao código que você <a href="#_returning_to_the_front_index_php_page">desenvolveu anteriormente</a>.</p>
</div>
<div class="paragraph">
<p>Insira o código seguinte no bloco &lt;? php?&gt; de  <code>editWish.php</code> , abaixo do código de tratamento de sessão:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">require_once("Includes/db.php");
$wisherID = WishDB::getInstance()-&gt;get_wisher_id_by_name($_SESSION['user']);

$wishDescriptionIsEmpty = false;
if ($_SERVER['REQUEST_METHOD'] == "POST"){
    if (array_key_exists("back", $_POST)) {
        header('Location: editWishList.php' );
        exit;
    } else
    if ($_POST['wish'] == "") {
        $wishDescriptionIsEmpty =  true;
    } else {
        WishDB::getInstance()-&gt;insert_wish($wisherID, $_POST['wish'], $_POST['dueDate']);
        header('Location: editWishList.php' );
        exit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código realiza as seguintes funções:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Permite o uso do arquivo  <code>db.php</code></p>
</li>
<li>
<p>Obtém ou cria uma instância da classe  <code>WishDB</code></p>
</li>
<li>
<p>Recupera o wisher ID que está tentando adicionar um desejo chamando a função  <code>get_wisher_id_by_name</code></p>
</li>
<li>
<p>Inicializa o flag  <code>$wishDescriptionIsEmpty</code> , que será usado mais tarde para mostrar mensagens de erro.</p>
</li>
<li>
<p>Verifica se o método de Solicitação é POST, o que significa que os dados foram enviados do form para inserir os dados do desejo na própria página  <code>editWish.php</code> .</p>
</li>
<li>
<p>Verifica se o array  <code>$_POST</code>  contém um elemento com a chave "back"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Se o array  <code>$_POST</code>  contém um elemento com a chave "back", o botão Voltar à Lista foi pressionado antes de o form ser enviado. Nesse caso, o código redireciona o usuário para o  <code>editWishList.php</code>  sem salvar os dados que foram inseridos nos campos e para o processamento de PHP.</p>
</div>
<div class="paragraph">
<p>Se o array $<em>POST _não</em> contiver um elemento com a chave "back", é porque os dados foram enviados quando o botão Salvar Alterações foi pressionado. Nesse caso, o código valida se a descrição do desejo está preenchida. O código faz isso, verificando se o elemento com a chave "wish" no array $_POST está vazio e, se a chave estiver vazia, altera o flag $wishDescriptionIsEmpty para verdadeiro. Observe que como nenhum código adicional é executado no bloco PHP, o form Adicionar Desejo é recarregado.</p>
</div>
<div class="paragraph">
<p>Se o botão Voltar à Lista não foi pressionado e a descrição do desejo foi preenchida, o código chama a função  <code>insert_wish</code>  com o wisher ID e a data de vencimento do desejo como os parâmetros de entrada. Em seguida, o código redireciona o usuário para a página  <code>editWishList.php</code>  e para o processamento de PHP.</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_error_messages">Exibindo Mensagens de Erro</h3>
<div class="paragraph">
<p>Se o usuário tentar salvar um desejo mas não tiver inserido uma descrição para ele, deve ser exibida uma mensagem de erro.
Insira o seguinte bloco &lt;? php?&gt; dentro do form de entrada HTML, abaixo do campo de entrada "Descreva seu desejo":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="php">&lt;?php
if ($wishDescriptionIsEmpty)
    echo "Please enter description&lt;br/&gt;";
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A mensagem de erro será exibida se o flag  <code>$wishDescriptionIsEmpty</code>  for verdadeira. O flag será processado durante a validação do form de entrada.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_returning_to_the_front_index_php_page">Retornando à Página Inicial index.php</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O usuário deve poder retornar à página inicial da aplicação a qualquer momento pressionando um botão.
Para implementar essa funcionalidade, insira o seguinte form de entrada HTML no arquivo  <code>editWishList.php</code> , antes da tag de fechamento &lt;/body&gt;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;form name="backToMainPage" action="index.php"&gt;&lt;input type="submit" value="Back To Main Page"/&gt;&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O form redireciona o usuário para a página inicial index.php quando o botão Voltar à Página Principal é pressionado.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_add_wish_functionality">Testando a Funcionalidade Adicionar Desejo</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute a aplicação. Na página  <code>index.php</code> , preencha os campos: no campo Nome do Usuário, insira "Tom", e no campo Senha, insira "tomcat".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/user-logon-to-edit-wish-list.png" alt="user logon to edit wish list">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressione o botão Editar Minha Lista de Desejos. A página  <code>editWishList.php</code>  abre.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-add-wish.png" alt="edit wish list add wish">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressione o botão Voltar à Página Principal. A página  <code>index.php</code>  abre.</p>
</li>
<li>
<p>Faça log-in como Tom e pressione o botão Editar Minha Lista de Desejos novamente. A página  <code>editWishList.php</code>  abre.</p>
</li>
<li>
<p>Pressione o botão Adicionar Desejo. A página  <code>editWish.php</code>  abre. Preencha o form.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-wish.png" alt="new wish">
</div>
</div>
<div class="paragraph">
<p>Pressione o botão Voltar à Lista. A página  <code>editWishList.php</code>  abre, mas o desejo inserido não foi adicionado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressione o botão Adicionar Desejo novamente. A página  <code>editWish.php</code>  abre. Preencha a data de vencimento e deixe a descrição vazia. Pressione o botão Salvar Alterações. A página  <code>editWish.php</code>  exibe o form de entrada com uma mensagem de erro e a data de vencimento preenchida.</p>
</li>
<li>
<p>Pressione o botão Adicionar Desejo novamente. A página  <code>editWish.php</code>  abre. Preencha o form e pressione o botão Salvar Alterações. A página  <code>editWishList.php</code>  mostra uma lista de desejos atualizada.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/edit-wish-list-updated.png" alt="edit wish list updated">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_source_code_after_the_current_lesson_is_completed">O código-fonte da Aplicação após a Lição Atual está Concluído</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Usuários MySQL: clique <a href="https://netbeans.org/files/documents/4/1932/lesson6.zip">aqui</a> para fazer o download do código-fonte que reflete o estado do projeto depois que a lição estiver concluída.</p>
</div>
<div class="paragraph">
<p>Usuários do banco de dados Oracle: clique <a href="https://netbeans.org/projects/www/downloads/download/php%252Foracle-lesson6.zip">aqui</a> para fazer o download do código-fonte que reflete o estado do projeto depois que a lição for concluída.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Próximas Etapas</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="wish-list-lesson5.html">&lt;&lt; Lição anterior</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-lesson7.html">Próxima lição &gt;&gt;</a></p>
</div>
<div class="paragraph">
<p><a href="wish-list-tutorial-main-page.html">Voltar à página principal do Tutorial</a></p>
</div>
<div class="paragraph">
<p><a href="/about/contact_form.html?to=3&amp;subject=Feedback:%20PHP%20Wish%20List%20CRUD%206:%20Writing%20New%20DB%20Entry">Enviar Feedback neste Tutorial</a></p>
</div>
<div class="paragraph">
<p>Para enviar comentários e sugestões, obter suporte e manter-se informado sobre os desenvolvimentos mais recentes das funcionalidades de desenvolvimento PHP do NetBeans IDE, <a href="../../../community/lists/top.html">junte-se à lista de correspondência users@php.netbeans.org</a>.</p>
</div>
<div class="paragraph">
<p><a href="../../trails/php.html">Voltar à Trilha do Aprendizado PHP</a></p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/kb/docs/php/wish-list-lesson6_pt_BR.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
