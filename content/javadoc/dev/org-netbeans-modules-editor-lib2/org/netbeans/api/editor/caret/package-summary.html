<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>org.netbeans.api.editor.caret (Editor Library 2)</title>
<link rel="stylesheet" type="text/css" href="../../../../../javadoc.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.netbeans.api.editor.caret (Editor Library 2)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">org.netbeans.modules.editor.lib2/1 2.21.0 55</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/netbeans/api/editor/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../org/netbeans/spi/editor/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/netbeans/api/editor/caret/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.netbeans.api.editor.caret</h1>
<div class="docSummary">
<div class="block">
  The Editor Caret API opens up the editor to give information about its carets
  and to manipulate them.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/EditorCaretListener.html" title="interface in org.netbeans.api.editor.caret">EditorCaretListener</a></td>
<td class="colLast">
<div class="block">Listener for changes in editor caret.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/CaretInfo.html" title="class in org.netbeans.api.editor.caret">CaretInfo</a></td>
<td class="colLast">
<div class="block">Immutable info about a single caret used in caret API - see <a href="../../../../../org/netbeans/api/editor/caret/EditorCaret.html" title="class in org.netbeans.api.editor.caret"><code>EditorCaret</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/CaretMoveContext.html" title="class in org.netbeans.api.editor.caret">CaretMoveContext</a></td>
<td class="colLast">
<div class="block">Context for carets moving within <a href="../../../../../org/netbeans/spi/editor/caret/CaretMoveHandler.html" title="interface in org.netbeans.spi.editor.caret"><code>CaretMoveHandler</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/EditorCaret.html" title="class in org.netbeans.api.editor.caret">EditorCaret</a></td>
<td class="colLast">
<div class="block">Extension to standard Swing caret used by all NetBeans editors.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/EditorCaretEvent.html" title="class in org.netbeans.api.editor.caret">EditorCaretEvent</a></td>
<td class="colLast">
<div class="block">Notification event about changes in editor caret.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/netbeans/api/editor/caret/MoveCaretsOrigin.html" title="class in org.netbeans.api.editor.caret">MoveCaretsOrigin</a></td>
<td class="colLast">
<div class="block">Describes the operation which initiated the caret navigation.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package org.netbeans.api.editor.caret Description">Package org.netbeans.api.editor.caret Description</h2>
<div class="block"><p>
  The Editor Caret API opens up the editor to give information about its carets
  and to manipulate them.
  </p>
  
  <h3>Key parts of the API</h3>
  
  <p>
  The whole API is organized around the
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/api/editor/caret/EditorCaret.html">EditorCaret</a></code>
  class, an implementation of the <code>javax.swing.text.Caret</code> managing
  all the carets in a single document. Information about carets maintained by
  <code>EditorCaret</code> is stored in the immutable class
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/api/editor/caret/CaretInfo.html">CaretInfo</a></code>.
  Once a caret gets mutated its corresponding caret info becomes obsolete
  and new caret info instance gets created lazily.
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/api/editor/caret/EditorCaretListener.html">EditorCaretListener</a></code>
  can be registered to an <code>EditorCaret</code> to be informed about caret
  addition/removal or movement with an
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/api/editor/caret/EditorCaretEvent.html">EditorCaretEvent</a></code>.
  </p>
  
  <p>
  The <code>EditorCaret</code> mutates its carets in a single transaction.
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/api/editor/caret/CaretMoveContext.html">CaretMoveContext</a></code>
  allows clients implementing
  <code><a href="http://netbeans.apache.org/javadoc/dev/org-netbeans-modules-editor-lib2/org/netbeans/spi/editor/caret/CaretMoveHandler.html">CaretMoveHandler</a></code>
  to manipulate carets. The following code shows how all carets are moved to the
  end of the word they are currently on.
  
  <pre><code>
    editorCaret.moveCarets((CaretMoveContext context) -> {
        for (CaretInfo ci : context.getOriginalCarets()) {
            Position pos = target.getDocument().createPosition(Utilities.getWordEnd(target, ci.getDot()));
            context.setDot(ci, pos);
        }
    });
  </code>
  </pre>
  </p>

  <h3>Locking and <code>Document</code> changes</h3>
  
  <p>
  The basics of the locking and events model of Swing documents is
  described in the javadoc of the
  <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/text/AbstractDocument.html">javax.swing.text.AbstractDocument</a>
  class. Netbeans documents use the same patterns and so does the Caret API,
  because of its tight relation to documents. The fundamentals of the Swing documents
  locking model are that any changes to a document are done under the
  document's write lock, the document's listeners are notified synchronously on the
  mutating thread and have full read access to the document, but can't modify it.
  </p>
  
  <ul>
    <li>
    Any calls from the infrastructure to <code>EditorCaret</code> to query or
    mutate its carets, should be called with document's read-lock acquired which
    will guarantee stability of <code>CaretInfo#getDot()</code> and
    <code>CaretInfo#getMark()</code> and prevent caret merging as a possible
    effect of document modifications.
    </li>
    <li>
    When <code>EditorCaret</code> needs to notify its listeners that some
    of its carets have changed, all the events have to be fired under the
    layer's document's read lock. Obviously, the listeners are not allowed to
    modify the document from the event notification methods.
    </li>
  </ul>
  
  <p>
  The Caret API does not use any special threads and any processing it
  does is always done on the caller's thread. This means that the above described
  constraints hardly cause any limitation for practical use.
  </p>
  
  <p>
  The Caret API is generally thread-safe meaning that it can be used
  simultaneously from multiple threads if not stated otherwise. This doesn't
  change in any way the rule of acquiring a read lock before calling the API.
  Swing documents generally allow access for multiple readers that can run
  concurrently.
  </p>
  
  <h3><a name="movement-origins">Reason of Caret Movement</a></h3>
  <p>
      It may be desirable (especially for <a href="http://download.oracle.com/javase/8/docs/api/javax/swing/text/NavigationListener.html">NavigationListeners</a>, but possibly for 
      <a href="EditorCaretListener.html">EditorCaretListeners</a> too) to determine
  what was the reason leading to caret movement. The caller of Caret API which intends to position the caret
  may provide an optional <a href="MoveCaretsOrigin.html">MoveCaretsOrigin</a> instance to Caret API methods to indicate
  type of action leading to the movement. 
  This description is used to select <i>NavigationFilters</i> which receive and can modify the movement, and is available
  to all invoked <i>NavigationFilters</i> or <i>EditorCaretListeners</i> contacted by the Caret API operation.
  </p>
  <p>
  Only one action type is currently defined by the 
  API - <a href="MoveCaretsOrigin.html#DIRECT_NAVIGATION">DIRECT_NAVIGATION</a>. This type identifies operations
  actions, whose only task is to reposition the caret (i.e. left/right, page-up, document-begin) from actions,
  which position caret as a part of larger task (i.e. search, goto type, ...).
  </p>
  
  <h3><a name="navigation-filters">Navigation Filters</a></h3>
  <p>
  The Caret API implements and extends the concept of swing 
  <a href="http://download.oracle.com/javase/8/docs/api/javax/swing/text/NavigationFilter.html">NavigationFilters</a>. The Filter
  gets notified on <code>CaretInfo</code> movement; so if more Carets are present, 
  a <code>NavigationFilter</code> will see all their moves. Navigation Filters are
  called with a special instance of <a href="http://download.oracle.com/javase/8/docs/api/javax/swing/text/NavigationFilter.FilterBypass.html">
  FilterBypass</a> extending <a href="../../../spi/editor/caret/NavigationFilterBypass.html">
    NavigationFilterBypass</a>. The Filter <b>can downcast the FilterBypass to access extended information</b>
  about the current caret's movement:
  </p>
   <div class="nonnormative">
    <pre><code>
    public void setDot(FilterBypass fb, int dot, Position.Bias bias) {
      if (fb instanceof NavigationFilterBypass) {
        NavigationFilterBypass nfb = (NavigationFilterBypass)fb;
   
        // get the Origin object created by the caret-moving operation, can query the details
        MoveCaretsOrigin origin = nfb.getOrigin();
   
        // get the individual caret in multi-caret scenario
        CaretInfo info = nfb.getCaretInfo();
   
        // get the whole EditorCaret
        EditorCaret eCaret = nfb.getEditorCaret();
      }
    }
    </code></pre>
   </div>
  <p>
  Navigation filters can be also selectively registered for only certain type of actions described by
  <a href="MoveCaretsOrigin.html">MoveCaretsOrigin</a> instance. 
  </p>
  <div class="nonnormative">
    <pre><code>
        EditorCaret eCaret = .... ; // obtain EditorCaret
        eCaret.setNavigationFilter(
          new NavigationFilter() {
                 // navigation filter implementation, not important for the example
          }, 
          new MoveCaretsOrigin(MoveCaretsOrigin.DIRECT_NAVIGATION)
        );
    </code></pre>
  </div>
  <p>
  Such filters are only called if the caller of Caret API provides a suitable <i>MoveCaretsOrigin</i> description of the move operatoion.
  </p>
  <div class="nonnormative">
      <pre>
          <code>
        // Action perform method
        editorCaret.moveCarets(new CaretMoveHandler() {
             &#64;Override
             public void moveCarets(CaretMoveContext context) {
                 ...
             }
         }, new MoveCaretsOrigin(
                 // The action is a raw movement command
                 MoveCaretsOrigin.DIRECT_NAVIGATION, 
                 // The approximate direction of the movement; can be 0.
                 SwingConstants.NORTH)
         );
        </code>
      </pre>
  </div>
  Swing NavigationFilters, specified by <a href="http://download.oracle.com/javase/8/docs/api/javax/swing/text/JTextComponent#setNavigationFilter(javax.swing.text.NavigationFilter)">TextComponent.setNavigationFilter()</a>
  are called for all caret movements.
  <p>
  Abstract boilerplate for <code>NavigationFilters</code> is created, 
  <a href="../../../spi/editor/caret/CascadingNavigationFilter.html">CascadingNavigationFilter</a>
  which allows to chain individual filters. Implementors are encouraged to use it, or otherwise
  pass the control to previously registered <code>NavigationFilter</code> in case the movement
  event is not handled by the custom implementation.
  <p/>
  
  <h3><a name="compatibilty">Backwards compatibility</a></h3>
  <p>
  As a technical limitation, <code>EditorCaret</code> has to implement <code>Caret</code>
  to be able to work with Swings Text API. The <code>Caret</code> interface is not
  aware of multiple carets and a call to <code>setDot(int)</code> will only retain
  a single caret. For multiple carets a call to <code>moveDot(int)</code> will move the last
  caret only (but it retains other existing carets).+
  <br>
  <code>editorTextComponent.getCaret()</code> will now always return <code>EditorCaret</code>
  instance instead of the original caret implementation <code>org.netbeans.editor.BaseCaret</code>.
  Since clients were expected to only rely on <code>javax.swing.text.Caret</code> returned type
  (except internal code in editor modules) they should not be affected by the change
  since <code>EditorCaret</code> implements <code>Caret</code> interface.
  <br>
  With official Caret API the clients can start to cast
  <code>editorTextComponent.getCaret()</code> to <code>EditorCaret</code> type
  and use its extended functionality.
  </p>
  
  <h3><a name="usecases">Use cases</a></h3>
  <p>
  Use cases are shown in javadoc documentation of particular methods.
  </p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">org.netbeans.modules.editor.lib2/1 2.21.0 55</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/netbeans/api/editor/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../org/netbeans/spi/editor/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/netbeans/api/editor/caret/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><span class="footnote"></span><!-- See javadoc.css for timestamp information --></small></p>
</body>
</html>
