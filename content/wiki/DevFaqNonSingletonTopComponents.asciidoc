

<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>DevFaqNonSingletonTopComponents</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqNonSingletonTopComponents">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqNonSingletonTopComponents">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans (incubating)</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate" style='margin-bottom: 2em'>
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1>Apache NetBeans 9.0</h1>
            <p><a class="button success" href="/download/nb90/nb90.html">Read more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content'>
            
<div class='aside' style='text-align: center; padding: 20px;'>
    <a href="/wiki/index.asciidoc" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>

            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel2">
<li><a href="#_how_can_i_change_my_topcomponent_to_not_be_a_singleton_nb_version_up_to_6_9">How can I change my TopComponent to not be a singleton (NB version up to 6.9)?</a></li>
<li><a href="#_apache_migration_information">Apache Migration Information</a></li>
</ul>
</div>
<div class="sect2">
<h3 id="_how_can_i_change_my_topcomponent_to_not_be_a_singleton_nb_version_up_to_6_9">How can I change my TopComponent to not be a singleton (NB version up to 6.9)?</h3>
<div class="paragraph">
<p>The "New Window Component" wizard in the NetBeans IDE generates a <a href="http://en.wikipedia.org/wiki/Singleton_pattern">singleton</a> TopComponent.  That&#8217;s fine for windows that there should only be one of.  Particularly if you are <a href="DevFaqEditorTopComponent.asciidoc">creating some kind of editor</a>, you will want to create multiple instances of your TopComponent.</p>
</div>
<div class="sect3">
<h4 id="_the_really_easy_way">The really easy way</h4>
<div class="paragraph">
<p>If you have not already used the <strong>New Window</strong> template to create your TopComponent subclass, don&#8217;t.</p>
</div>
<div class="paragraph">
<p>Instead, use <em>New &gt; JPanel Form</em>.  Once the new JPanel is created, switch to the Code tab, and replace <code>extends javax.swing.JPanel</code> with <code>extends TopComponent</code>.  Then do the following things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override <code>getPersistenceType()</code>.</p>
</li>
<li>
<p>If you <em>do not</em> want your components reopened on restart</p>
</li>
<li>
<p>return <code>PERSISTENCE_NEVER</code>&mdash;that is all you need to do to make sure they are not preserved across restarts.</p>
</li>
<li>
<p>If you <em>do</em> want your components reopened on restart, then</p>
</li>
<li>
<p>return <code>PERSISTENCE_ONLY_OPENED</code> from <code>getPersistenceType()</code></p>
</li>
<li>
<p>Add the following slightly-cryptic annotation to the class: <code>@ConvertAsProperties(dtd = "-//com.yourmodule.yourpackage//YourTopComponent//EN", autostore = false)</code>, replacing the package and class name with your own.  This identifies a DTD.  You do not need to define the DTD.  You just need to give it a unique namespace that nothing else is using.  Package and class name work well for that.</p>
</li>
<li>
<p>Add two additional methods (you are not overriding anything and they can be package-private, like serialization methods):</p>
</li>
<li>
<p><code>void writeProperties(Properties p)</code> - here we will call <code>p.put()</code> passing enough information to reconstruct your component on restart.  If we are editing a file, we might save the path to the file.  If we are viewing a URL, we might save the URL.  If we want to be particularly fastidious, we might save the scroll position, or what line the editor caret was on , or anything else useful to restore the state of our component.</p>
</li>
<li>
<p><code>void readProperties(Properties p)</code> - here we will reading whatever keys we wrote out in <code>writeProperties</code> and (re)initializing the component to its pre-shutdown state.  This method will be called on startup to restore our component to its pre-shutdown state as best can be done.  If we were, say, editing a file that no longer exists, the appropriate thing to do is throw an exception.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_if_you_already_have_a_generated_singleton_topcomponent_subclass">If you already have a generated singleton TopComponent subclass</h4>
<div class="paragraph">
<p>The good news is that you won&#8217;t have to write any code&#8201;&#8212;&#8201;you&#8217;ll just have to delete some of the code that was generated for you.</p>
</div>
<div class="paragraph">
<p>In your TopComponent&#8217;s .java source file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete the static <code>instance</code> variable, which ought to be declared a few lines above the constructor.</p>
</li>
<li>
<p>Make sure your TopComponent class is <code>public</code></p>
</li>
<li>
<p>Make sure your TopComponent has a no-argument constructor which is <code>public</code></p>
</li>
<li>
<p>Delete the <code>getDefault()</code> method (typically somewhere around the middle of the file)</p>
</li>
<li>
<p>Delete the <code>findInstance()</code> method (which typically follows the <code>getDefault()</code> method)</p>
</li>
<li>
<p>Update the persistence code which saves your component&#8217;s state on shutdown and restores it on restart to reopen your component as follows</p>
</li>
<li>
<p>Locate the <code>getPersistenceType</code> method and change its return value to either <code><a href="http://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#PERSISTENCE_NEVER">TopComponent.PERSISTENCE_NEVER</a></code> or <code><a href="http://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#PERSISTENCE_ONLY_OPENED">TopComponent.PERSISTENCE_ONLY_OPENED</a></code> (see below for why).</p>
</li>
<li>
<p>If you have methods called <code>writeReplace()`and an inner class called `ResolvableHelper</code> (NetBeans 6.8 and earlier):</p>
</li>
<li>
<p>Delete the <code>writeReplace()</code> method (typically towards the end of the file)</p>
</li>
<li>
<p>Delete the <code>ResolvableHelper</code> inner class (typically towards the end of the file)</p>
</li>
<li>
<p>If you <em>do not want persistence across restarts</em> &mdash; you are returning PERSISTENCE_NEVER from <code>getPersistenceType()</code></p>
</li>
<li>
<p>If you have a <code>@ConvertAsProperties</code> annotation and <code>readProperties(Properties)</code> and <code>writeProperties(Properties)</code> methods, delete the annotation and both methods</p>
</li>
<li>
<p>If <em>do want persistence across restarts</em> &mdash; you are returning <code>PERSISTENCE_ONLY_OPENED</code> from`getPersistenceType()`</p>
</li>
<li>
<p>If you already have the <code>@ConvertAsProperties</code> annotation and <code>readProperties(Properties)</code> and <code>writeProperties(Properties)</code> methods just leave them there</p>
</li>
<li>
<p>If you do not have the annotation and those methods, implement them as described in the previous section</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next we will need to delete the metadata that registers the component:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For version 6.9 of NetBeans:</p>
</li>
<li>
<p>Delete the settings XML file for your component.  If your component class is <code>MyWindow</code> then that file will be in the same folder and will be called <code>MyWindowSettings.xml</code>.</p>
</li>
<li>
<p>Delete the <a href="DevFaqWindowsWstcrefAndFriends.asciidoc">wstcrf</a> (&quot;window system TopComponent reference&quot;) XML file in that folder.  If your component class is <code>MyWindow</code> then that file will be named <code>MyWindowWstcrf.xml</code></p>
</li>
<li>
<p>Edit your module&#8217;s [DevFaqModulesLayerFile| layer.xml file] to</p>
</li>
<li>
<p>Remove any references to either of these files (just use Ctrl-F to search for e.g. <code>MyWindowSettings.xml</code> and <code>MyWindowWstcrf.xml</code>).  They will be in <code>&lt;file&gt;</code> tags.</p>
</li>
<li>
<p>If you have removed a <code>&lt;file&gt;</code> entry, and it was the only entry in that folder, you can remove the XML for parent folder (and its parent if it is now empty, and so forth)</p>
</li>
<li>
<p>Find where an Action is registered for to open your (formerly) singleton TopComponent</p>
</li>
<li>
<p><em>NetBeans 6.9 and later:</em></p>
</li>
<li>
<p>Look for an <code>&lt;file&gt;</code> registered in <code>Actions/Window`in the XML file.  It will have an `&lt;attr&gt;</code> element that refers to your TopComponent class, e.g. <code>&lt;attr name=&quot;component&quot; methodvalue=&quot;com.foo.MyWindow.findInstance&quot;/&gt;</code>.  Delete the entire <code>&lt;file&gt;</code> entry.</p>
</li>
<li>
<p>Look for <code>&lt;file&gt;</code> entry for a <code>.shadow</code> file in <code>Actions/Menu</code> in the XML, with its <code>originalFile</code> pointing to the file entry you just deleted.  Delete the <code>.shadow</code> <code>&lt;file&gt;</code> too.</p>
</li>
<li>
<p><em>NetBeans 6.8 and earlier:</em></p>
</li>
<li>
<p>There will be an <code>Action</code> class in your sources which is registered, e.g. <code>MyWindowAction.java</code>.  Delete the java source file.</p>
</li>
<li>
<p>Look for an <code>&lt;file&gt;</code> registered in <code>Actions/Window`in the XML file.  It will be a `&lt;file&gt;</code> whose name is the munged fully-qualified class name of the <code>Action</code> you just deleted, e.g. <code>com-foo-MyWindowAction.instance</code>.  Delete the <code>&lt;file&gt;</code> entry for it</p>
</li>
<li>
<p>Look for <code>&lt;file&gt;</code> entry for a <code>.shadow</code> file in <code>Actions/Menu</code> in the XML, with its <code>originalFile</code> pointing to the file entry you just deleted.  Delete the <code>.shadow</code> <code>&lt;file&gt;</code> too.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_opening_your_topcomponents">Creating And Opening Your TopComponents</h4>
<div class="paragraph">
<p>Now that you have deleted the actions for your TopComponent, presumably they will be created some other way (for example, from a file&#8217;s popup menu).  You can create new instances of your TopComponent, open them and give them focus as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">TopComponent win = new MyTopComponent();
win.open();
win.requestActive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wrote your persistence code correctly, your components will magically reopen on restart with no further work.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_about_persistence_always">What About PERSISTENCE_ALWAYS?</h4>
<div class="paragraph">
<p>There is one other value you can return from <code><a href="http://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#getPersistenceType()">TopComponent.getPersistenceType()</a></code>.  That value is <code>TopComponent.PERSISTENCE_ALWAYS</code>.</p>
</div>
<div class="paragraph">
<p>While it is <em>legal</em> to return this value from a non-singleton TopComponent, it is almost never what you want to do.  What will happen if you do this is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every instance of your component that is <strong>ever created</strong> will be persisted on shutdown, <em>forever</em></p>
</li>
<li>
<p>Even if it is closed</p>
</li>
<li>
<p>Even if nothing can use it, or it represents a file that was deleted, or is in some other way invalid</p>
</li>
<li>
<p>Even if no code will ever be able to find it and open it again</p>
</li>
<li>
<p>One every restart, <em>forever</em></p>
</li>
<li>
<p>Every instance of your component that has <em>ever existed</em> will be read back from disk</p>
</li>
<li>
<p>Each one will slow down startup a little bit</p>
</li>
<li>
<p>Each one will be wasting disk space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ALWAYS</code> is for singleton components that need to be remembered forever across restarts. Don&#8217;t use it for non-singletons.</p>
</div>
</div>
<div class="sect3">
<h4 id="_if_you_do_not_have_any_persistence_code_but_your_components_are_reopening_on_restart">If you do not have any persistence code, but your components are reopening on restart&#8230;&#8203;</h4>
<div class="paragraph">
<p>You are returning either <code>PERSISTENCE_ONLY_OPENED</code> or <code>PERSISTENCE_ALWAYS</code> from <code>getPersistenceType()</code>.  If there is no persistence code, but you <em>are</em> returning one of these values, NetBeans will use plain old Java serialization to store and reload your component.</p>
</div>
<div class="paragraph">
<p>Either use <code>PERSISTENCE_NEVER</code> or write persistence code as described above.  Serialization is slower and more fragile than proper persistence, and is never a good option for production code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apache_migration_information">Apache Migration Information</h3>
<div class="paragraph">
<p>The content in this page was kindly donated by Oracle Corp. to the
Apache Software Foundation.</p>
</div>
<div class="paragraph">
<p>This page was exported from <a href="http://wiki.netbeans.org/DevFaqNonSingletonTopComponents">http://wiki.netbeans.org/DevFaqNonSingletonTopComponents</a> ,
that was last modified by NetBeans user Cvdenzen
on 2012-09-18T10:54:57Z.</p>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> This document was automatically converted to the AsciiDoc format on 2018-02-07, and needs to be reviewed.</p>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/incubator-netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://netbeans.signup.team/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/incubator-netbeans-website/blob/master/netbeans.apache.org/src/content/wiki/DevFaqNonSingletonTopComponents.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in github.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1>About</h1>
                <ul>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                    <li><a href="https://incubator.apache.org/projects/netbeans.html">Incubation Status</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                    <li><a href="/community/who.html">Who is who</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/netcat.html">NetCAT - Community Acceptance Testing</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/help/getting-started.html">Platform videos</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/index.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html#releases">Releases</a></li>
                    <ul>
                        <li><a href="/download/nb90/nb90.html">Apache NetBeans 9.0</a></li>
                        <li><a href="/download/nb90/nb90-rc1.html">Apache NetBeans 9.0 (RC1)</a></li>
                        <li><a href="/download/nb90/nb90-beta.html">Apache NetBeans 9.0 (beta)</a></li>
                    </ul>
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2018 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <p><a href="https://incubator.apache.org/" alt="Apache Incubator"><img src='/images/incubator_feather_egg_logo_bw_crop.png' title='Apache Incubator'></img></a></p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache NetBeans is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
            <p>Apache Incubator, Apache, the Apache feather logo, the Apache NetBeans logo, and the Apache Incubator project logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>


        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
    </body>
</html>
