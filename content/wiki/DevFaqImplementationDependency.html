

<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>What is an implementation dependency and when should I use one?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqImplementationDependency">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqImplementationDependency">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content'>
      <h1 class="sect1">What is an implementation dependency and when should I use one?</h1>
      
      
<div class='aside' style='text-align: center; padding: 20px;'>
    <a href="/wiki/index.html" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>

      
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_friend_dependencies">Friend dependencies</a></li>
<li><a href="#_implementation_dependencies_auto_update_and_verifyupdatecenter">Implementation dependencies, Auto Update, and &lt;verifyupdatecenter&gt;</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Normally modules interact with one another using <em>public packages</em>: a module can (indeed, must) declare which, if any, of its Java packages are intended to be visible to other modules. When you declare a specification dependency on another module, you only get access to the public packages. This kind of dependency looks like this in the JAR manifest (which is normally constructed from <code>nbproject/project.xml</code> in sources):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">OpenIDE-Module-Module-Dependencies: some.other.module &gt; 1.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>(requesting version 1.5 or greater of <code>some.other.module</code>) or like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">OpenIDE-Module-Module-Dependencies: some.other.module</code></pre>
</div>
</div>
<div class="paragraph">
<p>(requesting any version; not recommended).</p>
</div>
<div class="paragraph">
<p>Occasionally you may find that the author of a module neglected to expose certain classes in public packages which you know (from reading the source code) that you need to use and know how to use properly. The classes are public but not in declared public packages. It is <em>possible</em> to access these classes if you really have to. But you need to declare a dependency on that <em>exact</em> version of the other module, since such classes might change incompatibly without notice in a newer copy of that module.  Since such a change could break your module, the NB module system requires that you declare the implementation dependency so that it can verify <em>before</em> loading your module that it matches the other module.  The general idea is that if module B has an implementation dependency on module A, the system should not be able to load B unless it has the exact same version of A that B was compiled against.  To make an implementation dependency in the manifest, use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">OpenIDE-Module-Module-Dependencies: some.other.module = 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the "3" is what that other module declared as its current implementation version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">OpenIDE-Module-Implementation-Version: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to add an implementation dependency, first add the dependency to the project (e.g. click on "Add Module Dependency" from the "Libraries" node or by click the "Add Dependency&#8230;&#8203;" button in Project&#8594;Properties&#8594;Libraries panel). Make sure you&#8217;ve checked the "Show Non-API Modules" checkbox when you&#8217;re looking for the non-API module, otherwise you&#8217;re not going to find it. Then, after you&#8217;ve added the module as a dependency, edit the dependency (either Project&#8594;Properties&#8594;Libraries&#8594;Select Dependency&#8594;Edit or Project&#8594;Right click on dependency Libraries node&#8594;Edit) and just select the "Implementation Version" radio box in the Edit dependency dialog. If you don&#8217;t want to "see" all packages within the module, but only a subset, uncheck the "Include Packages in Classpath" checkbox and select the packages you want to see. This works best if the other module uses a nonnegative integer for the implementation version, and if you also check <strong>Append Implementation Versions Automatically</strong> in the properties dialog.</p>
</div>
<div class="paragraph">
<p>Implementation dependencies are to be avoided unless you <em>really</em> need access to all the classes in another module, for the following reason:  If your module has an implementation dependency on module A, and module A is upgraded, your module probably must be upgraded as well, or the system will not load it (assuming module A&#8217;s implementation version has changed with the upgrade - it should have).  It is a particularly bad idea to use implementation dependencies if you do not know what the other module&#8217;s author&#8217;s intentions are for keeping the classes you use available and compatible.  It is always possible to make an enhancement request asking for the other module to make the classes you want to use available publicly.  Do not use implementation dependencies just to have access to one or two some convenience or utility classes in another module - copy them instead, and file a bug report asking for an API for doing what you&#8217;re trying to do.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_friend_dependencies">Friend dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Friend dependencies</em> are a little different. A module may have an API which its author is not yet comfortable exposing to just anyone - it might not be fully stabilized yet. In this case, the module with the API can declare some public packages, but also stipulate that only a predefined list of "friend modules" are permitted to use them. The friend modules just declare a regular specification version dependency, but unknown modules are not permitted to use any packages from the API module without an implementation dependency.</p>
</div>
<div class="paragraph">
<p>(Look at the <strong>Versioning</strong> panel in the API module&#8217;s project <strong>Properties</strong> dialog.)</p>
</div>
<div class="paragraph">
<p><em>Always prefer friend APIs to implementation dependencies where there is a choice.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_dependencies_auto_update_and_verifyupdatecenter">Implementation dependencies, Auto Update, and &lt;verifyupdatecenter&gt;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementation dependencies cause special problems for Auto Update. (Some background information is available in <a href="http://openide.netbeans.org/versioning-policy.html#3">NetBeans API &amp;amp; Module Versioning Policy / Numbering Scheme for Updates</a>.)</p>
</div>
<div class="paragraph">
<p>The problem is that when an implementation version of a module published to an update server changes, any modules declaring implementation dependencies on it must also be published, with dependencies on the new version of the base module. Furthermore, the Auto Update client has just one method for deciding whether an NBM on a server is an "update" relative to what you already have installed: if its specification version is larger. So consider the following snapshot of an update center. (The syntax is not what the actual XML file looks like, just an abbreviated version that shows parts relevant to this example.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">[Monday]

OpenIDE-Module: infrastructure
OpenIDE-Module-Specification-Version: 1.0
OpenIDE-Module-Implementation-Version: 070120

OpenIDE-Module: guifeature
OpenIDE-Module-Specification-Version: 1.0
OpenIDE-Module-Implementation-Version: 070120
OpenIDE-Module-Module-Dependencies: infrastructure = 070120</code></pre>
</div>
</div>
<div class="paragraph">
<p>These two modules were built at the same time and could be installed together into a NetBeans instance. So far so good.</p>
</div>
<div class="paragraph">
<p>Now consider what happens when the developer of <code>guifeature</code> adds a major new feature and decides to publish a new version, <code>1.1</code>. The next day&#8217;s build produces</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">[Tuesday]

OpenIDE-Module: infrastructure
OpenIDE-Module-Specification-Version: 1.0
OpenIDE-Module-Implementation-Version: 070121

OpenIDE-Module: guifeature
OpenIDE-Module-Specification-Version: 1.1
OpenIDE-Module-Implementation-Version: 070121
OpenIDE-Module-Module-Dependencies: infrastructure = 070121</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, these two modules could be installed together.</p>
</div>
<div class="paragraph">
<p>But what if a user connected to the update center on Monday and downloaded both modules, and then connects again on Tuesday looking for updates? <code>infrastructure</code> is still listed as <code>1.0</code> so Auto Update ignores it (<code>1.0</code> is "already installed", after all). <code>guifeature 1.1</code> is however a possible update. What if you install this update? The module system will refuse to enable <code>guifeature</code> because it requests <code>infrastructure = 070121</code>, whereas you have <code>infrastructure = 070120</code>. Oops!</p>
</div>
<div class="paragraph">
<p>The solution (short of not using implementation dependencies at all) is to use the NetBeans build harness to compute a specification version. The developer removes <code>OpenIDE-Module-Specification-Version</code> from <code>manifest.mf</code> in the source projects for <em>both</em> modules. <code>manifest.mf</code> for <code>infrastructure</code> instead will get</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">OpenIDE-Module-Implementation-Version: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>(only positive integers 1, 2, &#8230;&#8203; are supported!). And <code>nbproject/project.properties</code> for both modules will get the specification version in a new form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">spec.version.base=1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The IDE&#8217;s GUI for module projects lets you do all this without editing metadata files manually; just click the option <strong>Append Implementation Versions Automatically</strong> in the <strong>Versioning</strong> panel of the <strong>Properties</strong> dialog.</p>
</div>
<div class="paragraph">
<p>(The extra <code>.0</code> is required for modules in the NetBeans distribution. When sources are branched for a release, <code>spec.version.base</code> is incremented to <code>1.0.1</code>, <code>1.0.2</code>, &#8230;&#8203; for each release on the branch. "Trunk" (development) changes increment the first or second digits, e.g. <code>1.1.0</code>, <code>1.2.0</code>, &#8230;&#8203;)</p>
</div>
<div class="paragraph">
<p>The effect of using <code>spec.version.base</code> is that our AU snapshots now look like this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">[Monday]

OpenIDE-Module: infrastructure
OpenIDE-Module-Specification-Version: 1.0.0.1
OpenIDE-Module-Build-Version: 070120
OpenIDE-Module-Implementation-Version: 1

OpenIDE-Module: guifeature
OpenIDE-Module-Specification-Version: 1.0.0.1
OpenIDE-Module-Implementation-Version: 070120
OpenIDE-Module-Module-Dependencies: infrastructure = 1

[Tuesday]

OpenIDE-Module: infrastructure
OpenIDE-Module-Specification-Version: 1.0.0.1
OpenIDE-Module-Build-Version: 070121
OpenIDE-Module-Implementation-Version: 1

OpenIDE-Module: guifeature
OpenIDE-Module-Specification-Version: 1.1.0.1
OpenIDE-Module-Implementation-Version: 070121
OpenIDE-Module-Module-Dependencies: infrastructure = 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The update to <code>guifeature</code> is now safe; it can still use <code>infrastructure</code> from Monday. Note the new "build version" tag which is used only for diagnostics, not for dependencies.</p>
</div>
<div class="paragraph">
<p>If there is actually a change in the signature of anything in <code>infrastructure</code> that might affect <code>guifeature</code>, then the developer merely needs to increment the implementation version in <code>infrastructure/manifest.mf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">[Wednesday]

OpenIDE-Module: infrastructure
OpenIDE-Module-Specification-Version: 1.0.0.2
OpenIDE-Module-Build-Version: 070122
OpenIDE-Module-Implementation-Version: 2

OpenIDE-Module: guifeature
OpenIDE-Module-Specification-Version: 1.1.0.2
OpenIDE-Module-Implementation-Version: 070122
OpenIDE-Module-Module-Dependencies: infrastructure = 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user connects to the update center on Wednesday, the wizard will display both modules as needing to be updated - which is exactly what you want.</p>
</div>
<div class="paragraph">
<p>How is this system enforced? For one thing, attempts to use inherently unsafe implementation dependencies, or incorrect uses of <code>spec.version.base</code>, should produce warnings during the module build process. So look at the output of Ant once in a while and see if the build harness is telling you something.</p>
</div>
<div class="paragraph">
<p>There is also a continuous builder at <a href="http://deadlock.netbeans.org/hudson/job/nbms-and-javadoc/">http://deadlock.netbeans.org/hudson/job/nbms-and-javadoc/</a> which (among other things) tries to build NBMs for all modules in the NetBeans standard distribution plus those experimental "alpha" modules normally published on the update center for development builds. If you commit changes to experimental modules this build will be triggered; failures are mailed to <code>broken_builds@netbeans.org</code>, which all developers of modules in netbeans.org ought to subscribe to.</p>
</div>
<div class="paragraph">
<p>This builder uses an Ant task <code>&lt;verifyupdatecenter&gt;</code> to detect dependency problems among NBMs. There are two checks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Can the NBMs just built all be enabled together? (<em>synchronic consistency</em>)</p>
</li>
<li>
<p>Suppose I had connected to the update center produced by the previous successful build and installed everything, and now I connected again to this build&#8217;s update center and asked for all updates. Would any updated modules be broken, due to dependencies on new versions of other modules which were not updated? (<em>diachronic consistency</em>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second check is what will catch a lot of mistakes in usage of implementation dependencies as described above. Unfortunately it is not feasible to run the second check as part of an offline build process in your own source checkout, as it depends on a build of older sources; so you will need to commit changes and wait for the next build to verify them.</p>
</div>
<div class="paragraph">
<p>Generally there are two possible solutions to a
<a href="http://deadlock.netbeans.org/hudson/job/nbms-and-javadoc/lastSuccessfulBuild/testReport/org.netbeans.nbbuild/VerifyUpdateCenter/">test failure</a>
from this stage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove the implementation dependencies; switch to friend dependencies or public APIs.</p>
</li>
<li>
<p>Ensure that all implementation dependencies are against positive integers (not dates), and that <code>spec.version.base</code> is used on <em>both</em> sides of the dependency, as described above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In either case, to fix a test failure
you will generally also need to increment the specification versions
of modules on <em>both</em> sides of the dependency.</p>
</div>
<div class="paragraph">
<p>Applies to: NetBeans 5.x, 6.x</p>
</div>
<div class="paragraph">
<p>Platforms: all</p>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/wiki/DevFaqImplementationDependency.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
