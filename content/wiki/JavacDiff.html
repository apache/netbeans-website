

<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>JavacDiff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Quick Links to Turorials and Docs">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="null">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content'>
      
<div class='aside' style='text-align: center; padding: 20px;'>
    <a href="/wiki/index.html" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>

      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_recompleting_symbols_from_sources">Recompleting Symbols from Sources</a></li>
<li><a href="#_stable_annonymous_innerclass_numbers">Stable annonymous innerclass numbers</a></li>
<li><a href="#_error_recovery">Error Recovery</a></li>
<li><a href="#_cancellability">Cancellability</a></li>
<li><a href="#_inferring_binary_names">Inferring Binary Names</a></li>
<li><a href="#_support_for_reparsing_method_bodies">Support for Reparsing Method Bodies</a></li>
<li><a href="#_repair">Repair</a></li>
<li><a href="#_annotation_processing">Annotation Processing</a></li>
<li><a href="#_ide_mode">Ide Mode</a></li>
<li><a href="#_miscallenous">Miscallenous</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_recompleting_symbols_from_sources">Recompleting Symbols from Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the following usecase: let there be two classes, A and B available both in source code and (up-to-date) class files.
These classes are interdependent (each refers to the other).
Let there be a refactoring, that needs to work over both these files.
The refactoring needs Trees (to access method bodies, to get offsets, etc), and these trees need to be attributed.</p>
</div>
<div class="paragraph">
<p>There are the following ways for the refactoring to work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>parse the source codes in two instances of javac (each time completing the other one from the class files). This does not require much memory (only needs memory to parse one file), but is quite slow.</p>
</li>
<li>
<p>create one instance of javac and parse both files in that instance - fast, but requires a memory to parse both/all the files, which is not reasonable in the IDE.</p>
</li>
<li>
<p>create an instance of javac, parse A from sources, complete B from the classfile. After processing of file A is done, check the available memory and either parse the source code for B in the same instance of javac (if there is enough memory), or discard the old javac and create a new one for B. This allows to use the available memory to speed up the refactoring, but allows to perform it (slowly) in memory required to process one file. Unfortunately, the standard javac does not allow to recomplete a Symbol from sources (i.e. the Symbol was originally created from a class file and now we parse and attribute a file containing the same Symbol).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Recompleting of Symbols is also used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when an API client asks for Tree for Symbol that was loaded from classfiles</p>
</li>
<li>
<p>when Symbol originates from classfile without parameter names (debugging information), and parameter names are required. Source is parsed to fill in the parameter names.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ability to recomplete a Symbol from source file is one of the most important part of the NetBeans fork/patch.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stable_annonymous_innerclass_numbers">Stable annonymous innerclass numbers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a Scope is created, the corresponding Tree is duplicated and attributed. This may lead into incorrect Symbols created for anonymous innerclasses.
It is necessary to ensure that the anonymous innerclass numbers will match the numbers that would be produced by a batch compiler.
This needs to be ensured even in case when the Scope is created before the tree is attributed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_recovery">Error Recovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While editing, the code in the editor contains compilation errors almost all the time. It is therefore unacceptable to loose e.g. code completion only because of a missing semicolon, or because of an (unrelated) unresolvable symbol.</p>
</div>
<div class="paragraph">
<p>The list of current changes includes (not an exhaustive list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JavacParser:</p>
<div class="ulist">
<ul>
<li>
<p>a variable declaration tree is produced even for cases where variable declaration is not allowed, e.g. in then/else section of if. The tree is wrapped in an erroneous tree and an error is reported. Trees produced before this change were too confusing for some hints (NB bug #192561). Relates to parseStatement and parseBlockStatement(s).</p>
</li>
<li>
<p>parseCompilationUnit is modified to handle multiple package clauses</p>
</li>
</ul>
</div>
</li>
<li>
<p>Attr:</p>
<div class="ulist">
<ul>
<li>
<p>in "return &lt;expr&gt;" &lt;expr&gt; is always attributed, even for initializers and methods with return type void</p>
</li>
<li>
<p>the last-resort symbol filler PostAttrAnalyzer is modified to dive into erroneous trees (NB bug #152334)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Annotate:</p>
<div class="ulist">
<ul>
<li>
<p>modified to always attribute the annotation&#8217;s attribute&#8217;s values, even if the annotation itself is unresolvable (i.e. "@Undefined(@Another)" will attribute also @Another).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cancellability">Cancellability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans need to be able to stop javac processing even inside one phase (parse/member enter/attribute).
This is used e.g. when the user types into the editor, and the current instance of javac is already processing an obsolette source code.
Then, there is no point in wasting time and memory in continuing the processing of the file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inferring_binary_names">Inferring Binary Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider file A.java, containing classes B and C, and file D.java, referencing B and C. If file D.java is being parsed (and class file for B and C do not exist yet), the javac is currently unable to locate file A.java. Yet, the IDE may have the information about the content of the A.java file. So, the problem is how to pass this information into the javac. ClassNamesForFileOraculum is currently used for this.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support_for_reparsing_method_bodies">Support for Reparsing Method Bodies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the user changes are contained only inside one method body, it is desirable to reparse only the body of the one method.
This leads into faster reparse times and less garbage on the heap. The NetBeans' fork/patch contains support for reparsing methods bodies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repair">Repair</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the NetBeans' fork/patch, there is a new phase, Repair, running after Flow. For source code with compilation errors, this phase converts the "uncompilable" trees into "compilable" trees.</p>
</div>
<div class="paragraph">
<p>New attributes are added to the classfiles to keep:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>error types (stripped from the trees during repair to obtain valid trees)</p>
</li>
<li>
<p>parameters names, without depending on debug information</p>
</li>
<li>
<p>annotations with RetentionPolicy.SOURCE</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotation_processing">Annotation Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In vanilla javac, new Symbols are created for classes/methods/fields in the sources for each annotation processing round. This is rewritten in the NetBeans' fork/patch to use the symbol recompleting. Symbols, once created, are used in all rounds on annotation processing and also for the final compilation. Annotation processing is also supported when completing symbols from sources. Exceptions thrown by annotation processors are logged, but do not stop the compilation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ide_mode">Ide Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A special option, "ideMode", has been introduced by the NetBean&#8217;s fork/patch to improve javac behavior in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when there is no java.lang package (i.e. no platform), vanilla javac stops with an error. In IDE mode, the compiler handles the situation more gracefully. - !May not be needed anymore.</p>
</li>
<li>
<p>when loading 1.5+ classfile with sourcelevel &#8656;1.4, vanilla javac throws away any 1.5 information stored in the classfile. In IDE mode, this information is preserved.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_miscallenous">Miscallenous</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>small extensions to allow parsing and attributing a "standalone" statement, expression, etc. in the given context.</p>
</li>
<li>
<p>small extensions to JavacTaskImpl to allow per-file per-phase parsing of multiple sources in the same instance of javac</p>
</li>
<li>
<p>access restrictions loosened for a lot methods/classes (private&#8594;protected, etc.)</p>
</li>
<li>
<p>inlineTags cache for ParamTagImpl and ThrowsTagImpl</p>
</li>
<li>
<p>string folding is disabled (by "disableStringFolding" option) to so that concatenated strings are represented by full trees</p>
</li>
<li>
<p>ToolProvider loads classes from context classloader</p>
</li>
<li>
<p>TreeInfo.symbolFor works all trees that refer to a symbol</p>
</li>
</ul>
</div>
</div>
</div>
      
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/wiki/JavacDiff.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
