
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Учебный курс по NetBeans CRUD для платформы NetBeans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Учебный курс по NetBeans CRUD для платформы NetBeans - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, Учебный курс по NetBeans CRUD для платформы NetBeans">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Учебный курс по NetBeans CRUD для платформы NetBeans</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-crud_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_настройка_приложения">Настройка приложения</a></li>
<li><a href="#_интеграция_базы_данных">Интеграция базы данных</a>
<ul class="sectlevel2">
<li><a href="#_создание_классов_сущностей">Создание классов сущностей</a></li>
<li><a href="#_помещение_файла_jar_класса_сущностей_в_оболочку_модуля">Помещение файла JAR класса сущностей в оболочку модуля</a></li>
<li><a href="#_создание_других_связанных_модулей">Создание других связанных модулей</a></li>
<li><a href="#_проектирование_пользовательского_интерфейса">Проектирование пользовательского интерфейса</a></li>
<li><a href="#_установка_зависимостей">Установка зависимостей</a></li>
<li><a href="#_запуск_прототипа">Запуск прототипа</a></li>
</ul>
</li>
<li><a href="#_интеграция_функциональности_crud">Интеграция функциональности CRUD</a>
<ul class="sectlevel2">
<li><a href="#_чтение">Чтение</a></li>
<li><a href="#_обновление">Обновление</a></li>
<li><a href="#_создание">Создание</a></li>
<li><a href="#_удаление">Удаление</a></li>
</ul>
</li>
<li><a href="#_дополнительная_информация">Дополнительная информация</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом курсе описана интеграция базы данных Java DB в приложение платформы NetBeans. Вначале рассматривается база данных Java DB, исходя из которой создается класс сущностей. Следует отметить, что эти указания применимы не только для Java DB. Они могут использоваться для любой реляционной базы данных, поддерживаемой средой IDE NetBeans. Затем классы сущностей помещаются в оболочку модуля наряду с модулями для связанного компонента JPA JARS.</p>
</div>
<div class="paragraph">
<p>После того как модули становятся частью приложения, создается новый модуль, который обеспечивает пользовательский интерфейс приложения. Новый модуль предоставляет пользователю древовидную иерархию, отображающую данные из базы данных. Затем создается другой модуль, позволяющий пользователю изменять данные, отображаемые первым модулем. Выделение средства просмотра и средства изменения в отдельные модули позволяет устанавливать различные редакторы для одного средства просмотра, так как различные редакторы могут создаваться внешними производителями как на коммерческой, так и на бесплатной основе. Таким образом, модульная архитектура платформы NetBeans обеспечивает гибкость.</p>
</div>
<div class="paragraph">
<p>После установки редактора выполняется добавление функций CRUD. Первый компонент "R" ("Read", чтение) обрабатывается описанным выше средством просмотра. Затем выполняется компонент "U" ("Update", обновление), затем – "C" ("Create", создание) и "D" ("Delete", удаление).</p>
</div>
<div class="paragraph">
<p>Этот курс позволит получить сведения о различных функциях платформы NetBeans, которые способствуют созданию приложений такого рода. Например, в курсе описаны средства  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.Manager.html">UndoRedo.Manager</a></code>  и  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-explorer/org/openide/explorer/ExplorerManager.html">ExplorerManager</a></code> , а также компоненты платформы NetBeans Swing, например,  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html">TopComponent</a></code>  и  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-explorer/org/openide/explorer/view/BeanTreeView.html">BeanTreeView</a></code> .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
В этом документе используется среда IDE NetBeans версии 6.8. Если установлена более ранняя версия, обратитесь к  <a href="67/nbm-crud.html">версии 6.7 этого документа</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Создаваемое в этом курсе приложение выглядит следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://netbeans.dzone.com/sites/all/files/customer-app-on-nb.png" alt="customer app on nb">
</div>
</div>
<div class="paragraph">
<p>Рекомендуется просмотреть серию демо-роликов  <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">10 лучших интерфейсов API NetBeans</a> перед началом работы с этим курсом. Многие используемые в этом курсе понятия более подробно рассматриваются в демо-роликах.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_настройка_приложения">Настройка приложения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Начнем с создания нового приложения платформы NetBeans.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите в меню "Файл" команду "Новый проект" (CTRL+SHIFT+N). В разделе "Категории" выберите параметр "Модули NetBeans". В разделе "Проекты" выберите параметр "Приложение платформы NetBeans". Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>На панели "Имя и местоположение" введите в поле "Имя проекта" текст  <code>DBManager</code> . Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В среде IDE будет создан проект  <code>DBManager</code> . Проект является контейнером для всех остальных создаваемых модулей.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-1.png" alt="crud 68dbmanager 1">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_интеграция_базы_данных">Интеграция базы данных</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для интеграции базы данных следует создать классы сущностей из базы данных и интегрировать эти классы вместе со связанными файлами JAR в модули, которые входят в состав приложения NetBeans Platform.</p>
</div>
<div class="sect2">
<h3 id="_создание_классов_сущностей">Создание классов сущностей</h3>
<div class="paragraph">
<p>В этом разделе выполняется создание классов сущностей из выбранной базы данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В рамках этого примера окно "Службы" используется для соединения с демонстрационной базой данных, поставляемой вместе со средой IDE NetBeans:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-2.png" alt="crud 68dbmanager 2">
</div>
</div>
<div class="paragraph">
<p>Возможно также выбрать любую другую базу и применить адаптировать действия к конкретному случаю. Если используется MySQL, обратитесь к разделу  <a href="https://netbeans.apache.org/kb/docs/ide/mysql_ru.html">Подключение к базе данных MySQL</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В среде IDE выберите пункт меню "Файл | Новый проект", а затем – "Java | Библиотека классов Java" для создания нового проекта библиотеки с именем  <code>CustomerLibrary</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В окне "Проекты" правой кнопкой мыши щелкните проект библиотеки и выберите в меню "Файл" пункт "Новый файл", а затем – "Сохранение состояния" | "Классы сущностей из базы данных". В мастере выберите базу данных и требуемые таблицы. Здесь следует выбрать "Клиент", после чего "Код скидки" будет добавлен автоматически, поскольку между этими двумя таблицами установлена связь.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-3.png" alt="crud 68dbmanager 3">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Укажите стратегию постоянства, выбрав один из доступных вариантов: Поскольку выбор одного из вариантов является обязательным, выберем EclipseLink:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-4.png" alt="crud 68dbmanager 4">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Укажите имя demo для пакета, в котором будут созданы классы сущностей.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-5.png" alt="crud 68dbmanager 5">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Нажмите кнопку "Готово". После выполнения этого действия просмотрите созданный код и обратите внимание на то, что теперь в папке META-INF располагается файл  <code>persistence.xml</code> , а также классы сущностей для всех таблиц:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-7.png" alt="crud 68dbmanager 7">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Создайте библиотеку Java, после чего файл JAR будет размещен в папке "dist", которую можно просмотреть в окне "Файлы":</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-8.png" alt="crud 68dbmanager 8">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_помещение_файла_jar_класса_сущностей_в_оболочку_модуля">Помещение файла JAR класса сущностей в оболочку модуля</h3>
<div class="paragraph">
<p>В этом разделе рассматривается добавление первого модуля к приложению. Новый модуль NetBeans помещает в обертку файл JAR, созданный в предыдущем разделе.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Правой кнопкой мыши щелкните узел "Модули  <code>DBManager</code> " в окне "Проекты" и выберите команду "Добавить новую библиотеку".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите файл JAR, созданный в предыдущем подразделе, а затем завершите работу мастера, указав любые значения. Предположим, что приложение предназначено для работы с посетителями веб-сайта shop.org; в таком случае для основы кодового имени подходит уникальный идентификатор "org.shop.model":</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-9.png" alt="crud 68dbmanager 9">
</div>
</div>
<div class="paragraph">
<p>Теперь первый собственный модуль в новом приложении обертывает архив JAR, содержащий классы сущностей и файл persistence.xml:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-91.png" alt="crud 68dbmanager 91">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_создание_других_связанных_модулей">Создание других связанных модулей</h3>
<div class="paragraph">
<p>В этом разделе создаются два новых модуля, которые помещают файлы JAR EclipseLink в оболочку, а также соединитель баз данных JAR.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выполните те же действия, что и при создании оболочки библиотеки для файла JAR класса сущностей, но на этот раз для файлов JAR EclipseLink, которые расположены в библиотеке Java "CustomerLibrary", созданной ранее:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-94.png" alt="crud 68dbmanager 94">
</div>
</div>
<div class="paragraph">
<p>В мастере "Модуль-обёртка вокруг библиотеки" можно выбрать несколько архивов JAR щелчком кнопки мыши при нажатой клавише CTRL.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Затем следует создать еще один модуль-обертку вокруг библиотеки для файла JAR клиента базы данных Java DB, предоставляемого в дистрибутиве JDK:  <code>db/lib/derbyclient.jar</code> .</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_проектирование_пользовательского_интерфейса">Проектирование пользовательского интерфейса</h3>
<div class="paragraph">
<p>В этом разделе создается простой прототип пользовательского интерфейса, который предоставляет окно  <code>JTextArea</code>  для отображения данных, извлеченных из базы данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Правой кнопкой мыши щелкните узел "Модули  <code>DBManager</code> " в окне "Проекты" и выберите команду "Добавить новый". Создайте новый модуль с именем  <code>CustomerViewer</code>  с основой кодового имени  <code>org.shop.ui</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В окне "Проекты" щелкните правой кнопкой мыши новый модуль и выберите команду "Создать" | "Оконный компонент". Укажите, что компонент должен быть создан в положении  <code>editor</code>  и должен открываться при запуске приложения. Установите  <code>Customer</code>  в качестве префикса имени класса окна.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Используйте палитру (CTRL+SHIFT+8) для перетаскивания  <code>JTextArea</code>  в новое окно:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-93.png" alt="crud 68dbmanager 93">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Добавьте этот код в конец конструктора TopComponent:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
for (Customer c : resultList) {
  jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Так как не установлены зависимости модулей, которые предоставляют объект Customer и файлы состояния JAR, указанные выше операторы будут отмечены красным подчеркиванием. Это будет устранено в следующем разделе.</p>
</div>
<div class="paragraph">
<p>Выше приведены ссылки на единицу сохранения состояния CustomerLibraryPU, имя которой установлено в файле  <code>persistence.xml</code> . Кроме того, здесь имеется ссылка на один из классов сущностей с именем  <code>Customer</code> , который находится в модуле классов сущностей. Если эти элементы отличаются от приведенных выше, их можно соответствующим образом адаптировать.</p>
</div>
</div>
<div class="sect2">
<h3 id="_установка_зависимостей">Установка зависимостей</h3>
<div class="paragraph">
<p>В этом разделе будет показано, как в одних модулях использовать код из других модулей. Для этого нужно совершенно явным образом установить соглашения между связанными модулями. Строгая модульная архитектура платформы NetBeans предотвращает случайное и хаотическое использование кода разных модулей, что нередко происходит на других платформах.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Модуль классов сущностей должен иметь зависимости от модуля Derby Client, а также от модуля EclipseLink. Правой кнопкой мыши щелкните модуль  <code>CustomerLibrary</code> , выберите команду "Свойства", а затем перейдите на вкладку "Библиотеки" для задания зависимостей от двух модулей, необходимых модулю  <code>CustomerLibrary</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Модуль  <code>CustomerViewer</code>  требует наличия зависимости от модуля EclipseLink, а также от модуля классов сущностей. Правой кнопкой мыши щелкните модуль  <code>CustomerViewer</code> , выберите команду "Свойства", а затем перейдите на вкладку "Библиотеки" для задания зависимостей от двух модулей, необходимых модулю  <code>CustomerViewer</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Откройте элемент  <code>CustomerTopComponent</code>  в представлении "Исходный код", правой кнопкой мыши щелкните окно редактора и выберите команду "Исправить выражения импорта". Среда IDE теперь может добавлять необходимые операторы импорта, так как для компонента  <code>CustomerTopComponent</code>  теперь доступны модули, содержащие необходимые классы.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь между модулями приложения установлены соглашения, которые дают возможность управления зависимостями в отдельных частях кода.</p>
</div>
</div>
<div class="sect2">
<h3 id="_запуск_прототипа">Запуск прототипа</h3>
<div class="paragraph">
<p>В этом разделе вы выполните запуск приложения, которое поможет проверить, верно ли установлено соединение с базой данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Запустите сервер базы данных.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Запустите приложение. На экране должно отобразиться следующее изображение:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-92.png" alt="crud 68dbmanager 92">
</div>
</div>
<div class="paragraph">
<p>Таким образом, создан простой прототип, состоящий из приложения платформы NetBeans, и выводящий данные из базы данных, который будет расширен в следующем разделе.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_интеграция_функциональности_crud">Интеграция функциональности CRUD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Чтобы создать функциональность CRUD, которая тесно интегрируется с платформой NetBeans, необходимо реализовать некоторые очень специфические приемы программирования этой платформы. В следующих разделах эти шаблоны рассматриваются более подробно.</p>
</div>
<div class="sect2">
<h3 id="_чтение">Чтение</h3>
<div class="paragraph">
<p>В этом разделе производится изменение введенного в предыдущем разделе элемента  <code>JTextArea</code>  для представления проводника платформы NetBeans. Представления проводника платформы NetBeans являются компонентами Swing, которые, по сравнению со стандартными компонентами Swing, лучше всего интегрируются с платформой NetBeans. Среди прочего поддерживается понятие контекста, позволяющее представлениям обладать чувствительностью к контексту.</p>
</div>
<div class="paragraph">
<p>Данные будут представлены в общей иерархической модели, предоставленной классом платформы NetBeans  <code>Node</code> , который отображается во всех представлениях проводника платформы NetBeans. В конце данного раздела описан процесс синхронизации представления проводника с диалоговым окном "Свойства" платформы NetBeans.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В компоненте  <code>TopComponent</code>  удалите элемент  <code>JTextArea</code>  в представлении проектирования и закомментируйте связанный с ним код в представлении исходного кода:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager =  Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
//for (Customer c : resultList) {
//    jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
//}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Правой кнопкой мыши щелкните модуль  <code>CustomerViewer</code> , выберите команду "Свойства", а затем перейдите на вкладку "Библиотеки" для задания зависимостей интерфейса API Nodes и интерфейса API Explorer &amp; Property Sheet.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Затем измените подпись класса для реализации элемента  <code>ExplorerManager.Provider</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">final class CustomerTopComponent extends TopComponent implements ExplorerManager.Provider</code></pre>
</div>
</div>
<div class="paragraph">
<p>Необходимо переопределить  <code>getExplorerManager()</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public ExplorerManager getExplorerManager() {
    return em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>В начале класса следует объявить и инициализировать  <code>ExplorerManager</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static ExplorerManager em = new ExplorerManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратитесь к ролику  <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">10 лучших интерфейсов API NetBeans</a> для получения подробных сведений о приведенном выше коде, в особенности демо-ролик об интерфейсе Nodes API и интерфейсе Explorer &amp; Property Sheet API.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Откройте представление проектирования для  <code>TopComponent</code> , щелкните правой кнопкой палитру, выберите в меню "Менеджер палитры" команду "Добавить из файла JAR". Затем перейдите к элементу  <code>org-openide-explorer.jar</code> , который находится в папке  <code>platform11/modules</code>  внутри каталога установки среды IDE NetBeans. Выберите элемент BeanTreeView и завершите работу мастера. Теперь элемент  <code>BeanTreeView</code>  должен отображаться на палитре. Перетащите его с палитры в окно.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Создайте класс фабрики, создающий новый экземпляр  <a href="http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-db/org/netbeans/api/db/explorer/node/BaseNode.html">BeanNode</a> для каждого клиента в базе данных:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import demo.Customer;
import java.beans.IntrospectionException;
import java.util.List;
import org.openide.nodes.BeanNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;

public class CustomerChildFactory extends ChildFactory&lt;Customer&gt; {

    private List&lt;Customer&gt; resultList;

    public CustomerChildFactory(List&lt;Customer&gt; resultList) {
        this.resultList = resultList;
    }

    @Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer Customer : resultList) {
            list.add(Customer);
        }
        return true;
    }

    @Override
    protected Node createNodeForKey(Customer c) {
        try {
            return new BeanNode(c);
        } catch (IntrospectionException ex) {
            Exceptions.printStackTrace(ex);
            return null;
        }
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Повторно выберите компонент  <code>CustomerTopComponent</code>  и используйте  <code>ExplorerManager</code>  для передачи результата из запроса JPA в элемент  <code>Node</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager =  Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
*em.setRootContext(new AbstractNode(Children.create(new CustomerChildFactory(resultList), true)));*
//for (Customer c : resultList) {
//    jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
//}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Запустите приложение. После запуска приложения откройте диалоговое окно "Свойства". Обратите внимание на то, что, несмотря на доступность данных, отображаемых в  <code>BeanTreeView</code> , элемент  <code>BeanTreeView</code>  не синхронизирован с диалоговым окном "Свойства", которое открывается в меню "Окно" с помощью команды "Свойства. Другими словами, при перемещении по древовидной иерархии в окне "Свойства" элементы не отображаются.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Синхронизация окна "Свойства" с элементом  <code>BeanTreeView</code>  осуществляется путем добавления в конструктор элемента  <code>TopComponent</code>  следующего кода:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">associateLookup(ExplorerUtils.createLookup(em, getActionMap()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь элементы  <code>TopComponent</code>   <code>ActionMap</code>  и  <code>ExplorerManager</code>  добавляются в элемент  <code>Lookup</code>   <code>TopComponent</code> . Это также приводит к тому, что в окне "Свойства" появляется отображаемое имя и текст всплывающей подсказки выбранного элемента  <code>Node</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Повторно запустите приложение и обратите внимание на то, что диалоговое окно "Свойства" теперь синхронизировано с представлением проводника:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-95.png" alt="crud 68dbmanager 95">
</div>
</div>
<div class="paragraph">
<p>Теперь данные можно просмотреть в древовидной иерархии, как и в случае с элементом  <code>JTree</code> . В то же время возможен переход в другое представление проводника без изменения модели, так как  <code>ExplorerManager</code>  выполняет роль посредника между моделью и представлением. Кроме того, теперь будет возможна синхронизация представления с окном "Свойства".</p>
</div>
</div>
<div class="sect2">
<h3 id="_обновление">Обновление</h3>
<div class="paragraph">
<p>В этом разделе вначале создается редактор. Редактор будет предоставлен новым модулем NetBeans. Таким образом, вначале будет создан новый модуль. Затем в этом модуле будет создан новый элемент  <code>TopComponent</code> , содержащий два поля  <code>JTextFields</code>  (для каждого столбца, который доступен пользователю для редактирования). Модулю средства просмотра необходимо разрешить взаимодействие с модулем редактора. Каждый раз при выборе нового элемента  <code>Node</code>  в модуле средства просмотра текущий объект  <code>Customer</code>  будет добавлен в  <code>Lookup</code> . В модуле редактора будет осуществляться прослушивание  <code>Lookup</code>  на появление объектов  <code>Customer</code> . При появлении нового объекта  <code>Customer</code>  в  <code>Lookup</code>  будет выполнено обновление текстовых полей  <code>JTextField</code>  в редакторе.</p>
</div>
<div class="paragraph">
<p>Затем поля  <code>JTextFields</code>  будут синхронизированы с функциями платформы NetBeans "Отменить", "Вернуть" и "Сохранить". Другими словами, при внесении пользователем изменения в поле  <code>JTextField</code>  существующая функциональность платформы NetBeans должна быть доступной, чтобы обеспечивать поддержку платформы NetBeans, исключающую необходимость создания новых функций. Для этого необходимо использовать элемент  <code>UndoRedoManager</code>  наряду с элементом  <code>SaveCookie</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Создайте новый модуль с именем  <code>CustomerEditor</code>  и основой кодового имени  <code>org.shop.editor</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Правой кнопкой мыши щелкните модуль  <code>CustomerEditor</code>  и выберите команду "Создать | Оконный компонент". Убедитесь в том, что в настройках указано отображать окно в положении <code>editor</code>  и открывать его при запуске приложения. На последней панели мастера задайте префикс имени класса Editor.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Используйте палитру (CTRL+SHIFT+8) для добавления двух меток  <code>JLabels</code>  и двух полей  <code>JTextFields</code>  в новое окно. Задайте тексты меток "Имя" и "Город", а затем установите имена переменных полей  <code>JTextField</code>  равными  <code>jTextField1</code>  и  <code>jTextField2</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В Конструкторе GUI окно теперь должно выглядеть следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-96.png" alt="crud 68dbmanager 96">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Вернитесь к модулю  <code>CustomerViewer</code>  и измените его файл  <code>layer.xml</code> , указав в нем, что окно  <code>CustomerTopComponent</code>  выводится в режиме  <code>explorer</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Правой кнопкой мыши щелкните проект и выберите команду "Очистить", перейдя в файл  <code>layer.xml</code> . Зачем это нужно? При каждом запуске приложения и его закрытии положения окон сохраняются в пользовательском каталоге. Таким образом, если элемент  <code>CustomerViewer</code>  изначально отображался в режиме  <code>editor</code> , он останется в режиме  <code>editor</code>  до выполнения команды "Очистить", которая сбрасывает пользовательский каталог (т.е. <em>удаляет</em> его) и позволяет отображать  <code>CustomerViewer</code>  в положении, установленном в настоящий момент в файле  <code>layer.xml</code> .</p>
</div>
<div class="paragraph">
<p>Следует также убедиться в том, что  <code>BeanTreeView</code>  в  <code>CustomerViewer</code>  будет растягиваться по горизонтали и вертикали при изменении размера приложения пользователем. Для проверки этого откройте окно, выберите элемент  <code>BeanTreeView</code> , а затем нажмите кнопки со стрелками на панели инструментов Конструктора GUI.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Выполните приложение и проверьте, выводятся ли следующие данные при запуске приложения:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-97.png" alt="crud 68dbmanager 97">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Теперь можно приступить к добавлению кода. Сначала необходимо открыть выбранный в настоящий момент объект Customer в редакторе:</p>
<div class="ulist">
<ul>
<li>
<p>Сначала настройте модуль  <code>CustomerViewer</code>  таким образом, чтобы текущий объект  <code>Customer</code>  добавлялся в окно средства просмотра  <code>Lookup</code>  при каждом выборе элемента  <code>Node</code> . Для этого создайте  <code>AbstractNode</code>  вместо  <code>BeanNode</code>  в классе  <code>CustomerChildFactory</code> . В этом случае текущий объект  <code>Customer</code>  можно будет добавить к  <code>Lookup</code>  узла следующим образом (обратите внимание на текст, выделенный полужирным шрифтом):</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
    Node node = new AbstractNode(Children.LEAF, Lookups.singleton(c));
    node.setDisplayName(c.getName());
    node.setShortDescription(c.getCity());
    return node;
//        try {
//            return new BeanNode(c);
//        } catch (IntrospectionException ex) {
//            Exceptions.printStackTrace(ex);
//            return null;
//        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь при каждом создании элемента  <code>Node</code> , которое выполняется при выборе нового клиента в средстве просмотра, новый объект  <code>Customer</code>  добавляется в окно  <code>Lookup</code>  элемента  <code>Node</code> .</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Теперь следует изменить модуль редактора таким образом, чтобы его окно отслеживало объекты  <code>Customer</code> , добавляемые в окно  <code>Lookup</code> . Вначале установите в модуле редактора зависимость от модуля, который предоставляет класс сущностей, а также от модуля, предоставляющего файлы состояния JAR.</p>
</li>
<li>
<p>Затем настройте подпись класса  <code>EditorTopComponent</code>  для внедрения  <code>LookupListener</code> :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class EditorTopComponent extends TopComponent implements LookupListener</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Переопределите  <code>resultChanged</code>  таким образом, чтобы текстовые поля  <code>JTextField</code>  обновлялись при вставке нового объекта  <code>Customer</code>  в окно  <code>Lookup</code> :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent lookupEvent) {
    Lookup.Result r = (Lookup.Result) lookupEvent.getSource();
    Collection&lt;Customer&gt; coll = r.allInstances();
    if (!coll.isEmpty()) {
        for (Customer cust : coll) {
            jTextField1.setText(cust.getName());
            jTextField2.setText(cust.getCity());
        }
    } else {
        jTextField1.setText("[no name]");
        jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>После определения  <code>LookupListener</code>  необходимо добавить его к какому-либо элементу. В данном случае он добавляется к элементу  <code>Lookup.Result</code> , полученному из глобального контекста. Глобальный контекст используется в качестве посредника для контекста выбранного элемента  <code>Node</code> . Например, если в древовидной иерархии выбрано значение "Ford Motor Co", то объект  <code>Customer</code>  для значения "Ford Motor Co" добавляется в окно  <code>Lookup</code>  элемента  <code>Node</code> . Так как элемент  <code>Node</code>  является выбранным в настоящее время компонентом, объект  <code>Customer</code>  для значения "Ford Motor Co" становится доступным в глобальном контексте. Это передается в элемент  <code>resultChanged</code>  и приводит к заполнению текстовых полей.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Все описанные операции начинают выполняться, то есть элемент  <code>LookupListener</code>  становится активным при каждом открытии окна редактора, как показано ниже:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void componentOpened() {
    result = Utilities.actionsGlobalContext().lookupResult(Customer.class);
    result.addLookupListener(this);
    resultChanged(new LookupEvent(result));
}

@Override
public void componentClosed() {
    result.removeLookupListener(this);
    result = null;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Так как редактор открывается при запуске приложения, элемент  <code>LookupListener</code>  также доступен при запуске приложения.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Затем необходимо следующим образом объявить переменную result в начале класса:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Lookup.Result result = null;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Запустите приложение повторно и обратите внимание на то, что окно редактора обновляется при выборе нового элемента  <code>Node</code> :</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-98.png" alt="crud 68dbmanager 98">
</div>
</div>
<div class="paragraph">
<p>В то же время следует отметить операции, выполняемые при переходе в окно редактора:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-99.png" alt="crud 68dbmanager 99">
</div>
</div>
<div class="paragraph">
<p>Так как элемент  <code>Node</code>  больше не является текущим, объект  <code>Customer</code>  покидает глобальный контекст. Как сказано выше, это происходит потому, что глобальный контекст выступает посредником для окна  <code>Lookup</code>  текущего элемента  <code>Node</code> . Таким образом, в этом случае глобальный контекст не может использоваться. Вместо этого будет использоваться локальное окно  <code>Lookup</code> , предоставленное окном Customer.</p>
</div>
<div class="paragraph">
<p>Замените строку</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">result = Utilities.actionsGlobalContext().lookupResult(Customer.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>следующей строкой:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">result = WindowManager.getDefault().findTopComponent("CustomerTopComponent").getLookup().lookupResult(Customer.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Строка "CustomerTopComponent" является идентификатором  <code>CustomerTopComponent</code> , который представляет собой строковую константу, находящуюся в исходном коде компонента  <code>CustomerTopComponent</code> . Недостатком описанного выше подхода является то, что элемент  <code>EditorTopComponent</code>  при этом может работать только в том случае, если обнаруживается компонент  <code>TopComponent</code>  с идентификатором "CustomerTopComponent". Это должно явным образом документироваться, чтобы информировать пользователей других редакторов о том, что идентификация  <code>TopComponent</code>  средства просмотра выполняется именно таким образом. Разработчик также может изменить модель выбора,  <a href="http://weblogs.java.net/blog/timboudreau/archive/2007/01/how_to_replace.html">как описано здесь</a> Тимом Будро.</p>
</div>
<div class="paragraph">
<p>При использовании описанных подходов контекст не будет потерян при переключении фокусировки на компонент  <code>EditorTopComponent</code> , как показано ниже:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-991.png" alt="crud 68dbmanager 991">
</div>
</div>
<div class="paragraph">
<p>Поскольку теперь вместо  <code>BeanNode</code>  используется  <code>AbstractNode</code> , в окне "Свойства" нет свойств. Их придется задать вручную, в соответствии с описанием в документе  <a href="https://netbeans.apache.org/tutorials/nbm-nodesapi2.html">Руководство по интерфейсу API для узлов</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Теперь следует перейти к функциям "Отменить" и "Вернуть". Необходимо добиться того, чтобы при изменении пользователем одного из полей  <code>JTextFields</code>  стали доступны кнопки "Отменить" и "Вернуть", а также связанные с ними команды меню "Правка". Для этого платформа NetBeans предоставляет  <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.Manager.html">UndoRedo.Manager</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Объявите новый элемент UndoRedoManager и создайте его экземпляр в начале элемента  <code>EditorTopComponent</code> :</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private UndoRedo.Manager manager = new UndoRedo.Manager();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Затем следует переопределить метод  <code>getUndoRedo()</code>  в компоненте  <code>EditorTopComponent</code> :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public UndoRedo getUndoRedo() {
    return manager;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>В конструкторе элемента  <code>EditorTopComponent</code>  следует добавить элемент  <code>KeyListener</code>  в поля  <code>JTextFields</code> . Затем добавьте прослушиватели  <code>UndoRedoListeners</code>  в связанные методы, которые необходимо внедрить:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">jTextField1.getDocument().addUndoableEditListener(manager);
jTextField2.getDocument().addUndoableEditListener(manager);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Запустите приложение и проверьте функции "Отменить" и "Вернуть" в действии, а также кнопки и команды меню. Функции будут работать ожидаемым образом. Можно изменить прослушиватель  <code>KeyListener</code>  таким образом, чтобы не все клавиши вызывали включение функций "Отменить" и "Вернуть". Например, при нажатии клавиши ВВОД включение функций "Отменить" и "Вернуть", скорее всего, не потребуется. Следовательно, необходимо именить код, приведенный выше, чтобы он соответствовал требованиям предприятия.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Необходимо также выполнить интеграцию с функциональностью платформы NetBeans "Сохранить":</p>
<div class="ulist">
<ul>
<li>
<p>По умолчанию на панели инструментов платформы NetBeans доступна кнопка "Сохранить все". В рассматриваемой ситуации сохранение "всех" элементов не требуется, так как понятие "все" подразумевает наличие различных документов. Здесь имеется только один "документ", то есть редактор, который используется для всех узлов древовидной иерархии. Удалите кнопку "Сохранить все" и добавьте кнопку "Сохранить". Для этого добавьте следующий код в файл layer модуля  <code>CustomerEditor</code> :</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;folder name="Toolbars"&gt;
    &lt;folder name="File"&gt;
        &lt;file name="org-openide-actions-SaveAction.shadow"&gt;
            &lt;attr name="originalFile" stringvalue="Actions/System/org-openide-actions-SaveAction.instance"/&gt;
            &lt;attr name="position" intvalue="444"/&gt;
        &lt;/file&gt;
        &lt;file name="org-openide-actions-SaveAllAction.shadow_hidden"/&gt;
    &lt;/folder&gt;
&lt;/folder&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>При запуске приложения на панели инструментов отобразится другой значок. Вместо кнопки "Сохранить все" будет доступна кнопка "Сохранить".</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Установите зависимости от интерфейса API Dialogs и интерфейса API Nodes.</p>
</li>
<li>
<p>В конструкторе  <code>EditorTopCompontn</code>  добавьте вызов метода (определяемого на следующем этапе) при каждом обнаружении изменений:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public EditorTopComponent() {

        ...
        ...
        ...

        jTextField1.getDocument().addDocumentListener(new DocumentListener() {
            public void insertUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void removeUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void changedUpdate(DocumentEvent arg0) {
                fire(true);
            }
        });

        jTextField2.getDocument().addDocumentListener(new DocumentListener() {
            public void insertUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void removeUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void changedUpdate(DocumentEvent arg0) {
                fire(true);
            }
        });

        //Создание экземпляра реализации SaveCookie:
        impl = new SaveCookieImpl();

        //Создание экземпляра динамического объекта:
        content = new InstanceContent();

        //Добавление динамического объекта в верхнюю часть TopComponent Lookup:
        associateLookup(new AbstractLookup(content));

    }

    ...
    ...
    ...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Здесь приведены два метода, упоминавшиеся выше. Первый метод вызывается при каждом обнаружении изменений. При обнаружении изменений к  <code>InstanceContent</code>  добавляется реализация  <code>SaveCookie</code>  из интерфейса API узлов:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    public void fire(boolean modified) {
        if (modified) {
            //Если текст изменен,
            //добавить реализацию SaveCookie к Lookup:
            content.add(impl);
        } else {
            //В противном случае удалим реализацию SaveCookie из lookup:
            content.remove(impl);
        }
    }

    private class SaveCookieImpl implements SaveCookie {

        @Override
        public void save() throws IOException {

           Confirmation message = new NotifyDescriptor.Confirmation("Сохранить \""
                    + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                    NotifyDescriptor.OK_CANCEL_OPTION,
                    NotifyDescriptor.QUESTION_MESSAGE);

            Object result = DialogDisplayer.getDefault().notify(message);
            //Если пользователь намерен сохранить, и нажимает "Да",
            //необходимо отключить действие Save,
            //таким образом оно будет доступно только при наличии изменений
            //текстового поля:
            if (NotifyDescriptor.YES_OPTION.equals(result)) {
                fire(false);
                //Реализация функций сохранения.
            }
        }
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Запустите приложение и обратите внимание на включение и отключение кнопки "Сохранить":</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-992.png" alt="crud 68dbmanager 992">
</div>
</div>
<div class="paragraph">
<p>В настоящий момент при нажатии кнопки "ОК" в приведенном выше диалоговом окне не происходит. На следующем этапе будет добавлен код JPA, обрабатывающий состояние изменений.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Затем следует добавить код JPA для сохранения изменений. Для этого замените комментарий "//Реализация функций сохранения". Этот комментарий необходимо заменить следующим кодом.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
entityManager.getTransaction().begin();
Customer c = entityManager.find(Customer.class, customer.getCustomerId());
c.setName(jTextField1.getText());
c.setCity(jTextField2.getText());
entityManager.getTransaction().commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Значение "customer" в  <code>customer.getCustomerId()()</code>  в настоящее время не определено. Добавьте строку, выделенную жирным шрифтом, в  <code>resultChanged</code>  ниже, сразу после определения  <code>Customer customer;</code>  в верхней части класса, таким образом текущий объект  <code>Customer</code>  будет определять значение  <code>customer</code> , которое затем используется в коде сохранения состояния, определенном выше, для получения идентификатора текущего объекта  <code>Customer</code> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent lookupEvent) {
    Lookup.Result r = (Lookup.Result) lookupEvent.getSource();
    Collection&lt;Customer&gt; c = r.allInstances();
    if (!c.isEmpty()) {
        for (Customer customer : c) {
            *customer = cust;*
            jTextField1.setText(customer.getName());
            jTextField2.setText(customer.getCity());
        }
    } else {
        jTextField1.setText("[имя не указано]");
        jTextField2.setText("[город не указан]");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Запустите приложение и измените данные. В настоящее время функциональность "Обновить" отсутствует (она будет добавлена на следующем этапе), поэтому для просмотра обновленной информации следует перезапустить приложение. Например, в данном случае древовидная иерархия отображает сохраненное имя клиента "Toyota Motor Co":</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-993.png" alt="crud 68dbmanager 993">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Затем следует добавить функцию для обновления средства просмотра Customer. Разработчик может добавить элемент  <code>Timer</code> , который периодически обновляет средство просмотра. В этом примере в узел Root будет добавлена команда меню "Обновить", позволяющая пользователю вручную обновить средство просмотра.</p>
<div class="ulist">
<ul>
<li>
<p>В основном пакете модуля  <code>CustomerViewer</code>  необходимо создать новый элемент  <code>Node</code> , заменяющий элемент  <code>AbstractNode</code> , который в настоящее время используется в качестве корневого элемента нижестоящих элементов средства просмотра. Обратите внимание на то, что действие "Обновить" также привязывается к новому корневому узлу.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class CustomerRootNode extends AbstractNode {

    public CustomerRootNode(Children kids) {
        super(kids);
        setDisplayName("Root");
    }

    @Override
    public Action[] getActions(boolean context) {
        Action[] result = new Action[]{
            new RefreshAction()};
        return result;
    }

    private final class RefreshAction extends AbstractAction {

        public RefreshAction() {
            putValue(Action.NAME, "Обновить");
        }

        public void actionPerformed(ActionEvent e) {
            CustomerTopComponent.refreshNode();
        }
    }

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Добавьте этот метод в компонент  <code>CustomerTopComponent</code>  для обновления представления:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public static void refreshNode() {
    EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    em.setRootContext(new *CustomerRootNode*(Children.create(new CustomerChildFactory(resultList), true)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь следует заменить приведенный выше код в конструкторе  <code>CustomerTopComponent</code>  на вызов упомянутого элемента. Как видно из выделенной части кода, теперь вместо элемента  <code>AbstractNode</code>  используется элемент  <code>CustomerRootNode</code> . Элемент  <code>CustomerRootNode</code>  содержит действие "Обновить", вызывающее приведенный выше код.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Добавьте к коду сохранения вызов привденного выше метода, чтобы при каждом сохранении данных происходило автоматическое обновление. Реализация этого расширения кода сохранения возможна несколькими разными способами. Например, можно создать новый модуль, содержащий действие обновления. Этот модуль затем будет совместно исползоваться модулем просмотра и модулем редактора, предоставляя общие функциональные возможности.</p>
</li>
<li>
<p>Повторно запустите приложение и обратите внимание на то, что появился новый корневой узел с действием "Обновить":</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-994.png" alt="crud 68dbmanager 994">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Измените данные, сохраните их, выполните действие "Обновить" и убедитесь в том, что средство просмотра обновляется.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В этом разделе был рассмотрен способ обработки изменений полей  <code>JTextFields</code>  в платформе NetBeans. При изменении текста кнопки платформы NetBeans "Отменить" и "Вернуть" будут включены или отключены. Кроме того, кнопка "Сохранить" также корректно включается и отключается, что позволяет пользователю сохранять измененные данные в базу данных.</p>
</div>
</div>
<div class="sect2">
<h3 id="_создание">Создание</h3>
<div class="paragraph">
<p>В этом разделе пользователю предоставляется возможность создания новой записи базы данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Правой кнопкой мыши щелкните модуль  <code>CustomerEditor</code>  и выберите команду "Создать действие". Используйте мастер создания действия для создания нового действия "Всегда включено". Новое действие должно отображаться в любом положении на панели инструментов и/или в строке меню. На следующем шаге мастера вызовите действие  <code>NewAction</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Убедитесь в наличии значка размером 16 на 16, который необходимо выбрать в мастере, если действие должно выбираться с панели инструментов.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В новом действии следует открыть компонент  <code>TopComponent</code>  вместе с пустыми полями  <code>JTextFields</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public final class NewAction implements ActionListener {

    public void actionPerformed(ActionEvent e) {
        EditorTopComponent tc = EditorTopComponent.getDefault();
        tc.resetFields();
        tc.open();
        tc.requestActive();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это действие внедряет класс  <code>ActionListener</code> , который привязан к приложению через записи в файле layer. Эти записи создаются мастером нового действия. Представьте себе легкость переноса существующего приложения Swing на платформу NetBeans при наличии возможности использования тех же классов  <code>Action</code> , которые использовались в исходном приложении, без необходимости их изменения в соответствии с классами  <code>Action</code> , предоставляемыми платформой NetBeans!</p>
</div>
<div class="paragraph">
<p>В компоненте  <code>EditorTopComponent</code>  необходимо добавить следующий метод для сброса полей текстовых полей  <code>JTextField</code>  и создания нового объекта  <code>Customer</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void resetFields() {
    customer = new Customer();
    jTextField1.setText("");
    jTextField2.setText("");
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В элементе  <code>SaveCookie</code>  следует убедиться в том, что возврат значения  <code>null</code>  указывает на сохранение новой записи, а не на обновление существующей записи:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void save() throws IOException {

    Confirmation message = new NotifyDescriptor.Confirmation("Сохранить \""
                    + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                    NotifyDescriptor.OK_CANCEL_OPTION,
                    NotifyDescriptor.QUESTION_MESSAGE);

    Object result = DialogDisplayer.getDefault().notify(msg);

    //Когда пользователь щелкает кнопку "Yes", подтверждая сохранение,
            //следует отключить кнопку "Сохранить" и команду меню "Сохранить",
            //чтобы они могли использоваться только при внесении следующего изменения
            //в текстовое поле:
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
        entityManager.getTransaction().begin();
        *if (customer.getCustomerId() != null)* {
            Customer c = entityManager.find(Customer.class, cude.getCustomerId());
            c.setName(jTextField1.getText());
            c.setCity(jTextField2.getText());
            entityManager.getTransaction().commit();
        } else {
            *Query query = entityManager.createQuery("SELECT c FROM Customer c");
            List&lt;Customer&gt; resultList = query.getResultList();
            customer.setCustomerId(resultList.size()+1);
            customer.setName(jTextField1.getText());
            customer.setCity(jTextField2.getText());
            //Добавить дополнительные поля, заполняющие оставшиеся столбцы в таблице!
            entityManager.persist(customer);
            entityManager.getTransaction().commit();*
        }
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Повторно запустите приложение и добавьте нового клиента в базу данных.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_удаление">Удаление</h3>
<div class="paragraph">
<p>В этом разделе пользователю предоставляется возможность удалять выбранную запись в базе данных. С помощью описанных выше приемов и кода внедрите действие "Удалить" самостоятельно.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Создайте новое действие  <code>DeleteAction</code> . Следует определить необходимость привязки действия к узлу Customer, к панели инструментов, к строке меню, к сочетанию клавиш или к комбинации этих вариантов. В зависимости от привязки следует использовать различные подходы к написанию кода. Повторно изучите учебный курс, обратив особое внимание на способ создания действия "Новое" в сравнении с действием корневого узла "Обновить".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Получите текущий объект  <code>Customer</code> , возвратите диалоговое окно "Вы уверены?", а затем удалите запись. Для получения дополнительных сведений повторно прочитайте учебный курс, в особенности ту часть, в которой реализуется функция "Сохранить". Вместо сохранения записи теперь производится ее удаление из базы данных.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_дополнительная_информация">Дополнительная информация</h2>
<div class="sectionbody">
<div class="paragraph">
<p>На этом учебный курс по функциям CRUD в платформе NetBeans завершен. В этом документе описано создание нового приложения платформы NetBeans с функциональностью CRUD для определенной базы данных. Дополнительные сведения о создании и разработке приложений приведены в следующих ресурсах:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform.html">Учебная карта по платформе NetBeans</a></p>
</li>
<li>
<p><a href="http://bits.netbeans.org/dev/javadoc/">Документация Javadoc по интерфейсам API в среде NetBeans</a></p>
</li>
</ul>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-crud_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
