
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans プラットフォーム CRUD アプリケーションのチュートリアル</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans プラットフォーム CRUD アプリケーションのチュートリアル - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, NetBeans プラットフォーム CRUD アプリケーションのチュートリアル">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans プラットフォーム CRUD アプリケーションのチュートリアル</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-crud_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_アプリケーションの設定">アプリケーションの設定</a></li>
<li><a href="#_データベースの統合">データベースの統合</a>
<ul class="sectlevel2">
<li><a href="#_エンティティークラスの作成">エンティティークラスの作成</a></li>
<li><a href="#_エンティティークラス_jar_のモジュールへのラップ">エンティティークラス JAR のモジュールへのラップ</a></li>
<li><a href="#_その他の関連モジュールの作成">その他の関連モジュールの作成</a></li>
<li><a href="#_ユーザーインタフェースのデザイン">ユーザーインタフェースのデザイン</a></li>
<li><a href="#_依存関係の設定">依存関係の設定</a></li>
<li><a href="#_プロトタイプの実行">プロトタイプの実行</a></li>
</ul>
</li>
<li><a href="#_crud_機能の統合">CRUD 機能の統合</a>
<ul class="sectlevel2">
<li><a href="#_読み取り">読み取り</a></li>
<li><a href="#_更新">更新</a></li>
<li><a href="#_作成">作成</a></li>
<li><a href="#_削除">削除</a></li>
</ul>
</li>
<li><a href="#_関連項目">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このチュートリアルでは、Java DB データベースを NetBeans プラットフォームアプリケーションに統合する方法を説明します。まず、Java DB データベースの操作から開始します。この Java DB データベースからエンティティークラスを作成します。ただし、この手順は、Java DB だけに該当するわけではありません。むしろ、NetBeans IDE によってサポートされるすべてのリレーショナルデータベースに該当します。次に、関連する JPA JAR 用のモジュールとともに、エンティティークラスをモジュールにラップします。</p>
</div>
<div class="paragraph">
<p>前述のモジュールがアプリケーションに組み込まれたら、アプリケーションのユーザーインタフェースを提供する新しいモジュールを作成します。この新しいモジュールにより、ユーザーはデータベースからのデータをツリー階層で表示できます。次に、別のモジュールを作成し、最初のモジュールによって表示されるデータをユーザーが編集できるようにします。ビューアとエディタを別々のモジュールに分けることによって、ユーザーが 1 つのビューアに別のエディタをインストールできるようにします。これは、商用のものや無償のものなど、外部ベンダーによってさまざまなエディタが作成されているためです。このような柔軟性は、NetBeans プラットフォームのモジュールアーキテクチャーによって実現されます。</p>
</div>
<div class="paragraph">
<p>エディタを作成したら、CRUD 機能の追加を開始します。まず、読み取り (Read) を表す「R」が、前述のビューアで処理されます。次に、更新 (Update) を表す「U」が処理され、続いて、作成 (Create) の「C」、および削除 (Delete)の「D」が処理されます。</p>
</div>
<div class="paragraph">
<p>このチュートリアルを終えると、この種のアプリケーションの作成に役立つ NetBeans プラットフォームのさまざまな機能について理解できます。たとえば、 <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.Manager.html">UndoRedo.Manager</a></code>  や  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-explorer/org/openide/explorer/ExplorerManager.html">ExplorerManager</a></code> 、さらに、 <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html">TopComponent</a></code>  や  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-explorer/org/openide/explorer/view/BeanTreeView.html">BeanTreeView</a></code>  などの NetBeans プラットフォーム Swing コンポーネントについて理解できます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このドキュメントでは NetBeans IDE 6.8 リリースを使用します。これ以前のバージョンを使用している場合、 <a href="67/nbm-crud.html">このドキュメントの 6.7 バージョン</a>を参照してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このチュートリアルで作成するアプリケーションは、次のようになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://netbeans.dzone.com/sites/all/files/customer-app-on-nb.png" alt="customer app on nb">
</div>
</div>
<div class="paragraph">
<p>このチュートリアルの操作を開始する前に、スクリーンキャストシリーズの「 <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">NetBeans API のトップ 10</a>」を視聴いただくことをお勧めします。このスクリーンキャストシリーズでは、このチュートリアルで紹介する概念の多くがより詳細に説明されています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_アプリケーションの設定">アプリケーションの設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>まず、NetBeans プラットフォームアプリケーションを新しく作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「ファイル」&gt;「新規プロジェクト」(Ctrl-Shift-N) を選択します。「カテゴリ」で「NetBeans モジュール」を選択します。「プロジェクト」で「NetBeans プラットフォームアプリケーション」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「名前と場所」パネルで、「プロジェクト名」フィールドに「 <code>DBManager</code> 」と入力します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>IDE によって  <code>DBManager</code>  プロジェクトが作成されます。このプロジェクトは、これから作成するほかのモジュールすべてのコンテナになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-1.png" alt="crud 68dbmanager 1">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_データベースの統合">データベースの統合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>データベースを統合するには、データベースからエンティティークラスを作成し、それらのエンティティークラスとその関連 JAR を、NetBeans プラットフォームアプリケーションを構成するモジュールに統合する必要があります。</p>
</div>
<div class="sect2">
<h3 id="_エンティティークラスの作成">エンティティークラスの作成</h3>
<div class="paragraph">
<p>この節では、選択したデータベースからエンティティークラスを生成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>この例では、「サービス」ウィンドウを使用して、NetBeans IDE に含まれているサンプルデータベースに接続します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-2.png" alt="crud 68dbmanager 2">
</div>
</div>
<div class="paragraph">
<p>別の方法として、任意のデータベースを使用して、使用するユースケースに合わせて手順を適宜変更してもかまいません。MySQL の場合、 <a href="https://netbeans.apache.org/kb/docs/ide/mysql_ja.html">MySQL データベースへの接続</a>を参照してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>IDE で「ファイル」&gt;「新規プロジェクト」を選択します。次に「Java」&gt;「Java クラスライブラリ」を選択し、「 <code>CustomerLibrary</code> 」という名前の新しいライブラリプロジェクトを作成します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「プロジェクト」ウィンドウで、作成したライブラリプロジェクトを右クリックし、「ファイル」&gt;「新規ファイル」を選択します。次に、「持続性」&gt;「データベースからのエンティティークラス」を選択します。ウィザードで、必要なデータベースと表を選択します。ここで「Customer」を選択すると、自動的に「Discount Code」が追加されます。これは、これらの 2 つの表の間に関係があるためです。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-3.png" alt="crud 68dbmanager 3">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>使用可能な任意のオプションである、持続性の方針を指定します。何か選択する必要があるため、ここでは EclipseLink を選択します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-4.png" alt="crud 68dbmanager 4">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>エンティティークラスの生成先となるパッケージの名前として「demo」を指定します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-5.png" alt="crud 68dbmanager 5">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>「完了」をクリックします。この手順を完了したら、生成されたコードを確認します。また、特に、「META-INF」というフォルダに  <code>persistence.xml</code>  ファイルが作成されていること、および表ごとにエンティティークラスが作成されていることに注目します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-7.png" alt="crud 68dbmanager 7">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Java ライブラリを構築すると、ライブラリプロジェクトの「dist」フォルダに JAR ファイルが生成されます。このファイルは、「ファイル」ウィンドウで確認できます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-8.png" alt="crud 68dbmanager 8">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_エンティティークラス_jar_のモジュールへのラップ">エンティティークラス JAR のモジュールへのラップ</h3>
<div class="paragraph">
<p>この節では、アプリケーションに最初のモジュールを追加します。新規 NetBeans モジュールは、前の節で作成した JAR ファイルをラップします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「プロジェクト」ウィンドウで  <code>DBManager</code>  の「モジュール」ノードを右クリックし、「新規ライブラリを追加」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>前の節で作成した JAR を選択し、任意の値を指定してウィザードを終了します。このアプリケーションを、shop.org で顧客に対応するためのものと仮定します。その場合、コード名ベースとして、一意の識別子「org.shop.model」が適しています。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-9.png" alt="crud 68dbmanager 9">
</div>
</div>
<div class="paragraph">
<p>これで、新しいアプリケーション内に、エンティティークラスと persistence.xml ファイルを含む JAR をラップする、最初のカスタムモジュールが作成されました。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-91.png" alt="crud 68dbmanager 91">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_その他の関連モジュールの作成">その他の関連モジュールの作成</h3>
<div class="paragraph">
<p>この節では、EclipseLink JAR とデータベースコネクタ JAR をラップする新しいモジュールを 2 個作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>エンティティークラス JAR 用にライブラリラッパーを作成したときと同じようにします。ただし今回は、以前に作成した「CustomerLibrary」 Java ライブラリ内にある EclipseLink JAR 用です。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-94.png" alt="crud 68dbmanager 94">
</div>
</div>
<div class="paragraph">
<p>「ライブラリラッパーモジュール」ウィザードで Ctrl キーを押しながらクリックすると、複数の JAR を選択できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>次に、ライブラリラッパーモジュールをもう一つ作成します。これは Java DB クライアント JAR 用で、 <code>db/lib/derbyclient.jar</code>  の JDK ディストリビューションで使用できます。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_ユーザーインタフェースのデザイン">ユーザーインタフェースのデザイン</h3>
<div class="paragraph">
<p>この節では、単純なプロトタイプのユーザーインタフェースを作成します。このユーザーインタフェースのウィンドウに、データベースから取得したデータを  <code>JTextArea</code>  を使用して表示します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「プロジェクト」ウィンドウで  <code>DBManager</code>  の「モジュール」ノードを右クリックし、「新規を追加」を選択します。「 <code>CustomerViewer</code> 」という名前で新しいモジュールを作成し、コード名ベースに「 <code>org.shop.ui</code> 」を指定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「プロジェクト」ウィンドウで、新しく作成したモジュールを右クリックし、「新規」&gt;「ウィンドウコンポーネント」を選択します。このコンポーネントが  <code>editor</code>  位置に作成され、アプリケーションが起動するときに開くように指定します。ウィンドウのクラス名の接頭辞として  <code>Customer</code>  を設定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>パレット (Ctrl-Shift-8) を使用して、新しいウィンドウに  <code>JTextArea</code>  をドラッグ＆ドロップします。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-93.png" alt="crud 68dbmanager 93">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>次の行を TopComponent コンストラクタの最後に追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
for (Customer c : resultList) {
  jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Customer オブジェクトと持続性 JAR を提供するモジュールに対して依存関係を設定していないため、前出の文はエラーを示す赤い下線でマークされます。このエラーの修正は、次の節で行います。</p>
</div>
<div class="paragraph">
<p>前出の行には、「CustomerLibraryPU」という名前の持続性ユニットへの参照があります。これは、 <code>persistence.xml</code>  ファイル内で設定された名前です。さらに、 <code>Customer</code>  というエンティティークラスへの参照があります。これは、エンティティークラスモジュール内にあります。これらの記述が前出のものと異なる場合、必要に応じて適宜変更します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_依存関係の設定">依存関係の設定</h3>
<div class="paragraph">
<p>この節では、いくつかのモジュールで、別のモジュールのコードを利用できるようにします。これは、関連するモジュール間に意図的なコントラクトを設定することによって、明示的に行います。つまり、意図せずに無秩序にコードが再利用されるような状況とは対照的です。そのような無秩序な再利用は、NetBeans プラットフォームによって提供されるような厳密なモジュールアーキテクチャーを持たない場合に起こることがよくあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>エンティティークラスモジュールには、Derby Client モジュールと EclipseLink モジュールに対する依存関係が必要です。 <code>CustomerLibrary</code>  モジュールを右クリックして「プロパティー」を選択し、「ライブラリ」タブを使用して、 <code>CustomerLibrary</code>  モジュールに必要な 2 つのモジュールに対する依存関係を設定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>CustomerViewer</code>  モジュールには、EclipseLink モジュールとエンティティークラスモジュールに対する依存関係が必要です。 <code>CustomerViewer</code>  モジュールを右クリックして「プロパティー」を選択し、「ライブラリ」タブを使用して、 <code>CustomerViewer</code>  モジュールに必要な 2 つのモジュールに対する依存関係を設定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>CustomerTopComponent</code>  をソースビューで開き、エディタを右クリックして「インポートを修正」を選択します。必要なクラスを提供するモジュールが  <code>CustomerTopComponent</code>  に用意されたため、IDE は必要なインポート文を追加できるようになりました。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これで、アプリケーションのモジュール間にコントラクトが設定されました。これにより、コードの異なる部分間の依存関係を管理できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_プロトタイプの実行">プロトタイプの実行</h3>
<div class="paragraph">
<p>この節では、アプリケーションを実行し、データベースに適切にアクセスすることを確認できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>データベースサーバーを起動します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>アプリケーションを実行します。次のように表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-92.png" alt="crud 68dbmanager 92">
</div>
</div>
<div class="paragraph">
<p>これで、データベースからデータを表示する NetBeans プラットフォームアプリケーションからなる、単純なプロトタイプを作成しました。次の節で、これを拡張します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_crud_機能の統合">CRUD 機能の統合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans プラットフォームにスムースに統合する CRUD 機能を作成するには、NetBeans プラットフォームの特定のコーディングパターンをいくつか実装する必要があります。以降の節では、このパターンを詳細に説明します。</p>
</div>
<div class="sect2">
<h3 id="_読み取り">読み取り</h3>
<div class="paragraph">
<p>この節では、前の節で説明した  <code>JTextArea</code>  を NetBeans プラットフォームのエクスプローラビュー用に変更します。NetBeans プラットフォームのエクスプローラビューは Swing コンポーネントの一種ですが、標準の Swing コンポーネントよりも NetBeans プラットフォームに緊密に統合されます。特に、コンテキスト依存にすることができる、コンテキストの概念をサポートしています。</p>
</div>
<div class="paragraph">
<p>データの表示には、NetBeans プラットフォームの  <code>Node</code>  クラスによって提供される汎用的な階層モデルが使用されます。このモデルは、NetBeans プラットフォームのすべてのエクスプローラビューで表示できます。この節の最後で、エクスプローラビューを NetBeans プラットフォームのプロパティーウィンドウと同期させる方法について説明します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>TopComponent</code>  で、デザインビューから  <code>JTextArea</code>  を削除し、ソースビューで JTextArea に関連する次のコードをコメントアウトします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager =  Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
//for (Customer c : resultList) {
//    jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
//}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>CustomerViewer</code>  モジュールを右クリックして「プロパティー」を選択し、「ライブラリ」タブを使用して、「ノード API」と「エクスプローラおよびプロパティーシート API」に対する依存関係を設定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>次に、 <code>ExplorerManager.Provider</code>  を実装するように、クラスの署名を次のように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">final class CustomerTopComponent extends TopComponent implements ExplorerManager.Provider</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``getExplorerManager()``  をオーバーライドする必要があります。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public ExplorerManager getExplorerManager() {
    return em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスの先頭で、 <code>ExplorerManager</code>  を宣言して初期化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static ExplorerManager em = new ExplorerManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>前述のコードの詳細については、「 <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">NetBeans API のトップ 10</a>」で、特にノード API とエクスプローラおよびプロパティーシート API について取り上げているスクリーンキャストを視聴してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p><code>TopComponent</code>  のデザインビューに切り替えてパレット内を右クリックし、「パレットマネージャー」&gt;「JAR から追加」を選択します。次に、NetBeans IDE のインストールディレクトリの  <code>platform11/modules</code>  フォルダにある  <code>org-openide-explorer.jar</code>  を参照します。BeanTreeView を選択し、ウィザードを終了します。パレットに  <code>BeanTreeView</code>  が表示されます。これをパレットからウィンドウにドラッグ＆ドロップします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>データベース内の各顧客に新しい  <a href="http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-db/org/netbeans/api/db/explorer/node/BaseNode.html">BeanNode</a> を作成する、ファクトリクラスを作成します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import demo.Customer;
import java.beans.IntrospectionException;
import java.util.List;
import org.openide.nodes.BeanNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;

public class CustomerChildFactory extends ChildFactory&lt;Customer&gt; {

    private List&lt;Customer&gt; resultList;

    public CustomerChildFactory(List&lt;Customer&gt; resultList) {
        this.resultList = resultList;
    }

    @Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer Customer : resultList) {
            list.add(Customer);
        }
        return true;
    }

    @Override
    protected Node createNodeForKey(Customer c) {
        try {
            return new BeanNode(c);
        } catch (IntrospectionException ex) {
            Exceptions.printStackTrace(ex);
            return null;
        }
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p><code>CustomerTopComponent</code>  に戻り、 <code>ExplorerManager</code>  を使用して JPA クエリーの結果リストを  <code>Node</code>  に渡します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager =  Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
Query query = entityManager.createQuery("SELECT c FROM Customer c");
List&lt;Customer&gt; resultList = query.getResultList();
*em.setRootContext(new AbstractNode(Children.create(new CustomerChildFactory(resultList), true)));*
//for (Customer c : resultList) {
//    jTextArea1.append(c.getName() + " (" + c.getCity() + ")" + "\n");
//}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>アプリケーションを実行します。アプリケーションが起動したら、プロパティーウィンドウを開きます。 <code>BeanTreeView</code>  に表示されるデータがあるとしても、この  <code>BeanTreeView</code>  はプロパティーウィンドウ (「Window」&gt;「Properties」から表示) と同期しません。つまり、ツリー階層を上下に移動しても、プロパティーウィンドウには何も表示されません。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>次のコードを  <code>TopComponent</code>  内のコンストラクタに追加して、プロパティーウィンドウを  <code>BeanTreeView</code>  と同期させます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">associateLookup(ExplorerUtils.createLookup(em, getActionMap()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、 <code>TopComponent</code>  の  <code>ActionMap</code>  と  <code>ExplorerManager</code>  を  <code>TopComponent</code>  の  <code>Lookup</code>  に追加しました。これには、選択した  <code>Node</code>  の表示名とツールチップテキストがプロパティーウィンドウに表示されるようになるという副次的な効果があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>アプリケーションを再度実行し、今度は、プロパティーウィンドウがエクスプローラビューと同期することを確認します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-95.png" alt="crud 68dbmanager 95">
</div>
</div>
<div class="paragraph">
<p>これで、 <code>JTree</code>  を使用した場合と同じように、ツリー階層でデータを表示できるようになりました。別のエクスプローラビューに切り替えることもできますが、その際にモデルを変更する必要はまったくありません。これは、 <code>ExplorerManager</code>  がモデルとビューを媒介するためです。最後に、ビューとプロパティーウィンドウを同期することもできるようになりました。</p>
</div>
</div>
<div class="sect2">
<h3 id="_更新">更新</h3>
<div class="paragraph">
<p>この節では、まずエディタを作成します。エディタは、新しい NetBeans モジュールによって提供されます。このため、まず、新しいモジュールを作成します。次に、この新しいモジュール内で、新しい  <code>TopComponent</code>  を作成し、ユーザーが編集する各列に対して  <code>JTextFields</code>  を 2 つ含めます。ビューアモジュールがエディタモジュールと通信できるようにする必要があります。ビューアモジュール内で新しい  <code>Node</code>  が選択されるたびに、現在の  <code>Customer</code>  オブジェクトを  <code>Lookup</code>  に追加します。エディタモジュールで、 <code>Customer</code>  オブジェクトを挿入する  <code>Lookup</code>  を待機します。新しい  <code>Customer</code>  オブジェクトが  <code>Lookup</code>  に挿入されるたびに、エディタで  <code>JTextFields</code>  を更新します。</p>
</div>
<div class="paragraph">
<p>次に、 <code>JTextFields</code>  を、NetBeans プラットフォームの元に戻す、再実行、および保存の機能と同期させます。つまり、ユーザーが  <code>JTextField</code>  を変更したときに、NetBeans プラットフォームの既存の機能を利用できるようにします。このようにすると、新しい機能を作成せずに、NetBeans プラットフォームのサポートに取り込むことができます。これを実現するには、 <code>UndoRedoManager</code>  を  <code>SaveCookie</code>  とともに使用する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「 <code>CustomerEditor</code> 」という名前で新しいモジュールを作成し、コード名ベースに「 <code>org.shop.editor</code> 」を指定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>CustomerEditor</code>  モジュールを右クリックして、「新規」&gt;「ウィンドウコンポーネント」を選択します。ウィンドウが  <code>editor</code>  の位置に表示され、アプリケーションが起動するときに開くように指定する必要があります。ウィザードの最後のパネルで、クラス名の接頭辞として「Editor」を設定します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>パレット (Ctrl-Shift-8) を使用して、 <code>JLabels</code>  を 2 個と  <code>JTextFields</code>  を 2 個、新しいウィンドウに追加します。ラベルのテキストに「Name」と「City」を設定し、2 個の  <code>JTextFields</code>  の変数名にそれぞれ  <code>jTextField1</code>  と  <code>jTextField2</code>  を設定します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>GUI ビルダーで、ウィンドウが次のように表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-96.png" alt="crud 68dbmanager 96">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p><code>CustomerViewer</code>  モジュールに戻り、 <code>layer.xml</code>  ファイルを変更して  <code>CustomerTopComponent</code>  ウィンドウが  <code>explorer</code>  モードで表示されるように指定します。</p>
<div class="literalblock">
<div class="content">
<pre>``layer.xml``  ファイルを変更したあとは、アプリケーションプロジェクトを右クリックし、「生成物を削除」を選択します。これには理由があります。アプリケーションを実行して終了するたびに、ウィンドウの位置がユーザーディレクトリに保存されるからです。このため、 ``CustomerViewer``  が当初  ``editor``  モードで表示されていた場合、「生成物を削除」を実行するまで、 ``editor``  モードのままになります。「生成物を削除」により、ユーザーディレクトリがリセットされ (つまり、ユーザーディレクトリが_削除_され)、 ``CustomerViewer``  が有効になり、現在  ``layer.xml``  ファイルに設定されている位置に表示されます。</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>また、ユーザーによってアプリケーションのサイズが変更されたときに、 <code>CustomerViewer</code>  の  <code>BeanTreeView</code>  が縦または横に伸縮するかどうかを確認します。この確認を行うには、ウィンドウを開いて  <code>BeanTreeView</code>  を選択してから、GUI ビルダーのツールバーの矢印ボタンをクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>アプリケーションを実行し、アプリケーションの起動時に次のようになるかを確認します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-97.png" alt="crud 68dbmanager 97">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>これで、コードの追加を開始できます。最初に、現在選択されている Customer オブジェクトをエディタに表示する必要があります。</p>
<div class="ulist">
<ul>
<li>
<p>まず、 <code>CustomerViewer</code>  モジュールを調整し、新しい  <code>Node</code>  が選択されるたびに、現在の  <code>Customer</code>  オブジェクトがビューアのウィンドウの  <code>Lookup</code>  に追加されるようにします。 <code>CustomerChildFactory</code>  クラスに、 <code>BeanNode</code>  ではなく  <code>AbstractNode</code>  を作成することによって、これを実現します。次に示すように、現在の  <code>Customer</code>  オブジェクトをノードの  <code>Lookup</code>  に追加できます (ボールドの部分)。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
    Node node = new AbstractNode(Children.LEAF, Lookups.singleton(c));
    node.setDisplayName(c.getName());
    node.setShortDescription(c.getCity());
    return node;
//        try {
//            return new BeanNode(c);
//        } catch (IntrospectionException ex) {
//            Exceptions.printStackTrace(ex);
//            return null;
//        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、ユーザーがビューアで新規顧客を選択することで新しい  <code>Node</code>  が作成されるたびに、新しい  <code>Customer</code>  オブジェクトが  <code>Node</code>  の  <code>Lookup</code>  に追加されるようになります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>次に、エディタモジュールを変更し、 <code>Lookup</code>  に追加される  <code>Customer</code>  オブジェクトをエディタモジュールのウィンドウが最終的に待機するようにします。まず、エディタモジュールで、エンティティークラスを提供するモジュールと持続性 JAR を提供するモジュールに対する依存関係を設定します。</p>
</li>
<li>
<p>次に、 <code>LookupListener</code>  を実装するように <code>、EditorTopComponent</code>  クラスの署名を次のように変更します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class EditorTopComponent extends TopComponent implements LookupListener</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resultChanged</code>  をオーバーライドし、新しい  <code>Customer</code>  オブジェクトが  <code>Lookup</code>  に挿入されるたびに  <code>JTextFields</code>  が更新されるようにします。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent lookupEvent) {
    Lookup.Result r = (Lookup.Result) lookupEvent.getSource();
    Collection&lt;Customer&gt; coll = r.allInstances();
    if (!coll.isEmpty()) {
        for (Customer cust : coll) {
            jTextField1.setText(cust.getName());
            jTextField2.setText(cust.getCity());
        }
    } else {
        jTextField1.setText("[no name]");
        jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>これで、 <code>LookupListener</code>  が定義されたので、これをどこかに追加する必要があります。ここでは、グローバルコンテキストから取得した  <code>Lookup.Result</code>  に追加します。グローバルコンテキストは、選択された  <code>Node</code>  のコンテキストの代わりとして機能します。たとえば、ツリー階層で「Ford Motor Co」が選択された場合、「Ford Motor Co」の  <code>Customer</code>  オブジェクトが  <code>Node</code>  の  <code>Lookup</code>  に追加されます。これは、現在選択されている  <code>Node</code>  が「Ford Motor Co」であり、「Ford Motor Co」を表す  <code>Customer</code>  オブジェクトがグローバルコンテキストで利用可能になったことを意味します。次に、このオブジェクトが  <code>resultChanged</code>  に渡され、テキストフィールドに値が取り込まれます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>前出の処理 ( <code>LookupListener</code>  がアクティブになるなど) はすべて、次に示すように、エディタウィンドウが開かれるたびに開始されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void componentOpened() {
    result = Utilities.actionsGlobalContext().lookupResult(Customer.class);
    result.addLookupListener(this);
    resultChanged(new LookupEvent(result));
}

@Override
public void componentClosed() {
    result.removeLookupListener(this);
    result = null;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションが起動するとエディタウィンドウが開くので、 <code>LookupListener</code>  はアプリケーションの起動時に使用可能になります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最後に、次に示すように、クラスの先頭で結果変数を宣言します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Lookup.Result result = null;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>アプリケーションを再度実行し、新しい  <code>Node</code>  を選択するたびに、エディタウィンドウが更新されることを確認します。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-98.png" alt="crud 68dbmanager 98">
</div>
</div>
<div class="paragraph">
<p>一方、フォーカスをエディタウィンドウに切り替えるときに何が起こるかを確認します。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-99.png" alt="crud 68dbmanager 99">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``Node``  は選択を解除されたため、 ``Customer``  オブジェクトはグローバルコンテキストでなくなります。これは、すでに指摘したとおり、グローバルコンテキストが現在の  ``Node``  の  ``Lookup``  の代わりとして機能しているためです。このため、この例では、グローバルコンテキストを使用できません。代わりに、「Customer」ウィンドウによって提供されるローカル  ``Lookup``  を使用します。</pre>
</div>
</div>
<div class="paragraph">
<p>次のコードを書き換えます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">result = Utilities.actionsGlobalContext().lookupResult(Customer.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">result = WindowManager.getDefault().findTopComponent("CustomerTopComponent").getLookup().lookupResult(Customer.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>文字列「CustomerTopComponent」は  <code>CustomerTopComponent</code>  の ID であり、 <code>CustomerTopComponent</code>  のソースコードで確認できる文字列定数です。この方法の欠点は、ID が「CustomerTopComponent」の  <code>TopComponent</code>  を見つけることができなければ、 <code>EditorTopComponent</code>  が動作しないという点です。この点については、明確な文書を作成し、このようにしてビューアの  <code>TopComponent</code>  を識別する必要があることを代替エディタの開発者に示すか、Tim Boudreau が <a href="http://weblogs.java.net/blog/timboudreau/archive/2007/01/how_to_replace.html">ここ</a>で説明しているように、選択モデルを書き換える必要があります。</p>
</div>
<div class="paragraph">
<p>これらの方法のどちらかを採用した場合は、次に示すように、フォーカスを  <code>EditorTopComponent</code>  に切り替えてもコンテキストが失われません。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-991.png" alt="crud 68dbmanager 991">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``BeanNode``  の代わりに  ``AbstractNode``  を使用しているため、「プロパティー」ウィンドウにプロパティーは表示されません。 link:https://netbeans.apache.org/tutorials/nbm-nodesapi2.html[ノード API のチュートリアル]に説明されているように、自分で指定する必要があります。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>次に、元に戻す/再実行の機能に取り組みます。具体的には、ユーザーが  <code>JTextFields</code>  のいずれかを変更するたびに、「Undo」ボタンと「Redo」ボタン、および「Edit」メニューの関連するメニュー項目が有効になるようにします。これを実現するために、NetBeans プラットフォームは  <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.Manager.html">UndoRedo.Manager</a> を使用可能にします。</p>
<div class="ulist">
<ul>
<li>
<p>新しい UndoRedoManager を  <code>EditorTopComponent</code>  の先頭で宣言し、インスタンス化します。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private UndoRedo.Manager manager = new UndoRedo.Manager();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>次に、 <code>EditorTopComponent</code>  内の  <code>getUndoRedo()</code>  メソッドをオーバーライドします。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public UndoRedo getUndoRedo() {
    return manager;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EditorTopComponent</code>  のコンストラクタで、 <code>KeyListener</code>  を  <code>JTextFields</code>  に追加し、実装する必要のある関連メソッド内に  <code>UndoRedoListeners</code>  を追加します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">jTextField1.getDocument().addUndoableEditListener(manager);
jTextField2.getDocument().addUndoableEditListener(manager);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>アプリケーションを再度実行し、「Undo」と「Redo」のボタンとメニュー項目の機能が動作することを確認します。この機能は、予想どおりに動作します。必要な場合は、 <code>KeyListener</code>  を変更して、一部のキーに対して元に戻す/再実行の機能を無効にすることもできます。たとえば、Enter キーが押されたときに、元に戻す/再実行の機能が有効になるようにはしないでしょう。このため、前出のコードは、ビジネス要件に合わせて調整します。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>3 つ目に、NetBeans プラットフォームの保存機能と統合する必要があります。</p>
<div class="ulist">
<ul>
<li>
<p>デフォルトで、「Save All」ボタンは NetBeans プラットフォームツールバーで使用できます。このシナリオでは、「すべて」を保存するのではありません。「すべて」は複数のドキュメントがあることを示すからです。ここでは、「ドキュメント」は 1 個しかありません。それは、ツリー階層内の全ノードで再利用されるエディタです。 <code>CustomerEditor</code>  モジュールのレイヤーファイルに次のコードを追加して、「Save All」ボタンを削除し、代わりに「Save」ボタンを追加します。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;folder name="Toolbars"&gt;
    &lt;folder name="File"&gt;
        &lt;file name="org-openide-actions-SaveAction.shadow"&gt;
            &lt;attr name="originalFile" stringvalue="Actions/System/org-openide-actions-SaveAction.instance"/&gt;
            &lt;attr name="position" intvalue="444"/&gt;
        &lt;/file&gt;
        &lt;file name="org-openide-actions-SaveAllAction.shadow_hidden"/&gt;
    &lt;/folder&gt;
&lt;/folder&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>次にアプリケーションを実行すると、ツールバーに別のアイコンが表示されます。「Save All」ボタンの代わりに、「Save」ボタンが使用できるようになります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>「ダイアログ API」と「ノード API」に対して、依存関係を設定します。</p>
</li>
<li>
<p><code>EditorTopCompontn</code>  コンストラクタで、変更が検出されたときにメソッドを起動する呼び出しを追加します (次の手順で定義)。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public EditorTopComponent() {

        ...
        ...
        ...

        jTextField1.getDocument().addDocumentListener(new DocumentListener() {
            public void insertUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void removeUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void changedUpdate(DocumentEvent arg0) {
                fire(true);
            }
        });

        jTextField2.getDocument().addDocumentListener(new DocumentListener() {
            public void insertUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void removeUpdate(DocumentEvent arg0) {
                fire(true);
            }
            public void changedUpdate(DocumentEvent arg0) {
                fire(true);
            }
        });

        //SaveCookie 実装の新しいインスタンスを作成:
        impl = new SaveCookieImpl();

        //動的オブジェクトの新しいインスタンスを作成:
        content = new InstanceContent();

        //動的コンポーネントを TopComponent Lookup に追加:
        associateLookup(new AbstractLookup(content));

    }

    ...
    ...
    ...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>これらを参照する 2 つのメソッドは次のとおりです。1 つ目は、変更が検出されたときに起動されるメソッドです。ノード API からの  <code>SaveCookie</code>  の実装は、変更が検出されたときに  <code>InstanceContent</code>  に追加されます。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    public void fire(boolean modified) {
        if (modified) {
            //テキストが変更されたら、
              //Lookup に SaveCookie 実装を追加
            content.add(impl);
        } else {
            //そうでない場合、Lookup から SaveCookie 実装を削除
            content.remove(impl);
        }
    }

    private class SaveCookieImpl implements SaveCookie {

        @Override
        public void save() throws IOException {

           Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
                    + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                    NotifyDescriptor.OK_CANCEL_OPTION,
                    NotifyDescriptor.QUESTION_MESSAGE);

            Object result = DialogDisplayer.getDefault().notify(message);
            //ユーザーが「Yes」をクリックした場合、保存の意思を示しているので、
              //保存アクションを無効にする必要があり、
              //JTextArea に次回変更が加えられるまでは
              //使用できないようにする
            if (NotifyDescriptor.YES_OPTION.equals(result)) {
                fire(false);
                //保存の機能をここに実装
            }
        }
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>アプリケーションを実行し、「Save」ボタンが有効か無効かを確認します。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-992.png" alt="crud 68dbmanager 992">
</div>
</div>
<div class="paragraph">
<p>ここで、上のダイアログの「OK」をクリックしても、何も行われません。次の手順で、変更を維持するための、いくつかの JPA コードを追加します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>次に、変更を維持するための JPA コードを追加します。これを行うには、「//保存の機能をここに実装」のコメントを置き換えます。このコメントを、次のコードで置き換えます。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
entityManager.getTransaction().begin();
Customer c = entityManager.find(Customer.class, customer.getCustomerId());
c.setName(jTextField1.getText());
c.setCity(jTextField2.getText());
entityManager.getTransaction().commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>「 <code>customer.getCustomerId()()</code> 」の「customer」は、現在定義されていません。次の  <code>resultChanged</code>  のボールドで表示された行を、クラスの最上位にある  <code>Customer customer;</code>  宣言のあとに追加すると、現在の  <code>Customer</code>  オブジェクトが  <code>customer</code>  を設定します。これは前出の持続性コード内で使用され、現在の  <code>Customer</code>  オブジェクトの ID を取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent lookupEvent) {
    Lookup.Result r = (Lookup.Result) lookupEvent.getSource();
    Collection&lt;Customer&gt; c = r.allInstances();
    if (!c.isEmpty()) {
        for (Customer customer : c) {
            *customer = cust;*
            jTextField1.setText(customer.getName());
            jTextField2.setText(customer.getCity());
        }
    } else {
        jTextField1.setText("[no name]");
        jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>アプリケーションを実行し、一部のデータを変更します。現時点では、まだ「更新」機能はありません。次回追加される予定です。そのため、変更されたデータを確認するには、アプリケーションを再起動してください。ここでは、たとえば、ツリー階層に「Toyota Motor Co」を示す永続化された顧客名が表示されています。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-993.png" alt="crud 68dbmanager 993">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>4 つ目に、Customer ビューアを更新する機能を追加する必要があります。ビューアを定期的に更新する  <code>Timer</code>  を追加することができます。しかし、この例では、ルートノードに「Refresh」メニュー項目を追加し、ユーザーがビューアを手動で更新できるようにします。</p>
<div class="ulist">
<ul>
<li>
<p><code>CustomerViewer</code>  モジュールのメインパッケージで、新しい  <code>Node</code>  を作成し、ビューアの子ルートとして現在使用している  <code>AbstractNode</code>  を置き換えます。さらに、「Refresh」アクションを、作成したルートノードにバインドします。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class CustomerRootNode extends AbstractNode {

    public CustomerRootNode(Children kids) {
        super(kids);
        setDisplayName("Root");
    }

    @Override
    public Action[] getActions(boolean context) {
        Action[] result = new Action[]{
            new RefreshAction()};
        return result;
    }

    private final class RefreshAction extends AbstractAction {

        public RefreshAction() {
            putValue(Action.NAME, "Refresh");
        }

        public void actionPerformed(ActionEvent e) {
            CustomerTopComponent.refreshNode();
        }
    }

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>ビューを更新するために、次のメソッドを  <code>CustomerTopComponent</code>  に追加します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public static void refreshNode() {
    EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    em.setRootContext(new *CustomerRootNode*(Children.create(new CustomerChildFactory(resultList), true)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、 <code>CustomerTopComponent</code>  のコンストラクタ内の前出のコードを、前出のコードへの呼び出しと置き換えます。前出の強調表示されている部分で確認できるように、現在  <code>AbstractNode</code>  の代わりに  <code>CustomerRootNode</code>  が使用されています。 <code>CustomerRootNode</code>  には「Refresh」アクションが含まれます。このアクションが、前出のコードを呼び出します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>保存機能に、前出のメソッドの呼び出しを追加して、データが保存されたときに自動で再表示が行われるようにします。別の方法で、この拡張を保存機能に実装することができます。たとえば、「Refresh」アクションを含む新しいモジュールを作成するとします。このモジュールはビューアモジュールとエディタモジュールとの間で共有され、両方に共通する機能を提供します。</p>
</li>
<li>
<p>アプリケーションを再度実行し、「Refresh」アクションを備えた新しいルートノードがあることを確認します。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/crud_68dbmanager-994.png" alt="crud 68dbmanager 994">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>一部のデータを変更して保存し、「Refresh」アクションを呼び出して、ビューアが更新されていることを確認します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ここでは、NetBeans プラットフォームが  <code>JTextFields</code>  に加えられた変更を処理する方法を学習しました。テキストが変更されるたびに、NetBeans プラットフォームの「Undo」ボタンと「Redo」ボタンが有効化または無効化されます。さらに、変更したデータをユーザーがデータベースに保存できるように、「Save」ボタンが適切に有効化または無効化されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_作成">作成</h3>
<div class="paragraph">
<p>この節では、データベース内にユーザーが新しいエントリを作成できるようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>CustomerEditor</code>  モジュールを右クリックし、「新規アクション」を選択します。「新規アクション」ウィザードを使用して、「常に有効」アクションを新しく作成します。新しいアクションは、ツールバーまたはメニューバーの任意の場所、あるいはその両方に表示されるはずです。ウィザードの次の手順で、 <code>NewAction</code>  アクションを呼び出します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>16x16 のアイコンを使用できることを確認します。このアイコンは、ツールバーから呼び出されるアクションを指定する場合に、ウィザードで選択する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>新規アクションで、 <code>TopComponent</code>  と空の  <code>JTextFields</code>  が開くようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public final class NewAction implements ActionListener {

    public void actionPerformed(ActionEvent e) {
        EditorTopComponent tc = EditorTopComponent.getDefault();
        tc.resetFields();
        tc.open();
        tc.requestActive();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このアクションは、 <code>ActionListener</code>  クラスを実装します。このクラスは、レイヤーファイル内のエントリを通じてアプリケーションにバインドされ、「新規アクション」ウィザードによってアプリケーションに挿入されます。既存の Swing アプリケーションを NetBeans プラットフォームに移植することがどれほど容易かを想像してみてください。移植では、元のアプリケーションで使用していたのと同じ  <code>Action</code>  クラスをそのまま使用できます。NetBeans プラットフォームによって提供される  <code>Action</code>  クラスに適合させるために書き直す必要はありません。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``EditorTopComponent``  で、 ``JTextFields``  をリセットし、新しい  ``Customer``  オブジェクトを作成する次のメソッドを追加します。</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void resetFields() {
    customer = new Customer();
    jTextField1.setText("");
    jTextField2.setText("");
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>SaveCookie</code>  で、 <code>null</code>  の戻り値が、既存のエントリの更新ではなく、新しいエントリが保存されたことを示すようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void save() throws IOException {

    Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
                    + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                    NotifyDescriptor.OK_CANCEL_OPTION,
                    NotifyDescriptor.QUESTION_MESSAGE);

    Object result = DialogDisplayer.getDefault().notify(msg);

    //ユーザーが「Yes」をクリックした場合、保存の意思を示しているので、
    //「Save」ボタンと「Save」メニュー項目を無効にして、
    //テキストフィールドに次回変更が加えられるまでは
    //使用できないようにする
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
        entityManager.getTransaction().begin();
        *if (customer.getCustomerId() != null)* {
            Customer c = entityManager.find(Customer.class, cude.getCustomerId());
            c.setName(jTextField1.getText());
            c.setCity(jTextField2.getText());
            entityManager.getTransaction().commit();
        } else {
            *Query query = entityManager.createQuery("SELECT c FROM Customer c");
            List&lt;Customer&gt; resultList = query.getResultList();
            customer.setCustomerId(resultList.size()+1);
            customer.setName(jTextField1.getText());
            customer.setCity(jTextField2.getText());
            //表のほかの列すべてを生成するフィールドを追加
            entityManager.persist(customer);
            entityManager.getTransaction().commit();*
        }
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>アプリケーションを再度実行し、データベースに新しい顧客を追加します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_削除">削除</h3>
<div class="paragraph">
<p>この節では、ユーザーがデータベースで選択したエントリを削除できるようにします。前述の概念とコードを使用して、削除アクションを自分で実装してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>新規アクションの  <code>DeleteAction</code>  を作成します。作成したアクションを Customer ノードにバインドするか、ツールバー、メニューバー、キーボードショートカット、またはそれらの組み合わせにバインドするかを決定します。バインドする場所によって、コード内で異なる方法を使用する必要があります。ヘルプについては、再度このチュートリアルを読んでください。特に「新規」アクションの作成方法を読んで、この方法とルートノードに「Refresh」アクションを作成する方法とを比較してください。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>現在の  <code>Customer</code>  オブジェクトを取得し、「Are you sure?」ダイアログを返して、エントリを削除します。このやり方に関するヘルプについては、「保存」機能が実装される部分を中心に、再度チュートリアルを読んでください。保存する代わりに、ここでは、データベースからエントリを削除します。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_関連項目">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これで、NetBeans プラットフォーム CRUD チュートリアルを終了します。このドキュメントは、指定されたデータベースに、CRUD 機能を備えた新しい NetBeans プラットフォームアプリケーションを作成する方法について説明しました。アプリケーションの作成と開発の詳細については、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform_ja.html">NetBeans プラットフォームの学習</a></p>
</li>
<li>
<p><a href="http://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-crud_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
