
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>使用 Maven 创建 NetBeans 平台 CRUD 应用程序</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="使用 Maven 创建 NetBeans 平台 CRUD 应用程序 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, 使用 Maven 创建 NetBeans 平台 CRUD 应用程序">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 17</h1>
            <p><a class="button success" href="/download/nb17/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">使用 Maven 创建 NetBeans 平台 CRUD 应用程序</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-maven-crud_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_配置_maven">配置 Maven</a>
<ul class="sectlevel2">
<li><a href="#_查看_maven_资源库">查看 Maven 资源库</a></li>
</ul>
</li>
<li><a href="#_创建_netbeans_平台应用程序项目">创建 NetBeans 平台应用程序项目</a>
<ul class="sectlevel2">
<li><a href="#_创建项目">创建项目</a></li>
<li><a href="#_创建模块">创建模块</a></li>
<li><a href="#_为模块建立依赖关系">为模块建立依赖关系</a></li>
<li><a href="#_标记应用程序">标记应用程序</a></li>
</ul>
</li>
<li><a href="#_创建实体类">创建实体类</a>
<ul class="sectlevel2">
<li><a href="#_将_derbyclient_添加为运行时依赖关系">将 DerbyClient 添加为运行时依赖关系</a></li>
<li><a href="#_通过数据库生成实体类">通过数据库生成实体类</a></li>
</ul>
</li>
<li><a href="#_读取读取并显示记录">读取：读取并显示记录</a>
<ul class="sectlevel2">
<li><a href="#_添加窗口组件">添加窗口组件</a></li>
<li><a href="#_添加树视图">添加树视图</a></li>
<li><a href="#_创建工厂类">创建工厂类</a></li>
<li><a href="#_运行应用程序">运行应用程序</a></li>
</ul>
</li>
<li><a href="#_更新编辑记录">更新：编辑记录</a>
<ul class="sectlevel2">
<li><a href="#_创建编辑器窗口">创建编辑器窗口</a></li>
<li><a href="#_使用_lookuplistener">使用 LookupListener</a></li>
<li><a href="#_添加撤消和恢复">添加“撤消”和“恢复”</a></li>
<li><a href="#_添加保存功能">添加“保存”功能</a></li>
<li><a href="#_保留更改">保留更改</a></li>
<li><a href="#_添加刷新功能">添加“刷新”功能</a></li>
</ul>
</li>
<li><a href="#_创建添加新记录">创建：添加新记录</a>
<ul class="sectlevel2">
<li><a href="#_添加创建操作">添加“创建”操作</a></li>
<li><a href="#_创建并保存新对象">创建并保存新对象</a></li>
</ul>
</li>
<li><a href="#_生成和运行应用程序">生成和运行应用程序</a></li>
<li><a href="#_另请参见">另请参见</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>欢迎使用  <a href="https://netbeans.apache.org/platform/"><strong>NetBeans 平台</strong></a>！</p>
</div>
<div class="paragraph">
<p>本文档演示了如何使用 Maven 生成框架创建能读写数据库的简单 NetBeans 平台应用程序。在本文档中，您将使用 Maven 原型创建 NetBeans 平台应用程序和模块，并使用 Swing UI 工具包和 "Matisse" GUI 生成器创建窗口组件。</p>
</div>
<div class="paragraph">
<p>本文档根据基于 Ant 的 <a href="nbm-crud_zh_CN.html">针对 NetBeans 平台的 NetBeans CRUD 应用程序教程</a>而编写，阐述了使用 Ant 和 Maven 开发 NetBeans 平台应用程序的一些不同之处。在了解 Maven 与 Ant 之间的不同之处后，您便可以轻松地继续学习  <a href="https://netbeans.apache.org/kb/docs/platform_zh_CN.html">NetBeans 平台学习资源</a>上的其他教程。</p>
</div>
<div class="paragraph">
<p>“CRUD 样例应用程序”是“新建项目”向导中提供的一个 Maven 样例。</p>
</div>
<div class="paragraph">
<p>如果您不熟悉 NetBeans 平台，则可能需要观看截屏视频系列 <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">最主要的 10 个 NetBeans API</a>。</p>
</div>
<div class="paragraph">
<p><strong>注意：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>捆绑的 GlassFish Server Open Source Edition 3.0.1 附带 JavaDB 数据库服务器和一个样例数据库。</p>
</li>
<li>
<p>为开发适用于 NetBeans 平台的应用程序，您无需下载该平台的独立版本。通常，您是在 NetBeans IDE 中开发应用程序和模块，并且只包含运行 NetBeans 平台和您的应用程序所需的模块。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在开始本教程之前，您可以先阅读下面这些文档。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/MavenBestPractices">Best Practices for Apache Maven in NetBeans 6.x</a>（NetBeans 6.x 中 Apache Maven 的最佳做法）</p>
</li>
<li>
<p><a href="http://www.sonatype.com/books/maven-book/reference/introduction.html">Chapter 1. Introducing Apache Maven</a>（第 1 章. Apache Maven 简介，来自  <a href="http://www.sonatype.com/books/maven-book/reference/public-book.html">Maven: The Definitive Guide</a>（Maven：权威指南））</p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/java/gui-functionality_zh_CN.html">生成 GUI 应用程序简介</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置_maven">配置 Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果这是您首次创建 Maven 项目，则需要在“选项”窗口中检查 Maven 配置设置。要学完本教程，您的本地系统中必须安装有 Maven。可以从  <a href="http://maven.apache.org/">Maven 站点</a>下载安装程序。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在“选项”窗口中选择“其他”类别，然后单击 "Maven" 标签。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>指定 Maven 在本地的安装位置（要求为 2.0.9 或更高版本）。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>检查本地 Maven 资源库的位置是否正确。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>单击“确定”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在大多数情况下，如果您执行了典型的 Maven 配置，则“选项”窗口中的信息应该已经是正确的。</p>
</div>
<div class="paragraph">
<p>IDE 使用 Maven SCM 签出 Maven 工件。您可能希望检查本地计算机上是否安装了签出源文件所需的任何客户端，并对它们进行了正确配置。</p>
</div>
<div class="paragraph">
<p>有关 Maven SCM 的详细信息，请参见  <a href="http://maven.apache.org/scm/index.html">Maven SCM 页</a>。</p>
</div>
<div class="sect2">
<h3 id="_查看_maven_资源库">查看 Maven 资源库</h3>
<div class="paragraph">
<p>Maven 用于生成所有项目的工件均存储在本地 Maven 资源库中。如果某一工件被声明为项目依赖关系，则会将其从已注册的某个远程资源库下载到您的本地资源库中。</p>
</div>
<div class="paragraph">
<p>缺省情况下，已注册 NetBeans 资源库和一些常见的索引 Maven 资源库，并将它们列在资源库浏览器窗口中。NetBeans 资源库包含生成项目所需的大多数公共工件。您可以使用“Maven 资源库”浏览器查看本地和远程资源库的内容。您可以展开“本地库”节点以查看本地存在的工件。NetBeans 资源库节点下列出的工件可以添加为项目依赖关系，但并非所有这些工件都在本地存在。仅当这些工件被声明为项目依赖关系时，才会将其添加到“本地库”。</p>
</div>
<div class="paragraph">
<p>打开“Maven 资源库”浏览器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从主菜单中选择“窗口”&gt;“其他”&gt;“Maven 资源库浏览器”。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-quickstart68_maven-nbm-netbeans-repo.png" alt="maven quickstart68 maven nbm netbeans repo">
</div>
<div class="title">Figure 1. “Maven 资源库”浏览器的屏幕快照</div>
</div>
<div class="paragraph">
<p>当将光标置于某个工件上时，IDE 将显示包含其坐标的工具提示。在浏览器中双击工件的 JAR 文件，可以查看有关该工件的其他详细信息。</p>
</div>
<div class="paragraph">
<p>单击“Maven 资源库”浏览器工具栏上的“查找”按钮，或使用主工具栏中的“快速搜索”文本字段，可以搜索工件。</p>
</div>
<div class="paragraph">
<p>有关管理 Maven 类路径依赖关系和在 IDE 中使用 Maven 资源库的详细信息，请参见  <a href="http://wiki.netbeans.org/MavenBestPractices">Best Practices for Apache Maven in NetBeans 6.x</a>（NetBeans 6.x 中 Apache Maven 的最佳做法）的 <a href="http://wiki.netbeans.org/MavenBestPractices#Dependency_management">Dependency Management</a>（依赖关系管理）部分。</p>
</div>
<div class="paragraph">
<p>要观看使用工件查看器的演示，请参见 <a href="https://netbeans.apache.org/kb/docs/java/maven-dependencies-screencast.html">处理 Maven 依赖关系</a>截屏视频。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建_netbeans_平台应用程序项目">创建 NetBeans 平台应用程序项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此部分，您将使用“新建项目”向导来通过 Maven 原型创建 NetBeans 平台应用程序。该向导会创建您开发 NetBeans 平台应用程序所需的 Maven 模块项目。您还将使用“新建项目”向导创建 NetBeans 模块。</p>
</div>
<div class="sect2">
<h3 id="_创建项目">创建项目</h3>
<div class="paragraph">
<p>请执行下列步骤，以使用“新建项目”向导创建 NetBeans 平台应用程序。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>选择“文件”&gt;“新建项目”(Ctrl-Shift-N) 以打开“新建项目”向导。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>从 "Maven" 类别中选择“Maven NetBeans 应用程序”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“项目名称”中键入 <strong>MavenPlatformCRUDApp</strong> 并设置“项目位置”。单击“完成”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>*注意：*当创建平台应用程序时，可以在向导中单击“下一步”并创建模块项目；但在本教程中，出于演示目的，您将分别创建应用程序和模块。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-new-project.png" alt="maven crud mavencrud new project">
</div>
<div class="title">Figure 2. “新建项目”向导的屏幕快照</div>
</div>
<div class="paragraph">
<p>单击“完成”后，缺省情况下 IDE 会创建以下 Maven 项目类型。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*NetBeans 平台应用程序。*此项目是平台应用程序的容器项目，它列出了要包含的模块和项目资源库的位置。此项目不包含任何源文件。IDE 在此项目的子目录中生成包含源文件和资源的模块。</p>
</li>
<li>
<p>*基于 NetBeans 平台的应用程序。*此项目指定编译应用程序所需的工件（源文件）。在此项目的  <code>pom.xml</code>  文件中，指定了必需的依赖关系（IDE 工件和模块工件）。</p>
</li>
<li>
<p>*平台应用程序标记资源。*此项目包含用于标记应用程序的资源。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-projects-window1.png" alt="maven crud mavencrud projects window1">
</div>
<div class="title">Figure 3. “项目”窗口中的项目结构</div>
</div>
<div class="paragraph">
<p><strong>注意：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果这是您第一次使用 Maven 创建 NetBeans 平台应用程序，则创建项目可能会耗费一些时间，因为 IDE 需要从 NetBeans 资源库中下载所有必需的工件。</p>
</li>
<li>
<p>在创建项目时，您会看到某些项目（例如，基于 NetBeans 平台的应用程序项目）带有标记，这是因为在  <code>pom.xml</code>  文件 (POM) 中声明的一些依赖关系不可用。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_创建模块">创建模块</h3>
<div class="paragraph">
<p>在本练习中，您将使用“新建项目”向导创建一个 NetBeans 模块。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>选择“文件”&gt;“新建项目”(Ctrl-Shift-N) 以打开“新建项目”向导。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>从 "Maven" 类别中选择“Maven NetBeans 模块”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“项目名称”中键入 <strong>MavenPlatformCRUDApp-dbaccess</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>指定“项目位置”，方法是单击“浏览”并找到 <strong>MavenPlatformCRUDApp</strong> 目录。单击“打开”。
image::images/maven-crud_mavencrud-select-location.png[title="显示项目目录的“选择项目位置”对话框"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>单击“完成”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>单击“完成”后，向导会创建名为 <strong>MavenPlatformCRUDApp-dbaccess</strong> 的 NetBeans 模块项目。当您将模块保存在某个子目录中时，该模块会自动配置为包含在应用程序中。如果打开该项目的 POM，则会看到 MavenPlatformCRUDApp 被声明为父项目。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;parent&gt;
    &lt;artifactId&gt;MavenPlatformCRUDApp&lt;/artifactId&gt;
    &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;
&lt;artifactId&gt;MavenPlatformCRUDApp-dbaccess&lt;/artifactId&gt;
&lt;packaging&gt;nbm&lt;/packaging&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;name&gt;MavenPlatformCRUDApp - dbaccess NetBeans Module&lt;/name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以更改模块的显示名称，方法是编辑 POM 中的  <code>&lt;name&gt;</code>  元素，或者在该项目的属性窗口中修改名称。缺省显示名称为项目的工件 Id  <code>MavenPlatformCRUDApp-dbaccess</code> 。</p>
</div>
<div class="paragraph">
<p>如果在“项目”窗口中的“项目文件”节点下查看 NetBeans 平台应用程序的 POM，则可以看到在应用程序的模块中列出了三个模块。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;modules&gt;
   &lt;module&gt;branding&lt;/module&gt;
   &lt;module&gt;application&lt;/module&gt;
   &lt;module&gt;MavenPlatformCRUDApp-dbaccess&lt;/module&gt;
&lt;/modules&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_为模块建立依赖关系">为模块建立依赖关系</h3>
<div class="paragraph">
<p>现在，您需要将该模块添加为基于 NetBeans 平台的应用程序的依赖关系。可以通过在编辑器中编辑  <code>pom.xml</code>  或使用“添加依赖关系”对话框来添加依赖关系。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在“项目”窗口中展开*基于 NetBeans 平台的应用程序*节点。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>右键单击“库”节点，然后选择“添加依赖关系”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>单击“打开的项目”标签，然后选择 "MavenPlatformCRUDApp - dbaccess"。单击“确定”。
image::images/maven-crud_mavencrud-add-dependency1.png[title="“添加依赖关系”对话框中的“打开的项目”标签"]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果在“项目”窗口中展开基于 NetBeans 平台的应用程序的“库”节点，则可以看到 MavenPlatformCRUDApp-dbaccess 此时已被列为依赖关系。</p>
</div>
<div class="paragraph">
<p>如果查看基于 NetBeans 平台的应用程序的 POM，则可以看到模块工件  <code>MavenPlatformCRUDApp-dbaccess</code>  已被列为编译应用程序所需的依赖关系。在生成模块项目并在本地资源库中安装了工件之后，便可使用该工件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
    &lt;artifactId&gt;*MavenPlatformCRUDApp-dbaccess*&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_标记应用程序">标记应用程序</h3>
<div class="paragraph">
<p>标记模块用于指定在生成平台应用程序时所使用的标记资源。您可以使用“标记”对话框轻松地指定应用程序名称、闪屏和应用程序图标，并修改文本元素的值。</p>
</div>
<div class="paragraph">
<p>在本练习中，您将替换缺省的闪屏图像。缺省情况下，IDE 生成的标记模块会包含一个当平台应用程序启动时所显示的图像。可以通过执行下列步骤，将此图像替换为其他图像。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击“项目”窗口中的*平台应用程序标记资源*模块，然后选择“标记”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在“闪屏”标签中，指定要用作闪屏的图像，方法是单击缺省闪屏图像旁边的“浏览”按钮，然后找到您希望使用的图像。单击“确定”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>例如，您可以将下面的图像复制到本地系统，然后在“标记”对话框中指定该图像。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_splash-crud.gif" alt="maven crud splash crud">
</div>
<div class="title">Figure 4. 缺省闪屏图像的示例</div>
</div>
<div class="paragraph">
<p>当启动应用程序时，便会在启动过程中显示新图像。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建实体类">创建实体类</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此部分，将通过 Java DB 数据库中的表来生成一些实体类。要在应用程序中创建实体类并使用 Java 持久性 API (Java Persistence API, JPA)，您需要具有数据库服务器和 JPA 持久性提供器库的访问权限。本教程使用 JavaDB 数据库服务器，但您也可以将应用程序配置为使用其他数据库服务器。</p>
</div>
<div class="paragraph">
<p>使资源可用的最简便方法是注册 IDE 捆绑的 GlassFish Server Open Source Edition 3.0.1 实例。该 GlassFish 服务器附带 Java DB 数据库服务器、一个样例数据库和 JPA 持久性提供器。在创建实体类之前，请通过执行下列步骤启动 Java DB。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在“服务”窗口中，展开“服务器”节点，然后检查是否已注册 GlassFish 实例。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>展开“数据库”节点，右键单击 Java DB 上 <strong>app</strong> 数据库的数据库连接节点 ( <code>jdbc:derby://localhost:1527/sample [app on APP]</code> )，然后选择“连接”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>当您选择“连接”时，如果尚未启动数据库，则 IDE 会启动它。</p>
</div>
<div class="sect2">
<h3 id="_将_derbyclient_添加为运行时依赖关系">将 DerbyClient 添加为运行时依赖关系</h3>
<div class="paragraph">
<p>在此部分，您会将 derbyclient-10.5.3.0_1 库添加为依赖关系。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 <strong>dbaccess</strong> 模块的“库”节点，然后选择“添加依赖关系”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>添加库，方法是在 "GroupId" 中键入 <strong>org.apache.derby</strong>，在 "ArtifactId" 中键入 <strong>derbyclient</strong>，在“版本”中键入 <strong>10.5.3.0_1</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>从“作用域”下拉列表中选择 "runtime"。单击“确定”。
image::images/maven-crud_mavencrud-add-dependency-derby.png[title="在“添加依赖关系”对话框中添加 derbyclient JAR"]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果在“项目”窗口中展开“运行时库”节点，则可以看到  <code>derbyclient</code>  库已被列为依赖关系。</p>
</div>
<div class="paragraph">
<p>您还可以在编辑器中修改 POM，以指定依赖关系的  <code>&lt;scope&gt;</code>  元素值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
            &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
            &lt;artifactId&gt;derbyclient&lt;/artifactId&gt;
            &lt;version&gt;10.5.3.0_1&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_通过数据库生成实体类">通过数据库生成实体类</h3>
<div class="paragraph">
<p>在此部分，您将使用向导在 <strong>dbaccess</strong> 模块中生成实体类。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 <strong>dbaccess</strong> 模块的“源包”，然后选择“新建”&gt;“其他”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在“持久性”类别中选择“通过数据库生成实体类”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>从“数据库连接”下拉列表中选择 Java DB 样例数据库。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>从“可用表”列表中选择 "CUSTOMER" 表，然后单击“添加”。单击“添加”后，相关表 DISCOUNT_CODE 也会被添加到“选定表”列表中。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>键入 <strong>com.mycompany.mavenplatformcrudapp.dbaccess</strong> 作为包名。确保“创建持久性单元”和“为持久性字段生成已命名的查询标注”处于选中状态。单击“完成”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>单击“完成”后，IDE 会生成 Customer 和 DiscountCode 实体类。IDE 还会在“其他源”节点下 "src/main/resources" 目录的 "META-INF" 包中生成  <code>persistence.xml</code>  文件。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_读取读取并显示记录">读取：读取并显示记录</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此部分，您将使用向导在 <strong>dbaccess</strong> 模块中添加窗口组件。您将在窗口组件中启用树视图来将对象显示为节点。您可以在节点的属性窗口中查看每条记录的数据。</p>
</div>
<div class="sect2">
<h3 id="_添加窗口组件">添加窗口组件</h3>
<div class="paragraph">
<p>在本练习中，您将创建窗口组件。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在“项目”窗口中右键单击项目节点，然后选择“新建”&gt;“窗口”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在“窗口位置”下拉列表中选择 "editor"，然后选择“在应用程序启动时打开”。单击“下一步”。
image::images/maven-crud_mavencrud-new-window-customer.png[title="“新建窗口”向导的“基本设置”页"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“类名前缀”中键入 <strong>Customer</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>在“包”中键入 <strong>com.mycompany.mavenplatformcrudapp.viewer</strong>。单击“完成”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>向导会显示将创建和修改的文件列表。</p>
</div>
<div class="paragraph">
<p>单击“完成”后，您可以在“项目”窗口中看到 IDE 在“源包”下的 "com.mycompany.mavenplatformcrudapp.viewer" 中生成了  <code>CustomerTopComponent.java</code>  类。可以在“文件”窗口中查看项目的结构。要编译 Maven 项目，“源包”（“文件”窗口中的  <code>src/main/java</code>  目录）下只能放置源文件。资源文件（例如，XML 文件）需要置于“其他源”（“文件”窗口中的  <code>src/main/resources</code>  目录）下面。</p>
</div>
</div>
<div class="sect2">
<h3 id="_添加树视图">添加树视图</h3>
<div class="paragraph">
<p>现在，您将修改窗口组件以在树视图中显示数据库记录。您将在构造函数中添加实体管理器，并启用 Bean 树视图。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>单击  <code>CustomerTopComponent.java</code>  的“源”标签以在编辑器中查看源代码。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>修改构造函数以添加下列内容。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public CustomerTopComponent() {
    initComponents();
    setName(NbBundle.getMessage(CustomerTopComponent.class, "CTL_CustomerTopComponent"));
    setToolTipText(NbBundle.getMessage(CustomerTopComponent.class, "HINT_CustomerTopComponent"));
//        setIcon(ImageUtilities.loadImage(ICON_PATH, true));

    *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>检查代码中持久性单元的名称是否正确，方法是将其与  <code>persistence.xml</code>  中指定的名称进行比较。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>修改类签名以实现  <code>ExplorerManager.Provider</code> 。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class CustomerTopComponent extends TopComponent *implements ExplorerManager.Provider*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>修复导入以导入  <code><strong>javax.persistence.Query</strong></code>  和  <code><strong>javax.util.List</strong></code> 。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>声明并初始化 ExplorerManager：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static ExplorerManager em = new ExplorerManager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>实现抽象方法，然后修改  <code>getExplorerManager</code>  方法以返回  <code>em</code> 。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public ExplorerManager getExplorerManager() {
    return em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以将插入光标置于类签名中，然后按 Alt+Enter 组合键来实现抽象方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>将以下内容添加到构造函数中以启用树视图。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">BeanTreeView beanTreeView = new BeanTreeView();
add(beanTreeView, BorderLayout.CENTER);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>在“设计”视图，右键单击组件，然后选择“设置布局”&gt;“边框式布局”。保存所做的更改。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_创建工厂类">创建工厂类</h3>
<div class="paragraph">
<p>现在，您将在  <code>com.mycompany.mavenplatformcrudapp.viewer</code>  包中创建一个新类 <strong>CustomerChildFactory</strong>，该类用于为数据库中的每位客户创建一个新 BeanNode。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 "com.mycompany.mavenplatformcrudapp.viewer" 包，然后选择“新建”&gt;“Java 类”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在“类名”中键入 <strong>CustomerChildFactory</strong>。单击“完成”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>修改签名以扩展  <code>ChildFactory&lt;Customer&gt;</code> 。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>为表格中的项目列表声明字段  <code>resultList</code> ，然后添加  <code>CustomerChildFactory</code>  方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private List&lt;Customer&gt; resultList;

public CustomerChildFactory(List&lt;Customer&gt; resultList) {
    this.resultList = resultList;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>实现后，修改  <code>createKeys</code>  抽象方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
      for (Customer customer : resultList) {
          list.add(customer);
      }
      return true;
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>添加一个方法以创建节点。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
    try {
        return new BeanNode(c);
    } catch (IntrospectionException ex) {
        Exceptions.printStackTrace(ex);
        return null;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>修复导入以导入  <code>org.openide.nodes.Node</code>  和  <code>java.beans.InstrospectionException</code> 。保存所做的更改。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>该类将如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.mycompany.mavenplatformcrudapp.viewer;

import com.mycompany.mavenplatformcrudapp.dbaccess.Customer;
import java.beans.IntrospectionException;
import java.util.List;
import org.openide.nodes.BeanNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;

public class CustomerChildFactory extends ChildFactory&lt;Customer&gt; {

    private List&lt;Customer&gt; resultList;

    public CustomerChildFactory(List&lt;Customer&gt; resultList) {
        this.resultList = resultList;
    }

    @Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer customer : resultList) {
            list.add(customer);
        }
        return true;
    }

    @Override
    protected Node createNodeForKey(Customer c) {
        try {
            return new BeanNode(c);
        } catch (IntrospectionException ex) {
            Exceptions.printStackTrace(ex);
            return null;
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您需要修改 <strong>CustomerTopComponent</strong> 以使用 ExplorerManager 来将 JPA 查询的结果列表传递到节点。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>将以下行添加到 CustomerTopComponent 构造函数中，以设置节点的根上下文，并将 TopComponent 的 ActionMap 和 ExplorerManager 添加到 TopComponent 的 Lookup 中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    EntityManager entityManager =  Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    *em.setRootContext(new AbstractNode(Children.create(new CustomerChildFactory(resultList), true)));
    associateLookup(ExplorerUtils.createLookup(em, getActionMap()));*</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会同步每个选定节点的属性窗口和工具提示文本。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>修复导入并保存更改。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_运行应用程序">运行应用程序</h3>
<div class="paragraph">
<p>在本练习中，您将测试应用程序以确认该应用程序可以正确访问和读取数据库表。在生成和运行应用程序之前，需要首先修改 POM，因为该应用程序需要对  <code>org-openide-nodes</code>  和  <code>org-openide-explorer</code>  JAR 的直接依赖关系。您可以在“项目”窗口中修改此依赖关系。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>展开 <strong>dbaccess</strong> 模块的“库”节点。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>右键单击  <code>org-openide-nodes</code>  JAR，然后选择“声明为直接依赖关系”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>右键单击  <code>org-openide-explorer</code>  JAR，然后选择“声明为直接依赖关系”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>右键单击 "MavenPlatformCRUDApp - NetBeans Platform based application"，然后选择“使用依赖关系生成”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>“输出”窗口会显示将要包含的模块。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-build-output1.png" alt="maven crud mavencrud build output1">
</div>
<div class="title">Figure 5. 显示生成顺序的“输出”窗口</div>
</div>
<div class="paragraph">
<p>“输出”窗口还会显示生成状态。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-build-output2.png" alt="maven crud mavencrud build output2">
</div>
<div class="title">Figure 6. 显示生成成功的“输出”窗口</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>右键单击该应用程序，然后选择“运行”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>应用程序启动后，将显示 Customer 窗口，数据库表中的每条记录在该窗口中都有一个对应的节点。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-customer-window1.png" alt="maven crud mavencrud customer window1">
</div>
<div class="title">Figure 7. 应用程序中的 Customer 窗口</div>
</div>
<div class="paragraph">
<p>可以右键单击 Customer 窗口树中的某个节点，然后选择“属性”以查看有关该项目的其他详细信息。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-read-properties.png" alt="maven crud mavencrud read properties">
</div>
<div class="title">Figure 8. 显示选定节点详细信息的“属性”窗口</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_更新编辑记录">更新：编辑记录</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此部分，您将添加一个用于编辑记录详细信息的窗口组件。</p>
</div>
<div class="sect2">
<h3 id="_创建编辑器窗口">创建编辑器窗口</h3>
<div class="paragraph">
<p>在本练习中，您将创建一个新窗口 MyEditor，该窗口包含两个文本字段，用于编辑选定节点的名称和城市字段。然后，您将修改  <code>layer.xml</code>  文件，以便 Customer 窗口以浏览器模式打开，而不是以编辑器模式打开。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 <strong>dbaccess</strong> 模块，然后选择“新建”&gt;“窗口”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在下拉列表中选择 "editor"，然后选择“在应用程序启动时打开”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“类名前缀”中键入 <strong>MyEditor</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>在“包”中键入 <strong>com.mycompany.mavenplatformcrudapp.editor</strong>。单击“完成”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>在  <code>MyEditorTopComponent</code>  的“设计”视图中添加两个 JLabel 和两个 JTextField。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>将标签的文本分别设置为 "Name" 和 "City"，并将两个 JTextField 的变量名称分别设置为  <code>jTextField1</code>  和  <code><strong>jTextField2</strong></code> 。保存所做的更改。
image::images/maven-crud_mavencrud-myeditor-window.png[title="“设计”视图中的窗口组件"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>在“项目”窗口中展开“重要文件”节点，然后双击“XML 层”以在编辑器中打开  <code>layer.xml</code>  文件。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>修改  <code>layer.xml</code>  以指定将以浏览器模式显示 CustomerTopComponent 窗口。保存所做的更改。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;folder name="Modes"&gt;
    &lt;folder name="editor"&gt;
        &lt;file name="MyEditorTopComponent.wstcref" url="MyEditorTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;
    *&lt;folder name="explorer"&gt;
        &lt;file name="CustomerTopComponent.wstcref" url="CustomerTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;*
&lt;/folder&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，可以测试应用程序以检查窗口是否可以打开并且其位置是否正确。</p>
</div>
<div class="paragraph">
<p>请务必在执行“使用依赖关系生成”操作之前清理应用程序。</p>
</div>
<div class="paragraph">
<p>现在，可以开始添加代码，以便在 Customer 窗口中选择某个节点时，该对象的名称和城市字段会显示在编辑器中。</p>
</div>
</div>
<div class="sect2">
<h3 id="_使用_lookuplistener">使用 LookupListener</h3>
<div class="paragraph">
<p>在本练习中，您将修改 Customer 窗口，以便在选定了某个节点时，新的  <code>Customer</code>  对象会被添加到节点的 Lookup 中。然后，您将修改 MyEditor，以便窗口实现  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-util-lookup/org/openide/util/LookupListener.html">LookupListener</a></code>  以侦听被添加到 Lookup 中的  <code>Customer</code>  对象。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>修改 <strong>CustomerChildFactory</strong> 中的  <code>createNodeForKey</code>  方法以创建  <code>AbstractNode</code>  而不是  <code>BeanNode</code> 。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
  *Node node = new AbstractNode(Children.LEAF, Lookups.singleton(c));
  node.setDisplayName(c.getName());
  node.setShortDescription(c.getCity());
  return node;*
//        try {
//            return new BeanNode(c);
//        } catch (IntrospectionException ex) {
//            Exceptions.printStackTrace(ex);
//            return null;
//        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当在 Customer 窗口中选择某个新节点时，所选的  <code>Customer</code>  对象会被添加到窗口的 Lookup 中。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>单击 <strong>MyEditorTopComponent</strong> 的“源”标签，然后修改类签名以实现  <code>LookupListener</code> 。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class MyEditorTopComponent extends TopComponent *implements LookupListener*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>添加用于存储结果的变量。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Lookup.Result result = null;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>实现所需的抽象方法以添加  <code>resultChanged</code>  方法。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>修改  <code>resultChanged</code>  方法，以便每次将新的  <code>Customer</code>  对象引入 Lookup 时都会更新 jTextField。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">      @Override
      public void resultChanged(LookupEvent le) {
          Lookup.Result r = (Lookup.Result) le.getSource();
          Collection&lt;Customer&gt; coll = r.allInstances();
          if (!coll.isEmpty()) {
              for (Customer cust : coll) {
                  jTextField1.setText(cust.getName());
                  jTextField2.setText(cust.getCity());
              }
          } else {
              jTextField1.setText("[no name]");
              jTextField2.setText("[no city]");
          }
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>在定义 LookupListener 之后，便可以将其添加到从全局上下文获得的  <code>Lookup.Result</code>  中。全局上下文将代理选定 Node 的上下文。例如，如果在树分层结构中选择 "Ford Motor Co"，则 "Ford Motor Co" 的  <code>Customer</code>  对象会被添加到节点的 Lookup 中。由于 "Ford Motor Co" 是当前选定的节点，因此其  <code>Customer</code>  对象此时在全局上下文中可用。随后即会将此对象传递到  <code>resultChanged</code> ，以填充该文本字段。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>修改  <code>componentOpened</code>  和  <code>componentClosed</code>  方法以便当编辑器窗口打开时激活 LookupListener。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">      @Override
      public void componentOpened() {
          result = WindowManager.getDefault().findTopComponent("CustomerTopComponent").getLookup().lookupResult(Customer.class);
          result.addLookupListener(this);
          resultChanged(new LookupEvent(result));
      }

      @Override
      public void componentClosed() {
          result.removeLookupListener(this);
          result = null;
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于编辑器窗口被设置为在应用程序启动时打开，因此当应用程序启动时，LookupListener 也将可用。</p>
</div>
<div class="paragraph">
<p>在此示例中，您将使用 Customer 窗口提供的本地 Lookup。在这种情况下，将通过字符串 " <code>CustomerTopComponent</code> " 明确标识该窗口。在  <code>CustomerTopComponent</code>  的源代码中，该字符串被指定为 CustomerTopComponent 的 ID。仅当 MyEditorTopComponent 可以找到 ID 为 "CustomerTopComponent" 的 TopComponent 时，此方法才有效。</p>
</div>
<div class="paragraph">
<p><a href="http://weblogs.java.net/blog/timboudreau/archive/2007/01/how_to_replace.html">Tim Boudreau 的博客文章</a>中描述了一种更加灵活的方法，该方法需要重写选择模型。</p>
</div>
<div class="paragraph">
<p>在执行“清理”和“使用依赖关系生成”之后，便可以重新运行此应用程序。现在，当您在 Customer 窗口中选择某个新节点时，编辑器窗口即会更新。由于您现在使用的是  <code>AbstractNode</code>  而不是  <code>BeanNode</code> ，因此节点的“属性”窗口中不显示任何属性。</p>
</div>
</div>
<div class="sect2">
<h3 id="_添加撤消和恢复">添加“撤消”和“恢复”</h3>
<div class="paragraph">
<p>在本练习中，将通过实现  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.html">UndoRedo</a></code>  管理器来启用“撤消”和“恢复”功能。当用户在编辑器窗口中更改了某个字段时，工具栏上的“撤消”和“恢复”按钮以及“撤消”和“恢复”菜单项便会启用。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在 MyEditorTopComponent 的顶部声明并实例化一个新的 UndoRedoManager。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private UndoRedo.Manager manager = new UndoRedo.Manager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在 MyEditorTopComponent 中创建  <code>getUndoRedo()</code>  方法：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public UndoRedo getUndoRedo() {
    return manager;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>将以下内容添加到构造函数中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">jTextField1.getDocument().addUndoableEditListener(manager);
jTextField2.getDocument().addUndoableEditListener(manager);</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以运行该应用程序以测试“撤消”和“恢复”功能的按钮和菜单项是否能够正常使用。</p>
</div>
</div>
<div class="sect2">
<h3 id="_添加保存功能">添加“保存”功能</h3>
<div class="paragraph">
<p>在本练习中，您将集成 NetBeans 平台的“保存”功能。您将修改  <code>layer.xml</code>  文件以隐藏工具栏中的“全部保存”按钮，并添加“保存”按钮。然后，将添加用于检测文本字段更改的侦听程序，以及在检测到更改时所触发的  <code>fire</code>  方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>打开并修改 <strong>dbaccess</strong> 模块的  <code>layer.xml</code>  文件以添加一个 Toolbar 元素。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">    *&lt;folder name="Toolbars"&gt;
      &lt;folder name="File"&gt;
          &lt;file name="org-openide-actions-SaveAction.shadow"&gt;
              &lt;attr name="originalFile" stringvalue="Actions/System/org-openide-actions-SaveAction.instance"/&gt;
              &lt;attr name="position" intvalue="444"/&gt;
          &lt;/file&gt;
          &lt;file name="org-openide-actions-SaveAllAction.shadow_hidden"/&gt;
      &lt;/folder&gt;
    &lt;/folder&gt;*
&lt;/filesystem&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在 <strong>MyEditorTopComponent</strong> 构造函数中添加以下调用，以便在检测到文本字段更改时触发某个方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public MyEditorTopComponent() {

          ...
    jTextField1.getDocument().addUndoableEditListener(manager);
    jTextField2.getDocument().addUndoableEditListener(manager);

    *jTextField1.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

    jTextField2.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

    //Create a new instance of our SaveCookie implementation:
    impl = new SaveCookieImpl();

    //Create a new instance of our dynamic object:
    content = new InstanceContent();

    //Add the dynamic object to the TopComponent Lookup:
    associateLookup(new AbstractLookup(content));*

    ...
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>添加  <code>fire</code>  方法，在检测到更改时，即会调用该方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void fire(boolean modified) {
  if (modified) {
      //If the text is modified,
      //we add SaveCookie impl to Lookup:
      content.add(impl);
  } else {
      //Otherwise, we remove the SaveCookie impl from the lookup:
      content.remove(impl);
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>添加  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-nodes/org/openide/cookies/SaveCookie.html">SaveCookie</a></code> （由  <code>fire</code>  方法添加到  <code>InstanceContent</code>  中）的以下实现。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private class SaveCookieImpl implements SaveCookie {

  @Override
  public void save() throws IOException {

     Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
              + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
              NotifyDescriptor.OK_CANCEL_OPTION,
              NotifyDescriptor.QUESTION_MESSAGE);

      Object result = DialogDisplayer.getDefault().notify(message);
      //When user clicks "Yes", indicating they really want to save,
      //we need to disable the Save action,
      //so that it will only be usable when the next change is made
      //to the JTextArea:
      if (NotifyDescriptor.YES_OPTION.equals(result)) {
          fire(false);
          //Implement your save functionality here.
      }
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>将以下字段添加到 MyEditorTopComponent 中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private final SaveCookieImpl impl;
private final InstanceContent content;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>修复导入并保存更改。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>右键单击“项目”窗口中“库”节点下的  <code>org-openide-dialogs</code>  JAR，然后选择“声明为直接依赖关系”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>现在，您可以对该应用程序执行“清理”、“使用依赖关系生成”和“运行”操作，以确认当您修改某个文本字段时，便会启用“保存”按钮。</p>
</div>
</div>
<div class="sect2">
<h3 id="_保留更改">保留更改</h3>
<div class="paragraph">
<p>在下一个练习中，您将添加用于保留更改的代码。此时，应用程序可正确识别某个字段何时发生了更改，并启用更改保存选项。当单击“保存”时，随即出现一个对话框，提示您确认是否希望保存更改。然而，当在对话框中单击“确定”时，这些更改并没有保留。要保留更改，您需要添加一些 JPA 代码以处理到数据库的持久性。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>将以下字段添加到 <strong>MyEditorTopComponent</strong> 中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Customer customer;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>添加用于保留更改的 JPA 代码，方法是修改  <code>save</code>  方法以将注释  <code>"//Implement your save functionality here." </code>  替换为以下代码。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void save() throws IOException {
...
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
        entityManager.getTransaction().begin();
        Customer c = entityManager.find(Customer.class, customer.getCustomerId());
        c.setName(jTextField1.getText());
        c.setCity(jTextField2.getText());
        entityManager.getTransaction().commit();*
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>检查持久性单元的名称是否正确。</p>
</div>
<div class="paragraph">
<p>当前未定义  <code>customer.getCustomerId()</code>  中的 "customer"。在下一步中，您会将  <code>customer</code>  设置为用于获取客户 ID 的当前  <code>Customer</code>  对象。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>将下面以粗体显示的代码行添加到  <code>resultChanged</code>  方法中。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent le) {
    Lookup.Result r = (Lookup.Result) le.getSource();
    Collection&lt;Customer&gt; coll = r.allInstances();
    if (!coll.isEmpty()) {
      for (Customer cust : coll) {
          *customer = cust;*
          jTextField1.setText(cust.getName());
          jTextField2.setText(cust.getCity());
      }
    } else {
      jTextField1.setText("[no name]");
      jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>修复导入并保存更改。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>您可以运行此应用程序并更改一些数据，以测试保存功能是否能够正常使用并可保留更改。此时，编辑器不会更新字段以反映更改后的数据。要检查是否保留了数据，需要重新启动应用程序。</p>
</div>
<div class="paragraph">
<p>在下一个练习中，您将添加“刷新”功能，该功能可以从数据库中重新装入数据，并使您能够在编辑器中查看更改。</p>
</div>
</div>
<div class="sect2">
<h3 id="_添加刷新功能">添加“刷新”功能</h3>
<div class="paragraph">
<p>在本练习中，通过将“刷新”菜单项添加到 Customer 窗口的根节点来添加用于更新客户查看器的功能。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击  <code><strong>com.mycompany.mavenplatformcrudapp.viewer</strong></code>  包，选择“新建”&gt;“Java 类”，然后创建一个名为 <strong>CustomerRootNode</strong> 的类。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>修改此类以扩展  <code>AbstractNode</code>  并添加以下方法。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class CustomerRootNode extends AbstractNode {

    *public CustomerRootNode(Children kids) {
      super(kids);
      setDisplayName("Root");
    }

    @Override
    public Action[] getActions(boolean context) {
      Action[] result = new Action[]{
          new RefreshAction()};
      return result;
    }

    private final class RefreshAction extends AbstractAction {

      public RefreshAction() {
          putValue(Action.NAME, "Refresh");
      }

      public void actionPerformed(ActionEvent e) {
          CustomerTopComponent.refreshNode();
      }
    }*

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，“刷新”操作绑定到新的根节点。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>修复导入以导入 * <code>javax.swing.Action</code> *。保存所做的更改。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>修改 <strong>CustomerTopComponent</strong> 以添加下面用于刷新视图的方法：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public static void refreshNode() {
    EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    em.setRootContext(new *CustomerRootNode*(Children.create(new CustomerChildFactory(resultList), true)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，该方法使用 <strong>CustomerRootNode</strong> 来设置根上下文。</p>
</div>
<div class="paragraph">
<p>如果希望 IDE 为您生成方法框架，则可以在  <code>CustomerRootNode</code>  类中包含  <code>refreshNode</code>  的代码行内按 Alt+Enter 组合键。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>修改 CustomerTopComponent 构造函数中的代码，将调用 <strong>AbstractNode</strong> 替换为调用 <strong>CustomerRootNode</strong>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>对  <code>CustomerRootNode</code>  的调用会自动调用  <code>refreshNode</code>  方法和“刷新”。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>修复导入并保存更改。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果运行此应用程序，您会看到有一个新的根节点，并且其弹出式菜单中提供了“刷新”操作。</p>
</div>
<div class="paragraph">
<p>通过从  <code>save</code>  方法中调用  <code>refreshNode</code>  方法，可以重用  <code>refreshNode</code>  方法并实现自动刷新。或者，也可以创建一个包含刷新操作的独立模块，并使该模块可以在各模块之间共享。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建添加新记录">创建：添加新记录</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此部分，将允许用户在数据库中创建一个新的条目。</p>
</div>
<div class="sect2">
<h3 id="_添加创建操作">添加“创建”操作</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 <strong>dbaccess</strong> 模块，然后选择“新建”&gt;“操作”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>选择“始终启用”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“类别”下拉列表中，选择“文件”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>选择“全局工具栏按钮”。单击“下一步”。
image::images/maven-crud_mavencrud-new-action.png[title="“新建操作”向导中的“GUI 注册”"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>在“类名”中键入 <strong>NewAction</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>在“显示名称”中键入 <strong>My New Action</strong>。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>单击“浏览”，然后选择一个将在工具栏中使用的图像。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>可以将以下图像  <code>abc16.png</code>  复制到您的桌面，然后在向导中指定该图像。( 
image::images/maven-crud_abc16.png[title="样例 16 x 16 图标"] )</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>选择 <strong>com.mycompany.mavenplatformcrudapp.editor</strong> 包。单击“完成”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>修改  <code>NewAction</code>  类以打开 MyEditorTopComponent 并清除字段。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public final class NewAction implements ActionListener {

    public void actionPerformed(ActionEvent e) {
        MyEditorTopComponent tc = MyEditorTopComponent.getDefault();
        tc.resetFields();
        tc.open();
        tc.requestActive();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此操作将实现 ActionListener 类，此类通过层文件中的条目绑定到应用程序，并由“新建操作”向导在此处生成。</p>
</div>
</div>
<div class="sect2">
<h3 id="_创建并保存新对象">创建并保存新对象</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>在 <strong>MyEditorTopComponent</strong> 中，添加以下方法以重置 JTextField 并创建新的  <code>Customer</code>  对象。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void resetFields() {
    customer = new Customer();
    jTextField1.setText("");
    jTextField2.setText("");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果希望 IDE 在 MyEditorTopComponent 中生成方法框架，则可以在  <code>NewAction</code>  类中的  <code>resetFields</code>  调用内按 Alt+Enter 组合键。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在 SaveCookie 中，确保返回的 null 表示已保存新条目，而非更新了现有条目：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void save() throws IOException {

    Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
                  + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                  NotifyDescriptor.OK_CANCEL_OPTION,
                  NotifyDescriptor.QUESTION_MESSAGE);

    Object result = DialogDisplayer.getDefault().notify(msg);

    //When user clicks "Yes", indicating they really want to save,
    //we need to disable the Save button and Save menu item,
    //so that it will only be usable when the next change is made
    //to the text field:
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
        entityManager.getTransaction().begin();
        *if (customer.getCustomerId() != null) {*
            Customer c = entityManager.find(Customer.class, cude.getCustomerId());
            c.setName(jTextField1.getText());
            c.setCity(jTextField2.getText());
            entityManager.getTransaction().commit();
        *} else {
            Query query = entityManager.createQuery("SELECT c FROM Customer c");
            List&lt;Customer&gt; resultList = query.getResultList();
            customer.setCustomerId(resultList.size()+1);
            customer.setName(jTextField1.getText());
            customer.setCity(jTextField2.getText());
            //adds more fields that will populate the zip and discountCode columns
            customer.setZip("12345");
            customer.setDiscountCode(entityManager.find(DiscountCode.class, 'H'));

            entityManager.persist(customer);
            entityManager.getTransaction().commit();
        }*
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码还会在 DiscountCode 中写入一些任意的数据，因为该字段不能为空。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>修复导入以导入  <code><strong>javax.persistence.Query</strong></code> 。保存所做的更改。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_生成和运行应用程序">生成和运行应用程序</h2>
<div class="sectionbody">
<div class="paragraph">
<p>现在，此应用程序执行三种 CRUD 功能：创建、读取和更新。您现在可以生成和运行此应用程序以检查所有功能是否都能够正常使用。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击 "MavenPlatformCRUDApp - NetBeans Platform based application" 项目节点，然后选择“清理”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>右键单击 "MavenPlatformCRUDApp - NetBeans Platform based application" 项目节点，然后选择“使用依赖关系生成”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>右键单击 "MavenPlatformCRUDApp - NetBeans Platform based application" 项目节点，然后选择“运行”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>单击“运行”后，IDE 会启动平台应用程序。该应用程序将使用数据库中的客户名称来填充 Customer 窗口中的树。当在 Customer 窗口中选择某个节点时，MyEditor 窗口便会显示所选客户的名称和城市。您可以修改 "Name" 和 "City" 字段中的数据并进行保存。要创建新客户，请单击工具栏上的 "My New Action" 按钮，在 MyEditor 窗口的空文本字段中输入名称和城市，然后单击“保存”。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-finished-app.png" alt="maven crud mavencrud finished app">
</div>
<div class="title">Figure 9. 显示 Customer 和 MyEditor 窗口的完成的应用程序</div>
</div>
<div class="paragraph">
<p>如果您没有实现保存时刷新操作，则在创建或修改客户后，需要在 Customer 窗口中刷新根节点。</p>
</div>
<div class="paragraph">
<p>本教程说明了使用 Maven 创建 NetBeans 平台应用程序与使用 Ant 创建应用程序并无太大差异。主要的不同之处在于 Maven POM 控制应用程序组装的方式。有关如何生成 NetBeans 平台应用程序和模块的更多示例，请参见  <a href="https://netbeans.apache.org/kb/docs/platform_zh_CN.html">NetBeans 平台学习资源</a>中所列的教程。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_另请参见">另请参见</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CRUD 教程到此结束。本文档描述了如何使用 Maven 生成框架创建具有 CRUD 功能的新 NetBeans 平台应用程序。有关创建和开发应用程序的更多信息，请参见以下资源。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform_zh_CN.html">NetBeans 平台学习资源</a></p>
</li>
<li>
<p><a href="http://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果您有任何有关 NetBeans 平台的问题，可随时写信至邮件列表 <a href="mailto:dev@platform.netbeans.org">dev@platform.netbeans.org</a>，或查看  <a href="https://mail-archives.apache.org/mod_mbox/netbeans-dev/">NetBeans 平台邮件列表归档</a>。</p>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/80/nbm-maven-crud_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2022 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
