
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans Java 语言基础结构教程</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans Java 语言基础结构教程 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, NetBeans Java 语言基础结构教程">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans Java 语言基础结构教程</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/69/nbm-copyfqn_zh_CN.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_java_语言基础结构简介">Java 语言基础结构简介</a></li>
<li><a href="#_设置模块">设置模块</a></li>
<li><a href="#_创建上下文相关的工具栏按钮">创建上下文相关的工具栏按钮</a></li>
<li><a href="#_识别_java_源文件">识别 Java 源文件</a></li>
<li><a href="#_确定打开状态">确定打开状态</a></li>
<li><a href="#_检测插入记号下的元素">检测插入记号下的元素</a></li>
<li><a href="#_执行一些有用的操作">执行一些有用的操作</a></li>
<li><a href="#_另请参见">另请参见</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本教程将向您介绍 "Retouche" API 的各个方面，通过此 API 可以访问 NetBeans Java 编辑器。</p>
</div>
<div class="paragraph">
<p>由  <a href="http://zh-cn.netbeans.org/community">NetBeans 中文社区</a>的  <a href="mailto:dev@netbeans.apache.org">日月雨林</a> 翻译（2009年 8 月）</p>
</div>
<div class="paragraph">
<p>参考 <a href="https://netbeans.apache.org/tutorials/60/nbm-copyfqn_zh_CN.html">NetBeans 6.0 版本的翻译</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这份文档介绍的是基于 NetBeans IDE 6.5 . 如果你使用的是更早的版本, 请看 <a href="60/nbm-copyfqn.html">Netbeans 6.0/6.1 版本的文档</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>（可选）要解决疑难问题，可以  <a href="http://plugins.netbeans.org/PluginPortal/faces/PluginDetailPage.jsp?pluginid=2753">下载完整的样例</a> 并查看源代码。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_语言基础结构简介">Java 语言基础结构简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 NetBeans IDE 6.0 之前，支持 Java 编辑器的 Java 语言基础结构（包括 Java 代码生成和 Java 重构）基于一种名为 "JMI for Java"（也称为 "MDR"）的技术。JMI for Java 存在几个体系结构问题，例如单读锁。也就是说，即使仅从其模型中读取信息也必须获取锁，而这通常只有在执行写操作时才是必需的。经过几年的时间，JMI 在性能方面经过了调试并获得了改进。但另一个问题是它使用自己的 Java 解析器内部副本，这意味着它通过自己的方法来解释 Java 源代码，此方法不同于 JDK 的 Java 编译器所使用的方法。随着 JDK 5 中泛型的引入（引入了许多更复杂、更微妙的 Java 结构），这种差异变得更难以管理。因此，由于 JMI 的性能问题，并且由于开发了正式的语言模型而使 JDK Java 编译器变成了一个可通过编程来访问的工具，JMI for Java 被一种基于 JDK Java 编译器的新方法所取代。</p>
</div>
<div class="paragraph">
<p>Retouche（法语中的一个词，表示“润色”）就是在这个时候诞生的。Retouche 是 NetBeans IDE 中新型快速的 Java 语言基础结构，能够支持已在 NetBeans 6.0 中实现的所有出色的 Java 编辑器功能。在其核心位置，Retouche 包装了 JDK Java 编译器的一个实例并使用它的工件，例如，抽象语法树（也称为 "AST"）以及在解析的各个阶段发布的符号分辨率。使用 Retouche 时，需要处理其中一些工件。例如， <a href="http://java.sun.com/javase/6/docs/jdk/api/javac/tree/index.html">Compiler Tree API</a>（编译器树 API）就是其中一个工件。编译器树 API 中类的包命名为  <code>com.sun.<strong></code> 。因此，从技术上讲，这是一个非 JDK API，但它确实来自 JDK Java 编译器。对于 JDK Java 编译器的工件，您可以处理的与 Retouche 有关的另一个示例是 JDK API 中的正式语言模型，它由  <code>javax.language.model.</strong></code>  包提供。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_设置模块">设置模块</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，我们使用向导来创建一个模块项目并设置与相关 NetBeans 模块的依赖关系。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>选择“文件”&gt;“新建项目”。在“新建项目”向导中的“类别”下选择“NetBeans 模块”，在“项目”下选择“模块项目”，然后单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>在“项目名称”中键入  <code>CopyFQN</code> ，将“项目位置”设置为硬盘上的相应文件夹。选择“独立模块”和“设置为主项目”（如果未选择这两个选项）。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“代码名称基”中键入  <code>org.netbeans.modules.copyfqn</code> ，在“模块显示名称”中键入  <code>CopyFQN</code> 。单击“完成”。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>右键单击项目，选择“属性”，单击“项目属性”对话框中的“库”，然后声明与以下 API 的依赖关系：</p>
<div class="ulist">
<ul>
<li>
<p>数据系统 API</p>
</li>
<li>
<p>编辑器库 2</p>
</li>
<li>
<p>文件系统 API</p>
</li>
<li>
<p>Javac API 包装器</p>
</li>
<li>
<p>Java 源代码</p>
</li>
<li>
<p>节点 API</p>
</li>
<li>
<p>文本 API</p>
</li>
<li>
<p>UI 实用工具 API</p>
</li>
<li>
<p>实用程序 API</p>
</li>
<li>
<p>窗口系统 API</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>现在应该看到下面的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_proj-props-copyfqn-60.png" alt="copyfqn proj props copyfqn 60">
</div>
</div>
<div class="paragraph">
<p>单击“确定”。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_创建上下文相关的工具栏按钮">创建上下文相关的工具栏按钮</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，我们在工具栏中创建一个上下文相关按钮。这与新的 Retouche API 没有任何关系，但为我们提供了一个用户界面元素，用于与本教程后面实现的 Retouche API 进行交互。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>右键单击模块项目，选择“新建”&gt;“其他”，并从“模块开发”类别中选择“操作”。单击“下一步”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>1.
选择“有条件地启用”并保留所有缺省设置（如下所示），以便此操作将与  <code>DataObject</code>  相关，并且仅在选定了一个  <code>DataObject</code>  时才启用。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_cookie-action-60.png" alt="copyfqn cookie action 60">
</div>
</div>
<div class="paragraph">
<p>单击“下一步”。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在“类别”中选择“编辑”，在“工具栏”中也选择“编辑”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>您现在应该看到下面的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_gui-registration-60.png" alt="copyfqn gui registration 60">
</div>
</div>
<div class="paragraph">
<p>单击“下一步”。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>在“类名”中键入  <code>CopyFQNAction</code> ，在“显示名称”中键入  <code>CopyFQN</code> 。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>浏览到将显示在此工具栏按钮中的图标。例如，使用将在本教程中使用的图标：</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_icon.png" alt="copyfqn icon">
</div>
</div>
<div class="paragraph">
<p>单击“完成”。</p>
</div>
<div class="paragraph">
<p>您现在应该在新的  <code>CopyFQNAction.java</code>  类中看到以下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class CopyFQNAction extends CookieAction {

    protected void performAction(Node[] activatedNodes) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        // TODO use dataObject
    }

    protected int mode() {
        return CookieAction.MODE_EXACTLY_ONE;
    }

    public String getName() {
        return NbBundle.getMessage(CopyFQNAction.class, "CTL_CopyFQNAction");
    }

    protected Class[] cookieClasses() {
        return new Class[] {
            DataObject.class
        };
    }

    protected String iconResource() {
        return "org/netbeans/modules/copyfqn/icon.png";
    }

    public HelpCtx getHelpCtx() {
        return HelpCtx.DEFAULT_HELP;
    }

    protected boolean asynchronous() {
        return false;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
们在本教程其余部分执行的所有工作将集中于上面的  <code>performAction()</code>  方法。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>现在您已创建一个与数据对象相关的操作。下面我们来看一看它的正确含义。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>右键单击模块并选择“安装”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>安装此模块后，您应该在工具栏中看到一个新按钮。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>在“项目”窗口中选择一个节点，然后在工具栏中查看此按钮。如果选择一个表示文件或文件夹（包括包）的节点，此按钮将启用，如下所示：</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-on.png" alt="copyfqn ctx sensitive on">
</div>
</div>
<div class="paragraph">
<p>但是，如果选择一个表示项目的节点，此按钮将被禁用，如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-off.png" alt="copyfqn ctx sensitive off">
</div>
</div>
<div class="paragraph">
<p>在下一节，我们不仅将区分项目节点和文件/文件夹节点，还将区分 Java 类的文件节点和其他所有类型的文件节点。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_识别_java_源文件">识别 Java 源文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，我们开始使用一个新的 "Retouche" API，此 API 称作 <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/overview-summary.html">Java Source</a>. 在此，我们使用 <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html">JavaSource</a> class, 类，它表示一个 Java 源文件。我们为与数据对象关联的文件对象返回此类的一个实例。如果返回 null，则说明此文件对象不是 Java 源文件。在选定某个文件的情况下单击此按钮时，将在状态栏中显示结果。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>通过添加下面高亮显示的行来填写  <code>performAction()</code>  方法：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // TODO use dataObject

    *FileObject fileObject = dataObject.getPrimaryFile();

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html[JavaSource] javaSource =  link:https://bits.netbeans.org/dev/javadocorg-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#forFileObject(org.openide.filesystems.FileObject)[JavaSource.forFileObject(fileObject)];
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
    } else {
        StatusDisplayer.getDefault().setStatusText("Hurray! A Java file: " + fileObject.getPath());
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>检查 import 语句是否如下所示：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import org.netbeans.api.java.source.JavaSource;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>再次安装此模块。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>1.
选择一个文件节点并按此按钮。</p>
</div>
<div class="paragraph">
<p>请注意，只有选择了 Java 文件时，才会显示 "Hurray!" 消息，如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-60.png" alt="copyfqn message java file 60">
</div>
</div>
<div class="paragraph">
<p>另一种方法是_仅当选定了 Java 文件时才启用此按钮_。要实现此功能，请重写  <code>CookieAction.enable()</code>  方法，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected boolean enable(Node[] activatedNodes) {
    if (super.enable(activatedNodes)) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        FileObject fileObject = dataObject.getPrimaryFile();
        JavaSource javaSource = JavaSource.forFileObject(fileObject);
        if (javaSource == null) {
            return false;
        }
        return true;
    }
    return false;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>T上面的方法过滤掉了_非_ Java 文件的所有文件。因此，只有在当前文件是 Java 文件时，此按钮才启用。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_确定打开状态">确定打开状态</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节中，我们将开始第一个显式调用的 "Retouche" 任务。此类任务是由 JavaSource 类的  <code>runUserActionTask</code>  方法提供的。使用此类任务可以控制解析过程的各个阶段，当您要立即响应用户的输入时，解析过程才适用。在此任务内执行的所有工作作为一个单元完成。在本例中，我们希望在调用自己的操作（由工具栏中的一个按钮表示）后，立即在状态栏中显示相应的文本。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>将  <code>performAction()</code>  方法中的 "Hurray!" 消息替换为下面的代码： <a href="http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#runUserActionTask(org.netbeans.api.java.source.Task,%20boolean)">javaSource.runUserActionTask</a></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">(new  link:http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/Task.html[Task]&lt; link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html[CompilationController]&gt;());</code></pre>
</div>
</div>
<div class="paragraph">
<p>您现在应该在编辑器的左边栏中看到一个灯泡，如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_runuserasactiontask-60.png" alt="copyfqn runuserasactiontask 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>单击此灯泡。或者，在该行中放入插入记号，再按 Alt-Enter 组合键。然后让 IDE 实现此方法。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>稍微调整一下此方法，方法是：在方法的末尾添加一个  <code>true</code>  布尔值，并让 IDE 将此代码片段包装在一个 try/catch 块中。最后，结果应如下所示：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // TODO use dataObject

    FileObject fileObject = dataObject.getPrimaryFile();

    JavaSource javaSource = JavaSource.forFileObject(fileObject);
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
     } else {

            *try {
                javaSource.runUserActionTask(new Task&lt;CompilationController&gt;() {

                    public void run(CompilationController arg0) throws Exception {
                        throw new UnsupportedOperationException("Not supported yet.");
                    }
                }, true);
            } catch (IOException ex) {
                Exceptions.printStackTrace(ex);
            }*

     }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>如下所示实现  <code>run()</code>  方法：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#toPhase(org.netbeans.api.java.source.JavaSource.Phase)[compilationController.toPhase(Phase.ELEMENTS_RESOLVED)];

link:https://docs.oracle.com/javase/1.5.0/docs/api/javax/swing/text/Document.html[Document] document =  link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#getDocument()[compilationController.getDocument()];
      if (document != null) {
         StatusDisplayer.getDefault().setStatusText("Hurray, the Java file is open!");
      } else {
         StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
      }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>确保 import 语句如下所示：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.swing.text.Document;
import org.netbeans.api.java.source.CompilationController;
import org.netbeans.api.java.source.JavaSource;
import org.netbeans.api.java.source.JavaSource.Phase;
import org.netbeans.api.java.source.Task;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>再次安装此模块。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>选择一个文件节点并按此按钮。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>请注意，只有选择了在 Java 编辑器中处于打开状态的 Java 文件时，才会显示 "Hurray!" 消息，如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-open-60.png" alt="copyfqn message java file open 60">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_检测插入记号下的元素">检测插入记号下的元素</h2>
<div class="sectionbody">
<div class="paragraph">
<p>至此我们已经了解到要处理 Java 文件并且文件处于打开状态，在本节中，可以随时开始检测插入记号下的元素的类型。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>首先声明与 I/O API 的依赖关系，这样就可以将结果显示在“输出”窗口中。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>将  <code>run()</code>  方法中的 "Hurray!" 消息替换为下面高亮显示的代码：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

    compilationController.toPhase(Phase.ELEMENTS_RESOLVED);
    Document document = compilationController.getDocument();

    if (document != null) {
        *new MemberVisitor(compilationController).scan(compilationController.getCompilationUnit(), null);*
    } else {
        StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>以下是  <code>MemberVisitor</code>  类，将其定义为  <code>CopyFQNAction</code>  类的内部类：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    @Override
    public Void visitClass(ClassTree t, Void v) {
        Element el = info.getTrees().getElement(getCurrentPath());
        if (el == null) {
            StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
        } else {
            TypeElement te = (TypeElement) el;
            List enclosedElements = te.getEnclosedElements();
            InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                        + info.getFileObject().getName(), true);
            for (int i = 0; i &lt; enclosedElements.size(); i++) {
            Element enclosedElement = (Element) enclosedElements.get(i);
                if (enclosedElement.getKind() == ElementKind.CONSTRUCTOR) {
                    io.getOut().println("Constructor: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.METHOD) {
                    io.getOut().println("Method: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.FIELD) {
                    io.getOut().println("Field: "
                        + enclosedElement.getSimpleName());
                } else {
                    io.getOut().println("Other: "
                        + enclosedElement.getSimpleName());
                }
            }
            io.getOut().close();
        }
        return null;
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>再次安装此模块，并打开一个 Java 类。然后单击此按钮，并注意构造函数、方法以及字段已写入“输出”窗口中，如下所示：</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_output-window-60.png" alt="copyfqn output window 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>接下来，不在“输出”窗口中显示所有元素，而仅显示插入记号下的元素。只需将  <code>visitClass</code>  方法替换为下面高亮显示的代码：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    *@Override
    public Void visitClass(ClassTree t, Void v) {
        try {
            JTextComponent editor = EditorRegistry.lastFocusedComponent();
            if (editor.getDocument() == info.getDocument()) {
                int dot = editor.getCaret().getDot();
                TreePath tp = info.getTreeUtilities().pathFor(dot);
                Element el = info.getTrees().getElement(tp);
                if (el == null) {
                    StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
                } else {
                    InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                            + info.getFileObject().getName(), true);
                    if (el.getKind() == ElementKind.CONSTRUCTOR) {
                        io.getOut().println("Hurray, this is a constructor: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.METHOD) {
                        io.getOut().println("Hurray, this is a method: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.FIELD) {
                        io.getOut().println("Hurray, this is a field: "
                            + el.getSimpleName());
                    } else {
                        io.getOut().println("Hurray, this is something else: "
                            + el.getSimpleName());
                    }
                    io.getOut().close();
                }
            }
        } catch (IOException ex) {
            Exceptions.printStackTrace(ex);
        }
        return null;
    }*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>安装此模块。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>将插入记号放在 Java 代码中的某处，然后按此按钮。“输出”窗口显示有关插入记号下的代码的信息（如果适用）。例如，如果将插入记号放入某个方法中后按此按钮，“输出”窗口将通知您插入记号位于方法中，如下所示：</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-constructor-60.png" alt="copyfqn message constructor 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>B但是，除了检测到插入记号下的元素的名称外，还可以检测到其他许多信息。在  <code>visitClass</code>  方法中，替换下面以粗体显示的代码行：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public Void visitClass(ClassTree t, Void v) {
    try {
        JTextComponent editor = EditorRegistry.lastFocusedComponent();
        if (editor.getDocument() == info.getDocument()) {
            int dot = editor.getCaret().getDot();
            TreePath tp = info.getTreeUtilities().pathFor(dot);
            Element el = info.getTrees().getElement(tp);
            if (el == null) {
                StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
            } else {
                InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                    + info.getFileObject().getName(), true);
                *String te = null;
                if (el.getKind() == ElementKind.CONSTRUCTOR) {
                    te = ((TypeElement) ((ExecutableElement) el).getEnclosingElement()).getQualifiedName().toString();
                    io.getOut().println("Hurray, this is a constructor's qualified name: " + te);
                } else if (el.getKind() == ElementKind.METHOD) {
                    te = ((ExecutableElement) el).getReturnType().toString();
                    io.getOut().println("Hurray, this is a method's return type: " + te);
                } else if (el.getKind() == ElementKind.FIELD) {
                    te = ((VariableElement) el).asType().toString();
                    io.getOut().println("Hurray, this is a field's type: " + te);
                }* else {
                    io.getOut().println("Hurray, this is something else: "
                        + el.getSimpleName());
                }
                io.getOut().close();
            }
        }
    } catch (IOException ex) {
        Exceptions.printStackTrace(ex);
    }
    return null;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>再次安装此模块。这一次，如果您在插入记号位于某个构造函数、方法或字段上时单击此按钮，将在“输出”窗口中显示有关此元素的更多详细信息。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在此阶段，我们能够检测到是否正在处理 Java 文件、文档是否已打开以及插入记号下的元素的类型。但是，我们可以根据这些信息执行什么操作？在下一节，将介绍一个简单的方案，在此方案中，可以证明我们新获得的知识是非常有用的。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_执行一些有用的操作">执行一些有用的操作</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本节，我们基于插入记号下的元素设置  <code>java.awt.datatransfer.Clipboard</code>  提供的剪贴板的内容。当您按此按钮时，插入记号下的元素将放入剪贴板中，这样您就可以将这些内容粘贴到代码中的其他位置。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>首先声明剪贴板并定义一个构造函数：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Clipboard clipboard;

public CopyFQNAction() {
    clipboard = Lookup.getDefault().lookup(ExClipboard.class);
    if (clipboard == null) {
        clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>接下来，将代码中的每个 "Hurray!" 行替换为这样一行代码，该代码行将此元素作为一个字符串发送到将在下一步定义的方法。我们将此方法称为  <code>setClipboardContents</code> 。因此，将第一个 "Hurray!" 行替换为下面的代码行：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">setClipboardContents(te);</code></pre>
</div>
</div>
<div class="paragraph">
<p>行执行同样的操作，并确保向此方法传递正确的字符串。</p>
</div>
<div class="paragraph">
<p>*提示：*因为您尚未定义  <code>setClipboardContents</code>  方法，所以在此步骤中添加的每一行都带有红色的下划线。在下一步中添加新方法。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>最后，将以下代码添加到类的末尾。此方法接收字符串并将它放入剪贴板中：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void setClipboardContents(String content) {
    if (clipboard != null) {
        if (content == null) {
            StatusDisplayer.getDefault().setStatusText("");
            clipboard.setContents(null, null);
        } else {
            StatusDisplayer.getDefault().setStatusText("Clipboard: " + content);
            clipboard.setContents(new StringSelection(content), null);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://netbeans.apache.org/community/mailing-lists.html">请将您的意见和建议发送给我们</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_另请参见">另请参见</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有关创建和开发 NetBeans 模块的详细信息，请参见以下资源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/Java_DevelopersGuide">Java Developer&#8217;s Guide</a></p>
</li>
<li>
<p><a href="http://wiki.netbeans.org/RetoucheDeveloperFAQ">Retouche Developer FAQ</a></p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform.html">Other Related Tutorials</a></p>
</li>
<li>
<p><a href="https://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/69/nbm-copyfqn_zh_CN.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
