
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Maven を使用した NetBeans プラットフォーム CRUD アプリケーションの作成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Maven を使用した NetBeans プラットフォーム CRUD アプリケーションの作成 - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, Maven を使用した NetBeans プラットフォーム CRUD アプリケーションの作成">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Maven を使用した NetBeans プラットフォーム CRUD アプリケーションの作成</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/74/nbm-maven-crud_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_maven_の構成">Maven の構成</a>
<ul class="sectlevel2">
<li><a href="#_maven_リポジトリの表示">Maven リポジトリの表示</a></li>
</ul>
</li>
<li><a href="#_netbeans_プラットフォームアプリケーションプロジェクトの作成">NetBeans プラットフォームアプリケーションプロジェクトの作成</a>
<ul class="sectlevel2">
<li><a href="#_プロジェクトの作成">プロジェクトの作成</a></li>
<li><a href="#_モジュールの作成">モジュールの作成</a></li>
<li><a href="#_モジュールの依存リソース設定">モジュールの依存リソース設定</a></li>
<li><a href="#_アプリケーションのブランド設定">アプリケーションのブランド設定</a></li>
</ul>
</li>
<li><a href="#_エンティティークラスの作成">エンティティークラスの作成</a>
<ul class="sectlevel2">
<li><a href="#_実行時依存リソースとしての_derbyclient_の追加">実行時依存リソースとしての DerbyClient の追加</a></li>
<li><a href="#_データベースからのエンティティークラスの生成">データベースからのエンティティークラスの生成</a></li>
</ul>
</li>
<li><a href="#_read_レコードの読み取りと表示">READ: レコードの読み取りと表示</a>
<ul class="sectlevel2">
<li><a href="#_ウィンドウコンポーネントの追加">ウィンドウコンポーネントの追加</a></li>
<li><a href="#_ツリー表示の追加">ツリー表示の追加</a></li>
<li><a href="#_ファクトリクラスの作成">ファクトリクラスの作成</a></li>
<li><a href="#_アプリケーションの実行">アプリケーションの実行</a></li>
</ul>
</li>
<li><a href="#_update_レコードの編集">UPDATE: レコードの編集</a>
<ul class="sectlevel2">
<li><a href="#_エディタウィンドウの作成">エディタウィンドウの作成</a></li>
<li><a href="#_lookuplistener_の使用">LookupListener の使用</a></li>
<li><a href="#_元に戻すおよび再実行の追加">元に戻すおよび再実行の追加</a></li>
<li><a href="#_保存機能の追加">保存機能の追加</a></li>
<li><a href="#_変更内容の持続">変更内容の持続</a></li>
<li><a href="#_更新機能の追加">更新機能の追加</a></li>
</ul>
</li>
<li><a href="#_create_新規レコードの作成">CREATE: 新規レコードの作成</a>
<ul class="sectlevel2">
<li><a href="#_作成アクションの追加">作成アクションの追加</a></li>
<li><a href="#_新規オブジェクトの作成および保存">新規オブジェクトの作成および保存</a></li>
</ul>
</li>
<li><a href="#_アプリケーションの構築と実行">アプリケーションの構築と実行</a></li>
<li><a href="#_関連項目">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://netbeans.apache.org/platform/"><strong>NetBeans プラットフォーム</strong></a>へようこそ!</p>
</div>
<div class="paragraph">
<p>このドキュメントでは、データベースに対して読み書きを行う簡単な NetBeans プラットフォームアプリケーションを、Maven 構築フレームワークを使用して作成する方法を示します。このドキュメントでは、Maven 原型を使用して、NetBeans プラットフォームのアプリケーションおよびモジュールを作成します。また、Swing UI ツールキットおよび「Matisse」GUI ビルダーを使用して、ウィンドウコンポーネントを作成します。</p>
</div>
<div class="paragraph">
<p>このドキュメントは、Ant ベースの「 <a href="nbm-crud_ja.html">NetBeans プラットフォーム: NetBeans CRUD アプリケーションのチュートリアル</a>」に基づいており、NetBeans プラットフォームのアプリケーション開発において、Ant を使用する場合と Maven を使用する場合の違いについていくつか説明します。Maven と Ant との相違点を理解すれば、「 <a href="https://netbeans.apache.org/kb/docs/platform_ja.html">NetBeans プラットフォームの学習</a>」のチュートリアルを容易に理解できるようになります。</p>
</div>
<div class="paragraph">
<p>CRUD サンプルアプリケーションは、「新規プロジェクト」ウィザードで利用できる Maven サンプルの 1 つです。</p>
</div>
<div class="paragraph">
<p>NetBeans プラットフォームをはじめて使用する場合は、スクリーンキャストシリーズの「 <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">NetBeans API のトップ 10</a>」を視聴いただくことをお勧めします。</p>
</div>
<div class="paragraph">
<p>NOTE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JavaDB データベースサーバーおよびサンプルデータベースは、バンドルされている GlassFish Server Open Source Edition 3.0.1 に含まれています。</p>
</li>
<li>
<p>NetBeans プラットフォーム用のアプリケーション開発のために、別々のバージョンの NetBeans プラットフォームをダウンロードする必要はありません。通常、NetBeans IDE でアプリケーションおよびモジュールを開発し、NetBeans プラットフォームおよびアプリケーションを実行するのに必要なモジュールのみを追加します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このチュートリアルを開始する前に、必要に応じて次のドキュメントをお読みください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/MavenBestPractices">NetBeans 6.x での Apache Maven のベストプラクティス</a></p>
</li>
<li>
<p><a href="http://www.sonatype.com/books/maven-book/reference/introduction.html">Chapter 1. Introducing Apache Maven</a> (『 <a href="http://www.sonatype.com/books/maven-book/reference/public-book.html">Maven: The Definitive Guide</a>』)</p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/java/gui-functionality_ja.html">GUI 構築入門</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_の構成">Maven の構成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これがはじめての Maven プロジェクトである場合は、「オプション」ウィンドウで Maven の構成設定を確認します。このチュートリアルを完了するには、ローカルシステムに Maven がインストールされている必要があります。インストーラは  <a href="http://maven.apache.org/">Maven のサイト</a>からダウンロードできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「オプション」ウィンドウの「その他」カテゴリを選択して、「Maven」タブをクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Maven をインストールするローカルの場所を指定します (2.0.9 以降が必要)。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Maven のローカルリポジトリの場所が正しいことを確認します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「了解」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ほとんどの場合、Maven の設定が標準的であれば、「オプション」ウィンドウの情報はすでに正しいものになっています。</p>
</div>
<div class="paragraph">
<p>IDE は、Maven SCM を使用して Maven アーティファクトのチェックアウトを行います。ソースのチェックアウトを行うために必要なすべてのクライアントが、ローカルマシンにインストールされていて正しく設定されているか確認することをお勧めします。</p>
</div>
<div class="paragraph">
<p>Maven SCM の詳細については、「 <a href="http://maven.apache.org/scm/index.html">Maven SCM のページ</a>」を参照してください。</p>
</div>
<div class="sect2">
<h3 id="_maven_リポジトリの表示">Maven リポジトリの表示</h3>
<div class="paragraph">
<p>Maven ですべてのプロジェクトを構築するために使用されるアーティファクトは、Maven のローカルリポジトリに格納されます。アーティファクトがプロジェクトの依存リソースとして宣言されると、そのアーティファクトは登録されたリモートリポジトリの 1 つからローカルリポジトリにダウンロードされます。</p>
</div>
<div class="paragraph">
<p>デフォルトで、NetBeans リポジトリおよびよく知られているインデックス付きの Maven リポジトリがいくつか登録され、リポジトリブラウザウィンドウに一覧表示されます。NetBeans リポジトリには、プロジェクトの構築に必要な、ほとんどの公開アーティファクトが含まれています。Maven リポジトリブラウザを使用すると、ローカルリポジトリとリモートリポジトリの内容を確認することができます。「ローカルリポジトリ」ノードを展開すると、ローカルにあるアーティファクトを表示できます。NetBeans リポジトリノードの下に一覧表示されているアーティファクトは、プロジェクトの依存リソースとして追加できますが、すべてのアーティファクトがローカルにあるわけではありません。これらはプロジェクトの依存リソースとして宣言されたときにだけ、ローカルリポジトリに追加されます。</p>
</div>
<div class="paragraph">
<p>Maven リポジトリブラウザを開くには、次の手順に従います。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メインメニューから「ウィンドウ」&gt;「その他」&gt;「Maven リポジトリブラウザ」を選択します。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-quickstart68_maven-nbm-netbeans-repo.png" alt="maven quickstart68 maven nbm netbeans repo">
</div>
<div class="title">Figure 1. Maven リポジトリブラウザのスクリーンショット</div>
</div>
<div class="paragraph">
<p>カーソルをアーティファクトの上に置くと、アーティファクトのコーディネートとともにツールチップが表示されます。ブラウザで、アーティファクトの JAR ファイルをダブルクリックすると、アーティファクトについての追加の詳細情報を確認できます。</p>
</div>
<div class="paragraph">
<p>Maven リポジトリブラウザのツールバーにある「検索」ボタンをクリックするか、メインツールバーにあるクイック検索のテキストフィールドを使用すると、アーティファクトを検索できます。</p>
</div>
<div class="paragraph">
<p>IDE での Maven のクラスパス依存リソースの管理と、Maven リポジトリの操作の詳細については、「 <a href="http://wiki.netbeans.org/MavenBestPractices">NetBeans 6.x での Apache Maven のベストプラクティス</a>」の「 <a href="http://wiki.netbeans.org/MavenBestPractices#Dependency_management">依存リソースの管理</a>」の節を参照してください。</p>
</div>
<div class="paragraph">
<p>Artifact Viewer の使用方法のデモンストレーションを確認するには、「 <a href="https://netbeans.apache.org/kb/docs/java/maven-dependencies-screencast.html">Maven 依存リソースの操作</a>」のスクリーンキャストを参照してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_netbeans_プラットフォームアプリケーションプロジェクトの作成">NetBeans プラットフォームアプリケーションプロジェクトの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、「新規プロジェクト」ウィザードを使用して、Maven 原型から NetBeans プラットフォームアプリケーションを作成します。このウィザードにより、NetBeans プラットフォームアプリケーションを開発するために必要な Maven モジュールプロジェクトが作成されます。また、「新規プロジェクト」ウィザードを使用して、NetBeans モジュールも作成します。</p>
</div>
<div class="sect2">
<h3 id="_プロジェクトの作成">プロジェクトの作成</h3>
<div class="paragraph">
<p>「新規プロジェクト」ウィザードを使用して NetBeans プラットフォームアプリケーションを作成するには、次の手順を実行します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「ファイル」&gt;「新規プロジェクト」(Ctrl-Shift-N) を選択し、「新規プロジェクト」ウィザードを開きます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「Maven」カテゴリから「Maven NetBeans アプリケーション」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「プロジェクト名」に「<strong>MavenPlatformCRUDApp</strong>」と入力し、「プロジェクトの場所」を設定します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このウィザードでは、プラットフォームアプリケーションを作成するときに「次へ」をクリックするとモジュールプロジェクトを作成できますが、このチュートリアルはデモンストレーションであるため、アプリケーションとモジュールを別々に作成します。
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-new-project.png" alt="maven crud mavencrud new project">
</div>
<div class="title">Figure 2. 「新規プロジェクト」ウィザードのスクリーンショット</div>
</div>
<div class="paragraph">
<p>「完了」をクリックすると、デフォルトで IDE が次のような Maven プロジェクトタイプを作成します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*NetBeans Platform Application。*このプロジェクトはプラットフォームアプリケーションのコンテナプロジェクトです。このプロジェクトに、包含する各モジュールおよびプロジェクトのリポジトリの場所が一覧表示されます。このプロジェクトにソースは含まれません。IDE は、このプロジェクトのサブディレクトリに、ソースおよびリソースを含むモジュールを生成します。</p>
</li>
<li>
<p>*NetBeans Platform based application。*このプロジェクトは、アプリケーションをコンパイルするために必要なアーティファクト (ソース) を指定します。必要な依存リソース (IDE アーティファクト、モジュールアーティファクト) は、このプロジェクトの  <code>pom.xml</code>  ファイルに指定されます。</p>
</li>
<li>
<p>*Platform application branding resources。*このプロジェクトには、アプリケーションのブランド設定に使用されるリソースが含まれています。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-projects-window1.png" alt="maven crud mavencrud projects window1">
</div>
<div class="title">Figure 3. 「プロジェクト」ウィンドウのプロジェクト構造</div>
</div>
<div class="paragraph">
<p>NOTE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>これが Maven を使用した最初の NetBeans プラットフォームアプリケーションである場合、IDE が必要なすべてのアーティファクトを NetBeans リポジトリからダウンロードする必要があるため、プロジェクト作成まで少し時間がかかることがあります。</p>
</li>
<li>
<p>プロジェクトを作成するとき、いくつかのプロジェクト (NetBeans Platform based application プロジェクトなど) にバッジが付いていますが、これは  <code>pom.xml</code>  ファイル (POM) で宣言されている依存リソースに使用できないものがあるためです。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_モジュールの作成">モジュールの作成</h3>
<div class="paragraph">
<p>この課題では、「新規プロジェクト」ウィザードを使用して、NetBeans モジュールを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「ファイル」&gt;「新規プロジェクト」(Ctrl-Shift-N) を選択し、「新規プロジェクト」ウィザードを開きます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「Maven」カテゴリから「Maven NetBeans モジュール」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「プロジェクト名」に「<strong>MavenPlatformCRUDApp-dbaccess</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「プロジェクトの場所」で「参照」をクリックして、<strong>MavenPlatformCRUDApp</strong> ディレクトリを指定します。「開く」をクリックします。
image::images/maven-crud_mavencrud-select-location.png[title="プロジェクトディレクトリを示す「プロジェクトの場所を選択」ダイアログ"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「完了」をクリックすると、ウィザードによって <strong>MavenPlatformCRUDApp-dbaccess</strong> という名前の NetBeans モジュールプロジェクトが作成されます。モジュールはサブディレクトリに保存されると、アプリケーションに含まれるように自動的に設定されます。このプロジェクトの POM を開くと、MavenPlatformCRUDApp が親プロジェクトとして宣言されているのが確認できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;parent&gt;
    &lt;artifactId&gt;MavenPlatformCRUDApp&lt;/artifactId&gt;
    &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;
&lt;artifactId&gt;MavenPlatformCRUDApp-dbaccess&lt;/artifactId&gt;
&lt;packaging&gt;nbm&lt;/packaging&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;name&gt;MavenPlatformCRUDApp - dbaccess NetBeans Module&lt;/name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>POM の  <code>&lt;name&gt;</code>  要素を編集するか、プロジェクトの「プロパティー」ウィンドウで名前を変更すれば、モジュールの表示名を変更できます。デフォルトの表示名は、プロジェクトのアーティファクト ID  <code>MavenPlatformCRUDApp-dbaccess</code>  です。</p>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「プロジェクトファイル」ノードの下にある NetBeans プラットフォームアプリケーションの POM を見ると、3 つのモジュールがアプリケーションのモジュールとして一覧表示されているのが確認できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;modules&gt;
   &lt;module&gt;branding&lt;/module&gt;
   &lt;module&gt;application&lt;/module&gt;
   &lt;module&gt;MavenPlatformCRUDApp-dbaccess&lt;/module&gt;
&lt;/modules&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_モジュールの依存リソース設定">モジュールの依存リソース設定</h3>
<div class="paragraph">
<p>ここで、モジュールを「NetBeans Platform based application」の依存リソースとして追加する必要があります。依存リソースの追加は、エディタで  <code>pom.xml</code>  を編集するか、「依存リソースを追加」ダイアログボックスを使用して行います。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「プロジェクト」ウィンドウで「<strong>NetBeans Platform based application</strong>」ノードを展開します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「ライブラリ」ノードを右クリックし、「依存リソースを追加」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「開いているプロジェクト」タブをクリックして、「<strong>MavenPlatformCRUDApp - dbaccess</strong>」を選択します。「了解」をクリックします。
image::images/maven-crud_mavencrud-add-dependency1.png[title="「依存リソースを追加」ダイアログの「開いているプロジェクト」タブ"]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「NetBeans Platform based application」の「ライブラリ」ノードを展開すると、MavenPlatformCRUDApp-dbaccess が依存リソースとして表示されるようになっているのが確認できます。</p>
</div>
<div class="paragraph">
<p>「NetBeans Platform based application」の POM を見ると、モジュールのアーティファクト  <code>MavenPlatformCRUDApp-dbaccess</code>  が、アプリケーションのコンパイルのための必須依存リソースとして表示されているのが確認できます。このアーティファクトは、モジュールプロジェクトを構築して、アーティファクトをローカルリポジトリにインストールしたあとで使用できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
    &lt;artifactId&gt;*MavenPlatformCRUDApp-dbaccess*&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_アプリケーションのブランド設定">アプリケーションのブランド設定</h3>
<div class="paragraph">
<p>ブランド設定モジュールは、プラットフォームアプリケーションの構築時に使用されるブランド設定リソースを指定します。ブランド設定ダイアログでは、アプリケーション名、スプラッシュ画面、およびアプリケーションアイコンの指定や、テキスト要素の値の変更が簡単に行えます。</p>
</div>
<div class="paragraph">
<p>この課題では、デフォルトのスプラッシュ画像を置き換えます。デフォルトでは、IDE によって生成されるブランド設定モジュールには、プラットフォームアプリケーションの起動時に表示される画像が含まれています。次の手順を実行して、この画像を別の画像に置き換えられます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「プロジェクト」ウィンドウで「<strong>Platform application branding resources</strong>」モジュールを右クリックして、「ブランド設定」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「スプラッシュ画面」タブで、デフォルトのスプラッシュ画面の画像の隣にある「参照」ボタンをクリックして、使用する画像の場所に移動し、スプラッシュ画面として使用する画像を指定します。「了解」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>たとえば、次の画像をローカルシステムにコピーして、ブランド設定ダイアログでこの画像を指定することもできます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_splash-crud.gif" alt="maven crud splash crud">
</div>
<div class="title">Figure 4. デフォルトのスプラッシュ画像の例</div>
</div>
<div class="paragraph">
<p>アプリケーションを起動すると、起動中に新しい画像が表示されます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_エンティティークラスの作成">エンティティークラスの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、Java DB データベースの表からエンティティークラスをいくつか生成します。アプリケーションにエンティティークラスを作成して JPA (Java Persistence API) を使用するには、データベースサーバーおよび JPA 持続性プロバイダライブラリにアクセスできる必要があります。このチュートリアルでは JavaDB データベースサーバーを使用しますが、アプリケーションがほかのデータベースサーバーを使用するように設定することもできます。</p>
</div>
<div class="paragraph">
<p>リソースを使用できるようにするもっとも簡単な方法は、IDE にバンドルされている GlassFish Server Open Source Edition 3.0.1 のインスタンスを登録することです。Java DB データベースサーバー、サンプルデータベース、および JPA 持続性プロバイダは、GlassFish サーバーに含まれています。エンティティークラスを作成する前に、次の手順を実行して Java DB を起動してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「サービス」ウィンドウで「サーバー」ノードを展開して、GlassFish インスタンスが登録されていることを確認してください。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「データベース」ノードを展開して、Java DB の <strong>app</strong> データベースのデータベース接続ノード ( <code>jdbc:derby://localhost:1527/sample [APP の app]</code> ) を右クリックし、「接続」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「接続」を選択すると、データベースが起動していない場合は IDE によって起動されます。</p>
</div>
<div class="sect2">
<h3 id="_実行時依存リソースとしての_derbyclient_の追加">実行時依存リソースとしての DerbyClient の追加</h3>
<div class="paragraph">
<p>この課題では、依存リソースとして derbyclient-10.5.3.0_1 ライブラリを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>dbaccess</strong> モジュールの「ライブラリ」ノードを右クリックし、「依存リソースを追加」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「グループ ID」に「<strong>org.apache.derby</strong>」、「アーティファクト ID」に「<strong>derbyclient</strong>」、そして「バージョン」に「<strong>10.5.3.0_1</strong>」と入力してライブラリを追加します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「スコープ」ドロップダウンリストから「<strong>runtime</strong>」を選択します。「了解」をクリックします。
image::images/maven-crud_mavencrud-add-dependency-derby.png[title="「依存リソースを追加」ダイアログで derbyclient JAR を追加する"]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「プロジェクト」ウィンドウで「実行時ライブラリ」ノードを展開すると、 <code>derbyclient</code>  ライブラリが依存リソースとして表示されているのが確認できます。</p>
</div>
<div class="paragraph">
<p>エディタで POM を変更して、依存リソースの  <code>&lt;scope&gt;</code>  要素の値を指定することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
            &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
            &lt;artifactId&gt;derbyclient&lt;/artifactId&gt;
            &lt;version&gt;10.5.3.0_1&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_データベースからのエンティティークラスの生成">データベースからのエンティティークラスの生成</h3>
<div class="paragraph">
<p>この節では、ウィザードを使用して <strong>dbaccess</strong> モジュールにエンティティークラスを生成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>dbaccess</strong> モジュールの「ソースパッケージ」を右クリックして、「新規」&gt;「その他」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「持続性」カテゴリから「データベースからのエンティティークラス」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「データベース接続」ドロップダウンリストから Java DB サンプルデータベースを選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「使用可能な表」から「CUSTOMER」表を選択し、「追加」をクリックします。「追加」をクリックすると、関連する表である「DISCOUNT_CODE」も「選択した表」の一覧に追加されます。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>「パッケージ」の名前に「<strong>com.mycompany.mavenplatformcrudapp.dbaccess</strong>」と入力します。「持続フィールド用の NamedQuery 注釈を生成」および「持続性ユニットを作成」が選択されていることを確認してください。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「完了」をクリックすると、IDE によって Customer および DiscountCode エンティティークラスが生成されます。また、IDE によって、 <code>src/main/resources</code>  ディレクトリの「その他のソース」ノードの下にある  <code>META-INF</code>  パッケージに  <code>persistence.xml</code>  ファイルも生成されます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_read_レコードの読み取りと表示">READ: レコードの読み取りと表示</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、ウィザードを使用して、<strong>dbaccess</strong> モジュールにウィンドウコンポーネントを追加します。ウィンドウコンポーネントでツリー表示を可能にして、オブジェクトをノードとして表示できるようにします。ノードのプロパティーウィンドウで、各レコードのデータを確認できます。</p>
</div>
<div class="sect2">
<h3 id="_ウィンドウコンポーネントの追加">ウィンドウコンポーネントの追加</h3>
<div class="paragraph">
<p>この課題では、ウィンドウコンポーネントを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「プロジェクト」ウィンドウでプロジェクトノードを右クリックし、「新規」&gt;「ウィンドウ」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「ウィンドウの位置」ドロップダウンリストから「<strong>editor</strong>」を選択し、「<strong>アプリケーションの起動時に開く</strong>」を選択します。「次へ」をクリックします。
image::images/maven-crud_mavencrud-new-window-customer.png[title="「新規ウィンドウ」ウィザードの「基本設定」ページ"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「クラス名の接頭辞」に「<strong>Customer</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「パッケージ」に「<strong>com.mycompany.mavenplatformcrudapp.viewer</strong>」と入力します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ウィザードにより、作成されるファイルと変更されるファイルの一覧が表示されます。</p>
</div>
<div class="paragraph">
<p>「完了」をクリックすると、IDE によって「ソースパッケージ」の下の「 <code>com.mycompany.mavenplatformcrudapp.viewer</code> 」に  <code>CustomerTopComponent.java</code>  クラスが生成されているのが「プロジェクト」ウィンドウで確認できます。プロジェクトの構造は、「ファイル」ウィンドウで確認できます。Maven プロジェクトをコンパイルするには、「ソースパッケージ」(「ファイル」ウィンドウの  <code>src/main/java</code>  ディレクトリ) の下にソースファイルだけを配置する必要があります。リソースファイル (XML ファイルなど) は、「その他のソース」(「ファイル」ウィンドウの  <code>src/main/resources</code>  ディレクトリ) の下に配置しなければいけません。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ツリー表示の追加">ツリー表示の追加</h3>
<div class="paragraph">
<p>ここで、ウィンドウコンポーネントを変更して、データベースレコードをツリー表示できるようにします。コンストラクタにエンティティーマネージャーを追加して、Bean のツリー表示を可能にします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>CustomerTopComponent.java</code>  の「ソース」タブをクリックして、エディタでソースコードを表示します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>コンストラクタに次のコードを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public CustomerTopComponent() {
    initComponents();
    setName(NbBundle.getMessage(CustomerTopComponent.class, "CTL_CustomerTopComponent"));
    setToolTipText(NbBundle.getMessage(CustomerTopComponent.class, "HINT_CustomerTopComponent"));
//        setIcon(ImageUtilities.loadImage(ICON_PATH, true));

    *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>コードの持続性ユニットの名前を  <code>persistence.xml</code>  で指定されている名前と比較して、正しい名前になっているか確認してください。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code>ExplorerManager.Provider</code>  を実装するように、クラスの署名を次のように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class CustomerTopComponent extends TopComponent *implements ExplorerManager.Provider*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p><code><strong>javax.persistence.Query</strong></code>  および  <code><strong>javax.util.List</strong></code>  をインポートするために、インポートを修正します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>次のようにして、ExplorerManager の宣言と初期化を行います。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static ExplorerManager em = new ExplorerManager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>abstract メソッドを実装し、 <code>getExplorerManager</code>  メソッドを変更して、 <code>em</code>  を返すようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public ExplorerManager getExplorerManager() {
    return em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスの署名に挿入カーソルを置いて Alt+Enter を押すと、abstract メソッドを実装できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>コンストラクタに次のコードを追加して、ツリー表示を有効にします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">BeanTreeView beanTreeView = new BeanTreeView();
add(beanTreeView, BorderLayout.CENTER);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>「デザイン」ビューでコンポーネントを右クリックして、「レイアウトを設定」&gt;「ボーダーレイアウト」を選択します。変更を保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_ファクトリクラスの作成">ファクトリクラスの作成</h3>
<div class="paragraph">
<p>ここで、 <code>com.mycompany.mavenplatformcrudapp.viewer</code>  パッケージに、データベース内の各顧客に新しい BeanNode を作成する新しいクラス <strong>CustomerChildFactory</strong> を作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「 <code><strong>com.mycompany.mavenplatformcrudapp.viewer</strong></code> 」パッケージを右クリックし、「新規」&gt;「Java クラス」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「クラス名」に「<strong>CustomerChildFactory</strong>」と入力します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>署名を変更して、 <code>ChildFactory&lt;Customer&gt;</code>  を拡張します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>表の項目一覧のためのフィールド  <code>resultList</code>  を宣言して、 <code>CustomerChildFactory</code>  メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private List&lt;Customer&gt; resultList;

public CustomerChildFactory(List&lt;Customer&gt; resultList) {
    this.resultList = resultList;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p><code>createKeys</code>  abstract メソッドを実装してから変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
      for (Customer customer : resultList) {
          list.add(customer);
      }
      return true;
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>ノードを作成するメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
    try {
        return new BeanNode(c);
    } catch (IntrospectionException ex) {
        Exceptions.printStackTrace(ex);
        return null;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p><code>org.openide.nodes.Node</code>  および  <code>java.beans.InstrospectionException</code>  をインポートするために、インポートを修正します。変更を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>クラスは次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.mycompany.mavenplatformcrudapp.viewer;

import com.mycompany.mavenplatformcrudapp.dbaccess.Customer;
import java.beans.IntrospectionException;
import java.util.List;
import org.openide.nodes.BeanNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;

public class CustomerChildFactory extends ChildFactory&lt;Customer&gt; {

    private List&lt;Customer&gt; resultList;

    public CustomerChildFactory(List&lt;Customer&gt; resultList) {
        this.resultList = resultList;
    }

    @Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer customer : resultList) {
            list.add(customer);
        }
        return true;
    }

    @Override
    protected Node createNodeForKey(Customer c) {
        try {
            return new BeanNode(c);
        } catch (IntrospectionException ex) {
            Exceptions.printStackTrace(ex);
            return null;
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、<strong>CustomerTopComponent</strong> を変更して、ExplorerManager を使用して JPA クエリーの結果リストを Node に渡すようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>CustomerTopComponent コンストラクタに次の行を追加して、ノードのルートコンテキストを設定し、TopComponent の Lookup に TopComponent の ActionMap および ExplorerManager を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">    EntityManager entityManager =  Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    *em.setRootContext(new AbstractNode(Children.create(new CustomerChildFactory(resultList), true)));
    associateLookup(ExplorerUtils.createLookup(em, getActionMap()));*</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、選択した各ノードのプロパティーウィンドウおよびツールチップのテキストが同期します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>インポートを修正して変更内容を保存します。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_アプリケーションの実行">アプリケーションの実行</h3>
<div class="paragraph">
<p>この課題では、アプリケーションが正常にデータベースの表にアクセスして、読み取りを行えるかどうかを確認するためのテストを行います。アプリケーションは、 <code>org-openide-nodes</code>  および  <code>org-openide-explorer</code>  JAR に直接依存リソースを必要とするため、アプリケーションを構築および実行できるようにするには、POM を修正する必要があります。「プロジェクト」ウィンドウで依存リソースを変更できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「<strong>dbaccess</strong>」モジュールの「ライブラリ」ノードを展開します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「 <code>org-openide-nodes</code> 」JAR を右クリックし、「直接依存リソースとして宣言」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「 <code>org-openide-explorer</code> 」JAR を右クリックし、「直接依存リソースとして宣言」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「<strong>MavenPlatformCRUDApp NetBeans Platform based application</strong>」を右クリックして、「依存関係で構築」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「出力」ウィンドウに、含まれるモジュールが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-build-output1.png" alt="maven crud mavencrud build output1">
</div>
<div class="title">Figure 5. 構築順序を示す「出力」ウィンドウ</div>
</div>
<div class="paragraph">
<p>「出力」ウィンドウには、構築状態も表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-build-output2.png" alt="maven crud mavencrud build output2">
</div>
<div class="title">Figure 6. 構築の成功を示す「出力」ウィンドウ</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>アプリケーションを右クリックし、「実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>アプリケーションが起動すると、データベースの表の各レコードのノードと一緒に「Customer」ウィンドウが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-customer-window1.png" alt="maven crud mavencrud customer window1">
</div>
<div class="title">Figure 7. アプリケーションの「Customer」ウィンドウ</div>
</div>
<div class="paragraph">
<p>「Customer」ウィンドウツリーでノードを右クリックして「プロパティー」を選択すると、その項目に関する追加情報が表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-read-properties.png" alt="maven crud mavencrud read properties">
</div>
<div class="title">Figure 8. 選択したノードの詳細を示す「プロパティー」ウィンドウ</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_レコードの編集">UPDATE: レコードの編集</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、レコードの詳細を編集するためのウィンドウコンポーネントを追加します。</p>
</div>
<div class="sect2">
<h3 id="_エディタウィンドウの作成">エディタウィンドウの作成</h3>
<div class="paragraph">
<p>この課題では、選択したノードの name および city フィールドを編集するための 2 つのテキストフィールドを含む、新しいウィンドウ「MyEditor」を作成します。そのあと、 <code>layer.xml</code>  ファイルを変更して、「Customer」ウィンドウがエディタモードではなくエクスプローラモードで開くようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「<strong>dbaccess</strong>」モジュールを右クリックして、「新規」&gt;「ウィンドウ」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>ドロップダウンリストから「<strong>editor</strong>」を選択し、「<strong>アプリケーションの起動時に開く</strong>」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「クラス名の接頭辞」に「<strong>MyEditor</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「パッケージ」に「<strong>com.mycompany.mavenplatformcrudapp.editor</strong>」と入力します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>「 <code>MyEditorTopComponent</code> 」の「デザイン」ビューで、2 つの JLabel と 2 つの JTextField を追加します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>ラベルのテキストに「Name」と「City」を設定し、2 つの JTextField の変数名にそれぞれ「 <code><strong>jTextField1</strong></code> 」と「 <code><strong>jTextField2</strong></code> 」を設定します。変更を保存します。
image::images/maven-crud_mavencrud-myeditor-window.png[title="「デザイン」ビューのウィンドウコンポーネント"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>「プロジェクト」ウィンドウで「重要なファイル」ノードを展開して「<strong>XML レイヤー</strong>」をダブルクリックし、エディタで  <code>layer.xml</code>  ファイルを開きます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p><code>layer.xml</code>  を変更して、「CustomerTopComponent」ウィンドウがエクスプローラモードで表示されるようにします。変更を保存します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;folder name="Modes"&gt;
    &lt;folder name="editor"&gt;
        &lt;file name="MyEditorTopComponent.wstcref" url="MyEditorTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;
    *&lt;folder name="explorer"&gt;
        &lt;file name="CustomerTopComponent.wstcref" url="CustomerTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;*
&lt;/folder&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、アプリケーションをテストして、ウィンドウが開くかどうか、および正しい位置に表示されるかどうかを確認できます。</p>
</div>
<div class="paragraph">
<p>「依存関係で構築」を実行する前に、アプリケーションに対して「生成物を削除」を実行するようにしてください。</p>
</div>
<div class="paragraph">
<p>これで、「Customer」ウィンドウのノードを選択したときに、オブジェクトの name および city フィールドをエディタに表示するためのコードを追加できるようになりました。</p>
</div>
</div>
<div class="sect2">
<h3 id="_lookuplistener_の使用">LookupListener の使用</h3>
<div class="paragraph">
<p>この課題では、「Customer」ウィンドウを変更して、ノードを選択すると新しい  <code>Customer</code>  オブジェクトが Node の Lookup に追加されるようにします。そのあと MyEditor を変更して、Lookup に追加された  <code>Customer</code>  オブジェクトを待機する  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-util-lookup/org/openide/util/LookupListener.html">LookupListener</a></code>  をウィンドウに実装します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>CustomerChildFactory</strong> の  <code>createNodeForKey</code>  メソッドが、 <code>BeanNode</code>  ではなく  <code>AbstractNode</code>  を作成するように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
  *Node node = new AbstractNode(Children.LEAF, Lookups.singleton(c));
  node.setDisplayName(c.getName());
  node.setShortDescription(c.getCity());
  return node;*
//        try {
//            return new BeanNode(c);
//        } catch (IntrospectionException ex) {
//            Exceptions.printStackTrace(ex);
//            return null;
//        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>「Customer」ウィンドウで新しいノードを選択すると、選択された  <code>Customer</code>  オブジェクトがウィンドウの Lookup に追加されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><strong>MyEditorTopComponent</strong> の「ソース」タブをクリックして、クラス署名が  <code>LookupListener</code>  を実装するように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class MyEditorTopComponent extends TopComponent *implements LookupListener*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>結果を格納する変数を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Lookup.Result result = null;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>必要な abstract メソッドを実装して、 <code>resultChanged</code>  メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p><code>resultChanged</code>  メソッドを変更して、新しい  <code>Customer</code>  オブジェクトが Lookup に挿入されるたびに jTextField が更新されるようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">      @Override
      public void resultChanged(LookupEvent le) {
          Lookup.Result r = (Lookup.Result) le.getSource();
          Collection&lt;Customer&gt; coll = r.allInstances();
          if (!coll.isEmpty()) {
              for (Customer cust : coll) {
                  jTextField1.setText(cust.getName());
                  jTextField2.setText(cust.getCity());
              }
          } else {
              jTextField1.setText("[no name]");
              jTextField2.setText("[no city]");
          }
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>LookupListener を定義したら、グローバルコンテキストから取得した  <code>Lookup.Result</code>  に追加できます。グローバルコンテキストは、選択された Node のコンテキストの代わりとして機能します。たとえば、ツリー階層で「Ford Motor Co」を選択すると、「Ford Motor Co」の  <code>Customer</code>  オブジェクトが Node の Lookup に追加されます。これが現時点で選択された Node となるため、「Ford Motor Co」の  <code>Customer</code>  オブジェクトはグローバルコンテキストで使用できるようになります。次に、このオブジェクトが  <code>resultChanged</code>  に渡され、テキストフィールドに値が取り込まれます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p><code>componentOpened</code>  および  <code>componentClosed</code>  メソッドを変更して、エディタウィンドウが開いているときに LookupListener がアクティブになるようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">      @Override
      public void componentOpened() {
          result = WindowManager.getDefault().findTopComponent("CustomerTopComponent").getLookup().lookupResult(Customer.class);
          result.addLookupListener(this);
          resultChanged(new LookupEvent(result));
      }

      @Override
      public void componentClosed() {
          result.removeLookupListener(this);
          result = null;
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションが起動するとエディタウィンドウが開くように設定されているので、LookupListener はアプリケーションの起動時に使用可能になります。</p>
</div>
<div class="paragraph">
<p>この例では、「Customer」ウィンドウによって提供されるローカルの Lookup を使用しています。ウィンドウは、この場合「 <code>CustomerTopComponent</code> 」という文字列で明示的に識別されます。この文字列は、 <code>CustomerTopComponent</code>  のソースコードで、CustomerTopComponent の ID として指定されています。この方法は、MyEditorTopComponent が「CustomerTopComponent」の ID で TopComponent を検出できる場合にだけ機能します。</p>
</div>
<div class="paragraph">
<p>選択モデルの書き直しなどの、より柔軟な方法については、 <a href="http://weblogs.java.net/blog/timboudreau/archive/2007/01/how_to_replace.html">Tim Boudreau 氏によるこのブログエントリ</a>で説明されています。</p>
</div>
<div class="paragraph">
<p>「生成物を削除」および「依存関係で構築」を実行したら、アプリケーションを再度実行できます。「Customer」ウィンドウで新しい Node を選択すると、エディタウィンドウが更新されるようになりました。 <code>BeanNode</code>  の代わりに  <code>AbstractNode</code>  を使用しているため、ノードの「プロパティー」ウィンドウにプロパティーは表示されません。</p>
</div>
</div>
<div class="sect2">
<h3 id="_元に戻すおよび再実行の追加">元に戻すおよび再実行の追加</h3>
<div class="paragraph">
<p>この課題では、 <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.html">UndoRedo</a></code>  マネージャーを実装して、元に戻すおよび再実行機能を有効にします。ツールバーの「Undo」および「Redo」ボタンと、「Undo」および「Redo」メニュー項目は、ユーザーが「Editor」ウィンドウのいずれかのフィールドを変更すると有効になります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>新しい UndoRedoManager を MyEditorTopComponent の先頭で宣言し、インスタンス化します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private UndoRedo.Manager manager = new UndoRedo.Manager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>次のようにして、MyEditorTopComponent に  <code>getUndoRedo()</code>  メソッドを作成します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public UndoRedo getUndoRedo() {
    return manager;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>コンストラクタに次のコードを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">jTextField1.getDocument().addUndoableEditListener(manager);
jTextField2.getDocument().addUndoableEditListener(manager);</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションを実行して、「Undo」および「Redo」機能のボタンとメニュー項目が機能するかどうかをテストできます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_保存機能の追加">保存機能の追加</h3>
<div class="paragraph">
<p>この課題では、NetBeans プラットフォームの保存機能を統合します。 <code>layer.xml</code>  ファイルを変更して、ツールバーの「Save All」ボタンを隠し、「Save」ボタンを追加します。そのあと、テキストフィールドの変更を検出するリスナーと、変更が検出されたときにトリガーされる  <code>fire</code>  メソッドを追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>dbaccess</strong> モジュールの  <code>layer.xml</code>  ファイルを開き、Toolbar 要素を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">    *&lt;folder name="Toolbars"&gt;
      &lt;folder name="File"&gt;
          &lt;file name="org-openide-actions-SaveAction.shadow"&gt;
              &lt;attr name="originalFile" stringvalue="Actions/System/org-openide-actions-SaveAction.instance"/&gt;
              &lt;attr name="position" intvalue="444"/&gt;
          &lt;/file&gt;
          &lt;file name="org-openide-actions-SaveAllAction.shadow_hidden"/&gt;
      &lt;/folder&gt;
    &lt;/folder&gt;*
&lt;/filesystem&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><strong>MyEditorTopComponent</strong> コンストラクタで、テキストフィールドで変更が検出されたときにメソッドを起動する、次の呼び出しを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public MyEditorTopComponent() {

          ...
    jTextField1.getDocument().addUndoableEditListener(manager);
    jTextField2.getDocument().addUndoableEditListener(manager);

    *jTextField1.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

    jTextField2.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

    //Create a new instance of our SaveCookie implementation:
    impl = new SaveCookieImpl();

    //Create a new instance of our dynamic object:
    content = new InstanceContent();

    //Add the dynamic object to the TopComponent Lookup:
    associateLookup(new AbstractLookup(content));*

    ...
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>変更が検出されたときに呼び出される  <code>fire</code>  メソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void fire(boolean modified) {
  if (modified) {
      //If the text is modified,
      //we add SaveCookie impl to Lookup:
      content.add(impl);
  } else {
      //Otherwise, we remove the SaveCookie impl from the lookup:
      content.remove(impl);
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p><code>fire</code>  メソッドによって  <code>InstanceContent</code>  に追加される、次の  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-nodes/org/openide/cookies/SaveCookie.html">SaveCookie</a></code>  の実装を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private class SaveCookieImpl implements SaveCookie {

  @Override
  public void save() throws IOException {

     Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
              + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
              NotifyDescriptor.OK_CANCEL_OPTION,
              NotifyDescriptor.QUESTION_MESSAGE);

      Object result = DialogDisplayer.getDefault().notify(message);
      //When user clicks "Yes", indicating they really want to save,
      //we need to disable the Save action,
      //so that it will only be usable when the next change is made
      //to the JTextArea:
      if (NotifyDescriptor.YES_OPTION.equals(result)) {
          fire(false);
          //Implement your save functionality here.
      }
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>MyEditorTopComponent に次のフィールドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private final SaveCookieImpl impl;
private final InstanceContent content;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>インポートを修正して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>「プロジェクト」ウィンドウで、「ライブラリ」ノードの下の「 <code>org-openide-dialogs</code> 」JAR を右クリックし、「直接依存リソースとして宣言」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ここで、アプリケーションに対して「生成物を削除」、「依存関係で構築」、および「実行」を行うと、テキストフィールドを変更したときに「Save」ボタンが有効になることを確認できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_変更内容の持続">変更内容の持続</h3>
<div class="paragraph">
<p>この課題では、変更内容を持続させるコードを追加します。現時点のアプリケーションでは、フィールドが変更されると正常にそれを認識し、変更内容を保存するオプションを有効にします。「Save」をクリックすると、変更内容を保存するかどうかの確認を求めるダイアログが表示されます。ただし、ダイアログで「了解」をクリックしても、変更内容は持続しません。変更内容を持続させるには、データベースの変更を維持するための JPA コードをいくつか追加する必要があります。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>MyEditorTopComponent</strong> に次のフィールドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Customer customer;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>save</code>  メソッドを変更して、変更内容を持続させる JPA コードを追加します。これを行うには、「 <code>//Implement your save functionality here.</code> 」というコメントを次のコードに置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void save() throws IOException {
...
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
        entityManager.getTransaction().begin();
        Customer c = entityManager.find(Customer.class, customer.getCustomerId());
        c.setName(jTextField1.getText());
        c.setCity(jTextField2.getText());
        entityManager.getTransaction().commit();*
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>持続性ユニットの名前が正しいことを確認します。</p>
</div>
<div class="paragraph">
<p>「 <code>customer.getCustomerId()</code> 」の「customer」は、現時点では定義されていません。次の手順で、顧客 ID の取得に使用する現在の  <code>Customer</code>  オブジェクトを  <code>customer</code>  に設定します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>次のボールドの行を  <code>resultChanged</code>  メソッドに追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public void resultChanged(LookupEvent le) {
    Lookup.Result r = (Lookup.Result) le.getSource();
    Collection&lt;Customer&gt; coll = r.allInstances();
    if (!coll.isEmpty()) {
      for (Customer cust : coll) {
          *customer = cust;*
          jTextField1.setText(cust.getName());
          jTextField2.setText(cust.getCity());
      }
    } else {
      jTextField1.setText("[no name]");
      jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>インポートを修正して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>アプリケーションを実行してデータをいくつか変更すると、保存機能が正常に機能して変更内容が持続するかどうかをテストできます。この時点では、変更されたデータはエディタのフィールドに反映されません。データが持続するかどうかを確認するには、アプリケーションを再起動する必要があります。</p>
</div>
<div class="paragraph">
<p>次の課題では、データベースからデータを再読み込みして、エディタで変更内容が表示されるようにする「更新」機能を追加します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_更新機能の追加">更新機能の追加</h3>
<div class="paragraph">
<p>この課題では、「Customer」ウィンドウのルートノードに「Refresh」メニュー項目を追加して、Customer ビューアを更新する機能を追加します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「 <code><strong>com.mycompany.mavenplatformcrudapp.viewer</strong></code> 」パッケージを右クリックし、「新規」&gt;「Java クラス」を選択して、<strong>CustomerRootNode</strong> という名前のクラスを作成します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>クラスで  <code>AbstractNode</code>  を拡張し、次のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class CustomerRootNode extends AbstractNode {

    *public CustomerRootNode(Children kids) {
      super(kids);
      setDisplayName("Root");
    }

    @Override
    public Action[] getActions(boolean context) {
      Action[] result = new Action[]{
          new RefreshAction()};
      return result;
    }

    private final class RefreshAction extends AbstractAction {

      public RefreshAction() {
          putValue(Action.NAME, "Refresh");
      }

      public void actionPerformed(ActionEvent e) {
          CustomerTopComponent.refreshNode();
      }
    }*

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>「Refresh」アクションは、新しいルートノードにバインドされます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>* <code>javax.swing.Action</code> * をインポートするために、インポートを修正します。変更を保存します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p><strong>CustomerTopComponent</strong> を変更して、ビューを再表示するための次のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public static void refreshNode() {
    EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    em.setRootContext(new *CustomerRootNode*(Children.create(new CustomerChildFactory(resultList), true)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このメソッドは、ルートコンテキストの設定に <strong>CustomerRootNode</strong> を使用します。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``CustomerRootNode``  クラスでは、 ``refreshNode``  が含まれる行で Alt+Enter を押すと、IDE によってメソッドのスケルトンが生成されます。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>CustomerTopComponent のコンストラクタのコードを、<strong>AbstractNode</strong> の代わりに <strong>CustomerRootNode</strong> への呼び出しに変更します。</p>
<div class="literalblock">
<div class="content">
<pre>``CustomerRootNode``  を呼び出すと自動的に  ``refreshNode``  メソッドが呼び出され、「Refresh」が呼び出されます。</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>インポートを修正して変更内容を保存します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>アプリケーションを実行すると、ポップアップメニューで「Refresh」アクションが使用できる、新しいルートノードがあることが確認できます。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``refreshNode``  メソッドを再利用して自動再表示を実装できます。 ``save``  メソッドから  ``refreshNode``  メソッドを呼び出してください。または、「Refresh」アクションを含む別のモジュールを作成して、このモジュールをモジュール間で共有することもできます。</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_新規レコードの作成">CREATE: 新規レコードの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、データベース内にユーザーが新しいエントリを作成できるようにします。</p>
</div>
<div class="sect2">
<h3 id="_作成アクションの追加">作成アクションの追加</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「<strong>dbaccess</strong>」モジュールを右クリックして、「新規」&gt;「アクション」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「常に有効化」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「カテゴリ」ドロップダウンリストから「<strong>ファイル</strong>」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「大域ツールバーボタン」を選択します。「次へ」をクリックします。
image::images/maven-crud_mavencrud-new-action.png[title="「新規アクション」ウィザードの「GUI の登録」"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>「クラス名」に「<strong>NewAction</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>「表示名」に「<strong>My New Action</strong>」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>「参照」をクリックして、ツールバーで使用する画像を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次の画像  <code>abc16.png</code>  をデスクトップにコピーして、ウィザードでこの画像を指定することもできます。( 
image::images/maven-crud_abc16.png[title="サンプル 16 x 16 アイコン"] )</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>「<strong>com.mycompany.mavenplatformcrudapp.editor</strong>」パッケージを選択します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p><code>NewAction</code>  クラスを、MyEditorTopComponent を開いてフィールドを削除するように変更します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public final class NewAction implements ActionListener {

    public void actionPerformed(ActionEvent e) {
        MyEditorTopComponent tc = MyEditorTopComponent.getDefault();
        tc.resetFields();
        tc.open();
        tc.requestActive();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このアクションは、ActionListener クラスを実装します。このクラスは、レイヤーファイル内のエントリを通じてアプリケーションにバインドされ、「新規アクション」ウィザードによってアプリケーションに挿入されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_新規オブジェクトの作成および保存">新規オブジェクトの作成および保存</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>MyEditorTopComponent</strong> で、JTextFields をリセットし、新しい  <code>Customer</code>  オブジェクトを作成する次のメソッドを追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void resetFields() {
    customer = new Customer();
    jTextField1.setText("");
    jTextField2.setText("");
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>``NewAction``  クラスでは、 ``resetFields``  への呼び出しで Alt+Enter を押すと、IDE によって MyEditorTopComponent にメソッドのスケルトンが生成されます。</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>SaveCookie で、null の戻り値が、既存のエントリの更新ではなく、新しいエントリが保存されたことを示すようにします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void save() throws IOException {

    Confirmation message = new NotifyDescriptor.Confirmation("Do you want to save \""
                  + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                  NotifyDescriptor.OK_CANCEL_OPTION,
                  NotifyDescriptor.QUESTION_MESSAGE);

    Object result = DialogDisplayer.getDefault().notify(msg);

    //When user clicks "Yes", indicating they really want to save,
    //we need to disable the Save button and Save menu item,
    //so that it will only be usable when the next change is made
    //to the text field:
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
        entityManager.getTransaction().begin();
        *if (customer.getCustomerId() != null) {*
            Customer c = entityManager.find(Customer.class, cude.getCustomerId());
            c.setName(jTextField1.getText());
            c.setCity(jTextField2.getText());
            entityManager.getTransaction().commit();
        *} else {
            Query query = entityManager.createQuery("SELECT c FROM Customer c");
            List&lt;Customer&gt; resultList = query.getResultList();
            customer.setCustomerId(resultList.size()+1);
            customer.setName(jTextField1.getText());
            customer.setCity(jTextField2.getText());
            //adds more fields that will populate the zip and discountCode columns
            customer.setZip("12345");
            customer.setDiscountCode(entityManager.find(DiscountCode.class, 'H'));

            entityManager.persist(customer);
            entityManager.getTransaction().commit();
        }*
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、DiscountCode を空にすることはできないため、このフィールドに任意のデータを書き込んでいます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><code><strong>javax.persistence.Query</strong></code>  をインポートするために、インポートを修正します。変更を保存します。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_アプリケーションの構築と実行">アプリケーションの構築と実行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これで、アプリケーションは CRUD 機能のうちの 3 つ (Create、Read、および Update) を実行できるようになりました。ここでアプリケーションを構築および実行し、すべての機能が正常に動作するかを確認できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「<strong>MavenPlatformCRUDApp NetBeans Platform based application</strong>」のプロジェクトノードを右クリックして、「生成物を削除」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「<strong>MavenPlatformCRUDApp NetBeans Platform based application</strong>」のプロジェクトノードを右クリックして、「依存関係で構築」を選択します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「<strong>MavenPlatformCRUDApp NetBeans Platform based application</strong>」のプロジェクトノードを右クリックして、「実行」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>「実行」をクリックすると、IDE によってプラットフォームアプリケーションが起動します。アプリケーションは、データベースの顧客名を使用して「Customer」ウィンドウにツリーを生成します。「Customer」ウィンドウでノードを選択すると、選択した顧客の名前および都市が「My Editor」ウィンドウに表示されます。「Name」および「City」フィールドのデータを変更して保存できます。新しい顧客を作成するには、ツールバーで「My Action」ボタンをクリックし、「My Editor」ウィンドウの空のテキストフィールドに名前と都市を入力してから、「Save」をクリックします。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-crud_mavencrud-finished-app.png" alt="maven crud mavencrud finished app">
</div>
<div class="title">Figure 9. 「Customer」および「MyEditor」ウィンドウを表示する完成したアプリケーション</div>
</div>
<div class="paragraph">
<p>保存機能に「Refresh」アクションを実装しなかった場合は、顧客を作成または変更したあとに、「Customer」ウィンドウのルートノードを再表示する必要があります。</p>
</div>
<div class="paragraph">
<p>このチュートリアルでは、Maven を使用した NetBeans プラットフォームアプリケーションの作成方法が、Ant を使用した作成方法と大きく違わないことを示しました。主な違いは、Maven POM によるアプリケーション組み立ての制御方式です。ほかの NetBeans プラットフォームアプリケーションおよびモジュール構築の例については、「 <a href="https://netbeans.apache.org/kb/docs/platform.html">NetBeans プラットフォームの学習</a>」に一覧表示されている各チュートリアルを参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_関連項目">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これで、CRUD チュートリアルを終了します。このドキュメントは、Maven 構築フレームワークを使用して、CRUD 機能を備えた新しい NetBeans プラットフォームアプリケーションを作成する方法について説明しました。アプリケーションの作成と開発の詳細については、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform_ja.html">NetBeans プラットフォームの学習</a></p>
</li>
<li>
<p><a href="http://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>NetBeans プラットフォームに関して質問がある場合は、<a href="mailto:dev@platform.netbeans.org">dev@platform.netbeans.org</a> のメーリングリストに投稿していただくか、 <a href="https://mail-archives.apache.org/mod_mbox/netbeans-dev/">NetBeans プラットフォームメーリングリストのアーカイブ</a>を参照してください。</p>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/74/nbm-maven-crud_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
