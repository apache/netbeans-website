
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Создание приложения CRUD на платформе NetBeans с помощью Maven</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Создание приложения CRUD на платформе NetBeans с помощью Maven - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, Создание приложения CRUD на платформе NetBeans с помощью Maven">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="/plugins/index.html">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Just released!</div>
            <h1 syle='font-size: 2rem'>Apache NetBeans 11.3</h1>
            <p><a class="button success" href="/download/nb113/index.html">Find out more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">Создание приложения CRUD на платформе NetBeans с помощью Maven</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/691/nbm-maven-crud_ru.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_Настройка_maven">Настройка Maven</a>
<ul class="sectlevel2">
<li><a href="#_Просмотр_репозиториев_maven">Просмотр репозиториев Maven</a></li>
</ul>
</li>
<li><a href="#_Создание_проекта_приложения_на_платформе_netbeans">[[Создание проекта приложения на платформе NetBeans]]</a>
<ul class="sectlevel2">
<li><a href="#_Создание_проекта">Создание проекта</a></li>
<li><a href="#_Создание_модуля">[[Создание модуля]]</a></li>
<li><a href="#_Добавление_модуля_в_качестве_зависимости">Добавление модуля в качестве зависимости</a></li>
<li><a href="#_Брэндинг_приложения">Брэндинг приложения</a></li>
</ul>
</li>
<li><a href="#_Создание_классов_сущностей">Создание классов сущностей</a>
<ul class="sectlevel2">
<li><a href="#_Добавление_модуля_derby_client_в_качестве_зависимости">[[Добавление модуля Derby Client в качестве зависимости]]</a></li>
<li><a href="#_Создание_классов_сущностей_из_базы_данных">Создание классов сущностей из базы данных</a></li>
</ul>
</li>
<li><a href="#_Чтение_считывание_и_вывод_записи">Чтение: считывание и вывод записи</a>
<ul class="sectlevel2">
<li><a href="#_Добавление_оконного_компонента">Добавление оконного компонента</a></li>
<li><a href="#_Добавление_древовидного_представления">Добавление древовидного представления</a></li>
<li><a href="#_Создание_класса_фабрики">Создание класса фабрики</a></li>
<li><a href="#_Запуск_приложения">Запуск приложения</a></li>
</ul>
</li>
<li><a href="#_Обновление_изменение_записи">Обновление: изменение записи</a>
<ul class="sectlevel2">
<li><a href="#_Создание_окна_редактора">Создание окна редактора</a></li>
<li><a href="#_Использование_lookuplistener">Использование LookupListener</a></li>
<li><a href="#_Добавление_функций_Отменить_и_Вернуть">Добавление функций "Отменить" и "Вернуть"</a></li>
<li><a href="#_Добавление_функции_Сохранить">Добавление функции "Сохранить"</a></li>
<li><a href="#_Сохранение_измененных_данных">Сохранение измененных данных</a></li>
<li><a href="#_Добавление_функции_Обновить">Добавление функции "Обновить"</a></li>
</ul>
</li>
<li><a href="#_Создание_добавление_новой_записи">Создание: добавление новой записи</a>
<ul class="sectlevel2">
<li><a href="#_Добавление_действия_Создать">Добавление действия "Создать"</a></li>
<li><a href="#_Создание_и_сохранение_нового_объекта">Создание и сохранение нового объекта</a></li>
</ul>
</li>
<li><a href="#_Построение_и_запуск_приложения">Построение и запуск приложения</a></li>
<li><a href="#_Дополнительные_сведения">Дополнительные сведения</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Добро пожаловать в  <a href="https://netbeans.apache.org/platform/"><strong>платформу NetBeans</strong></a>!</p>
</div>
<div class="paragraph">
<p>В этом документе описано использование платформы построения Maven для создания простого приложения на платформе NetBeans, позволяющего выполнять операции чтения и записи в базу данных. В этом документе для создания приложения и модуля на платформе NetBeans будут использоваться архетипы Maven, а для создания оконных компонентов - инструментарий Swing UI и конструктор графического интерфейса пользователя Matisse.</p>
</div>
<div class="paragraph">
<p>Этот документ основан на  <a href="nbm-crud_ru.html">Учебном курсе по созданию приложения CRUD на платформе NetBeans</a> на базе Ant и описывает различия между Ant и Maven при создании приложений на платформе NetBeans. После изучения отличий Maven от Ant можно легко пройти другие учебные курсы в  <a href="https://netbeans.apache.org/kb/docs/platform_ru.html">Учебной карте по платформе NetBeans</a>.</p>
</div>
<div class="paragraph">
<p>Пример приложения CRUD является одним из примеров Maven, доступных в мастере создания проекта.</p>
</div>
<div class="paragraph">
<p>При отсутствии опыта работы с платформой NetBeans можно посмотреть серию демонстрационных роликов  <a href="https://netbeans.apache.org/tutorials/nbm-10-top-apis.html">10 лучших интерфейсов API NetBeans</a>.</p>
</div>
<div class="paragraph">
<p><strong>Содержимое</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/netbeans-stamp69.png" alt="netbeans stamp69">
</div>
<div class="title">Figure 1. Содержимое этой страницы относится к среде IDE NetBeans версий 6.5, 6.7, 6.8</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#config">Настройка Maven</a></p>
</li>
<li>
<p><a href="#01">Создание проекта приложения на платформе NetBeans</a></p>
</li>
<li>
<p><a href="#01b">Создание модуля</a></p>
</li>
<li>
<p><a href="#01c">Добавление модуля в качестве зависимости</a></p>
</li>
<li>
<p><a href="#01d">Брэндинг приложения</a></p>
</li>
<li>
<p><a href="#02">Создание классов сущностей</a></p>
</li>
<li>
<p><a href="#02a">Добавление модуля Derby Client в качестве зависимости</a></p>
</li>
<li>
<p><a href="#02b">Создание классов сущностей из базы данных</a></p>
</li>
<li>
<p><a href="#03">Чтение: считывание и вывод записи</a></p>
</li>
<li>
<p><a href="#03b">Добавление древовидного представления к операционной системе Windows</a></p>
</li>
<li>
<p><a href="#03c">Создание класса фабрики</a></p>
</li>
<li>
<p><a href="#03d">Изменение зависимостей</a></p>
</li>
<li>
<p><a href="#04">Обновление: изменение записи</a></p>
</li>
<li>
<p><a href="#04b">Использование LookupListener</a></p>
</li>
<li>
<p><a href="#04c">Добавление функций "Отменить" и "Вернуть"</a></p>
</li>
<li>
<p><a href="#04d">Добавление функции "Сохранить"</a></p>
</li>
<li>
<p><a href="#04e">Сохранение изменений</a></p>
</li>
<li>
<p><a href="#04f">Добавление функции "Обновить"</a></p>
</li>
<li>
<p><a href="#05">Создание: добавление новой записи</a></p>
</li>
<li>
<p><a href="#05b">Создание и сохранение нового объекта</a></p>
</li>
<li>
<p><a href="#06">Запуск приложения</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Для работы с этим учебным курсом требуется программное обеспечение и ресурсы, перечисленные в следующей таблице.</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Программное обеспечение или ресурс</th>
<th class="tableblock halign-left valign-top">Требуемая версия</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.apache.org/download/index.html">Среда IDE NetBeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия 6.9 (Java)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">Комплект для разработчика на языке Java (JDK)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://maven.apache.org/">Maven</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия 2.0.9 или более поздняя версия</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Сервер базы данных JavaDB (или другой) и база данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>NOTE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Сервер базы данных JavaDB и демонстрационная база данных поставляются вместе со встроенным сервером приложений GlassFish Server Open Source Edition 3.0.1.</p>
</li>
<li>
<p>Для разработки приложений на платформе NetBeans не требуется загружать отдельную версию этой платформы. Как правило, разработка приложений и модулей осуществляется в среде IDE NetBeans, затем необходимо просто включить требуемые модули для выполнения платформы NetBeans и созданного приложения.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Перед изучением этого учебного курса можно ознакомиться со следующей документацией:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/MavenBestPractices">Практические рекомендации по Apache Maven в NetBeans 6.x</a>;</p>
</li>
<li>
<p><a href="http://www.sonatype.com/books/maven-book/reference/introduction.html">Глава 1. Введение в Apache Maven</a> (из книги  <a href="http://www.sonatype.com/books/maven-book/reference/public-book.html">Maven: полное руководство</a>)</p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/java/gui-functionality_ru.html">Введение в разработку графического интерфейса </a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Настройка_maven">Настройка Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Если это первый опыт работы с Maven, следует проверить параметры настройки Maven в окне "Параметры". Для работы с этим учебным курсом необходимо установить Maven на локальный компьютер. Программу установки можно загрузить с  <a href="http://maven.apache.org/">сайта Maven</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите категорию "Разное" в окне "Параметры" и перейдите на вкладку Maven.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Укажите папку установки Maven (требуется версия 2.0.9 или более поздняя).</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Проверьте корректность адреса к локальному репозиторию Maven.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В большинстве случаев при использовании типичной настройки Maven данные в окне "Параметры" уже корректны.</p>
</div>
<div class="paragraph">
<p>Maven SCM используется в среде IDE для проверки артефактов Maven. Может потребоваться проверка факта установки всех необходимых клиентов для проверки исходных файлов на локальном компьютере и корректности их настройки.</p>
</div>
<div class="paragraph">
<p>Дополнительные сведения о Maven SCM приведены на  <a href="http://maven.apache.org/scm/index.html">странице Maven SCM</a>.</p>
</div>
<div class="sect2">
<h3 id="_Просмотр_репозиториев_maven">Просмотр репозиториев Maven</h3>
<div class="paragraph">
<p>Артефакты, используемые Maven для создания всех проектов, сохраняются в локальном репозитории Maven. Если артефакт объявлен как зависимость проекта, он загружается в локальный репозиторий из одного из зарегистрированных удаленных репозиториев.</p>
</div>
<div class="paragraph">
<p>Репозиторий NetBeans и некоторые известные индексированные репозитории Maven зарегистрированы и включены в список окна "Обозреватель репозитория" по умолчанию. Репозиторий NetBeans содержит большинство общедоступных артефактов, требуемых для создания проекта. Обозреватель репозиториев Maven можно использовать для просмотра содержимого локальных и удаленных репозиториев. Для просмотра локальных артефактов разверните узел "Локальный репозиторий". Артефакты, указанные в узлах удаленного репозитория, могут быть добавлены в качестве зависимостей проекта, однако не все из них представлены локально. Они добавляются к локальному репозиторию только в том случае, если объявляются в качестве зависимостей проекта.</p>
</div>
<div class="paragraph">
<p>Чтобы открыть обозреватель репозиториев Maven:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>выберите в главном меню "Окно" &gt; "Прочее" &gt; "Обозреватель репозиториев Maven".</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/maven-nbm-netbeans-repo.png" alt="maven nbm netbeans repo">
</div>
<div class="title">Figure 2. Снимок экрана: обозреватель репозиториев Maven</div>
</div>
<div class="paragraph">
<p>Когда курсор находится над артефактом, среда IDE отображает всплывающую подсказку с координатами артефакта. Посмотреть дополнительные сведения об артефакте можно с помощью двойного щелчка по файлу JAR артефакта в обозревателе.</p>
</div>
<div class="paragraph">
<p>Чтобы выполнить поиск артефакта, нажмите кнопку "Найти" на панели инструментов обозревателя репозиториев Maven или используйте текстовое поле "Быстрый поиск" на главной панели инструментов.</p>
</div>
<div class="paragraph">
<p>Подробные сведения об управлении зависимостями путей классов Maven и работе с репозиториями Maven в среде IDE приведены в разделе  <a href="http://wiki.netbeans.org/MavenBestPractices#Dependency_management">Управление зависимостями</a> курса  <a href="http://wiki.netbeans.org/MavenBestPractices">Практические рекомендации по Apache Maven в NetBeans 6.x</a>.</p>
</div>
<div class="paragraph">
<p>Для просмотра видеоролика по использованию Artifact Viewer обратитесь к демонстрации  <a href="https://netbeans.apache.org/kb/docs/java/maven-dependencies-screencast.html">Работа с зависимостями Maven</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Создание_проекта_приложения_на_платформе_netbeans">[[Создание проекта приложения на платформе NetBeans]]</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе для построения приложения на платформе NetBeans из архетипа Maven используется мастер создания проекта. Этот мастер создает проекты модуля Maven, требуемые для разработки приложения на платформе NetBeans. Модуль на платформе NetBeans создается также с помощью мастера создания проекта.</p>
</div>
<div class="sect2">
<h3 id="_Создание_проекта">Создание проекта</h3>
<div class="paragraph">
<p>Чтобы создать приложение на платформе NetBeans с помощью мастера создания проекта, выполните следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите в меню "Файл" команду "Новый проект" (CTRL+SHIFT+N), чтобы открыть мастер создания проекта.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите приложение Maven NetBeans из категории Maven. Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В поле "Имя проекта" введите <strong>MavenPlatformCRUDApp</strong> и укажите местоположение проекта. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
При построении приложения на платформе можно нажать кнопку "Далее" и создать проект модуля в мастере создания проекта, однако для наглядности в данном учебном курсе приложение и модуль создаются отдельно.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-new-project.png" alt="mavencrud new project">
</div>
<div class="title">Figure 3. Снимок экрана: мастер создания проекта</div>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" в среде IDE по умолчанию создаются следующие типы проектов Maven.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Приложение на платформе NetBeans.</strong> Данный проект является проектом-контейнером для приложения на платформе. В нем перечисляются включаемые модули и местоположения репозиториев проекта. Данный проект не содержит исходных файлов. В среде IDE создаются модули, содержащие исходные файлы и ресурсы в подкаталогах проекта.</p>
</li>
<li>
<p><strong>Приложение на базе платформы NetBeans.</strong> В данном проекте указываются артефакты (исходные файлы), требуемые для компиляции приложения. Необходимые зависимости (артефакты среды IDE, артефакты модуля) указываются в файле проекта  <code>pom.xml</code> .</p>
</li>
<li>
<p><strong>Ресурсы брэндинга приложения на платформе.</strong> Этот проект содержит ресурсы, используемые для брэндинга приложения.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-projects-window1.png" alt="mavencrud projects window1" width="Проекты""">
</div>
<div class="title">Figure 4. Структура проекта в окне </div>
</div>
<div class="paragraph">
<p><strong>Примечания.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Первое создание приложения платформы NetBeans с использованием Maven может занять некоторое время, поскольку среде IDE требуется загрузить все необходимые артефакты из репозитория NetBeans.</p>
</li>
<li>
<p>После создания этого проекта некоторые из проектов (например, проект приложения на базе платформы NetBeans) отмечаются значком, так как некоторые зависимости в файле  <code>pom.xml</code>  недоступны.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_Создание_модуля">[[Создание модуля]]</h3>
<div class="paragraph">
<p>В этом упражнении будет использоваться мастер создания проекта для создания модуля на платформе NetBeans.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите в меню "Файл" команду "Новый проект" (CTRL+SHIFT+N), чтобы открыть мастер создания проекта.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите модуль Maven NetBeans из категории Maven. Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В поле "Имя проекта" введите <strong>MavenPlatformCRUDApp-dbaccess</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Укажите местоположение проекта, нажав кнопку "Обзор" и выбрав каталог <strong>MavenPlatformCRUDApp</strong>. Нажмите кнопку "Открыть".
image::images/mavencrud-select-location.png[title="Диалоговое окно "Выбрать местоположение" (для проекта), в котором отображается каталог проекта"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>После нажатия кнопки "Готово" мастер создает проект модуля на платформе NetBeans с именем <strong>MavenPlatformCRUDApp-dbaccess</strong>. При сохранении модуля в подкаталоге он автоматически включается в приложение. При открытии POM проекта MavenPlatformCRUDApp объявляется как вышестоящий проект.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parent&gt;
    &lt;artifactId&gt;MavenPlatformCRUDApp&lt;/artifactId&gt;
    &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;
&lt;artifactId&gt;MavenPlatformCRUDApp-dbaccess&lt;/artifactId&gt;
&lt;packaging&gt;nbm&lt;/packaging&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;name&gt;MavenPlatformCRUDApp - dbaccess NetBeans Module&lt;/name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Можно изменить отображаемое имя модуля, изменив элемент  <code>&lt;name&gt;</code>  в POM или в окне проекта "Свойства". Отображаемое имя, заданное по умолчанию, - идентификатор артефакта проекта  <code>MavenPlatformCRUDApp-dbaccess</code> .</p>
</div>
<div class="paragraph">
<p>Обратите внимание на POM приложения на платформе NetBeans в узле "Файлы проекта" в окне "Проекты": в качестве модулей приложения приводятся три модуля.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;modules&gt;
   &lt;module&gt;branding&lt;/module&gt;
   &lt;module&gt;application&lt;/module&gt;
   &lt;module&gt;MavenPlatformCRUDApp-dbaccess&lt;/module&gt;
&lt;/modules&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_Добавление_модуля_в_качестве_зависимости">Добавление модуля в качестве зависимости</h3>
<div class="paragraph">
<p>Теперь необходимо добавить модуль как зависимость приложения на базе платформы NetBeans. Зависимость можно добавить, изменив в редакторе файл  <code>pom.xml</code>  или используя диалоговое окно "Добавить зависимость".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Разверните в окне "Проекты" узел <strong>Приложение на базе платформы NetBeans</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Щелкните узел "Библиотеки" правой кнопкой мыши и выберите команду "Добавить зависимость".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Щелкните вкладку "Открыть проекты" и выберите <strong>MavenPlatformCRUDApp - dbaccess</strong>. Нажмите кнопку "ОК".
image::images/mavencrud-add-dependency1.png[title="Вкладка "Открыть проекты" в диалоговом окне "Добавить зависимость""]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Разверните в окне "Проекты" узел "Библиотеки" приложения на базе платформы NetBeans: теперь MavenPlatformCRUDApp-dbaccess приводится как зависимость.</p>
</div>
<div class="paragraph">
<p>Обратите внимание на POM приложения на базе платформы NetBeans: артефакт модуля  <code>MavenPlatformCRUDApp-dbaccess</code>  приводится как зависимость, требуемая для компиляции приложения. Данный артефакт будет доступен после создания проекта модуля и установки артефакта в локальный репозиторий.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
    &lt;artifactId&gt;*MavenPlatformCRUDApp-dbaccess*&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_Брэндинг_приложения">Брэндинг приложения</h3>
<div class="paragraph">
<p>В модуле брэндинга указываются ресурсы брэндинга, используемые для построения приложения на платформе. В диалоговом окне брэндинга можно простым образом указать имя, заставку и значок приложения, а также изменить значения текстовых элементов.</p>
</div>
<div class="paragraph">
<p>В этом упражнении будет выполнена замена изображения заставки, заданного по умолчанию. Модуль брэндинга, созданный средой IDE по умолчанию, содержит изображение, выводимое при запуске приложения на платформе. Чтобы заменить это изображение другим, выполните следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В окне "Проекты" щелкните правой кнопкой мыши модуль <strong>Ресурсы брэндинга приложения на платформе</strong> и выберите команду "Брэндинг".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>На вкладке "Заставка" укажите изображение для заставки, нажав кнопку "Обзор" рядом с изображением заставки, заданным по умолчанию, и указав местоположение требуемого изображения. Нажмите кнопку "ОК".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Например, можно скопировать изображение, приведенное ниже, на локальный компьютер и указать его в диалоговом окне "Брэндинг".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/splash-crud.gif" alt="splash crud">
</div>
<div class="title">Figure 5. Пример изображения заставки, заданного по умолчанию</div>
</div>
<div class="paragraph">
<p>Новое изображение появится при запуске приложения.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Создание_классов_сущностей">Создание классов сущностей</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет создано несколько классов сущностей из таблиц в базе данных Java DB. Чтобы создать классы сущностей и использовать в приложении интерфейс API Java Persistence (JPA), необходимо иметь доступ к серверу базы данных и библиотекам поставщика сохранения состояния JPA. В данном учебном курсе используется сервер базы данных Java DB, однако для работы с приложением можно настроить другой сервер базы данных.</p>
</div>
<div class="paragraph">
<p>Сделать ресурсы доступными проще всего, зарегистрировав экземпляр сервера приложений GlassFish Server Open Source Edition 3.0.1, поставляемый в составе среды IDE. Сервер базы данных Java DB, демонстрационная база данных и поставщик сохранения состояния JPA поставляются вместе с сервером GlassFish. Перед созданием классов сущностей запустите Java DB, выполнив следующие действия:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В окне "Службы" разверните узел "Серверы" и убедитесь в том, что экземпляр сервера приложений GlassFish зарегистрирован.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Разверните узел базы данных, щелкните правой кнопкой мыши узел подключения к базе данных*app* на Java DB  <code>jdbc:derby://localhost:1527/sample [app on APP]</code>  и выберите команду "Подключить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Подключить" среда IDE запускает базу данных, если она еще не запущена.</p>
</div>
<div class="sect2">
<h3 id="_Добавление_модуля_derby_client_в_качестве_зависимости">[[Добавление модуля Derby Client в качестве зависимости]]</h3>
<div class="paragraph">
<p>В этом разделе в качестве зависимости будет добавлена библиотека derbyclient-10.5.3.0_1.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши узел "Библиотеки" модуля <strong>dbaccess</strong> и выберите команду "Добавить зависимость".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Чтобы добавить библиотеку, введите <strong>org.apache.derby</strong> в поле "Имя группы", <strong>derbyclient</strong> в поле "Имя артефакта" и <strong>10.5.3.0_1</strong> в поле "Имя версии".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Выберите в контекстном меню "Область действия" команду <strong>Выполнить</strong>. Нажмите кнопку "ОК".
image::images/mavencrud-add-dependency-derby.png[title="Добавление JAR derbyclient в диалоговом окне "Добавить зависимость""]</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Разверните узел "Библиотеки выполнения" в окне "Проекты": библиотека  <code>derbyclient</code>  приводится в качестве зависимости.</p>
</div>
<div class="paragraph">
<p>Также в редакторе можно изменить POM, чтобы указать значение элемента  <code>&lt;scope&gt;</code>  зависимости.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
            &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
            &lt;artifactId&gt;derbyclient&lt;/artifactId&gt;
            &lt;version&gt;10.5.3.0_1&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_Создание_классов_сущностей_из_базы_данных">Создание классов сущностей из базы данных</h3>
<div class="paragraph">
<p>В этом разделе будет использоваться мастер для создания классов сущностей в модуле <strong>dbaccess</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши узел "Исходные файлы" модуля <strong>dbaccess</strong> и выберите "Создать" &gt; "Прочее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите классы сущностей из базы данных в категории "Сохранение состояния". Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Выберите демонстрационную базу данных Java DB в контекстном меню "Соединение с базой данных".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Выберите таблицу Customer из списка "Доступные таблицы" и нажмите кнопку "Добавить". При нажатии кнопки "Добавить" связанная таблица DiscountCode также добавляется в список "Выбранные таблицы". Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>В поле "Имя пакета" введите <strong>com.mycompany.mavenplatformcrudapp.dbaccess</strong>. Убедитесь, что команды "Создать единицу сохранения состояния" и "Создать аннотации именованных запросов" выбраны. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" среда IDE создает классы сущностей Customer и DiscountCode. Также среда IDE создает файл  <code>persistence.xml</code>  в пакете  <code>META-INF</code>  в узле "Другие источники" в каталоге  <code>src/main/resources</code> .</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Чтение_считывание_и_вывод_записи">Чтение: считывание и вывод записи</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет использоваться мастер для добавления оконного компонента в модуль <strong>dbaccess</strong>. Чтобы просмотреть объекты как узлы, настройте в оконном компоненте древовидное представление. В окне свойств узла можно просмотреть данные по каждой записи.</p>
</div>
<div class="sect2">
<h3 id="_Добавление_оконного_компонента">Добавление оконного компонента</h3>
<div class="paragraph">
<p>В этом упражнении будет создан оконный компонент.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В окне "Проекты" щелкните правой кнопкой мыши узел проекта и выберите "Создать" &gt; "Оконный компонент".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Задайте в контекстном меню "Позиция окна" значение <strong>editor</strong> и установите флажок <strong>Открывать при запуске приложения</strong>. Нажмите кнопку "Далее".
image::images/mavencrud-new-window-customer.png[title="Страница основных параметров мастера создания оконного компонента"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В качестве префикса имени класса введите <strong>Customer</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>В поле "Имя пакета" введите <strong>com.mycompany.mavenplatformcrudapp.viewer</strong>. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В мастере отображается список файлов, которые нужно создать или изменить.</p>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Готово" в окне "Проекты" отображается класс  <code>CustomerTopComponent.java</code> , созданный средой IDE в  <code>com.mycompany.mavenplatformcrudapp.viewer</code>  в узле "Исходные файлы". В окне "Файлы" можно просмотреть структуру проекта. Для компиляции проекта Maven в узле "Папка с исходными файлами" могут находиться только исходные файлы (каталог  <code>src/main/java</code>  в окне "Файлы"). Файлы ресурсов (например, файлы XML) должны быть расположены в узле "Другие источники" (каталог  <code>src/main/resources</code>  в окне "Файлы").</p>
</div>
</div>
<div class="sect2">
<h3 id="_Добавление_древовидного_представления">Добавление древовидного представления</h3>
<div class="paragraph">
<p>Теперь можно изменить оконный компонент, чтобы отобразить записи базы данных в древовидной структуре. Можно добавить в конструктор диспетчер сущностей и включить древовидное представление компонентов.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Для просмотра исходного кода в редакторе перейдите на вкладку "Исходный код" в  <code>CustomerTopComponent.java</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Измените конструктор, добавив следующие элементы:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public CustomerTopComponent() {
    initComponents();
    setName(NbBundle.getMessage(CustomerTopComponent.class, "CTL_CustomerTopComponent"));
    setToolTipText(NbBundle.getMessage(CustomerTopComponent.class, "HINT_CustomerTopComponent"));
//        setIcon(ImageUtilities.loadImage(ICON_PATH, true));

    *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Убедитесь, что имя единицы сохранения состояния в коде корректно, сравнив его с именем, указанным в файле  <code>persistence.xml</code> .</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Измените сигнатуру класса для реализации элемента  <code>ExplorerManager.Provider.</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">final class CustomerTopComponent extends TopComponent *implements ExplorerManager.Provider*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Исправьте операторы импорта для импорта  <code><strong>javax.persistence.Query</strong></code>  и  <code><strong>javax.util.List</strong></code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Объявите и инициализируйте ExplorerManager:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static ExplorerManager em = new ExplorerManager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Реализуйте абстрактные методы и измените метод  <code>getExplorerManager</code>  для возврата  <code>em</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
public ExplorerManager getExplorerManager() {
    return em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы реализовать абстрактные методы, установите курсор в режиме вставки на сигнатуру класса и нажмите сочетание клавиш ALT+ВВОД.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Чтобы включить древовидное представление компонентов, добавьте в конструктор следующие элементы:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">BeanTreeView beanTreeView = new BeanTreeView();
add(beanTreeView, BorderLayout.CENTER);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Щелкните компонент правой кнопкой мыши в режиме проектирования и выберите из меню "Установить макет" пункт "Макет с границами". Сохраните изменения.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_Создание_класса_фабрики">Создание класса фабрики</h3>
<div class="paragraph">
<p>Теперь можно создать новый класс <strong>CustomerChildFactory</strong> в пакете  <code>com.mycompany.mavenplatformcrudapp.viewer</code> , создающий новый элемент BeanNode для каждого клиента в базе данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши пакет  <code><strong>com.mycompany.mavenplatformcrudapp.viewer</strong></code>  и выберите "Создать" &gt; "Класс Java ".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В поле "Имя класса" введите <strong>CustomerChildFactory</strong>. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Для расширения класса  <code>ChildFactory&lt;Customer&gt;</code>  измените его сигнатуру.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Объявите поле  <code>resultList</code>  для списка элементов в таблице и добавьте метод  <code>CustomerChildFactory</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private List&lt;Customer&gt; resultList;

public CustomerChildFactory(List&lt;Customer&gt; resultList) {
    this.resultList = resultList;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Реализуйте и затем измените абстрактный метод  <code>createKeys</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer Customer : resultList) {
            list.add(Customer);
        }
        return true;
    }</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Добавьте метод для создания узлов.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
    try {
        return new BeanNode(c);
    } catch (IntrospectionException ex) {
        Exceptions.printStackTrace(ex);
        return null;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Исправьте операторы импорта для импорта  <code>org.openide.nodes.Node</code>  и  <code>java.beans.InstrospectionException</code> . Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Класс будет выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.mycompany.mavenplatformcrudapp.viewer;

import com.mycompany.mavenplatformcrudapp.dbaccess.Customer;
import java.beans.IntrospectionException;
import java.util.List;
import org.openide.nodes.BeanNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;

public class CustomerChildFactory extends ChildFactory&lt;Customer&gt; {

    private List&lt;Customer&gt; resultList;

    public CustomerChildFactory(List&lt;Customer&gt; resultList) {
        this.resultList = resultList;
    }

    @Override
    protected boolean createKeys(List&lt;Customer&gt; list) {
        for (Customer customer : resultList) {
            list.add(customer);
        }
        return true;
    }

    @Override
    protected Node createNodeForKey(Customer c) {
        try {
            return new BeanNode(c);
        } catch (IntrospectionException ex) {
            Exceptions.printStackTrace(ex);
            return null;
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь необходимо изменить <strong>CustomerTopComponent</strong>, чтобы использовать ExplorerManager для передачи результатов из запроса JPA в элемент Node.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Добавьте следующие строки в конструктор CustomerTopComponent, чтобы установить корневой контекст для узлов и добавить ActionMap элемента TopComponent и ExplorerManager в Lookup элемента TopComponent.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">    EntityManager entityManager =  Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    *em.setRootContext(new AbstractNode(Children.create(new CustomerChildFactory(resultList), true)));
    associateLookup(ExplorerUtils.createLookup(em, getActionMap()));*</code></pre>
</div>
</div>
<div class="paragraph">
<p>При этом синхронизируются окно "Свойства" и текст всплывающей подсказки для каждого выбранного узла.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Исправьте операторы импорта и сохраните измененные данные.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_Запуск_приложения">Запуск приложения</h3>
<div class="paragraph">
<p>В этом упражнении будет выполнена проверка приложения для подтверждения правильности доступа и считывания таблицы базы данных. Перед построением и запуском приложения необходимо изменить POM, так как приложение требует прямой зависимости от файлов JAR  <code>org-openide-nodes</code>  и  <code>org-openide-explorer</code> . Зависимость можно изменить в окне "Проекты".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Разверните узел "Библиотеки" модуля <strong>dbaccess</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Щелкните правой кнопкой мыши файл JAR  <code>org-openide-nodes</code>  и выберите команду "Объявить как прямую зависимость".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Щелкните правой кнопкой мыши файл JAR  <code>org-openide-explorer</code>  и выберите команду "Объявить как прямую зависимость".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Щелкните правой кнопкой мыши <strong>приложение на базе платформы NetBeans MavenPlatformCRUDApp</strong> и выберите команду "Построить вместе с зависимостями".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В окне "Вывод" отобразятся включаемые модули.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-build-output1.png" alt="mavencrud build output1" width="Вывод" отображается порядок построения"">
</div>
<div class="title">Figure 6. В окне </div>
</div>
<div class="paragraph">
<p>В окне "Вывод" также отображается статус построения.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-build-output2.png" alt="mavencrud build output2" width="Вывод" выводится сообщение об успешном завершении построения"">
</div>
<div class="title">Figure 7. В окне </div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Щелкните приложение правой кнопкой мыши и выберите команду "Выполнить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При запуске приложения появляется окно Customer с узлами для всех записей в таблице базы данных.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-customer-window1.png" alt="mavencrud customer window1">
</div>
<div class="title">Figure 8. Окно Customer в приложении</div>
</div>
<div class="paragraph">
<p>Для просмотра дополнительных сведений о нужном элементе щелкните правой кнопкой мыши его узел в окне Customer и выберите "Свойства".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-read-properties.png" alt="mavencrud read properties" width="Свойства" отображаются дополнительные сведения о выбранном узле"">
</div>
<div class="title">Figure 9. В окне </div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Обновление_изменение_записи">Обновление: изменение записи</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет добавляться оконный компонент для редактирования подробных сведений записи.</p>
</div>
<div class="sect2">
<h3 id="_Создание_окна_редактора">Создание окна редактора</h3>
<div class="paragraph">
<p>В этом упражнении будет создано новое окно MyEditor, содержащее два текстовых поля "Имя" и "Город" для выбранного узла. Затем необходимо изменить файл  <code>layer.xml</code> , чтобы окно Customer открылось в режиме поиска, а не редактирования.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните модуль <strong>dbaccess</strong> правой кнопкой мыши и выберите "Создать" &gt; "Окно".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите в контекстном меню значение <strong>editor</strong> и установите флажок <strong>Открывать при запуске приложения</strong>. Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В качестве префикса имени класса введите <strong>MyEditor</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>В поле "Имя пакета" введите <strong>com.mycompany.mavenplatformcrudapp.editor</strong>. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Добавьте в режиме проектирования компонента  <code>MyEditorTopComponent</code>  две метки JLabel и два поля JTextField.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Задайте тексты меток "Имя" и "Город", а затем установите имена переменных полей JTextField равными  <code>jTextField1</code>  и  <code><strong>jTextField2</strong></code> . Сохраните изменения.
image::images/mavencrud-myeditor-window.png[title="Оконный компонент в режиме проектирования"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>В окне "Проекты" разверните узел "Важные файлы" и дважды щелкните подузел <strong>Слой XML</strong>, чтобы открыть в редакторе файл  <code>layer.xml</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Измените файл  <code>layer.xml</code> , указав в нем, что окно CustomerTopComponent выводится в режиме поиска. Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml"> &lt;folder name="Modes"&gt;
    &lt;folder name="editor"&gt;
        &lt;file name="MyEditorTopComponent.wstcref" url="MyEditorTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;
    *&lt;folder name="explorer"&gt;
        &lt;file name="CustomerTopComponent.wstcref" url="CustomerTopComponentWstcref.xml"/&gt;
    &lt;/folder&gt;*
&lt;/folder&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь можно протестировать приложение, чтобы проверить, как отрываются окна и правильно ли они расположены.</p>
</div>
<div class="paragraph">
<p>Не забудьте очистить приложение перед построением вместе с зависимостями.</p>
</div>
<div class="paragraph">
<p>Теперь можно добавить код, чтобы при выборе узла в окне Customer поля "Имя" и "Город" объекта отображались в редакторе.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Использование_lookuplistener">Использование LookupListener</h3>
<div class="paragraph">
<p>В этом упражнении будет изменено окно Customer, чтобы при выборе узла новый объект  <code>Customer</code>  добавлялся в Lookup элемента Node. Затем будет изменен элемент MyEditor, чтобы в этом окне реализовался элемент  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-util-lookup/org/openide/util/LookupListener.html">LookupListener</a></code>  для прослушивания объектов  <code>Customer</code> , добавленных в Lookup.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Измените метод  <code>createNodeForKey</code>  в элементе <strong>CustomerChildFactory</strong>, чтобы создать  <code>AbstractNode</code>  вместо  <code>BeanNode</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
protected Node createNodeForKey(Customer c) {
  *Node node = new AbstractNode(Children.LEAF, Lookups.singleton(c));
  node.setDisplayName(c.getName());
  node.setShortDescription(c.getCity());
  return node;*
//        try {
//            return new BeanNode(c);
//        } catch (IntrospectionException ex) {
//            Exceptions.printStackTrace(ex);
//            return null;
//        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>При выборе нового узла в окне Customer указанный объект  <code>Customer</code>  добавляется в Lookup окна.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Перейдите на вкладку "Исходный код" элемента <strong>MyEditorTopComponent</strong> и измените сигнатуру класса, чтобы реализовать  <code>LookupListener</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public final class MyEditorTopComponent extends TopComponent *implements LookupListener*</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте переменную, чтобы сохранить результаты.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Lookup.Result result = null;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Реализуйте требуемые абстрактные методы, чтобы добавить метод  <code>resultChanged</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Измените метод  <code>resultChanged</code> , чтобы обновлять поля jTextField каждый раз при вставке нового объекта  <code>Customer</code>  в окно Lookup.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">      @Override
      public void resultChanged(LookupEvent le) {
          Lookup.Result r = (Lookup.Result) le.getSource();
          Collection&lt;Customer&gt; coll = r.allInstances();
          if (!coll.isEmpty()) {
              for (Customer cust : coll) {
                  jTextField1.setText(cust.getName());
                  jTextField2.setText(cust.getCity());
              }
          } else {
              jTextField1.setText("[no name]");
              jTextField2.setText("[no city]");
          }
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>После определения элемента LookupListener можно добавить его в  <code>Lookup.Result</code> , полученный из глобального контекста. Глобальный контекст используется в качестве прокси для контекста выбранного узла. Например, если в древовидной иерархии выбран узел Ford Motor Co, объект  <code>Customer</code>  для него добавляется в окно Lookup элемента Node. Так как в настоящий момент выбран узел Ford Motor Co, объект  <code>Customer</code>  для него доступен сейчас в глобальном контексте. Это передается в элемент  <code>resultChanged</code>  и приводит к заполнению текстовых полей.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Измените методы  <code>componentOpened</code>  и  <code>componentClosed</code> , чтобы активировать LookupListener, когда откроется окно редактора.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">      @Override
      public void componentOpened() {
          result = WindowManager.getDefault().findTopComponent("CustomerTopComponent").getLookup().lookupResult(Customer.class);
          result.addLookupListener(this);
          resultChanged(new LookupEvent(result));
      }

      @Override
      public void componentClosed() {
          result.removeLookupListener(this);
          result = null;
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Так как окно редактора открывается при запуске приложения, элемент LookupListener становится тоже доступен в этот момент.</p>
</div>
<div class="paragraph">
<p>В этом упражнении используется локальное окно Lookup, предоставленное окном Customer. В этом случае окно явно определяется строкой " <code>CustomerTopComponent</code> ". Строка определяется в исходном коде  <code>CustomerTopComponent</code>  как идентификатор элемента CustomerTopComponent. Данный подход работает только в том случае, если MyEditorTopComponent может найти компонент TopComponent с идентификатором "CustomerTopComponent".</p>
</div>
<div class="paragraph">
<p>Более гибкий подход, включающий в себя перезапись модели выбора, описывается в  <a href="http://weblogs.java.net/blog/timboudreau/archive/2007/01/how_to_replace.html">сообщении блога Тима Будро</a>.</p>
</div>
<div class="paragraph">
<p>После выполнения команды "Очистить и построить вместе с зависимостями" можно повторно запустить приложение. Теперь окно редактора обновляется каждый раз при выборе нового элемента Node в окне Customer. Так как теперь вместо  <code>BeanNode</code>  используется  <code>AbstractNode</code> , в окне "Свойства" нет свойств.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Добавление_функций_Отменить_и_Вернуть">Добавление функций "Отменить" и "Вернуть"</h3>
<div class="paragraph">
<p>В этом упражнении с помощью диспетчера  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/UndoRedo.html">UndoRedo</a></code>  будут включены функции "Отменить" и "Вернуть". Кнопки "Отменить" и "Вернуть" на панели инструментов и соответствующие пункты меню включаются после изменения одного из полей в окне редактора.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Объявите и создайте новый экземпляр диспетчера UndoRedoManager в верхней части компонента MyEditorTopComponent.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private UndoRedo.Manager manager = new UndoRedo.Manager();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Создайте метод  <code>getUndoRedo</code>  в компоненте MyEditorTopComponent:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
public UndoRedo getUndoRedo() {
    return manager;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте в конструктор следующие элементы:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">jTextField1.getDocument().addUndoableEditListener(manager);
jTextField2.getDocument().addUndoableEditListener(manager);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Запустите приложение для проверки правильной работы кнопок "Отменить" и "Вернуть" и соответствующих пунктов меню.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Добавление_функции_Сохранить">Добавление функции "Сохранить"</h3>
<div class="paragraph">
<p>В этом упражнении будут интегрированы функции сохранения платформы NetBeans. Будет изменен файл <code>layer.xml</code> , чтобы скрыть кнопку "Сохранить все" и добавить кнопку "Сохранить" на панели инструментов. Затем будут добавлены прослушивающие процессы для определения изменений в текстовых полях и метод  <code>fire</code> , инициируемый при обнаружении изменения.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Откройте и измените файл  <code>layer.xml</code>  модуля <strong>dbaccess</strong>, чтобы добавить элемент панели инструментов.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">    *&lt;folder name="Toolbars"&gt;
      &lt;folder name="File"&gt;
          &lt;file name="org-openide-actions-SaveAction.shadow"&gt;
              &lt;attr name="originalFile" stringvalue="Actions/System/org-openide-actions-SaveAction.instance"/&gt;
              &lt;attr name="position" intvalue="444"/&gt;
          &lt;/file&gt;
          &lt;file name="org-openide-actions-SaveAllAction.shadow_hidden"/&gt;
      &lt;/folder&gt;
    &lt;/folder&gt;*
&lt;/filesystem&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В конструкторе <strong>MyEditorTopComponent</strong> добавьте вызов метода при каждом обнаружении изменений в текстовых полях.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public MyEditorTopComponent() {

          ...
    jTextField1.getDocument().addUndoableEditListener(manager);
    jTextField2.getDocument().addUndoableEditListener(manager);

    *jTextField1.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

    jTextField2.getDocument().addDocumentListener(new DocumentListener() {
        public void insertUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void removeUpdate(DocumentEvent arg0) {
          fire(true);
        }
        public void changedUpdate(DocumentEvent arg0) {
          fire(true);
        }
    });

//Создание экземпляра реализации SaveCookie:
    impl = new SaveCookieImpl();

    //Создание экземпляра динамического объекта:
    content = new InstanceContent();

    //Добавление динамического объекта в верхнюю часть TopComponent Lookup:
    associateLookup(new AbstractLookup(content));*

    ...
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте метод  <code>fire</code> , вызываемый всякий раз при обнаружении изменений.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void fire(boolean modified) {
  if (modified) {
      //Если текст изменен,
      //к Lookup добавляется реализация SaveCookie:
      content.add(impl);
  } else {
      //В противном случае реализация SaveCookie удаляется из lookup:
      content.remove(impl);
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Добавьте следующую реализацию  <code> <a href="http://bits.netbeans.org/dev/javadoc/org-openide-nodes/org/openide/cookies/SaveCookie.html">SaveCookie</a></code> , которая была ранее добавлена к  <code>InstanceContent</code>  с помощью метода  <code>fire</code> .</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private class SaveCookieImpl implements SaveCookie {

  @Override
  public void save() throws IOException {

     Confirmation message = new NotifyDescriptor.Confirmation("Сохранить \""
              + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
              NotifyDescriptor.OK_CANCEL_OPTION,
              NotifyDescriptor.QUESTION_MESSAGE);

      Object result = DialogDisplayer.getDefault().notify(message);
      //Если пользователь намерен сохранить и нажимает "Да",
      //необходимо отключить действие Save,
      //таким образом оно будет доступно только при наличии изменений
      //текстового поля:
      if (NotifyDescriptor.YES_OPTION.equals(result)) {
          fire(false);
          //Реализация функций сохранения.
      }
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Добавьте в компонент MyEditorTopComponent следующие поля:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private final SaveCookieImpl impl;
private final InstanceContent content;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Исправьте операторы импорта и сохраните измененные данные.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Щелкните правой кнопкой мыши файл JAR  <code>org-openide-dialogs</code>  в узле "Библиотеки" в окне "Проекты" и выберите команду "Объявить как прямую зависимость".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь можно очистить приложение, построить его вместе с зависимостями и запустить для подтверждения включения кнопки "Сохранить" при изменении текстового поля.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Сохранение_измененных_данных">Сохранение измененных данных</h3>
<div class="paragraph">
<p>В следующем упражнении будет добавлен код для сохранения измененных данных. Сейчас приложение правильно распознает внесение изменений в поля и включает параметр сохранения изменений. При нажатии кнопки "Сохранить" появляется диалоговое окно с запросом на подтверждение сохранения измененных данных. Однако изменения не сохраняются при нажатии в диалоговом окне кнопки "ОК". Чтобы сохранить данные, необходимо добавить код JPA для выполнения сохранения в базу данных.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Добавьте следующее поле в компонент <strong>MyEditorTopComponent</strong>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Customer customer;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Добавьте код JPA для сохранения изменений, изменив метод  <code>save</code> , чтобы заменить комментарий  <code>"//Реализация функций сохранения." </code> следующим кодом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
public void save() throws IOException {
...
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        *EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
        entityManager.getTransaction().begin();
        Customer c = entityManager.find(Customer.class, customer.getCustomerId());
        c.setName(jTextField1.getText());
        c.setCity(jTextField2.getText());
        entityManager.getTransaction().commit();*
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Убедитесь в том, что имя единицы сохранения состояния введено правильно.</p>
</div>
<div class="paragraph">
<p>Значение "customer" в  <code>customer.getCustomerId()</code>  в настоящее время не определено. Затем установите значение  <code>customer</code>  для настоящего объекта  <code>Customer</code> , используемого для получения идентификатора Customer.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте следующую строку, выделенную полужирным шрифтом, в метод  <code>resultChanged</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
public void resultChanged(LookupEvent le) {
    Lookup.Result r = (Lookup.Result) le.getSource();
    Collection&lt;Customer&gt; coll = r.allInstances();
    if (!coll.isEmpty()) {
      for (Customer cust : coll) {
          *customer = cust;*
          jTextField1.setText(cust.getName());
          jTextField2.setText(cust.getCity());
      }
    } else {
      jTextField1.setText("[no name]");
      jTextField2.setText("[no city]");
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Исправьте операторы импорта и сохраните измененные данные.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Запустите приложение и измените некоторые данные, чтобы проверить правильность работы функции сохранения при наличии изменений. В настоящий момент редактор не обновляет поля для отражения измененных данных. Чтобы проверить, все ли данные сохранены, необходимо перезапустить приложение.</p>
</div>
<div class="paragraph">
<p>В следующем упражнении будет добавлена функция "Обновить", перезагружающая данные из базы данных и отражающая изменения в редакторе.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Добавление_функции_Обновить">Добавление функции "Обновить"</h3>
<div class="paragraph">
<p>В этом упражнении будет добавлена функция обновления средства просмотра Customer путем добавления позиции меню "Обновить" в корневой узел в окне Customer.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши пакет  <code><strong>com.mycompany.mavenplatformcrudapp.viewer</strong></code> , выберите "Создать" &gt; "Класс Java" и создайте класс с именем <strong>CustomerRootNode.</strong></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Измените этот класс, чтобы расширить узел  <code>AbstractNode</code>  и добавить следующие методы:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class CustomerRootNode extends AbstractNode {

    *public CustomerRootNode(Children kids) {
      super(kids);
      setDisplayName("Root");
    }

    @Override
    public Action[] getActions(boolean context) {
      Action[] result = new Action[]{
          new RefreshAction()};
      return result;
    }

    private final class RefreshAction extends AbstractAction {

      public RefreshAction() {
          putValue(Action.NAME, "Refresh");
      }

      public void actionPerformed(ActionEvent e) {
          CustomerTopComponent.refreshNode();
      }
    }*

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что действие "Обновить" привязано к новому узлу Root.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Исправьте операторы импорта для импорта * <code>javax.swing.Action</code> *. Сохраните изменения.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Измените компонент <strong>CustomerTopComponent</strong>, чтобы добавить для обновления представления следующий метод:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public static void refreshNode() {
    EntityManager entityManager = Persistence.createEntityManagerFactory("com.mycompany_MavenPlatformCRUDApp-dbaccess_nbm_1.0-SNAPSHOTPU").createEntityManager();
    Query query = entityManager.createQuery("SELECT c FROM Customer c");
    List&lt;Customer&gt; resultList = query.getResultList();
    em.setRootContext(new *CustomerRootNode*(Children.create(new CustomerChildFactory(resultList), true)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на то, что метод использует элемент <strong>CustomerRootNode</strong> для настройки корневого контекста.</p>
</div>
<div class="paragraph">
<p>Если необходимо создание скелетного метода средой IDE, нажмите в классе  <code>CustomerRootNode</code>  в строке, содержащей элемент  <code>refreshNode</code> , сочетание клавиш ALT+ВВОД.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Измените код в конструкторе CustomerTopComponent с вызовом <strong>CustomerRootNode</strong> вместо <strong>AbstractNode</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При вызове  <code>CustomerRootNode</code>  автоматически вызываются метод  <code>refreshNode</code>  и команда "Обновить".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Исправьте операторы импорта и сохраните измененные данные.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При запуске приложения в контекстном меню становится доступен новый корневой узел с действием "Обновить".</p>
</div>
<div class="paragraph">
<p>Можно использовать метод  <code>refreshNode</code>  и реализовать автоматическое обновление, вызвав метод  <code>refreshNode</code>  из метода  <code>save</code> . Другой вариант заключается в создании отдельного модуля, содержащего действие обновления, который будет совместно использоваться другими модулями.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Создание_добавление_новой_записи">Создание: добавление новой записи</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе пользователю предоставляется возможность создания новой записи базы данных.</p>
</div>
<div class="sect2">
<h3 id="_Добавление_действия_Создать">Добавление действия "Создать"</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши модуль <strong>dbaccess</strong> и выберите "Создать" &gt; "Действие".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Укажите параметр "Всегда включено". Нажмите кнопку "Далее".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>В контекстном меню "Категория" выберите <strong>Файл</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Выберите "Глобальная кнопка панели инструментов". Нажмите кнопку "Далее".
image::images/mavencrud-new-action.png[title="Панель "Регистрация в интерфейсе" в мастере создания действия"]</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>В поле "Имя класса" введите <strong>NewAction</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>В поле "Отображаемое имя" введите <strong>My New Action</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Нажмите кнопку "Обзор" и выберите изображение, которое будет использоваться на панели инструментов.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Можно скопировать изображение  <code>abc16.png</code>  в рабочей среде и указать его в мастере.
image::images/abc16.png[title="Пример значка 16x16"]</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Выберите пакет <strong>com.mycompany.mavenplatformcrudapp.editor</strong>. Нажмите кнопку "Готово".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Измените класс  <code>NewAction</code> , чтобы открыть компонент MyEditorTopComponent и очистить поля.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public final class NewAction implements ActionListener {

    public void actionPerformed(ActionEvent e) {
        MyEditorTopComponent tc = MyEditorTopComponent.getDefault();
        tc.resetFields();
        tc.open();
        tc.requestActive();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это действие реализует класс ActionListener, привязанный к приложению через записи в файле layer, размещенном там мастером создания действия.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Создание_и_сохранение_нового_объекта">Создание и сохранение нового объекта</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>В компоненте <strong>MyEditorTopComponent</strong> добавьте следующий метод для сброса текстовых полей JTextField и создания нового объекта  <code>Customer</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void resetFields() {
    customer = new Customer();
    jTextField1.setText("");
    jTextField2.setText("");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Если необходимо создание скелетного метода средой IDE в компоненте MyEditorTopComponent, нажмите в классе  <code>NewAction</code>  в вызове  <code>resetFields</code>  сочетание клавиш ALT+ВВОД.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В SaveCookie возвращаемое значение "null" должно соответствовать сохранению новой записи, а не обновлению существующей:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void save() throws IOException {

    Confirmation message = new NotifyDescriptor.Confirmation("Сохранить \""
                  + jTextField1.getText() + " (" + jTextField2.getText() + ")\"?",
                  NotifyDescriptor.OK_CANCEL_OPTION,
                  NotifyDescriptor.QUESTION_MESSAGE);

    Object result = DialogDisplayer.getDefault().notify(msg);

    //Если пользователь намерен сохранить, и нажимает "Да",
    //следует отключить кнопку "Сохранить" и команду меню "Сохранить",
    //чтобы они могли использоваться только при внесении следующего изменения
    //в текстовом поле:
    if (NotifyDescriptor.YES_OPTION.equals(result)) {
        fire(false);
        EntityManager entityManager = Persistence.createEntityManagerFactory("CustomerLibraryPU").createEntityManager();
        entityManager.getTransaction().begin();
        *if (customer.getCustomerId() != null) {*
            Customer c = entityManager.find(Customer.class, cude.getCustomerId());
            c.setName(jTextField1.getText());
            c.setCity(jTextField2.getText());
            entityManager.getTransaction().commit();
        *} else {
            Query query = entityManager.createQuery("SELECT c FROM Customer c");
            List&lt;Customer&gt; resultList = query.getResultList();
            customer.setCustomerId(resultList.size()+1);
            customer.setName(jTextField1.getText());
            customer.setCity(jTextField2.getText());
            //добавление полей для заполнения столбцов zip и discountCode
            customer.setZip("12345");
            customer.setDiscountCode(entityManager.find(DiscountCode.class, 'H'));

            entityManager.persist(customer);
            entityManager.getTransaction().commit();
        }*
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот код также записывает произвольные данные в DiscountCode, так как это поле не может быть пустым.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Исправьте операторы импорта для импорта  <code><strong>javax.persistence.Query</strong></code> . Сохраните изменения.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Построение_и_запуск_приложения">Построение и запуск приложения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Теперь приложение выполняет три функции CRUD: создание, чтение и обновление. Теперь можно построить и запустить приложение, чтобы проверить, правильно ли выполняются все эти функции.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните правой кнопкой мыши узел проекта <strong>Приложение на базе платформы NetBeans MavenPlatformCRUDApp</strong> и выберите команду "Очистить".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Щелкните правой кнопкой мыши узел проекта <strong>Приложение на базе платформы NetBeans MavenPlatformCRUDApp</strong> и выберите команду "Построить вместе с зависимостями".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Щелкните правой кнопкой мыши узел проекта <strong>Приложение на базе платформы NetBeans MavenPlatformCRUDApp</strong> и выберите команду "Выполнить".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>При нажатии кнопки "Выполнить" среда IDE запускает приложение на платформе. Приложение заполняет дерево в окне Customer именами клиентов в базе данных. При выборе узла в окне Customer в окне My Editor отражаются имя и город выбранного клиента. Можно изменить и сохранить данные в полях "Имя" и "Город". Чтобы создать нового клиента, нажмите кнопку My Action на панели инструментов, заполните пустые текстовые поля "Имя" и "Город" в окне My Editor и нажмите "Сохранить".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mavencrud-finished-app.png" alt="mavencrud finished app">
</div>
<div class="title">Figure 10. В готовом приложении отражаются окна Customer и MyEditor</div>
</div>
<div class="paragraph">
<p>После создания или изменения клиента необходимо обновить корневой узел в окне Customer, если действие "Обновить" не было реализовано при сохранении.</p>
</div>
<div class="paragraph">
<p>В этом учебном курсе рассмотрены принципы создания приложения на платформе NetBeans с помощью Maven, которые во многом совпадают с принципами создания приложения с помощью Ant. Основное отличие заключается в том, что Maven POM управляет процессом сборки приложения. Дополнительные примеры построения приложений и модулей на платформе NetBeans приведены в учебных курсах  <a href="https://netbeans.apache.org/kb/docs/platform.html">Учебной карты по платформе NetBeans</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Дополнительные_сведения">Дополнительные сведения</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Это заключительный раздел учебного курса CRUD. В этом документе были описаны принципы использования платформы построения Maven для создания нового приложения на платформе NetBeans с функциональностью CRUD. Дополнительные сведения о создании и разработке приложений приведены в следующих ресурсах:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform_ru.html">Учебная карта по платформе NetBeans</a></p>
</li>
<li>
<p><a href="http://bits.netbeans.org/dev/javadoc/">Документация Javadoc по интерфейсам API в среде NetBeans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Если у вас возникли вопросы по платформе NetBeans, можно отправить их в список рассылки <a href="mailto:dev@platform.netbeans.org">dev@platform.netbeans.org</a> либо ознакомиться с  <a href="https://netbeans.org/projects/platform/lists/dev/archive">Архивом списка рассылки по платформе NetBeans</a>.</p>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/691/nbm-maven-crud_ru.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2019 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
