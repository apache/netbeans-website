
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>NetBeans Java 言語インフラストラクチャーのチュートリアル</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NetBeans Java 言語インフラストラクチャーのチュートリアル - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, NetBeans Java 言語インフラストラクチャーのチュートリアル">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 18</h1>
            <p><a class="button success" href="/download/nb18/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">NetBeans Java 言語インフラストラクチャーのチュートリアル</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-copyfqn_ja.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_java_言語インフラストラクチャーについて">Java 言語インフラストラクチャーについて</a></li>
<li><a href="#_モジュールの設定">モジュールの設定</a></li>
<li><a href="#_コンテキストを区別するツールバーボタンの作成">コンテキストを区別するツールバーボタンの作成</a></li>
<li><a href="#_java_ソースファイルの識別">Java ソースファイルの識別</a></li>
<li><a href="#_開いている状態の判定">開いている状態の判定</a></li>
<li><a href="#_キャレットの下の要素の検出">キャレットの下の要素の検出</a></li>
<li><a href="#_便利な使い方">便利な使い方</a></li>
<li><a href="#_関連項目">関連項目</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このチュートリアルでは、新しい NetBeans 6.0「Retouche」API について学習します。この API によって NetBeans Java エディタにアクセスできるようになります。</p>
</div>
<div class="paragraph">
<p>トラブルシューティングのために、 <a href="http://plugins.netbeans.org/PluginPortal/faces/PluginDetailPage.jsp?pluginid=2753">完了したサンプルをダウンロード</a>してソースを調べることもできます (任意)。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_言語インフラストラクチャーについて">Java 言語インフラストラクチャーについて</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans IDE 6.0 より以前は、Java コード生成および Java リファクタリングを含め、Java エディタをサポートする Java 言語インフラストラクチャーは、JMI for Java と呼ばれるもの (「MDR」ともいう) に基づいていました。JMI for Java には、単一の読み取りに対するロックなど、いくつかの構造上の問題点がありました。つまり、モデルから情報を読み取るだけの場合もロックされるわけですが、これは通常は書き込み時にのみ必要なものです。数年かけて JMI はデバッグされ、パフォーマンスに関しては改善されています。しかし、自身の Java パーサーの内部コピーを使用するという問題が残っています。つまり、Java ソースを独自の手法で解釈するため JDK の Java コンパイラとは異なることになります。より複雑で繊細な Java の概念を取り入れた JDK 5 が汎用的に導入され、その違いを処理することがいっそう困難になっています。このように、JMI のパフォーマンスに関して問題があること、また 正式な言語モデルが JDK Java コンパイラをプログラムのツールとして活用するように開発されていることから、JMI for Java が廃止され JDK Java コンパイラに基づく新しい手法が取り入れられました。</p>
</div>
<div class="paragraph">
<p>こうして Retouche が生まれました。Retouche とはフランス語で「改良」を意味します。Retouche は、NetBeans IDE における新しい高速の Java 言語インフラストラクチャーです。NetBeans 6.0 で実現された優れた Java エディタの機能をすべてサポートしています。本質的に、Retouche は JDK Java コンパイラのインスタンスをラップし、たとえば抽象構文ツリー (AST と呼ぶ) や解析のさまざまな段階で発生するシンボリックの解決といった、自身のアーティファクトを消費します。Retouche を使用するときには、それらのアーティファクトをいくつか取り扱う必要があります。たとえば、 <a href="http://java.sun.com/javase/6/docs/jdk/api/javac/tree/index.html">コンパイラツリー API</a> はそれらの 1 つです。コンパイラツリー API のクラスのパッケージは  <code>com.sun.<strong></code>  と命名されています。したがって、技術的にはこれは非 JDK API ですが、JDK Java に由来するものです。Retouche の使用に伴う JDK Java コンパイラのアーティファクトの別の例として、JDK API における正式言語モデルがあげられます。これは、 <code>javax.language.model.</strong></code>  パッケージに含まれています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_モジュールの設定">モジュールの設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、ウィザードを使用してモジュールプロジェクトを作成し、関係する NetBeans モジュールとの依存関係を設定します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>「ファイル」&gt;「新規プロジェクト」を選択します。「新規プロジェクト」ウィザードで、「カテゴリ」の下にある「NetBeans モジュール」と「プロジェクト」の下にある「モジュールプロジェクト」を選択し、「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>「プロジェクト名」に「 <code>CopyFQN</code> 」と入力し、「プロジェクトの場所」をディスク上の適切なフォルダに設定します。「スタンドアロンモジュール」および「主プロジェクトとして設定」が選択されていない場合は、それらを選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「コード名ベース」に「 <code>org.netbeans.modules.copyfqn</code> 」、「モジュール表示名」に「 <code>CopyFQN</code> 」と入力します。「完了」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>プロジェクトを右クリックして「プロパティー」を選択し、「プロジェクトプロパティー」ダイアログで「ライブラリ」をクリックして次の API との依存関係を宣言します。</p>
<div class="ulist">
<ul>
<li>
<p>データシステム API</p>
</li>
<li>
<p>エディタライブラリ 2</p>
</li>
<li>
<p>ファイルシステム API</p>
</li>
<li>
<p>Javac API ラッパー</p>
</li>
<li>
<p>Java ソース</p>
</li>
<li>
<p>ノード API</p>
</li>
<li>
<p>テキスト API</p>
</li>
<li>
<p>UI ユーティリティー API</p>
</li>
<li>
<p>ユーティリティー API</p>
</li>
<li>
<p>ウィンドウシステム API</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>次のような表示になります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_proj-props-copyfqn-60.png" alt="copyfqn proj props copyfqn 60">
</div>
</div>
<div class="paragraph">
<p>「了解」をクリックします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_コンテキストを区別するツールバーボタンの作成">コンテキストを区別するツールバーボタンの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、ツールバー上にコンテキスト認識ボタンを作成します。新しい Retouche API とは関係ありませんが、このチュートリアルのあとのほうで、Retouche API の実装と相互に作用するためのユーザーインタフェース要素を提供します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>モジュールプロジェクトを右クリックして「新規」&gt;「その他」を選択し、「モジュールの開発」カテゴリの「アクション」を選択します。「次へ」をクリックします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>次に示すように、「条件付で有効」を選択してすべての項目をデフォルトのままにします。これによってアクションは  <code>DataObjects</code>  を区別できるようになり、 <code>DataObject</code>  が 1 つ選択されたときにだけ有効になります。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_cookie-action-60.png" alt="copyfqn cookie action 60">
</div>
</div>
<div class="paragraph">
<p>「次へ」をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>「カテゴリ」で「編集」を、「ツールバー」で「編集」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>画面は次のようになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_gui-registration-60.png" alt="copyfqn gui registration 60">
</div>
</div>
<div class="paragraph">
<p>「次へ」をクリックします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>「クラス名」に「 <code>CopyFQNAction</code> 」、「表示名」に「 <code>CopyFQN</code> 」と入力します。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>ツールバーボタンとして表示されるアイコンを参照します。例として、このチュートリアルで使用されているものを使用します。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_icon.png" alt="copyfqn icon">
</div>
</div>
<div class="paragraph">
<p>「完了」をクリックします。</p>
</div>
<div class="paragraph">
<p>新しい  <code>CopyFQNAction.java</code>  クラスに、次のようなコードが見つかるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class CopyFQNAction extends CookieAction {

    protected void performAction(Node[] activatedNodes) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        // TODO dataObject を使用
    }

    protected int mode() {
        return CookieAction.MODE_EXACTLY_ONE;
    }

    public String getName() {
        return NbBundle.getMessage(CopyFQNAction.class, "CTL_CopyFQNAction");
    }

    protected Class[] cookieClasses() {
        return new Class[] {
            DataObject.class
        };
    }

    protected String iconResource() {
        return "org/netbeans/modules/copyfqn/icon.png";
    }

    public HelpCtx getHelpCtx() {
        return HelpCtx.DEFAULT_HELP;
    }

    protected boolean asynchronous() {
        return false;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このあと、このチュートリアルでは、すべてこの  <code>performAction()</code>  メソッドに重点を置いて進めます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>これで、データオブジェクトを区別するアクションが作成されました。続いて、その働きについて確認します。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>モジュールを右クリックして「インストール」を選択します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>モジュールがインストールされると、ツールバーに新しいボタンが表示されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>「プロジェクト」ウィンドウでノードを選択してから、ツールバーのボタンを確認します。ファイルまたはフォルダ (パッケージを含む) を示すノードを選択した場合は、次に示すようにボタンが使用可能になっています。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-on.png" alt="copyfqn ctx sensitive on">
</div>
</div>
<div class="paragraph">
<p>一方、プロジェクトを示すノードを選択した場合は、次に示すようにボタンは使用できなくなっています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-off.png" alt="copyfqn ctx sensitive off">
</div>
</div>
<div class="paragraph">
<p>次の節では、ここで確認したプロジェクトノードと、ファイルノードまたはフォルダノードの区別だけでなく、Java クラスのファイルノードとその他すべての種類のファイルノードの区別について学習します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_ソースファイルの識別">Java ソースファイルの識別</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、 <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/overview-summary.html">Java ソース</a>と呼ばれる、新しい Retouche API の 1 つを使用します。ここで使用する  <a href="https://bits.netbeans.org/dev/javadocorg-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html">JavaSource</a> クラスは、Java ソースファイルを表しています。使用中のデータオブジェクトに関連付けられたファイルオブジェクトの、このクラスのインスタンスを返します。null が返された場合は、ファイルオブジェクトは Java ソースファイルではありません。ファイルが選択されている状態でボタンをクリックすると、ステータスバーに結果が表示されるようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>performAction()</code>  メソッドに、次に示す強調表示された行を追加します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // TODO dataObject を使用

    *FileObject fileObject = dataObject.getPrimaryFile();

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html[JavaSource] javaSource =  link:https://bits.netbeans.org/dev/javadocorg-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#forFileObject(org.openide.filesystems.FileObject)[JavaSource.forFileObject(fileObject)];
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
    } else {
        StatusDisplayer.getDefault().setStatusText("Hurray! A Java file: " + fileObject.getPath());
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>インポート文が次のようになっていることを確認します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import org.netbeans.api.java.source.JavaSource;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>モジュールをもう一度インストールします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>ファイルノードを選択し、ボタンを押します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次に示すように、Java ファイルを選択したときだけ「Hurray!」のメッセージが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-60.png" alt="copyfqn message java file 60">
</div>
</div>
<div class="paragraph">
<p>別の手法として、_Java ファイルが選択されたときにだけボタンを使用可能にする_という方法もあります。これを実装するには、次のように  <code>CookieAction.enable()</code>  メソッドをオーバーライドします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected boolean enable(Node[] activatedNodes) {
    if (super.enable(activatedNodes)) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        FileObject fileObject = dataObject.getPrimaryFile();
        JavaSource javaSource = JavaSource.forFileObject(fileObject);
        if (javaSource == null) {
            return false;
        }
        return true;
    }
    return false;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このメソッドは、Java ファイル_以外_のすべてのファイルをフィルタで除外します。これによって、現在のファイルが Java ファイルであるときだけボタンが使用可能になります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_開いている状態の判定">開いている状態の判定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、はじめて明示的に呼び出された Retouche タスクを取り扱います。このようなタスクは JavaSource クラスの  <code>runUserActionTask</code>  メソッドによってもたらされます。この種のタスクによって、構文解析の段階を制御できるようになります。これは、ユーザーの入力にすぐに応答する際に適用できます。タスク内で行われることはすべて単体として処理されます。ここでは、ツールバーのボタンによって表されるアクションの呼び出しのあと、すぐにステータスバーのテキストを表示するようにします。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><code>performAction()</code>  メソッドの「Hurray!」メッセージを次の行に置き換えます。 <a href="http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#runUserActionTask(org.netbeans.api.java.source.Task,%20boolean)">javaSource.runUserActionTask</a></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">(new  link:http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/Task.html[Task]&lt; link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html[CompilationController]&gt;());</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで、次に示すような電球がエディタの左側のバーに表示されるはずです。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_runuserasactiontask-60.png" alt="copyfqn runuserasactiontask 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>電球をクリックします。あるいは、その行にキャレットを置いて Alt-Enter キーを押します。これで、IDE によってメソッドが実装されます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>メソッドの最後に  <code>true</code>  の Boolean を加え、IDE が try/catch ブロックのスニペットをラップするように変更します。コードは次のようになります。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // TODO dataObject を使用

    FileObject fileObject = dataObject.getPrimaryFile();

    JavaSource javaSource = JavaSource.forFileObject(fileObject);
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
     } else {

            *try {
                javaSource.runUserActionTask(new Task&lt;CompilationController&gt;() {

                    public void run(CompilationController arg0) throws Exception {
                        throw new UnsupportedOperationException("Not supported yet.");
                    }
                }, true);
            } catch (IOException ex) {
                Exceptions.printStackTrace(ex);
            }*

     }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>次のように、 <code>run()</code>  メソッドを実装します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#toPhase(org.netbeans.api.java.source.JavaSource.Phase)[compilationController.toPhase(Phase.ELEMENTS_RESOLVED)];

link:https://docs.oracle.com/javase/1.5.0/docs/api/javax/swing/text/Document.html[Document] document =  link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#getDocument()[compilationController.getDocument()];
      if (document != null) {
         StatusDisplayer.getDefault().setStatusText("Hurray, the Java file is open!");
      } else {
         StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
      }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>インポート文が次のようになっていることを確認します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.swing.text.Document;
import org.netbeans.api.java.source.CompilationController;
import org.netbeans.api.java.source.JavaSource;
import org.netbeans.api.java.source.JavaSource.Phase;
import org.netbeans.api.java.source.Task;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>モジュールをもう一度インストールします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>ファイルノードを選択し、ボタンを押します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次に示すように、Java エディタで開いている Java ファイルを選択するときだけ「Hurray!」のメッセージが表示されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-open-60.png" alt="copyfqn message java file open 60">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_キャレットの下の要素の検出">キャレットの下の要素の検出</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、Java ファイルを取り扱っていてそれが開いている状態であるため、随時キャレットの下の要素の型を検出できます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>はじめに入出力 API との依存関係を宣言すると、「出力」ウィンドウに結果を出力できます。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><code>run()</code>  メソッドの「Hurray!」のメッセージを、次に示す強調表示された行に置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

    compilationController.toPhase(Phase.ELEMENTS_RESOLVED);
    Document document = compilationController.getDocument();

    if (document != null) {
        *new MemberVisitor(compilationController).scan(compilationController.getCompilationUnit(), null);*
    } else {
        StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>また、ここに示す  <code>MemberVisitor</code>  クラスは、 <code>CopyFQNAction</code>  クラスの内部クラスとして定義されます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    @Override
    public Void visitClass(ClassTree t, Void v) {
        Element el = info.getTrees().getElement(getCurrentPath());
        if (el == null) {
            StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
        } else {
            TypeElement te = (TypeElement) el;
            List enclosedElements = te.getEnclosedElements();
            InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                        + info.getFileObject().getName(), true);
            for (int i = 0; i &lt; enclosedElements.size(); i++) {
            Element enclosedElement = (Element) enclosedElements.get(i);
                if (enclosedElement.getKind() == ElementKind.CONSTRUCTOR) {
                    io.getOut().println("Constructor: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.METHOD) {
                    io.getOut().println("Method: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.FIELD) {
                    io.getOut().println("Field: "
                        + enclosedElement.getSimpleName());
                } else {
                    io.getOut().println("Other: "
                        + enclosedElement.getSimpleName());
                }
            }
            io.getOut().close();
        }
        return null;
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>モジュールをもう一度インストールし、Java クラスを開きます。そのあとで、ボタンをクリックすると、次のようにコンストラクタ、メソッド、およびフィールドが「出力」ウィンドウに示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_output-window-60.png" alt="copyfqn output window 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>次に、「出力」ウィンドウにすべての要素を出力するのではなく、キャレットの下にある要素だけを出力します。 <code>visitClass</code>  メソッドを、次に示す強調表示されたコードに置き換えるだけです。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    *@Override
    public Void visitClass(ClassTree t, Void v) {
        try {
            JTextComponent editor = EditorRegistry.lastFocusedComponent();
            if (editor.getDocument() == info.getDocument()) {
                int dot = editor.getCaret().getDot();
                TreePath tp = info.getTreeUtilities().pathFor(dot);
                Element el = info.getTrees().getElement(tp);
                if (el == null) {
                    StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
                } else {
                    InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                            + info.getFileObject().getName(), true);
                    if (el.getKind() == ElementKind.CONSTRUCTOR) {
                        io.getOut().println("Hurray, this is a constructor: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.METHOD) {
                        io.getOut().println("Hurray, this is a method: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.FIELD) {
                        io.getOut().println("Hurray, this is a field: "
                            + el.getSimpleName());
                    } else {
                        io.getOut().println("Hurray, this is something else: "
                            + el.getSimpleName());
                    }
                    io.getOut().close();
                }
            }
        } catch (IOException ex) {
            Exceptions.printStackTrace(ex);
        }
        return null;
    }*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>モジュールをインストールします。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Java コードの任意の場所にキャレットを置き、ボタンを押します。「出力」ウィンドウに、キャレットの下にあるコードに関する情報がある場合には、それが表示されます。たとえば、メソッド内にキャレットを置いたあとにボタンを押すと、「出力」ウィンドウには、次のように、キャレットがメソッド内にあることが表示されます。</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-constructor-60.png" alt="copyfqn message constructor 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>キャレットの下にある要素の名前だけでなく、より多くの情報を検出することもできます。 <code>visitClass</code>  メソッドで、次に示す太字の行に置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public Void visitClass(ClassTree t, Void v) {
    try {
        JTextComponent editor = EditorRegistry.lastFocusedComponent();
        if (editor.getDocument() == info.getDocument()) {
            int dot = editor.getCaret().getDot();
            TreePath tp = info.getTreeUtilities().pathFor(dot);
            Element el = info.getTrees().getElement(tp);
            if (el == null) {
                StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
            } else {
                InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                    + info.getFileObject().getName(), true);
                *String te = null;
                if (el.getKind() == ElementKind.CONSTRUCTOR) {
                    te = ((TypeElement) ((ExecutableElement) el).getEnclosingElement()).getQualifiedName().toString();
                    io.getOut().println("Hurray, this is a constructor's qualified name: " + te);
                } else if (el.getKind() == ElementKind.METHOD) {
                    te = ((ExecutableElement) el).getReturnType().toString();
                    io.getOut().println("Hurray, this is a method's return type: " + te);
                } else if (el.getKind() == ElementKind.FIELD) {
                    te = ((VariableElement) el).asType().toString();
                    io.getOut().println("Hurray, this is a field's type: " + te);
                }* else {
                    io.getOut().println("Hurray, this is something else: "
                        + el.getSimpleName());
                }
                io.getOut().close();
            }
        }
    } catch (IOException ex) {
        Exceptions.printStackTrace(ex);
    }
    return null;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>モジュールをもう一度インストールします。今度は、キャレットが、コンストラクタ、メソッド、あるいはフィールドの上にあるときにボタンをクリックすると、「出力」ウィンドウに要素に関するより詳細な情報が表示されます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ここでは、Java ファイルを取り扱っているかどうか、ドキュメントが開いているかどうか、また、キャレットの下の要素の型を検出できることを学習しました。しかし、この情報をどのように使ったらよいのでしょうか。次の節では、この新たに学習したことが役に立つことがわかる簡単なシナリオを紹介します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_便利な使い方">便利な使い方</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この節では、 <code>java.awt.datatransfer.Clipboard</code>  にあるクリップボードの内容が、キャレットの下にある要素に基づくように設定します。ボタンを押すと、キャレットの下にある要素がクリップボードにコピーされ、コード内の任意の場所にその内容をペーストできます。</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>次に示すように、はじめにクリップボードの宣言を行い、コンストラクタを定義します。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Clipboard clipboard;

public CopyFQNAction() {
    clipboard = Lookup.getDefault().lookup(ExClipboard.class);
    if (clipboard == null) {
        clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>次に、コード内の「Hurray!」の行を、次の手順で定義するメソッドに文字列として要素を送信する行に置き換えます。 <code>setClipboardContents</code>  メソッドを呼び出すことになります。したがって、たとえば、最初の「Hurray!」の行を次に置き換えます。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">setClipboardContents(te);</code></pre>
</div>
</div>
<div class="paragraph">
<p>ほかの「Hurray!」の行についても同様のことを行い、必ずメソッドに正しい文字列が渡されるようにします。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
まだ  <code>setClipboardContents</code>  メソッドを定義していないため、この手順で追加した各行には赤い下線が付きます。次の手順で、新しいメソッドを追加します。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>最後に、クラスの最後に次の内容を追加します。このメソッドは、文字列を受け取ってそれをクリップボードにコピーします。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void setClipboardContents(String content) {
    if (clipboard != null) {
        if (content == null) {
            StatusDisplayer.getDefault().setStatusText("");
            clipboard.setContents(null, null);
        } else {
            StatusDisplayer.getDefault().setStatusText("Clipboard: " + content);
            clipboard.setContents(new StringSelection(content), null);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://netbeans.apache.org/community/mailing-lists.html">ご意見をお寄せください</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_関連項目">関連項目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NetBeans モジュールの作成と開発の詳細については、次のリソースを参照してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/Java_DevelopersGuide">Java Developer&#8217;s Guide</a></p>
</li>
<li>
<p><a href="http://wiki.netbeans.org/RetoucheDeveloperFAQ">Retouche Developer FAQ</a></p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform.html">その他の関連チュートリアル</a></p>
</li>
<li>
<p><a href="https://bits.netbeans.org/dev/javadoc/">NetBeans API Javadoc</a></p>
</li>
</ul>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-copyfqn_ja.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
