
<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Руководство по работе с Visual Library в среде NetBeans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Руководство по работе с Visual Library в среде NetBeans - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, Руководство по работе с Visual Library в среде NetBeans">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet"> 
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
</head>


    <body>
        

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="https://blogs.apache.org/netbeans/">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


        
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 12.4</h1>
            <p><a class="button success" href="/download/nb124/nb124.html">Find out more</a></p>
        </div>
    </div>
</section>

        <div class='grid-container main-content tutorial'>
            <h1 class="sect0">Руководство по работе с Visual Library в среде NetBeans</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://issues.apache.org/jira/projects/NETBEANS/issues">open a JIRA issue</a>, 
                     or <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-visual_library_ru.asciidoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
            <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_настройка_модуля">Настройка модуля</a></li>
<li><a href="#_создание_рабочего_пространства">Создание рабочего пространства</a></li>
<li><a href="#_создание_палитры_элементов_для_рабочего_пространства">Создание палитры элементов для рабочего пространства</a></li>
<li><a href="#_добавление_элемента_layerwidget">Добавление элемента "LayerWidget"</a></li>
<li><a href="#_добавление_элемента_iconnodewidget_с_функциональностью_перетаскивания">Добавление элемента "IconNodeWidget" с функциональностью перетаскивания</a></li>
<li><a href="#_добавление_функциональности_в_рабочее_пространство">Добавление функциональности в рабочее пространство</a></li>
<li><a href="#_добавление_функциональности_к_элементу_iconnodewidget">Добавление функциональности к элементу "IconNodeWidget"</a></li>
<li><a href="#_что_дальше">Что дальше?</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Это руководство посвящено работе с основными возможностями, предусмотренными в интерфейсе API для Visual Library в среде NetBeans. Интерфейс API для Visual Library – это интерфейс визуализации, который удобно использовать в контексте, например, моделирования и построения графов.</p>
</div>
<div class="paragraph">
<p>Дополнительно, в целях поиска и устранения ошибок, можно  <a href="http://plugins.netbeans.org/PluginPortal/faces/PluginDetailPage.jsp?pluginid=2701">загрузить готовые примеры</a> и изучить исходный код.</p>
</div>
<div class="paragraph">
<p>В этом руководстве также будут использоваться 3 значка. Здесь можно щелкнуть каждый из них правой кнопкой мыши и сохранить его локально, либо скопировать в местоположение проекта модуля после его создания в соответствии с указаниями, приведенными в данном руководстве. Это следующие значки:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/image1.png" alt="image1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/image2.png" alt="image2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/image3.png" alt="image3">
</div>
</div>
<div class="paragraph">
<p>Вся информация, которая потребуется для работы с интерфейсом API для Visual Library, собрана в следующих двух источниках:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://netbeans.apache.org/graph/">Страница проекта Visual Library</a></p>
</li>
<li>
<p><a href="https://netbeans.apache.org/graph/documentation.html">Документация по Visual Library 2.0</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Также см.  <a href="http://www.javalobby.org/eps/netbeans_visual_library/">демонстрацию по Visual Library, подготовленную Романом Штроблем (Roman Strobl),</a> на сайте Javalobby.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_настройка_модуля">Настройка модуля</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе демонстрируется использование программ-мастеров для создания проекта модуля и собственного оконного элемента.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">New Project</b></span>. В мастере создания проекта выберите "NetBeans Modules" в области "Categories" и "Module" в области "Projects". Нажмите кнопку "Next". Введите  <code>ShapeSample</code>  в поле "Project Name" и укажите соответствующую папку на диске в поле "Project Location". Выберите "Standalone Module" и "Set as Main Project", если эти параметры не выбраны. Нажмите кнопку "Next".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Введите  <code>org.netbeans.shapesample</code>  в поле "Code Name Base" и  <code>Shape Sample</code>  в поле "Module Display Name". Нажмите кнопку "Finish".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Щелкните проект правой кнопкой мыши, выберите "Properties", щелкните "Libraries" в диалоговом окне "Project Properties" и установите зависимость от следующих интерфейсов API:</p>
<div class="ulist">
<ul>
<li>
<p>Visual Library API</p>
</li>
<li>
<p>Utilities API</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Нажмите кнопку "OK".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Щелкните проект модуля правой кнопкой мыши, выберите <span class="menuseq"><b class="menu">New</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">File/Folder</b></span>, затем выберите "Window Component" из категории "NetBeans Module Development". Нажмите кнопку "Next". Выберите  <code>editor</code>  в раскрывающемся списке и затем выберите "Open on Application Start". Нажмите кнопку "Next".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Введите  <code>Shape</code>  в поле "Class Name Prefix". При необходимости можно добавить значок размером 16x16 пикселей. Нажмите кнопку "Finish".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Создается несколько файлов, один из которых –  <code>ShapeTopComponent</code> . Откройте этот файл в режиме проектирования. Экран должен выглядеть следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/shapetopcomponent.png" alt="shapetopcomponent">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Щелкните правой кнопкой мыши элемент "TopComponent" в режиме проектирования, выберите "Set Layout" и затем выберите "BorderLayout".</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_рабочего_пространства">Создание рабочего пространства</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Программирование с использованием интерфейса API для Visual Library аналогично программированию в Swing. При этом составляется и изменяется дерево визуальных элементов, именуемых элементами оформления окон (widgets). Корень дерева представлен классом "Scene", содержащим все визуальные характеристики рабочего пространства. Само рабочее пространство также представляет собой элемент оформления окон. Необходимо создать представление рабочего пространства, которое является элементом "JComponent". Затем следует добавить "JComponent" к элементу "JScrollPane".</p>
</div>
<div class="paragraph">
<p>В этом разделе представлена процедура добавления элемента "JScrollPane" к "TopComponent". Затем создается новое рабочее пространство. Представление рабочего пространства передается в элемент "TopComponent", что позволяет вывести его в элементе "JScrollPane" элемента "TopComponent". После этого осуществляется установка проекта модуля и вывод на экран первого рабочего пространства.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>При помощи окна "Palette" (Ctrl-Shift-8) перетащите  <code>JScrollPane</code>  к элементу "TopComponent". В окне "Inspector" щелкните правой кнопкой мыши  <code>JScrollPane</code> , выберите "Change Variable Name" и введите  <code>shapePane</code> .</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В пакете  <code>org.netbeans.shapesample</code>  создайте класс Java с именем  <code>GraphSceneImpl</code> . Этот класс должен расширять  <code>GraphScene</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Появляется красное подчеркивание, указывающее на ошибку, и изображение лампочки. Подтвердите создание оператора импорта средой IDE.</p>
</div>
<div class="paragraph">
<p>Снова появляется красное подчеркивание, указывающее на ошибку, и изображение лампочки. Подтвердите создание абстрактных методов класса средой IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Создайте фиктивную реализацию класса путем добавления значимых идентификаторов и настройки возврата  <code>null</code>  там, где это необходимо, для удовлетворения всех требований класса:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class GraphSceneImpl extends GraphScene {

    public GraphSceneImpl() {
    }

    protected Widget attachNodeWidget(Object node) {
        return null;
    }

    protected Widget attachEdgeWidget(Object edge) {
        return null;
    }

    protected void attachEdgeSourceAnchor(Object edge, Object oldSourceNode, Object newSourceNode) {

    }

    protected void attachEdgeTargetAnchor(Object edge, Object oldTargetNode, Object newTargetNode) {

    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Теперь вставьте в конструктор элемента "TopComponent" экземпляр класса  <code>GraphSceneImpl</code> . Для этого добавьте в конец конструктора класса  <code>ShapeTopComponent</code>  следующее:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">GraphSceneImpl scene = new GraphSceneImpl();
myView = scene.createView();

shapePane.setViewportView(myView);
add(scene.createSatelliteView(), BorderLayout.WEST);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что создается два представления. Первое – это развернутое представление для визуализации графов, моделей и т.д. Второе – вспомогательное представление с левой стороны элемента "TopComponent". Наличие двух представлений позволит пользователю быстро перемещаться по основному представлению с одновременным обзором всего рабочего пространства.</p>
</div>
<div class="paragraph">
<p>Объявите представление "JComponent":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private JComponent myView;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Обеспечивать сохранение состояния элемента "TopComponent" при перезапуске среды IDE не требуется. Напротив, в нашем случае это будет ошибкой. Поэтому замените PERSISTENCE_ALWAYS на PERSISTENCE_NEVER, как показано ниже:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public int getPersistenceType() {
   return TopComponent.PERSISTENCE_NEVER;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Щелкните правой кнопкой мыши узел проекта и выберите "Install/Reload in Development IDE". Если появляется предупреждающее сообщение, нажмите кнопку "OK".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В процессе установки модуля в списке пунктов меню "Window" появляется новый пункт "Shape". При выборе этого пункта запускается подготовленная реализация интерфейса API для Visual Library:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/firstscene.png" alt="firstscene">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_палитры_элементов_для_рабочего_пространства">Создание палитры элементов для рабочего пространства</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для практического применения интерфейса API для Visual Library будет реализован  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-spi-palette/overview-summary.html">интерфейс API "Palette"</a>, что позволит создать палитру элементов с фигурами, показанными в начале данного руководства. Затем добавим функциональность перетаскивания, предусмотренную в интерфейсе API для Visual Library, при помощи которой можно будет размещать фигуры в рабочем пространстве путем перетаскивания. После этого расширим рабочее пространство путем добавления дополнительных возможностей, например, масштабирования и перемещения по рабочему пространству.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Поскольку это руководство посвящено интерфейсу API для Visual Library, а не интерфейсу "Palette", подробное описание принципов работы последнего здесь не приводится. По этой теме существует достаточно много других руководств ( <a href="https://netbeans.apache.org/kb/docs/platform.html">например, здесь</a>). Поэтому просто скопируйте и вставьте в новый пакет с именем  <code>org.netbeans.shapesample.palette</code>  следующие файлы:</p>
<div class="ulist">
<ul>
<li>
<p><a href="images/Category.java">Category.java</a></p>
</li>
<li>
<p><a href="images/CategoryChildren.java">CategoryChildren.java</a></p>
</li>
<li>
<p><a href="images/CategoryNode.java">CategoryNode.java</a></p>
</li>
<li>
<p><a href="images/PaletteSupport.java">PaletteSupport.java</a></p>
</li>
<li>
<p><a href="images/Shape.java">Shape.java</a></p>
</li>
<li>
<p><a href="images/ShapeChildren.java">ShapeChildren.java</a></p>
</li>
<li>
<p><a href="images/ShapeNode.java">ShapeNode.java</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Добавьте зависимости от интерфейсов API Actions, Nodes и Common Palette аналогично способу, описанному в действии 3 раздела "Начало работы".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Затем добавьте палитру к элементу "Lookup" элемента "TopComponent" путем вставки следующей строки в конец конструктора "TopComponent":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">associateLookup( Lookups.fixed( new Object[] { PaletteSupport.createPalette() } ) );</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Среда IDE предложит вставить операторы импорта для  <code>org.openide.util.lookup.Lookups</code>  и  <code>org.netbeans.shapesample.palette.PaletteSupport</code> . Подтвердите предложение, после чего средой IDE будут автоматически созданы операторы импорта.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Поместите изображения, приведенные в начале этого руководства, в пакет  <code>org.netbeans.shapesample.palette</code> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Окно "Projects" теперь должно выглядеть следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/proj-window.png" alt="proj window">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Установите модуль еще раз. При вызове элемента "TopComponent" при помощи соответствующего пункта меню справа от рабочего пространства отображается палитра элементов:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/firstpalette.png" alt="firstpalette">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_добавление_элемента_layerwidget">Добавление элемента "LayerWidget"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Элемент  <a href="https://netbeans.apache.org/graph/documentation.html#LayerWidget">LayerWidget</a> представляет собой "прозрачный слой" (glasspane), похожий на элемент "JGlassPane" в Swing. Этот элемент прозрачен по умолчанию. Прежде, чем двигаться дальше, добавим элемент "LayerWidget" к рабочему пространству, что позволит в дальнейшем размешать видимые элементы оформления окон путем их перетаскивания в это пространство.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Объявите элемент "LayerWidget" в классе  <code>GraphSceneImpl</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private LayerWidget mainLayer;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>В конструкторе класса  <code>GraphSceneImpl</code>  добавьте элемент "LayerWidget" как подчиненный элемент рабочего пространства:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">mainLayer = new LayerWidget (this);
addChild (mainLayer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь при перетаскивании элементов из палитры в рабочее пространство в качестве элементов оформления окон они будут добавляться как подчиненные элементу "LayerWidget". Поскольку элементы "LayerWidget" по умолчанию являются прозрачными, можно добавить множество таких элементов, один над другим, и таким образом вставить в рабочее пространство, например, фоновое изображение.</p>
</div>
<div class="paragraph">
<p>Для получения более подробной информации см. описание элемента  <a href="https://netbeans.apache.org/graph/documentation.html#LayerWidget">LayerWidget</a> в документации Javadoc.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_добавление_элемента_iconnodewidget_с_функциональностью_перетаскивания">Добавление элемента "IconNodeWidget" с функциональностью перетаскивания</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ранее конструктор класса  <code>GraphSceneImpl</code>  использовался для передачи рабочего пространства в элемент "JScrollPane" элемента "TopComponent". Рабочее пространство существует, однако для него еще не настроено поведение. Для настройки поведения нами будут использоваться действия. В этом разделе будет рассмотрено действие  <code> <a href="https://netbeans.apache.org/graph/documentation.html#AcceptAction">AcceptAction</a></code> . Это действие предоставляет функциональность перетаскивания. Функциональность перетаскивания может применяться в отношении элемента оформления окон, однако в нашем случае она будет применена к самому рабочему пространству.</p>
</div>
<div class="paragraph">
<p>Для определения того, что должно происходить при перетаскивании элемента из палитры в пределах рабочего пространства, будет использоваться действие  <code>createAcceptAction</code> . Здесь задействованы два метода. Первый метод –  <code>isAcceptable()</code>  – позволяет определить приемлемость элемента для рабочего пространства. Таким образом можно протестировать перемещаемый элемент. Также можно определить изображение, которое будет появляться при перетаскивании. Это демонстрируется в примере ниже. Если возвращается  <code>true</code> , вызывается метод  <code>accept</code> . Получение изображения от перемещаемого элемента производится с использованием того же вспомогательного метода, что и ранее. Затем вызывается метод  <code>addNode</code> , создающий новый экземпляр  <a href="https://netbeans.apache.org/graph/documentation.html#IconNodeWidget">IconNodeWidget</a> и передающий изображение, полученное от перемещаемого элемента.</p>
</div>
<div class="paragraph">
<p>Весь код в этом разделе взаимосвязан, и пока не будут добавлены все названные ниже методы, в коде будут появляться ошибки, обозначенные красным подчеркиванием. Тем не менее, мы попробуем добавить все методы в некоторой логической последовательности.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Прежде всего, добавьте к конструктору класса  <code>GraphSceneImpl</code>   <code>createAcceptAction</code>  и два связанных метода:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">getActions().addAction(ActionFactory.createAcceptAction(new AcceptProvider() {

    public ConnectorState isAcceptable(Widget widget, Point point, Transferable transferable) {
        Image dragImage = getImageFromTransferable(transferable);
        JComponent view = getView();
        Graphics2D g2 = (Graphics2D) view.getGraphics();
        Rectangle visRect = view.getVisibleRect();
        view.paintImmediately(visRect.x, visRect.y, visRect.width, visRect.height);
        g2.drawImage(dragImage,
                AffineTransform.getTranslateInstance(point.getLocation().getX(),
                point.getLocation().getY()),
                null);
        return ConnectorState.ACCEPT;
    }

    public void accept(Widget widget, Point point, Transferable transferable) {
        Image image = getImageFromTransferable(transferable);
        Widget w = GraphSceneImpl.this.addNode(new MyNode(image));
        w.setPreferredLocation(widget.convertLocalToScene(point));
    }

}));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
После добавления вышеприведенного кода некоторые красные подчеркивания не исчезнут, свидетельствуя о наличии ошибки. Причина появления ошибок состоит в том, что этот код содержит ссылки на метод и класс, которые еще не созданы. Они будут созданы на одном из следующих этапов.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Затем в классе  <code>GraphSceneImpl</code>  добавьте вспомогательный метод для получения изображения из перемещаемого элемента:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Image getImageFromTransferable(Transferable transferable) {
    Object o = null;
    try {
        o = transferable.getTransferData(DataFlavor.imageFlavor);
    } catch (IOException ex) {
        ex.printStackTrace();
    } catch (UnsupportedFlavorException ex) {
        ex.printStackTrace();
    }
    return o instanceof Image ? (Image) o : Utilities.loadImage("org/netbeans/shapesample/palette/shape1.png");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что можно указать любое произвольное изображение на случай, если вспомогательный метод не возвращает какое-либо изображение. В примере для этого будет использоваться изображение " <code>shape1.png</code> ".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Создайте новый класс с именем  <code>MyNode</code> . Этот класс представляет узел в графо-ориентированной модели. Он не может быть непосредственно изображением, так как каждый узел в модели должен быть уникальным (это проверяется методом "equals"). Если бы использовались непосредственно изображения, то можно было бы получить только 3 узла в рабочем пространстве (по одному для каждого изображения). При помощи класса "MyNode" можно получить несколько узлов, каждый из которых может иметь свой собственный или совместно используемый экземпляр изображения.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class MyNode {

    private Image image;

    public MyNode(Image image) {
        this.image = image;
    }

    public Image getImage() {
        return image;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Измените подпись класса  <code>GraphSceneImpl</code> , как показано ниже, для получения узла классом реализации "Visual Library":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">extends GraphScene&lt;MyNode, String&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Подтвердите автоматическое создание средой IDE новых заглушек для абстрактных методов.</p>
</div>
<div class="paragraph">
<p>Кроме того, поскольку в нашем примере используются общие объекты, в среде IDE должен присутствовать инструментарий JDK 1.5. Если точная версия неизвестна, щелкните правой кнопкой мыши проект, выберите "Properties" и перейдите на страницу "Sources". В раскрывающемся списке "Source Level" выберите "1.5".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Наконец, определите новый элемент оформления окон в классе  <code>GraphSceneImpl</code> . Этот метод автоматически вызывается методом  <code>accept</code> . Он используется для определения элемента оформления окон Visual Library при перетаскивании элемента палитры.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected Widget attachNodeWidget(MyNode node) {
    IconNodeWidget widget = new IconNodeWidget(this);
    widget.setImage(node.getImage());
    widget.setLabel(Long.toString(node.hashCode()));
    widget.getActions().addAction(ActionFactory.createMoveAction());
    mainLayer.addChild(widget);
    return widget;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на установку изображения, получаемого от узла. В качестве идентифицирующей метки будет использоваться генерируемое случайное число. По умолчанию элемент оформления окон существует, но его поведение не определено. Для получения возможности перемещения элемента оформления окон в рабочем пространстве необходимо создать действие по перемещению. Перед возвратом элемента оформления окон в рабочее пространство его следует добавить в качестве подчиненного элементу "LayerWidget", который был создан в предыдущем разделе.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Перезагрузите модуль и снова откройте окно "Shape".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь имеется возможность перетаскивания элементов из палитры. При перемещении элемента в рабочем пространстве отображается изображение, которое было определено как изображение при перетаскивании. По завершении перемещения оно заменяется элементом оформления окон, отображаемым в рабочем пространстве, а также во вспомогательном представлении, как показано на следующем рисунке:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/finishedscene.png" alt="finishedscene">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_добавление_функциональности_в_рабочее_пространство">Добавление функциональности в рабочее пространство</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В предыдущем разделе мы добавили к рабочему пространству  <code> <a href="https://netbeans.apache.org/graph/documentation.html#AcceptAction">AcceptAction</a></code> . Необходимо было определить два метода, которые проверяли возможность перетаскивания элемента и способ его обработки. В этом разделе при помощи  <code> <a href="https://netbeans.apache.org/graph/documentation.html#ZoomAction">ZoomAction</a></code>  к рабочему пространству будет добавлена функциональность для изменения масштаба.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Добавьте следующую строку в конструктор класса  <code>GraphSceneImpl</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">getActions().addAction(ActionFactory.createZoomAction());</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Установите модуль еще раз.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Удерживая нажатой клавишу CTRL, попробуйте изменить масштаб в рабочем пространстве при помощи колеса мыши:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/zoom.png" alt="zoom">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/unzoom.png" alt="unzoom">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Фигуры визуализируются как изображения. SVG в настоящее время не поддерживается.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Как и ранее, для добавления возможности перемещения по рабочему пространству вставьте следующую строку:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">getActions().addAction(ActionFactory.createPanAction());</code></pre>
</div>
</div>
<div class="paragraph">
<p>После добавления этой строки пользователь сможет перемещаться по рабочему пространству в любом направлении путем нажатия и поворота колеса мыши.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_добавление_функциональности_к_элементу_iconnodewidget">Добавление функциональности к элементу "IconNodeWidget"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ранее для добавления возможности перемещения элемента оформления окон "IconNodeWidget" к нему было добавлено действие  <code> <a href="https://netbeans.apache.org/graph/documentation.html#MoveAction">MoveAction</a></code> . Аналогичным образом для этого элемента оформления окон можно настроить и другие возможности поведения. В этом разделе мы добавим действия  <code> <a href="https://netbeans.apache.org/graph/documentation.html#HoverAction">HoverAction</a></code> ,  <code> <a href="https://netbeans.apache.org/graph/documentation.html#SelectAction">SelectAction</a></code>  и  <code> <a href="https://netbeans.apache.org/graph/documentation.html#InplaceEditorAction">InplaceEditorAction</a></code> .</p>
</div>
<div class="paragraph">
<p>Действие  <code>InplaceEditorAction</code>  позволит пользователю изменять подпись (метку) элемента:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/editable.png" alt="editable">
</div>
</div>
<div class="paragraph">
<p>Действие  <code>SelectAction</code>  используется для изменения цвета подписи при выделении элемента оформления окон, а действие  <code>HoverAction</code>  изменяет цвет подписи при наведении на элемент указателя мыши:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/selectable-hoverable.png" alt="selectable hoverable">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Сначала определим действие "Editor", которое будет добавлено к элементу "IconNodeWidget":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private WidgetAction editorAction = ActionFactory.createInplaceEditorAction(new LabelTextFieldEditor());</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Затем определим  <code>LabelTextFieldEditor</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private class LabelTextFieldEditor implements TextFieldInplaceEditor {

    public boolean isEnabled(Widget widget) {
        return true;
    }

    public String getText(Widget widget) {
        return ((LabelWidget) widget).getLabel();
    }

    public void setText(Widget widget, String text) {
        ((LabelWidget) widget).setLabel(text);
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Наконец, присвоим действие "Editor" элементу "IconNodeWidget" способом, аналогичным вышеописанной настройке действия "Move":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">widget.getLabelWidget().getActions().addAction(editorAction);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь сначала получаем элемент "LabelWidget" элемента оформления окон "IconNodeWidget". Затем к "LabelWidget" добавляется действие "Editor".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Среда IDE предложит добавить несколько операторов импорта. В каждом случае следует подтвердить предложенный средой IDE оператор.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Затем, в случаях  <code>SelectAction</code>  и  <code>HoverAction</code> , потребуется лишь присвоить эти действия элементу "IconNodeWidget":</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">widget.getActions().addAction(createSelectAction());
widget.getActions().addAction(createObjectHoverAction());</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Теперь необходимо определить порядок выполнения созданных действий. Для получения более подробной информации см. раздел  <a href="https://netbeans.apache.org/graph/documentation.html#OrderOfActions">Определение порядка действий</a> в документации. После изменения порядка действий код  <code>attachNodeWidget</code>  должен выглядеть следующим образом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected Widget attachNodeWidget(MyNode node) {
    IconNodeWidget widget = new IconNodeWidget(this);
    widget.setImage(node.getImage());
    widget.setLabel(Long.toString(node.hashCode()));

    //Двойной щелчок, событие используется только при двойном щелчке:
    widget.getLabelWidget().getActions().addAction(editorAction);

    //Однократный щелчок, событие не используется:
    widget.getActions().addAction(createSelectAction());

    //Перетаскивание мышью, событие используется во время перемещения указателя мыши:
    widget.getActions().addAction(ActionFactory.createMoveAction());

    //Наведение мыши; событие используется при перемещении указателя мыши по элементу оформления окон :
    widget.getActions().addAction(createObjectHoverAction());

    mainLayer.addChild(widget);
    return widget;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Установите и снова протестируйте модуль. Как было показано в начале этого раздела, при наведении указателя мыши на подпись к элементу оформления окон или при выделении этого элемента его цвет изменяется. Кроме того, после щелчка подписи ее текст можно изменить.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Поздравляем! Руководство по работе с Visual Library 2.0 в среде NetBeans 6.0 завершено.</p>
</div>
<div class="paragraph">
<p><a href="http://netbeans.apache.org/community/mailing-lists.html">Мы ждем ваших отзывов</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_что_дальше">Что дальше?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для получения дополнительной информации о работе с интерфейсом API для "Visual Library" см.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.javalobby.org/eps/netbeans_visual_library/">Демонстрация по Visual Library, подготовленная Романом Штроблем (Roman Strobl),</a> на сайте Javalobby.</p>
</li>
<li>
<p><a href="https://netbeans.apache.org/graph/">Страница проекта Visual Library</a></p>
</li>
<li>
<p><a href="https://netbeans.apache.org/graph/documentation.html">Документация по Visual Library 2.0</a></p>
</li>
</ul>
</div>
</div>
</div>
            
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="JIRA" href="https://issues.apache.org/jira/projects/NETBEANS/summary"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-visual_library_ru.asciidoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

        </div>
        

<div class='grid-container incubator-area' style='margin-top: 64px'>
    <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/">
                <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
            </a>
        </div>
        <div class='large-auto cell text-center'>
            <a href="https://www.apache.org/events/current-event.html">
               <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>
    </div>
</div>
<footer>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="large-auto cell">
                
                <h1><a href="/about/index.html">About</a></h1>
                <ul>
                    <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/community/index.html">Community</a></h1>
                <ul>
                    <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/community/committer.html">Becoming a committer</a></li>
                    <li><a href="/community/events.html">NetBeans Events</a></li>
                    <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/participate/index.html">Participate</a></h1>
                <ul>
                    <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
                    <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
                    <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/help/index.html">Get Help</a></h1>
                <ul>
                    <li><a href="/help/index.html#documentation">Documentation</a></li>
                    <li><a href="/wiki/index.asciidoc">Wiki</a></li>
                    <li><a href="/help/index.html#support">Community Support</a></li>
                    <li><a href="/help/commercial-support.html">Commercial Support</a></li>
                </ul>
            </div>
            <div class="large-auto cell">
                <h1><a href="/download/nb110/nb110.html">Download</a></h1>
                <ul>
                    <li><a href="/download/index.html">Releases</a></li>                    
                    <li><a href="/plugins/index.html">Plugins</a></li>
                    <li><a href="/download/index.html#source">Building from source</a></li>
                    <li><a href="/download/index.html#previous">Previous releases</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div class='footer-disclaimer'>
    <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2020 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
            <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
            <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
        </div>
        
    </div>
</div>



        <script src="/js/vendor/jquery-3.2.1.min.js"></script>
        <script src="/js/vendor/what-input.js"></script>
        <script src="/js/vendor/jquery.colorbox-min.js"></script>
        <script src="/js/vendor/foundation.min.js"></script>
        <script src="/js/netbeans.js"></script>
        <script>
            
            $(function(){ $(document).foundation(); });
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
         $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
        </script>
        
    </body>
</html>
