
<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Руководство по инфраструктуре языка Java в среде NetBeans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Руководство по инфраструктуре языка Java в среде NetBeans - Apache NetBeans">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans Platform, Platform Tutorials, Руководство по инфраструктуре языка Java в среде NetBeans">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css"> 
    <link rel="stylesheet" href="/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>

  <body>
    

<div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="/"><img src='/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <a href="/community/index.html">Community</a> </li>
            <li> <a href="/participate/index.html">Participate</a> </li>
            <li> <a href="/blogs/index.html">Blog</a></li>
            <li> <a href="/help/index.html">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="/download/index.html">Download</a> </li>
        </ul>
    </div>
</div>


    
<!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="/download/nb19/">Download</a></p>
        </div>
    </div>
</section>

    <div class='grid-container main-content tutorial'>
      <h1 class="sect0">Руководство по инфраструктуре языка Java в среде NetBeans</h1>
            
            <div class="sectionbody">
              <div class="admonitionblock note">
                <table>
                  <tbody><tr>
                  <td class="icon"><i class="fa icon-note" title="Note"></i></td>
                  <td class="content">This tutorial needs a review. 
                     You can <a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-copyfqn_ru.adoc" title="Edit this tutorial in github">edit it in GitHub </a>
                     following these <a href="/kb/docs/contributing.html">contribution guidelines.</a></td>
                  </tr></tbody>
                </table>
              </div>
            </div>
            
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_введение_в_инфраструктуру_языка_java">Введение в инфраструктуру языка Java</a></li>
<li><a href="#_настройка_модуля">Настройка модуля</a></li>
<li><a href="#_создание_контекстно_зависимой_кнопки_на_панели_инструментов">Создание контекстно-зависимой кнопки на панели инструментов</a></li>
<li><a href="#_идентификация_исходных_файлов_java">Идентификация исходных файлов Java</a></li>
<li><a href="#_определение_состояния_открытия">Определение состояния открытия</a></li>
<li><a href="#_обнаружение_элемента_под_курсором">Обнаружение элемента под курсором</a></li>
<li><a href="#_применение_на_практике">Применение на практике</a></li>
<li><a href="#_дополнительная_информация">Дополнительная информация</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>В этом руководстве описываются аспекты новых интерфейсов API инфраструктуры "Retouche" в среде NetBeans 6.0, которые предоставляют доступ к редактору Java, предусмотренному в этой среде.</p>
</div>
<div class="paragraph">
<p>Дополнительно, в целях поиска и устранения ошибок, можно  <a href="http://plugins.netbeans.org/PluginPortal/faces/PluginDetailPage.jsp?pluginid=2753">загрузить готовые примеры</a> и изучить исходный код.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_введение_в_инфраструктуру_языка_java">Введение в инфраструктуру языка Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>До появления среды IDE NetBeans 6.0 инфраструктура языка Java, поддерживавшая редактор Java, включая создание и реорганизацию кода Java, была основана на так называемом "JMI для Java" (Java Metadata Interface – интерфейс метаданных Java), также известном как "MDR" (MetaData Repository – хранилище метаданных). В JMI для Java имелся ряд архитектурных проблем, например, блокировка для единственной операции чтения. Другими словами, блокировка применялась просто для чтения информации из модели, в то время как обычно она требуется только для записи. В течение нескольких лет проводилась отладка и улучшение производительности JMI. Еще одна проблема состояла в использовании внутренней копии синтаксического анализатора Java, что предполагало собственный подход к интерпретации исходного кода Java, который отличался от компилятора Java в JDK. После появления общих объектов в JDK 5, в результате чего в языке Java появились намного более сложные и тонкие конструкции, преодолеть это расхождение стало еще труднее. Поэтому из-за проблем с производительностью JMI и из-за того, что благодаря разработке формальной модели языка компилятор Java из JDK стал программно доступным средством, JMI для Java был заменен новым подходом, основанным на компиляторе Java из JDK.</p>
</div>
<div class="paragraph">
<p>Именно тогда появилась инфраструктура "Retouche" (французское слово, означающее "мелкий ремонт" или "доработку"). "Retouche" – это новая и быстрая инфраструктура языка Java в среде IDE NetBeans, способная к поддержке всех превосходных компонентов редактора Java, реализованных в среде NetBeans 6.0. Суть состоит в том, что "Retouche" обеспечивает обертку экземпляра компилятора Java в JDK и использует его артефакты, такие как абстрактное синтаксическое дерево (также известное как "AST") и разрешение символических ссылок, производимое на различных этапах процесса синтаксического анализа. При работе с "Retouche" необходимо иметь дело с некоторыми из этих артефактов. Одним из них, например, является  <a href="http://java.sun.com/javase/6/docs/jdk/api/javac/tree/index.html">интерфейс API дерева компиляции</a>. Пакеты классов в интерфейсе API дерева компиляции начинаются с  <code>com.sun.<strong></code> . Поэтому технически этот интерфейс не является интерфейсом API JDK, но фактически происходит из компилятора Java в JDK. Другим примером артефактов компилятора Java в JDK, используемых при работе с инфраструктурой "Retouche", является формальная модель языка в интерфейсах API в JDK, представленная пакетами  <code>javax.language.model.</strong></code> .</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_настройка_модуля">Настройка модуля</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Этот раздел посвящен созданию проекта модуля и настройке зависимостей от соответствующих модулей NetBeans с помощью программ-мастеров.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Выберите <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">New Project</b></span>. В мастере создания проекта выберите "NetBeans Modules" в области "Categories" и "Module Project" в области "Projects", а затем нажмите кнопку "Next".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Введите  <code>CopyFQN</code>  в поле "Project Name" и укажите соответствующую папку на диске в поле "Project Location". Выберите "Standalone Module" и "Set as Main Project", если эти параметры не выбраны. Нажмите кнопку "Next".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Введите  <code>org.netbeans.modules.copyfqn</code>  в поле "Code Name Base" и  <code>CopyFQN</code>  в поле "Module Display Name". Нажмите кнопку "Finish".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Щелкните проект правой кнопкой мыши, выберите "Properties", щелкните "Libraries" в диалоговом окне "Project Properties" и установите зависимость от следующих интерфейсов API:</p>
<div class="ulist">
<ul>
<li>
<p>Datasystems API</p>
</li>
<li>
<p>Editor Library 2</p>
</li>
<li>
<p>File System API</p>
</li>
<li>
<p>Javac API Wrapper</p>
</li>
<li>
<p>Java Source</p>
</li>
<li>
<p>Nodes API</p>
</li>
<li>
<p>Text API</p>
</li>
<li>
<p>UI Utilities API</p>
</li>
<li>
<p>Utilities API</p>
</li>
<li>
<p>Window System API</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Экран должен выглядеть следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_proj-props-copyfqn-60.png" alt="copyfqn proj props copyfqn 60">
</div>
</div>
<div class="paragraph">
<p>Нажмите кнопку "OK".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_создание_контекстно_зависимой_кнопки_на_панели_инструментов">Создание контекстно-зависимой кнопки на панели инструментов</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе будет рассмотрено создание контекстно-зависимой кнопки на панели инструментов. Это не связано с новыми интерфейсами API инфраструктуры "Retouche", но позволяет создать элемент интерфейса пользователя для взаимодействия с нашей реализацией этих интерфейсов, описанных далее в настоящем руководстве.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Щелкните проект модуля правой кнопкой мыши, выберите <span class="menuseq"><b class="menu">New</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Other</b></span>, затем выберите "Action" из категории "Module Development". Нажмите кнопку "Next".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Выберите "Conditionally Enabled" и сохраните все значения по умолчанию, как показано ниже. Действие должно зависеть от  <code>DataObjects</code> , и его выполнение должно быть возможно только при выборе какого-либо  <code>DataObject</code> .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_cookie-action-60.png" alt="copyfqn cookie action 60">
</div>
</div>
<div class="paragraph">
<p>Нажмите кнопку "Next".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Выберите "Edit" в поле "Category" и "Edit" в поле "Toolbar".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Экран должен выглядеть следующим образом:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_gui-registration-60.png" alt="copyfqn gui registration 60">
</div>
</div>
<div class="paragraph">
<p>Нажмите кнопку "Next".</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Введите  <code>CopyFQNAction</code>  в поле "Class Name" и  <code>CopyFQN</code>  в поле "Display Name".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Найдите значок, который должен отображаться на кнопке панели инструментов. Например, выберите значок, который используется в этом руководстве:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_icon.png" alt="copyfqn icon">
</div>
</div>
<div class="paragraph">
<p>Нажмите кнопку "Finish".</p>
</div>
<div class="paragraph">
<p>В новом классе  <code>CopyFQNAction.java</code>  должен быть представлен следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public final class CopyFQNAction extends CookieAction {

    protected void performAction(Node[] activatedNodes) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        // Добавить: использование dataObject
    }

    protected int mode() {
        return CookieAction.MODE_EXACTLY_ONE;
    }

    public String getName() {
        return NbBundle.getMessage(CopyFQNAction.class, "CTL_CopyFQNAction");
    }

    protected Class[] cookieClasses() {
        return new Class[] {
            DataObject.class
        };
    }

    protected String iconResource() {
        return "org/netbeans/modules/copyfqn/icon.png";
    }

    public HelpCtx getHelpCtx() {
        return HelpCtx.DEFAULT_HELP;
    }

    protected boolean asynchronous() {
        return false;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
В оставшейся части этого руководства описывается метод  <code>performAction()</code> .
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Было создано действие, зависящее от объектов данных. Теперь выясним, что это означает.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Щелкните модуль правой кнопкой мыши и выберите "Install".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>После установки модуля на панели инструментов должна появиться новая кнопка.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Выберите узел в окне "Projects" и проверьте кнопку на панели инструментов. При выборе узла, соответствующего файлу или папке (в том числе пакет), кнопка активна, как показано ниже:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-on.png" alt="copyfqn ctx sensitive on">
</div>
</div>
<div class="paragraph">
<p>Однако при выборе узла, соответствующего проекту, кнопка отключается, как показано ниже:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_ctx-sensitive-off.png" alt="copyfqn ctx sensitive off">
</div>
</div>
<div class="paragraph">
<p>В следующем разделе будут рассмотрены не только различия между узлами проекта и узлами файла/папки, но и различия между узлами файлов для классов Java и всеми остальными видами узлов файлов.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_идентификация_исходных_файлов_java">Идентификация исходных файлов Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе рассматривается использование одного из новых интерфейсов API инфраструктуры "Retouche", называемого  <a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/overview-summary.html">Java Source</a>. Здесь используется класс  <a href="https://bits.netbeans.org/dev/javadocorg-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html">JavaSource</a>, представляющий исходный файл Java. Возвращается экземпляр этого класса для объекта файла, связанного с объектом данных. Если возвращается пустое значение, объект файла не является исходным файлом Java. При нажатии кнопки после выбора файла в строке состояния отображается результат.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Заполните метод  <code>performAction()</code>  путем добавления строк, выделенных ниже:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // Добавить: использование dataObject

    *FileObject fileObject = dataObject.getPrimaryFile();

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html[JavaSource] javaSource =  link:https://bits.netbeans.org/dev/javadocorg-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#forFileObject(org.openide.filesystems.FileObject)[JavaSource.forFileObject(fileObject)];
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
    } else {
        StatusDisplayer.getDefault().setStatusText("Hurray! A Java file: " + fileObject.getPath());
    }*
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Проверьте, что используются следующие операторы импорта:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import org.netbeans.api.java.source.JavaSource;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Установите модуль еще раз.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Выберите узел файла и нажмите кнопку.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Обратите внимание, что сообщение "Hurray!" появляется только при выборе файла Java, как показано ниже:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-60.png" alt="copyfqn message java file 60">
</div>
</div>
<div class="paragraph">
<p>Альтернативный подход заключается во <em>включении кнопки только при выборе файла Java</em>. Для этого необходимо переопределить метод  <code>CookieAction.enable()</code>  следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
protected boolean enable(Node[] activatedNodes) {
    if (super.enable(activatedNodes)) {
        DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
        FileObject fileObject = dataObject.getPrimaryFile();
        JavaSource javaSource = JavaSource.forFileObject(fileObject);
        if (javaSource == null) {
            return false;
        }
        return true;
    }
    return false;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Показанный выше метод отфильтровывает любой файл, <em>не</em> являющийся файлом Java. В результате кнопка включается только тогда, когда текущий файл является файлом Java.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_определение_состояния_открытия">Определение состояния открытия</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе мы обратимся к нашей первой явно вызываемой задаче в инфраструктуре "Retouche". Такая задача представлена методом  <code>runUserActionTask</code>  класса JavaSource. Задача этого вида позволяет управлять этапами процесса синтаксического анализа и применяется при необходимости немедленной реакции на пользовательский ввод. Все действия задачи выполняются единым блоком. В данном случае необходимо, чтобы действие, представленное кнопкой на панели инструментов, немедленно сопровождалось появлением текста в строке состояния.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Замените сообщение "Hurray!" в методе  <code>performAction()</code>  следующей строкой: <a href="http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/JavaSource.html#runUserActionTask(org.netbeans.api.java.source.Task,%20boolean)">javaSource.runUserActionTask</a></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">(new  link:http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/Task.html[Task]&lt; link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html[CompilationController]&gt;());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь в левом столбце редактора должен появиться значок лампочки, показанный ниже:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_runuserasactiontask-60.png" alt="copyfqn runuserasactiontask 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Щелкните значок лампочки. В качестве альтернативы можно установить курсор на строку и нажать Alt-Enter. Теперь позволим среде IDE реализовать метод.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Незначительно измените метод путем добавления в его конец логической переменной  <code>true</code> . Среда IDE перенесет фрагмент в блок try/catch. Конечный результат должен выглядеть следующим образом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">protected void performAction(Node[] activatedNodes) {
    DataObject dataObject = activatedNodes[0].getLookup().lookup(org.openide.loaders.DataObject.class);
    // Добавить: использование dataObject

    FileObject fileObject = dataObject.getPrimaryFile();

    JavaSource javaSource = JavaSource.forFileObject(fileObject);
    if (javaSource == null) {
        StatusDisplayer.getDefault().setStatusText("Not a Java file: " + fileObject.getPath());
     } else {

            *try {
                javaSource.runUserActionTask(new Task&lt;CompilationController&gt;() {

                    public void run(CompilationController arg0) throws Exception {
                        throw new UnsupportedOperationException("Not supported yet.");
                    }
                }, true);
            } catch (IOException ex) {
                Exceptions.printStackTrace(ex);
            }*

     }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Реализуйте метод  <code>run()</code>  следующим образом:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#toPhase(org.netbeans.api.java.source.JavaSource.Phase)[compilationController.toPhase(Phase.ELEMENTS_RESOLVED)];

link:https://docs.oracle.com/javase/1.5.0/docs/api/javax/swing/text/Document.html[Document] document =  link:https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-java-source/org/netbeans/api/java/source/CompilationController.html#getDocument()[compilationController.getDocument()];
      if (document != null) {
         StatusDisplayer.getDefault().setStatusText("Hurray, the Java file is open!");
      } else {
         StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
      }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Проверьте, что используются следующие операторы импорта:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">import java.io.IOException;
import javax.swing.text.Document;
import org.netbeans.api.java.source.CompilationController;
import org.netbeans.api.java.source.JavaSource;
import org.netbeans.api.java.source.JavaSource.Phase;
import org.netbeans.api.java.source.Task;
import org.openide.awt.StatusDisplayer;
import org.openide.filesystems.FileObject;
import org.openide.loaders.DataObject;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;
import org.openide.util.HelpCtx;
import org.openide.util.NbBundle;
import org.openide.util.actions.CookieAction;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Установите модуль еще раз.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Выберите узел файла и нажмите кнопку.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Обратите внимание, что сообщение "Hurray!" появляется только при выборе файла Java, открытого в редакторе Java (см. ниже):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-java-file-open-60.png" alt="copyfqn message java file open 60">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_обнаружение_элемента_под_курсором">Обнаружение элемента под курсором</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе, зная, что мы имеем дело с открытым файлом Java, можно приступить к обнаружению типа элемента, находящегося под курсором в любой определенный период времени.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Начните с объявления зависимости от интерфейсов API ввода/вывода, чтобы результаты выводились в окне "Output".</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Замените сообщение "Hurray!" в методе  <code>run()</code>  выделенными строками, как показано ниже:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public void run(CompilationController compilationController) throws Exception {

    compilationController.toPhase(Phase.ELEMENTS_RESOLVED);
    Document document = compilationController.getDocument();

    if (document != null) {
        *new MemberVisitor(compilationController).scan(compilationController.getCompilationUnit(), null);*
    } else {
        StatusDisplayer.getDefault().setStatusText("The Java file is closed!");
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Здесь представлен класс  <code>MemberVisitor</code> , определенный как внутренний класс класса  <code>CopyFQNAction</code> :</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    @Override
    public Void visitClass(ClassTree t, Void v) {
        Element el = info.getTrees().getElement(getCurrentPath());
        if (el == null) {
            StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
        } else {
            TypeElement te = (TypeElement) el;
            List enclosedElements = te.getEnclosedElements();
            InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                        + info.getFileObject().getName(), true);
            for (int i = 0; i &lt; enclosedElements.size(); i++) {
            Element enclosedElement = (Element) enclosedElements.get(i);
                if (enclosedElement.getKind() == ElementKind.CONSTRUCTOR) {
                    io.getOut().println("Constructor: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.METHOD) {
                    io.getOut().println("Method: "
                        + enclosedElement.getSimpleName());
                } else if (enclosedElement.getKind() == ElementKind.FIELD) {
                    io.getOut().println("Field: "
                        + enclosedElement.getSimpleName());
                } else {
                    io.getOut().println("Other: "
                        + enclosedElement.getSimpleName());
                }
            }
            io.getOut().close();
        }
        return null;
    }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Установите модуль еще раз и откройте класс Java. Затем нажмите кнопку и обратите внимание на то, что конструкторы, методы и поля отображаются в окне "Output", как показано ниже:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_output-window-60.png" alt="copyfqn output window 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Затем вместо того, чтобы выводить все элементы в окне "Output", выведем в это окно только тот элемент, на котором установлен курсор. Просто замените метод  <code>visitClass</code>  выделенным кодом, показанным ниже:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private static class MemberVisitor extends TreePathScanner&lt;Void, Void&gt; {

    private CompilationInfo info;

    public MemberVisitor(CompilationInfo info) {
        this.info = info;
    }

    *@Override
    public Void visitClass(ClassTree t, Void v) {
        try {
            JTextComponent editor = EditorRegistry.lastFocusedComponent();
            if (editor.getDocument() == info.getDocument()) {
                int dot = editor.getCaret().getDot();
                TreePath tp = info.getTreeUtilities().pathFor(dot);
                Element el = info.getTrees().getElement(tp);
                if (el == null) {
                    StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
                } else {
                    InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                            + info.getFileObject().getName(), true);
                    if (el.getKind() == ElementKind.CONSTRUCTOR) {
                        io.getOut().println("Hurray, this is a constructor: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.METHOD) {
                        io.getOut().println("Hurray, this is a method: "
                            + el.getSimpleName());
                    } else if (el.getKind() == ElementKind.FIELD) {
                        io.getOut().println("Hurray, this is a field: "
                            + el.getSimpleName());
                    } else {
                        io.getOut().println("Hurray, this is something else: "
                            + el.getSimpleName());
                    }
                    io.getOut().close();
                }
            }
        } catch (IOException ex) {
            Exceptions.printStackTrace(ex);
        }
        return null;
    }*

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Установите модуль.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Установите курсор в любом месте кода Java и нажмите кнопку. В окне "Output" появится информация о коде под курсором (если применимо). Например, при нажатии кнопки после помещения курсора на метод, как показано ниже, в окне "Output" сообщается, что курсор установлен на данном методе:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/copyfqn_message-constructor-60.png" alt="copyfqn message constructor 60">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Однако в это окно можно вывести гораздо больше информации, чем название элемента под курсором. В методе  <code>visitClass</code>  замените выделенные полужирным строки, показанные ниже:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Override
public Void visitClass(ClassTree t, Void v) {
    try {
        JTextComponent editor = EditorRegistry.lastFocusedComponent();
        if (editor.getDocument() == info.getDocument()) {
            int dot = editor.getCaret().getDot();
            TreePath tp = info.getTreeUtilities().pathFor(dot);
            Element el = info.getTrees().getElement(tp);
            if (el == null) {
                StatusDisplayer.getDefault().setStatusText("Cannot resolve class!");
            } else {
                InputOutput io = IOProvider.getDefault().getIO("Analysis of "
                    + info.getFileObject().getName(), true);
                *String te = null;
                if (el.getKind() == ElementKind.CONSTRUCTOR) {
                    te = ((TypeElement) ((ExecutableElement) el).getEnclosingElement()).getQualifiedName().toString();
                    io.getOut().println("Hurray, this is a constructor's qualified name: " + te);
                } else if (el.getKind() == ElementKind.METHOD) {
                    te = ((ExecutableElement) el).getReturnType().toString();
                    io.getOut().println("Hurray, this is a method's return type: " + te);
                } else if (el.getKind() == ElementKind.FIELD) {
                    te = ((VariableElement) el).asType().toString();
                    io.getOut().println("Hurray, this is a field's type: " + te);
                }* else {
                    io.getOut().println("Hurray, this is something else: "
                        + el.getSimpleName());
                }
                io.getOut().close();
            }
        }
    } catch (IOException ex) {
        Exceptions.printStackTrace(ex);
    }
    return null;
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Установите модуль еще раз. На этот раз после нажатия кнопки при условии, что курсор находится на конструкторе, методе или поле, в окне "Output" отображается более подробная информация об этом элементе.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>На данном этапе можно определить, является ли текущий файл файлом Java, открыт ли документ и к какому типу относится элемент под курсором. Как можно использовать эту информацию? В следующем разделе представлен простой сценарий, при работе с которым приобретенное знание окажется полезным.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_применение_на_практике">Применение на практике</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом разделе описано определение содержимого буфера обмена, представленного  <code>java.awt.datatransfer.Clipboard</code> , в соответствии с элементом под курсором. При нажатии кнопки элемент под курсором помещается в буфер обмена, после чего его можно переместить в другое место кода.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Сначала необходимо объявить буфер обмена и определить конструктор:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private Clipboard clipboard;

public CopyFQNAction() {
    clipboard = Lookup.getDefault().lookup(ExClipboard.class);
    if (clipboard == null) {
        clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Затем замените каждую строку "Hurray!" в коде строкой, передающей элемент в качестве строки методу, который будет определен на следующем этапе. Дадим методу имя  <code>setClipboardContents</code> . Затем, например, замените первую строку "Hurray!" на следующую:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">setClipboardContents(te);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выполните аналогичные операции для других строк "Hurray!", убедившись в том, что в метод была передана корректная строка.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Поскольку метод  <code>setClipboardContents</code>  еще не определен, каждая из добавляемых на этом этапе строк подчеркивается красным цветом. На следующем этапе мы добавим новый метод.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Добавьте следующий код (вплоть до конца класса). Этот метод получает строку и помещает ее в буфер обмена:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">private void setClipboardContents(String content) {
    if (clipboard != null) {
        if (content == null) {
            StatusDisplayer.getDefault().setStatusText("");
            clipboard.setContents(null, null);
        } else {
            StatusDisplayer.getDefault().setStatusText("Clipboard: " + content);
            clipboard.setContents(new StringSelection(content), null);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://netbeans.apache.org/community/mailing-lists.html">Мы ждем ваших отзывов</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_дополнительная_информация">Дополнительная информация</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для получения дополнительной информации о создании и разработке модуля NetBeans см. следующие материалы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.netbeans.org/Java_DevelopersGuide">Руководство разработчика Java</a></p>
</li>
<li>
<p><a href="http://wiki.netbeans.org/RetoucheDeveloperFAQ">Часто задаваемые вопросы по разработке в инфраструктуре "Retouche" </a></p>
</li>
<li>
<p><a href="https://netbeans.apache.org/kb/docs/platform.html">Другие связанные руководства</a></p>
</li>
<li>
<p><a href="https://bits.netbeans.org/dev/javadoc/">Документация Javadoc по интерфейсам API в среде NetBeans</a></p>
</li>
</ul>
</div>
</div>
</div>
        
<section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        
        <li><a href="https://github.com/apache/netbeans-website/blob/master/netbeans.apache.org/src/content/tutorials/60/nbm-copyfqn_ru.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>

    </div>
    

    <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
                    
            <h1><a href="/about/index.html">About</a></h1>
            <ul>
              <li><a href="https://netbeans.apache.org/community/who.html">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/community/index.html">Community</a></h1>
            <ul>
              <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
              <li><a href="/community/committer.html">Becoming a committer</a></li>
              <li><a href="/community/events.html">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/participate/index.html">Participate</a></h1>
            <ul>
              <li><a href="/participate/submit-pr.html">Submitting Pull Requests</a></li>
              <li><a href="/participate/report-issue.html">Reporting Issues</a></li>
              <li><a href="/participate/index.html#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/help/index.html">Get Help</a></h1>
            <ul>
              <li><a href="/help/index.html#documentation">Documentation</a></li>
              <li><a href="/wiki/index.html">Wiki</a></li>
              <li><a href="/help/index.html#support">Community Support</a></li>
              <li><a href="/help/commercial-support.html">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="/download/index.html">Download</a></h1>
            <ul>
              <li><a href="/download/index.html">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="/download/index.html#source">Building from source</a></li>
              <li><a href="/download/index.html#previous">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
            
      </div>
    </div>


    

    <script src="/js/vendor/jquery-3.2.1.min.js"></script>
    <script src="/js/vendor/what-input.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>
    <script src="/js/vendor/jquery.colorbox-min.js"></script>
    <script src="/js/netbeans.js"></script>
    <script>

       $(function(){ $(document).foundation(); });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
       $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); }); 
    </script>

  </body>
</html>
