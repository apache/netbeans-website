<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>I have a non-singleton TopComponent. Can I write actions which show all available instances in the main menu?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqMultipleTopComponentAction">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqMultipleTopComponentAction">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 class="sect1">I have a non-singleton TopComponent. Can I write actions which show all available instances in the main menu?</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_tracking_topcomponents_and_creating_actions_for_them">Tracking TopComponents And Creating Actions For Them</a></li>
<li><a href="#_writing_an_action_which_provides_an_array_of_menu_items">Writing an Action which provides an array of menu items</a></li>
<li><a href="#_registering_the_action">Registering The Action</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Some people applications where there is one primary kind of window component - an editor of some kind, or something that visualizes some data.  There may be several such components open at any time, and they all are just instances of the same TopComponent subclass which are showing different data.</p>
</div>
<div class="paragraph">
<p>In this case, it can be useful to list all such components in the main menu, to facilitate switching between components.  This involves three steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Track all opened instances of the TopComponent subclass</p>
</li>
<li>
<p>Write an Action which provides an array of menu items, one for each TopComponent instance</p>
</li>
<li>
<p>Register that action in one of the main window menus</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracking_topcomponents_and_creating_actions_for_them"><a class="anchor" href="#_tracking_topcomponents_and_creating_actions_for_them"></a>Tracking TopComponents And Creating Actions For Them</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keeping track of all of the instances of our TopComponent subclass is simple.  Whenever a new one is constructed, we will just add it to a list.  There are only two caveats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We do not want memory leaks, so we should use a <code><a href="http://java.sun.com/javase/6/docs/api/java/lang/ref/WeakReference.html">WeakReference</a></code>.  That way a component which has been closed can be garbage collected</p>
</li>
<li>
<p>It is not guaranteed that, during restart, previously opened components will be deserialized on the event thread (though they should be).  So the list should be synchronized</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will add a static method which creates a list of `<a href="http://java.sun.com/javase/6/docs/api/javax/swing/Action.html">Action</a>`s suitable for use with standard Swing `<a href="http://java.sun.com/javase/6/docs/api/javax/swing/JMenuItem.html">JMenuItem</a>`s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//Helper annotation to allow our component to be remembered across restarts.
//The DTD does not have to be defined, it just needs to be a unique name
@ConvertAsProperties(dtd = "-//org.netbeans.demo.multitopcomponent//MultiTopComponent//EN", autostore = false)
public class MultiTopComponent extends TopComponent {
  //A index for our display name, so we can tell the components apart

  static int ix;
  //Keep a list of all components we create.  Synchronize it because
  //they could be deserialized on some random thread;  use WeakReferences
  //so we don't hold a closed TopComponent in memory if it will never
  //be used again
  private static List&lt;Reference&lt;TopComponent&gt;&gt; all =
          Collections.synchronizedList(
          new ArrayList&lt;Reference&lt;TopComponent&gt;&gt;());

  public MultiTopComponent() {
    setDisplayName("Component " + ix++);
    all.add(new WeakReference&lt;TopComponent&gt;(this));
    setLayout(new BorderLayout());
    add(new JLabel(getDisplayName()), BorderLayout.CENTER);
  }

  public static List&lt;Action&gt; allActions() {
    List&lt;Action&gt; result = new ArrayList&lt;Action&gt;();
    for (Iterator&lt;Reference&lt;TopComponent&gt;&gt; it = all.iterator(); it.hasNext();) {
      Reference&lt;TopComponent&gt; tc = it.next();
      TopComponent comp = tc.get();
      if (comp == null) {
        it.remove();
      } else {
        result.add(new ShowAction(comp.getDisplayName(), tc));
      }
    }
    return result;
  }

  private static final class ShowAction extends AbstractAction {
    //Our action should not hold a strong reference to the TopComponent -
    //if it is closed, it should get garbage collected.  If a menu
    //item holds a reference to the component, then it won't be

    private final Reference&lt;TopComponent&gt; tc;

    public ShowAction(String name, Reference&lt;TopComponent&gt; tc) {
      this.tc = tc;
      putValue(NAME, name);
    }

    @Override
    public void actionPerformed(ActionEvent e) {
      TopComponent comp = tc.get();
      if (comp != null) { //Could have been garbage collected
        comp.requestActive();
      } else {
        //will almost never happen
        Toolkit.getDefaultToolkit().beep();
      }
    }

    @Override
    public boolean isEnabled() {
      TopComponent comp = tc.get();
      return comp != null &amp;amp;&amp;amp; comp.isOpened();
    }
  }

  @Override
  public int getPersistenceType() {
    return PERSISTENCE_ONLY_OPENED;
  }

  void readProperties(java.util.Properties p) {
    setDisplayName(p.getProperty("name"));
  }

  void writeProperties(java.util.Properties p) {
    p.setProperty("name", getDisplayName());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class contains <em>persistence</em> code - particularly the <code><a href="https://bits.netbeans.org/dev/javadoc/org-netbeans-modules-settings/org/netbeans/api/settings/ConvertAsProperties.html">@ConvertAsProperties</a></code> annotation and the methods <code>readProperties()``writeProperties()</code> and <code>getPersistenceType()</code>.  These methods save some information about our TopComponent to disk on shutdown, in the form of a <code><a href="http://java.sun.com/javase/6/docs/api/java/util/Properties.html">Properties</a></code> object.  If we do not want our components to be reopened after an application restart, we can just return <code>PERSISTENCE_NEVER</code> from <code>getPersistenceType()</code>, and delete the other persistence-related methods and the annotation.  Note that you can omit the <code>*Properties()</code> methods and the annotation, and the components <em>will</em> be reopened on startup&#8201;&#8212;&#8201;but without persistence code, this is done by serializing the whole component to disk, which is both slower and stores more data than necessary.  Typically, for an editor component, just storing the path to the file being edited is enough.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_an_action_which_provides_an_array_of_menu_items"><a class="anchor" href="#_writing_an_action_which_provides_an_array_of_menu_items"></a>Writing an Action which provides an array of menu items</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code><a href="https://bits.netbeans.org/dev/javadoc/org-openide-awt/org/openide/awt/DynamicMenuContent.html">DynamicMenuContent</a></code> interface allows an Action to act as a factory for menu items - to control what components are shown in a menu to represent it.  It also allows a single action to produce multiple menu items.</p>
</div>
<div class="paragraph">
<p>Here we will create an action which produces an array of menu items.  All of them will be shown inline in the main menu:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MultiComponentAction extends AbstractAction implements DynamicMenuContent {

    @Override
    public void actionPerformed(ActionEvent e) {
        throw new AssertionError("Should never be called");
    }

    @Override
    public JComponent[] getMenuPresenters() {
        List&lt;Action&gt; actions = MultiTopComponent.allActions();
        List&lt;JComponent&gt; result = new ArrayList&lt;JComponent&gt;(actions.size());
        for (Action a : actions) {
            result.add (new JMenuItem(a));
        }
        return result.toArray(new JComponent[result.size()]);
    }

    @Override
    public JComponent[] synchMenuPresenters(JComponent[] jcs) {
        //We could iterate all of our JMenuItems from the previous call to
        //getMenuPresenters() here, weed out those for dead TopComponents and
        //add entries for newly created TopComponents here
        return getMenuPresenters();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create an <em>inline</em> array of menu items, not a submenu.  If you want a submenu instead, then implement <code>getMenuPresenters()</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        List&lt;Action&gt; actions = MultiTopComponent.allActions();
        JMenu menu = new JMenu("Multi TopComponents");
        for (Action a : actions) {
            menu.add (a);
        }
        return new JComponent[] { menu };</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_the_action"><a class="anchor" href="#_registering_the_action"></a>Registering The Action</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we just need to actually add our multi-item action to the main menu, by registering it in our module&#8217;s <a href="../DevFaqModulesLayerFile/" class="xref page">XML layer</a>.</p>
</div>
<div class="paragraph">
<p>In this example, we register it in the <code>Actions/Window</code> folder and then create a link in the Window menu folder using a <a href="../DevFaqDotShadowFiles/" class="xref page">.shadow file</a>.  Note that we could simply put the <a href="../DevFaqInstanceDataObject/" class="xref page">.instance file</a> directly in the <code>Menu/Window</code> folder, but this approach is the preferred practice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&amp;amp;lt;?xml version=&amp;amp;quot;1.0&amp;amp;quot; encoding=&amp;amp;quot;UTF-8&amp;amp;quot;?&amp;amp;gt;
&amp;amp;lt;!DOCTYPE filesystem PUBLIC
     &amp;amp;quot;-//NetBeans//DTD Filesystem 1.1//EN&amp;amp;quot;
     &amp;amp;quot;http://www.netbeans.org/dtds/filesystem-1_1.dtd&amp;amp;quot;&amp;amp;gt;
&amp;amp;lt;filesystem&amp;amp;gt;
    &amp;amp;lt;folder name=&amp;amp;quot;Actions&amp;amp;quot;&amp;amp;gt;
        &amp;amp;lt;folder name=&amp;amp;quot;Window&amp;amp;quot;&amp;amp;gt;
            &amp;amp;lt;file name=&amp;amp;quot;org-netbeans-demo-multitopcomponent-MultiComponentAction.instance&amp;amp;quot;&amp;amp;gt;
                &amp;amp;lt;attr name=&amp;amp;quot;position&amp;amp;quot; intvalue=&amp;amp;quot;230&amp;amp;quot;/&amp;amp;gt;
            &amp;amp;lt;/file&amp;amp;gt;
        &amp;amp;lt;/folder&amp;amp;gt;
    &amp;amp;lt;/folder&amp;amp;gt;
    &amp;amp;lt;folder name=&amp;amp;quot;Menu&amp;amp;quot;&amp;amp;gt;
        &amp;amp;lt;folder name=&amp;amp;quot;Window&amp;amp;quot;&amp;amp;gt;
            &amp;amp;lt;!-- This is the action that actually shows all available components --&amp;amp;gt;
            &amp;amp;lt;file name=&amp;amp;quot;MultiComponent.shadow&amp;amp;quot;&amp;amp;gt;
                &amp;amp;lt;attr name=&amp;amp;quot;position&amp;amp;quot; intvalue=&amp;amp;quot;230&amp;amp;quot;/&amp;amp;gt;
                &amp;amp;lt;attr name=&amp;amp;quot;originalFile&amp;amp;quot;
                stringvalue=&amp;amp;quot;Actions/Window/org-netbeans-demo-multitopcomponent-MultiComponentAction.instance&amp;amp;quot;/&amp;amp;gt;
            &amp;amp;lt;/file&amp;amp;gt;
        &amp;amp;lt;/folder&amp;amp;gt;
    &amp;amp;lt;/folder&amp;amp;gt;
&amp;amp;lt;/filesystem&amp;amp;gt;</code></pre>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/DevFaqMultipleTopComponentAction.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
