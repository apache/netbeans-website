<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>FitnessViaPostMortem</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="How it works?">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="../../../../_/css/highlight-11.9.0.default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 21</h1>
            <p><a class="button success" href="../../../../front/main/download/nb21">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 style="visibily: hidden">FitnessViaPostMortem</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_how_it_works">How it works?</a>
<ul class="sectlevel2">
<li><a href="#What_our_users_shall_do">What our users shall do?</a></li>
<li><a href="#Evaluating_Snapshot">Evaluating Snapshot</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is a continuation of the
<a href="../FitnessViaPartnership/" class="xref page">FitnessViaPartnership</a> that enhances the
original ideas with automatic postmortem identification and notification of
problems. Done as part of <a href="../Fitness/" class="xref page">performance work for 6.8</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infrastructure: <a href="https://bz.apache.org/netbeans/show_bug.cgi?id=166023">IZ 166023</a></p>
</li>
<li>
<p>Bugs reported with <strong>perf-profileme</strong> status board: <a href="https://bz.apache.org/netbeans/buglist.cgi?bug_file_loc_type=substring&amp;bugidtype=include&amp;chfieldto=Now&amp;cmdtype=doit&amp;emailassigned_to1=1&amp;emailreporter2=1&amp;emailtype1=substring&amp;emailtype2=substring&amp;field0-0-0=noop&amp;keywords_type=anywords&amp;long_desc_type=substring&amp;order=Reuse%20same%20sort%20as%20last%20time&amp;query_format=advanced&amp;short_desc_type=substring&amp;status_whiteboard=perf-profileme&amp;status_whiteboard_type=substring&amp;type0-0-0=noop">list</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a>How it works?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="../../_images/wiki/notification_FitnessViaPostMortem.png" alt="notification FitnessViaPostMortem"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Detects that AWT thread is blocked for more than certain time (100ms in dev builds, 10s in final production build)</p>
</li>
<li>
<p>Starts self-sampling profiling</p>
</li>
<li>
<p>As soon as AWT thread is free:</p>
<div class="ulist">
<ul>
<li>
<p>stops the profiling</p>
</li>
<li>
<p>if the elapsed time is more than <a href="http://performance.netbeans.org/responsiveness/whatisresponsiveness.html">appropriate</a> (3s in dev builds, 20s in final production build), it displays a notification</p>
</li>
<li>
<p>the notification stays on for a minute, then it disappears</p>
</li>
</ul>
</div>
</li>
<li>
<p>What are the user&#8217;s options?</p>
<div class="ulist">
<ul>
<li>
<p>ignore the icon (disappears after a minute)</p>
</li>
<li>
<p>submit a bug report via <a href="../FitnessViaPostMortemAutoReport/" class="xref page">FitnessViaPostMortemAutoReport</a>
*Â¿ explore the content themselves (view data/show profiler data and work in editor as the dialog is modal)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="What_our_users_shall_do"><a class="anchor" href="#What_our_users_shall_do"></a>What our users shall do?</h3>
<div class="sect3">
<h4 id="Enabling_the_slowness_detector"><a class="anchor" href="#Enabling_the_slowness_detector"></a>Enabling the slowness detector</h4>
<div class="paragraph">
<p>The slowness detector is enabled by default in development builds and beta builds. However, it is disabled by default in final releases in NetBeans, and in release candidates. To enable the slowness detector in the FCS and RC builds, it is necessary to enable assertions, i.e. run the IDE with the following switch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-J-ea</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the <code>-J-ea</code> parameter can be added to the <code>netbeans_default_options</code> property in <code>etc/netbeans.conf</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Not_all_slowness_is_a_problem."><a class="anchor" href="#Not_all_slowness_is_a_problem."></a>Not all slowness is a problem.</h4>
<div class="paragraph">
<p>Sometimes it may be acceptable. For example if the system wakes up from hibernation, etc. In such case just ignore the report and close it.</p>
</div>
</div>
<div class="sect3">
<h4 id="I_don.27t_care_about_slowness"><a class="anchor" href="#I_don.27t_care_about_slowness"></a>I don&#8217;t care about slowness</h4>
<div class="paragraph">
<p>In case you are annoyed by the "slowness detector" you may disable it by providing additional properties when launching NetBeans. For example to report only blockages higher than 10s use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-J-Dorg.netbeans.core.TimeableEventQueue.report=10000</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also increase the time when the sampling starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-J-Dorg.netbeans.core.TimeableEventQueue.quantum=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since 6.9 development time there is also <em>slowness detector</em> on code completion. If it takes more than 2s to provide results, it starts self profiling and allows you to complain. You can adjust the time by specifying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-J-Dorg.netbeans.modules.editor.completion.slowness.report=10000</code></pre>
</div>
</div>
<div class="paragraph">
<p>(to be included in 7.0beta2).</p>
</div>
</div>
<div class="sect3">
<h4 id="Real_Slowness"><a class="anchor" href="#Real_Slowness"></a>Real Slowness</h4>
<div class="paragraph">
<p>If you really noticed the slowness (e.g. blocked mouse, or keyboard input), then you can submit it for evaluation to <a href="../FitnessViaPostMortemAutoReport/" class="xref page">FitnessViaPostMortemAutoReport</a> or you can evaluate the snapshot first and then submit it.</p>
</div>
<div class="paragraph">
<p>To evaluate the snapshot follow these steps: click on the slowness notification icon in bottom right corner, click view data and click show profiler data. Snapshot is open in editor area and you can work with it as above dialog is modal are modal.</p>
</div>
<div class="paragraph">
<p>Thanks in advance for your help!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Evaluating_Snapshot"><a class="anchor" href="#Evaluating_Snapshot"></a>Evaluating Snapshot</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Important things are happening in AWT-Event threads. Explore what is happening there.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the snapshot ends in <code>Object.wait()</code> or while waiting on some lock, explore other threads to see who&#8217;s blocking the evaluation</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Weird_Behaviour"><a class="anchor" href="#Weird_Behaviour"></a>Weird Behaviour</h4>
<div class="paragraph">
<p>There are some things that can confuse those who evaluate the profiler snapshots taken by the slowness detector. Please be patient, the improvements are in the queue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Sum of time of all threads is wrong</strong> - currently the time of all threads is summed up, which is wrong. We use sampling and we are measuring the real time, not CPU time. The sum for all threads shall be max of all thread times. Confusion among poor developers would be lowered.</p>
</li>
<li>
<p><strong>Object.wait() interpretation is almost impossible</strong> - Just try to analyse dump from <a href="https://bz.apache.org/netbeans/show_bug.cgi?id=168536">IZ 168536</a> and find out why the AWT thread is blocked. Quite hard and some simplification is needed.</p>
</li>
<li>
<p><strong>Hotspots Tab Unusable</strong> - most developers start understanding of a slowness problem by looking at Hotspots tab of the snapshot. However this is currently unusable as it primarily shows CLI Handler and XAWT-Dispatch threads as the biggest bottleneck (they are waiting for socketAccept or other I/O). This results in large confusion, useless close/reopen bug lifecycle stage, etc.</p>
</li>
<li>
<p><strong>Inaccurate Snapshots</strong> - the accuracy of the snapshot&#8217;s data depends on regular execution of the time (e.g. each 10ms a thread dump shall be taken). This may not be satisfied all the time, especially if the system is being awaken from hibernation, etc. This needs to be detected and indicated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We need help from profiler team to improve the snapshots themselves or simplify life of those who analyse them. Please, help our developers be more productive!</p>
</div>
</div>
<div class="sect3">
<h4 id="Plan_to_Address_Weird_Behaviour"><a class="anchor" href="#Plan_to_Address_Weird_Behaviour"></a>Plan to Address Weird Behaviour</h4>
<div class="ulist">
<ul>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> Have a meeting with profiler guys</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> 'Jarda': Write the plan</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>native wait</strong> - treat Object.wait and <em><a href="">native.html[[native</a></em> state equally (e.g. zero execution time)</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>two times</strong> - output two times (execution time, wall clock time) into the .nps file</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>display two times</strong> - make sure the UI represents the two times in some columns</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>no sum for threads</strong> - the sum of all threads execution is incorrect (in sampling or on multicore CPUs), thus hide it</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>JMX</strong> - rewrite the sampler to JMX. This will open the door to possible use in VisualVM as well as provide more info about the real thread execution time</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>overhead</strong> is slightly less than 10% - <em>Jarda</em>: measure overhead of sampling (I ran the sieve of erastothenes for first 100000 numbers. Without self profiling 4.1s+-100ms with profiling 4.3ms+-100ms)</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>inaccuracy</strong>: compute average snapshot time and ignore intervals that are far (more than 30ms) from average. Potentially don&#8217;t report these snapshots at all as a slowdown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tentatively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>collect wait info</strong>: generate a subnode below Object.wait() or monitor enter(?) with a subtree of other threads activity during the blocked time</p>
</li>
<li>
<p><span class="image"><img src="../../_images/wiki/yes.png" alt="yes"></span> <strong>format</strong>: change the sampling format to be (more or less) GZip of stacktraces. Processing to tree structure would occur later. Done for NetBeans 6.9</p>
</li>
<li>
<p><a href="./" class="xref page">FitnessViaPostMortem</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/FitnessViaPostMortem.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2024 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="../../../../_/js/vendor/highlight-11.9.0.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
         document.querySelectorAll('pre code').forEach((el) => {
         hljs.highlightElement(el);
        });
      });
    </script>
  </body>
</html>
