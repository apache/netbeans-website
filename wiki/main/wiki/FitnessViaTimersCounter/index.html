<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>FitnessViaTimersCounter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Timers/Counters">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 20</h1>
            <p><a class="button success" href="../../../../front/main/download/nb20">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 style="visibily: hidden">FitnessViaTimersCounter</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_timerscounters">Timers/Counters</a>
<ul class="sectlevel2">
<li><a href="#How_to_ensure_acceptable_performance.3F">How to ensure acceptable performance?</a></li>
<li><a href="#How_to_fight_against_memory_leaks.3F">How to fight against memory leaks?</a></li>
</ul>
</li>
<li><a href="#Probes">Probes</a>
<ul class="sectlevel2">
<li><a href="#Runtime_Watches_Window">Runtime Watches Window</a></li>
<li><a href="#Writing_Automated_Tests">Writing Automated Tests</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_timerscounters"><a class="anchor" href="#_timerscounters"></a>Timers/Counters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Timers/counters (a.k.a Runtime watches) is a plugin that defined a convention
based on
<a href="https://bits.netbeans.org/dev/javadoc/org-openide-util/org/openide/util/doc-files/logging.html#structured">structured logging</a>
for communicating some performance metrics. It depends on <a href="#Probes">probes</a> spread over the code of
interest, but the probes themselves don&#8217;t depend on the plugin.</p>
</div>
<div class="sect2">
<h3 id="How_to_ensure_acceptable_performance.3F"><a class="anchor" href="#How_to_ensure_acceptable_performance.3F"></a>How to ensure acceptable performance?</h3>
<div class="paragraph">
<p>First, the code needs to have <a href="#Probes">probes</a> coded in, so it reports times taken for interesting parts of processing. Then users can see reported times in the runtime watches window as soon as each
measured action finishes (if they have the plugin installed).
The probes can also be used from inside a test by registering a special handler for the TIMER logger and using it for collecting the times. Such a test would heavily depend on the configuration and the load of the testing machine, though, so it is not recommended except for properly controlled environment (automated daily tests).</p>
</div>
</div>
<div class="sect2">
<h3 id="How_to_fight_against_memory_leaks.3F"><a class="anchor" href="#How_to_fight_against_memory_leaks.3F"></a>How to fight against memory leaks?</h3>
<div class="paragraph">
<p>Again, proper object reference <a href="#Probes">probes</a> needs to be in place first so users can potentially see the accumulating objects in the runtime watches window. Then the NbTestCase can be extended to intercept object reference logging messages and collect weak references to the reported objects. At the end of each test, the assertGC can be called for each reference to verify the objects were freed correctly. Of course not every test would want this functionality, so each test would need to indicate this need and maybe somehow provide a filter of objects to consider (e.g. not tracking Projects, only Documents).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Probes"><a class="anchor" href="#Probes"></a>Probes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two kinds of probes supported currently, but more kinds can be defined, if necessary.
Each probe reports some information keyed by (usually) two keys that form a hierarchy.
The primary key is usually a FileObject (but can be any type), while the second is always a String message.</p>
</div>
<div class="paragraph">
<p>The probe kinds are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">integer value (count, time) </dt>
<dd>
<p>allows a number (time to perform an operation, number of objects processed during the operation) to be reported with a message and a key. The typical use case would be:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">long time = System.currentTimeMillis();
int count = parseEverything();
time = System.currentTimeMillis() - time;
Logger timer = Logger.getLogger("TIMER");
timer.log(Level.FINE, "Parsed objects",new Object[] {myFileObject, count});
timer.log(Level.FINE, "Parsed in [[Ms | ms]]",new Object[] {myFileObject, time});</code></pre>
</div>
</div>
<div class="paragraph">
<p>or some simplification (log only time, only count, less local variables).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">object reference </dt>
<dd>
<p>allows tracking a life cycle of passed object. This is useful if you need to check number of created objects of given kind in given context. The probe would typically end up in the constructor of the object, like:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SyntaxElement(FileObect fo) {
    this.fo = fo;
    Logger.getLogger("TIMER").log(Level.FINE, "SyntaxElements",new Object[] {fo, this});
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a simplified way of logging common IDE-wide instaces without the primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Logger.getLogger("TIMER").log(Level.FINE, "Project:", p);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="Runtime_Watches_Window"><a class="anchor" href="#Runtime_Watches_Window"></a>Runtime Watches Window</h3>
<div class="paragraph">
<p>Having the probes in your code, you can always inspect their results in the Runtime Watches window. The window can be shown by clicking on the "Run-time Watches" button in the <em>Memory toolbar</em> (next to the memory meter).</p>
</div>
<div class="paragraph">
<p>You can see registered objects for given keys (usually files) and number of instances. You can invoke <em>Find References</em> to see how the instances are held in memory.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/wiki/RuntimeWatches.png" alt="RuntimeWatches"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="Writing_Automated_Tests"><a class="anchor" href="#Writing_Automated_Tests"></a>Writing Automated Tests</h3>
<div class="paragraph">
<p>It is easy to enhance existing functional tests with checkpoints asserting that all probes of a kind has been released. See <a href="../FitnessMemoryLeaks/" class="xref page">FitnessMemoryLeaks</a>.</p>
</div>
<div class="paragraph">
<p><a href="#./Category:Performance:ToolsAndTests.adoc" class="xref unresolved">Category:Performance:ToolsAndTests</a> <a href="#./Category:Performance:HowTo.adoc" class="xref unresolved">Category:Performance:HowTo</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The content in this page was kindly donated by Oracle Corp. to the Apache Software Foundation.</p>
</div>
<div class="paragraph">
<p>This page was exported from <a href="http://wiki.netbeans.org/FitnessViaTimersCounter">http://wiki.netbeans.org/FitnessViaTimersCounter</a> , that was last modified by NetBeans user Tpavek on 2010-02-18T17:46:48Z.</p>
</div>
<div class="paragraph">
<p>This document was automatically converted to the AsciiDoc format on 2020-03-12, and needs to be reviewed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/FitnessViaTimersCounter.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
