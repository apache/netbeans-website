<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Can I obfuscate a module?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqModuleObfuscation">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqModuleObfuscation">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 class="sect1">Can I obfuscate a module?</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div class="paragraph">
<p>If you want to protect a NetBeans module from disassembly, you can obfuscate it.
For example you can use <a href="http://proguard.sourceforge.net/">ProGuard</a>, an open-source obfuscator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy <code>proguard.jar</code> somewhere on disk, referenced by <code>proguard.jar.path</code>. You can do this for example by creating a <code>build.properties</code> in the module directory and reference it in the <code>build.xml</code> like</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;!-- Load project's default properties --&gt;
    &lt;property file="${basedir}/build.properties"/&gt;

    &lt;import file="nbproject/build-impl.xml"/&gt;

&lt;!-- ### BEGIN OBFUSCATION TARGETS ###--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is assuming that you have created a directory called <code>tools</code> parallel to your module. Under that <code>tools</code> directory have you copied the proguard jar file into &lt;pre&gt;tools/obfuscating/jar/proguard.jar&lt;/pre&gt;</p>
</div>
<div class="paragraph">
<p>The <code>build.properties</code> could look like the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">tools.dir=../tools
proguard.jar.path=${tools.dir}/obfuscating/jar/proguard.jar</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Edit the <code>build.xml</code> of your module and override some targets as in the following excerpt:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Replace the non-obfuscated jar with the obfuscated one when compiling --&gt;
&lt;target name="netbeans-extra" depends="obfuscate"&gt;
    &lt;copy file="${suite.dir}/build/obfuscated/${module.jar}"
          tofile="${cluster}/${module.jar}"/&gt;
&lt;/target&gt;

&lt;!-- Overridden debug target that depends on netbeans-debug --&gt;
&lt;target name="debug" depends="netbeans-debug,-jdk-presetdef-nbjpdastart"&gt;
    &lt;ant antfile="${harness.dir}/run.xml" target="debug"/&gt;
&lt;/target&gt;

&lt;!-- netbeans-debug DOES NOT depends on netbeans-extra
     (then DOES NOT depends on obfuscate) --&gt;
&lt;target name="netbeans-debug"
        depends="init,jar,module-xml-regular,module-xml-autoload,
      module-xml-eager,javahelp,module-auto-deps,release,verify-class-linkage"&gt;
    &lt;genlist outputfiledir="${cluster}" module="${module.jar}"&gt;
        &lt;fileset dir="${cluster}"&gt;
            &lt;patternset refid="module.files"/&gt;
        &lt;/fileset&gt;
    &lt;/genlist&gt;
&lt;/target&gt;

&lt;!-- Overridden to delete also the obfuscated jar --&gt;
&lt;target name="clean" depends="files-init,testuserdir-delete"&gt;
    &lt;delete failonerror="false" includeemptydirs="true"&gt;
        &lt;fileset dir="build"&gt;
            &lt;exclude name="testuserdir/"/&gt;
        &lt;/fileset&gt;
    &lt;/delete&gt;
    &lt;delete dir="${netbeans.javadoc.dir}/${code.name.base.dashes}"/&gt;
    &lt;delete file="${netbeans.javadoc.dir}/${code.name.base.dashes}.zip"/&gt;
    &lt;delete failonerror="false"&gt; &lt;!-- #59457: OK if cluster does not exist currently --&gt;
        &lt;fileset dir="${cluster}"&gt;
            &lt;patternset refid="module.files"/&gt;
        &lt;/fileset&gt;
    &lt;/delete&gt;
    &lt;delete file="${cluster}/update_tracking/${code.name.base.dashes}.xml"/&gt;
    &lt;delete file="${suite.dir}/build/obfuscated/${module.jar}"/&gt;
&lt;/target&gt;

&lt;!--  Just a cut and paste of how the proguard obfuscator works.
      This is not supposed to work below.  In fact, this seems to work
      on jars, not .class files, so it will have to be placed in a
      post jar target, which I haven't identified yet --&gt;
&lt;target name="obfuscate" depends="init"&gt;
    &lt;taskdef resource="proguard/ant/task.properties"
             classpath="${proguard.jar.path}" /&gt;

    &lt;echo message="Obfuscating ${cluster}/${module.jar}..."/&gt;
    &lt;mkdir dir="${suite.dir}/build/obfuscated"/&gt;
    &lt;proguard printmapping="${suite.dir}/build/obfuscated/${code.name.base.dashes}.map"
              renamesourcefileattribute="SourceFile" ignorewarnings="true"&gt;

        &lt;!-- Specify the input jars, output jars, and library jars. --&gt;
        &lt;injar  file="${cluster}/${module.jar}" /&gt;
        &lt;outjar file="${suite.dir}/build/obfuscated/${module.jar}" /&gt;

        &lt;libraryjar path="${module.run.classpath}" /&gt;
        &lt;libraryjar file="${nbjdk.home}/jre/lib/rt.jar" /&gt;

        &lt;!-- Keep some useful attributes. --&gt;

        &lt;keepattribute name="InnerClasses" /&gt;
        &lt;keepattribute name="SourceFile" /&gt;
        &lt;keepattribute name="LineNumberTable" /&gt;
        &lt;keepattribute name="Deprecated" /&gt;
        &lt;keepattribute name="*Annotation*" /&gt;
        &lt;keepattribute name="Signature" /&gt;

        &lt;!-- Preserve all public classes,
             and their public and protected fields and methods. --&gt;

        &lt;keep access="public"&gt;
            &lt;field  access="public protected" /&gt;
            &lt;method access="public protected" /&gt;
        &lt;/keep&gt;


        &lt;!-- Preserve all .class method names. --&gt;

        &lt;keepclassmembernames access="public"&gt;
            &lt;method type      ="java.lang.Class"
                    name      ="class$"
                    parameters="java.lang.String" /&gt;
            &lt;method type      ="java.lang.Class"
                    name      ="class$"
                    parameters="java.lang.String,boolean" /&gt;
        &lt;/keepclassmembernames&gt;

        &lt;!-- Preserve all native method names and the names of their classes. --&gt;

        &lt;keepclasseswithmembernames&gt;
            &lt;method access="native" /&gt;
        &lt;/keepclasseswithmembernames&gt;

        &lt;!-- Preserve the methods that are required in all enumeration classes. --&gt;

        &lt;keepclassmembers extends="java.lang.Enum"&gt;
            &lt;method access="public static"
                    type="**[]"
                    name="values"
                    parameters="" /&gt;
            &lt;method access="public static"
                    type="**"
                    name="valueOf"
                    parameters="java.lang.String" /&gt;
        &lt;/keepclassmembers&gt;

        &lt;!-- Explicitly preserve all serialization members. The Serializable
             interface is only a marker interface, so it wouldn't save them.
             You can comment this out if your library doesn't use serialization.
             With this code serializable classes will be backward compatible --&gt;

        &lt;keepnames implements="java.io.Serializable"/&gt;
        &lt;keepclassmembers implements="java.io.Serializable"&gt;
            &lt;field  access    ="final"
                    type      ="long"
                    name      ="serialVersionUID" /&gt;
            &lt;field  access    ="!static !transient"
                    name      ="**"/&gt;
            &lt;field  access    ="!private"
                    name      ="**"/&gt;
            &lt;method access    ="!private"
                    name      ="**"/&gt;
            &lt;method access    ="private"
                    type      ="void"
                    name      ="writeObject"
                    parameters="java.io.ObjectOutputStream" /&gt;
            &lt;method access    ="private"
                    type      ="void"
                    name      ="readObject"
                    parameters="java.io.ObjectOutputStream" /&gt;
            &lt;method type      ="java.lang.Object"
                    name      ="writeReplace"
                    parameters="" /&gt;
            &lt;method type      ="java.lang.Object"
                    name      ="readResolve"
                    parameters="" /&gt;
        &lt;/keepclassmembers&gt;

        &lt;!-- Your application may contain more items that need to be preserved;
             typically classes that are dynamically created using Class.forName --&gt;

    &lt;/proguard&gt;
&lt;/target&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this way when running and when creating the NBM (as well from a suite) the module will be obfuscated.
When debugging your module you use the non-obfuscated JAR, so you can step through source as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example will obfuscate all your private classes and methods only. This approach should protect you against problems which a full obfuscation could create as <code>layer.xml</code> references to classes will not be found and other lookup/services mechanism would fail. Design your code accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>NOTE2: As a practical suggestion you could also decide not to overwrite the <code>debug</code> target and simply comment out the <code>netbeans-extra</code> target as long as you develop. Only activate the <code>netbeans-extra</code> target when you do a release build or create new <code>NBM&#8217;s</code> for an update.</p>
</div>
<div class="paragraph">
<p>This is verified to work on NB 6.5 running Solaris or Windows using Proguard 4.1. (<code>proguard.jar</code> 548 Kb) Issues were found with 4.2. Others versions (current Feb 2010) the 4.5 beta is out has not been tested yet. For Mac OS X you will need to softlink the classes.jar to rt.jar as described in <a href="http://bruehlicke.blogspot.com/search/label/Mac%20OS%20X"> This blog entry</a></p>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/DevFaqModuleObfuscation.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
