<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>How can I fix memory leaks?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqMemoryLeaks">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqMemoryLeaks">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="../../../../_/css/highlight-11.9.0.default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 21</h1>
            <p><a class="button success" href="../../../../front/main/download/nb21">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 class="sect1">How can I fix memory leaks?</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_jmap_and_built_in_dumpers_in_jdk"><code>jmap</code> and built-in dumpers in JDK</a>
<ul class="sectlevel2">
<li><a href="#_obtain_the_dump">Obtain the dump.</a></li>
<li><a href="#_analyze_the_problem">Analyze the problem.</a></li>
</ul>
</li>
<li><a href="#_other_tools">Other tools</a></li>
<li><a href="#_tips_and_tricks">Tips and tricks</a>
<ul class="sectlevel2">
<li><a href="#_common_leaking_objects">Common leaking objects</a></li>
<li><a href="#_leaks_vs_retained_memory">Leaks vs. retained memory</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The first problem is to identify what is the root problem causing memory to not be used effectively.
The usual approach for this is to analyze the complete contents of memory when the problem appears, using one of a number of appropriate tools, and ideally then find a solution.</p>
</div>
<div class="paragraph">
<p>Below are some hints on how to analyze the content of memory:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jmap_and_built_in_dumpers_in_jdk"><a class="anchor" href="#_jmap_and_built_in_dumpers_in_jdk"></a><code>jmap</code> and built-in dumpers in JDK</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_obtain_the_dump"><a class="anchor" href="#_obtain_the_dump"></a>Obtain the dump.</h3>
<div class="paragraph">
<p>If the problem causes <code>OutOfMemoryError</code>, it is possible to customize the JVM to provide a memory dump automatically whenever an <code>OutOfMemoryError</code> is thrown.
<a href="../FaqNetBeansAndOOME/" class="xref page">FaqNetBeansAndOOME</a> describes what options can be used for this.
If you are developing modules, it is a very good idea to set the option <code>-J-XX:+HeapDumpOnOutOfMemoryError</code>.</p>
</div>
<div class="paragraph">
<p>If the memory leak is not so aggresive to fill all the available memory and cause an <code>OutOfMemoryError</code>, it is still possible to use <code>jmap</code> to generate the same dump.
Running full GC before you create this dump can be a good idea as it can strip the size of dump file and remove some unimportant objects from the snapshot.
You can do this by turning memory toolbar on (do a right click in toolbar area and check <strong>Memory</strong>).
Repeating this several times can even collect large amounts of data held in various caches through soft or weak references and make it easier to browse the dump.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analyze_the_problem"><a class="anchor" href="#_analyze_the_problem"></a>Analyze the problem.</h3>
<div class="paragraph">
<p>Once you have the dump of the heap in a file, it is possible to open it using
the NetBeans profiler.
This has a number of analysis features and is integrated with the IDE, e.g. to browse sources.</p>
</div>
<div class="paragraph">
<p>Alternately, you can use the JDK&#8217;s tool <code>jhat</code>.
It will start simple web server and you can use a web browser to see the data.
There are many functions starting with lists of classes with numbers of objects and their size, navigation between references,
finding of reference chains from GC root to certain objects.
JavaScript can be used to express more complex queries.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_tools"><a class="anchor" href="#_other_tools"></a>Other tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>INSANE is a home-grown tool that is useful for analysis of memory content and also can be used in automated tests - so once you have fixed a memory leak, you can write a test that will fail if the memory leak is ever recreated.
<code>NbTestCase.assertGC</code> is all you need to know. See also <a href="../FitnessMemoryLeaks/" class="xref page">FitnessMemoryLeaks</a>.</p>
</div>
<div class="paragraph">
<p><a href="../FitnessViaTimersCounter/" class="xref page">Timers/counters</a> module can be used to register objects of interest in the code, then inspect them during IDE run via Runtime Watches window.</p>
</div>
<div class="paragraph">
<p>Advanced: <a href="http://www.opensolaris.org/os/community/dtrace/">DTrace</a> can be used to monitor object allocation and garbage collection. Nice article about using DTrace with the HotSpot provider: <a href="http://www.solarisinternals.com/wiki/index.php/DTrace_Topics_Java">Java and DTrace</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tips_and_tricks"><a class="anchor" href="#_tips_and_tricks"></a>Tips and tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_common_leaking_objects"><a class="anchor" href="#_common_leaking_objects"></a>Common leaking objects</h3>
<div class="paragraph">
<p>There are some typical classes where it should be easily possible to tell
what the appropriate number of their instances in memory should be,
and if these are leaking there is a serious problem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Projects - it means instances of all subclasses of <code>org.netbeans.api.project.Project</code></p>
</li>
<li>
<p>Editors (or <code>TopComponent`s) - it can be useful to check for `org.openide.text.QuietEditorPane</code> instances to see if closed editors can release substantial part of associated memory. If the editor component is held it often means that associated editor support is held too linking to parsing data, sidebars providing versioning information and probably also project metadata. It is also possible to look for instance of <code>org.openide.windows.TopComponent</code> if there is some suspicion or better to search for its particular subclasses. Generally there will be always certain numbers of `TopComponent`s.</p>
</li>
<li>
<p>Documents - somewhat related to editors. An important class where you can start is <code>org.netbeans.modules.editor.NbEditorDocument</code>.</p>
</li>
<li>
<p>Top-level windows - undisposed dialogs can be a problem as these hold native resources that can be limited in the system.</p>
</li>
<li>
<p><code>ClassLoader</code> - we need to be very careful and check that class loaders created dynamically during runtime can be GC&#8217;ed when they are no longer used. Without this the result is OOME signaling that perm gen area is full.</p>
</li>
<li>
<p><code>CompilationInfo</code> (<code>java.source</code> module) - related to Java infrastructure. An important class where you can start is <code>com.sun.tools.javac.code.Symtab</code>, which is a singleton in a javac instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_leaks_vs_retained_memory"><a class="anchor" href="#_leaks_vs_retained_memory"></a>Leaks vs. retained memory</h3>
<div class="paragraph">
<p>There are two different ways how memory can be wasted: leaks and improper retention of memory.</p>
</div>
<div class="paragraph">
<p><em>Leaks</em> are cases when repeated invocation of certain activity creates new set of objects that cannot be reclaimed after
activity is finished.
The biggest problem is accumulation of these objects that leads to increased memory usage
and after a long enough time leads to <code>OutOfMemoryError</code>.
The nature of this error is that it leaves data structures of an application in undefined state
so anything executed after this moment may lead to unexpected results.</p>
</div>
<div class="paragraph">
<p><em>Retained memory</em> is memory occupied by objects that were created to serve some purpose but these objects
are held longer than necessary.
This may mean that some action has to be performed that flushes these objects or they will remain in memory until the end of the session.
An example of the former is LRU caches (often holding last component in UI, files or projects).
A common example of the latter is resources like parsed bundles or images statically referenced in classes that use them.</p>
</div>
<div class="paragraph">
<p><code>-J-Dnetbeans.debug.heap</code> can make profiling easier as it more quickly releases references to collapsed nodes.</p>
</div>
<div class="paragraph">
<p>If you have the <strong>Timers</strong> module enabled (normally it is in dev builds),
click its button in the <strong>Memory</strong> toolbar
to get a summary of interesting live objects and statistics.</p>
</div>
<hr>
<div class="paragraph">
<p>Applies to: NetBeans 6.5 and above</p>
</div>
<div class="paragraph">
<p>Platforms: All</p>
</div>
<div class="paragraph">
<p><a href="../Category_Performance_HowTo/" class="xref page">Category:Performance:HowTo</a></p>
</div>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/DevFaqMemoryLeaks.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2024 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="../../../../_/js/vendor/highlight-11.9.0.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
         document.querySelectorAll('pre code').forEach((el) => {
         hljs.highlightElement(el);
        });
      });
    </script>
  </body>
</html>
