<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>How can I change my TopComponent to not be a singleton (NB version up to 6.9)?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Apache NetBeans wiki DevFaqNonSingletonTopComponents">
    <meta name="author" content="Apache NetBeans">
    <meta name="keywords" content="Apache NetBeans wiki DevFaqNonSingletonTopComponents">
    <meta name="generator" content="Apache NetBeans">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="alternate" type="application/atom+xml" title="Apache NetBeans Blog" href="https://netbeans.apache.org/blogs/atom" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="../../../../_/css/netbeans.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/images/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/images/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/images/fav/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/images/fav/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <link href="../../../../_/css/font-open-sans.css" rel="stylesheet">
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at
        http://www.apache.org/licenses/LICENSE-2.0
        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
  </head>
  <body>
    <div class="title-bar" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button type="button" data-toggle="responsive-menu"><i style='font-size: 32px; color: #fff; padding: 8px' class='fa fa-bars'></i></button>
    <div class="title-bar-title">Apache NetBeans</div>
</div>
<div class="top-bar" id="responsive-menu">
    <div class='top-bar-left'>
        <a class='title' href="../../../../index.html"><img src='../../../../_/images/apache-netbeans.svg' style='padding: 8px; height: 48px;'></img> Apache NetBeans</a>
    </div>
    <div class="top-bar-right">
        <ul class="vertical medium-horizontal menu" data-responsive-menu="drilldown medium-dropdown">
            <li> <input id="search-input" type="text" placeholder="Search the docs"> </li>
            <li> <a href="../../../../front/main/community">Community</a> </li>
            <li> <a href="../../../../front/main/participate">Participate</a> </li>
            <li> <a href="../../../../front/main/blogs">Blog</a></li>
            <li> <a href="../../../../front/main/help">Get Help</a> </li>
            <li> <a href="https://plugins.netbeans.apache.org/">Plugins</a> </li>
            <li> <a href="../../../../front/main/download">Download</a> </li>
        </ul>
    </div>
</div>

    <!-- src/templates/news -->
<section class="hero news alternate">
    <div class='grid-container'>
        <div class='cell'>
            <div class="annotation">Latest release</div>
            <h1>Apache NetBeans 19</h1>
            <p><a class="button success" href="../../../../front/main/download/nb19">Download</a></p>
        </div>
    </div>
</section>
    <div class='grid-container main-content'>
      <article class="doc">
      <h1 class="sect1">How can I change my TopComponent to not be a singleton (NB version up to 6.9)?</h1>
      <div class='aside' style='text-align: center; padding: 20px;'>
    <a href="../../../../wiki/main/wiki" title="Apache NetBeans WIKI">Apache NetBeans Wiki Index</a>
    <p><b>Note:</b> These pages are being reviewed.</p>
</div>
      <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_the_really_easy_way">The really easy way</a></li>
<li><a href="#_if_you_already_have_a_generated_singleton_topcomponent_subclass">If you already have a generated singleton TopComponent subclass</a></li>
<li><a href="#_creating_and_opening_your_topcomponents">Creating And Opening Your TopComponents</a></li>
<li><a href="#_what_about_persistence_always">What About PERSISTENCE_ALWAYS?</a></li>
<li><a href="#_if_you_do_not_have_any_persistence_code_but_your_components_are_reopening_on_restart">If you do not have any persistence code, but your components are reopening on restart&#8230;&#8203;</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The "New Window Component" wizard in the NetBeans IDE generates a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a> TopComponent.  That&#8217;s fine for windows that there should only be one of.  Particularly if you are <a href="../DevFaqEditorTopComponent/" class="xref page">creating some kind of editor</a>, you will want to create multiple instances of your TopComponent.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_really_easy_way"><a class="anchor" href="#_the_really_easy_way"></a>The really easy way</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have not already used the <strong>New Window</strong> template to create your TopComponent subclass, don&#8217;t.</p>
</div>
<div class="paragraph">
<p>Instead, use <em>New &gt; JPanel Form</em>.  Once the new JPanel is created, switch to the Code tab, and replace <code>extends javax.swing.JPanel</code> with <code>extends TopComponent</code>.  Then do the following things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override <code>getPersistenceType()</code>.</p>
</li>
<li>
<p>If you <em>do not</em> want your components reopened on restart</p>
</li>
<li>
<p>return <code>PERSISTENCE_NEVER</code>&#8201;&#8212;&#8201;that is all you need to do to make sure they are not preserved across restarts.</p>
</li>
<li>
<p>If you <em>do</em> want your components reopened on restart, then</p>
</li>
<li>
<p>return <code>PERSISTENCE_ONLY_OPENED</code> from <code>getPersistenceType()</code></p>
</li>
<li>
<p>Add the following slightly-cryptic annotation to the class: <code>@ConvertAsProperties(dtd = "-//com.yourmodule.yourpackage//YourTopComponent//EN", autostore = false)</code>, replacing the package and class name with your own.  This identifies a DTD.  You do not need to define the DTD.  You just need to give it a unique namespace that nothing else is using.  Package and class name work well for that.</p>
</li>
<li>
<p>Add two additional methods (you are not overriding anything and they can be package-private, like serialization methods):</p>
</li>
<li>
<p><code>void writeProperties(Properties p)</code> - here we will call <code>p.put()</code> passing enough information to reconstruct your component on restart.  If we are editing a file, we might save the path to the file.  If we are viewing a URL, we might save the URL.  If we want to be particularly fastidious, we might save the scroll position, or what line the editor caret was on , or anything else useful to restore the state of our component.</p>
</li>
<li>
<p><code>void readProperties(Properties p)</code> - here we will reading whatever keys we wrote out in <code>writeProperties</code> and (re)initializing the component to its pre-shutdown state.  This method will be called on startup to restore our component to its pre-shutdown state as best can be done.  If we were, say, editing a file that no longer exists, the appropriate thing to do is throw an exception.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_if_you_already_have_a_generated_singleton_topcomponent_subclass"><a class="anchor" href="#_if_you_already_have_a_generated_singleton_topcomponent_subclass"></a>If you already have a generated singleton TopComponent subclass</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The good news is that you won&#8217;t have to write any code&#8201;&#8212;&#8201;you&#8217;ll just have to delete some of the code that was generated for you.</p>
</div>
<div class="paragraph">
<p>In your TopComponent&#8217;s .java source file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete the static <code>instance</code> variable, which ought to be declared a few lines above the constructor.</p>
</li>
<li>
<p>Make sure your TopComponent class is <code>public</code></p>
</li>
<li>
<p>Make sure your TopComponent has a no-argument constructor which is <code>public</code></p>
</li>
<li>
<p>Delete the <code>getDefault()</code> method (typically somewhere around the middle of the file)</p>
</li>
<li>
<p>Delete the <code>findInstance()</code> method (which typically follows the <code>getDefault()</code> method)</p>
</li>
<li>
<p>Update the persistence code which saves your component&#8217;s state on shutdown and restores it on restart to reopen your component as follows</p>
</li>
<li>
<p>Locate the <code>getPersistenceType</code> method and change its return value to either <code><a href="https://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#PERSISTENCE_NEVER">TopComponent.PERSISTENCE_NEVER</a></code> or <code><a href="https://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#PERSISTENCE_ONLY_OPENED">TopComponent.PERSISTENCE_ONLY_OPENED</a></code> (see below for why).</p>
</li>
<li>
<p>If you have methods called <code>writeReplace()`and an inner class called `ResolvableHelper</code> (NetBeans 6.8 and earlier):</p>
</li>
<li>
<p>Delete the <code>writeReplace()</code> method (typically towards the end of the file)</p>
</li>
<li>
<p>Delete the <code>ResolvableHelper</code> inner class (typically towards the end of the file)</p>
</li>
<li>
<p>If you <em>do not want persistence across restarts</em>&#8201;&#8212;&#8201;you are returning PERSISTENCE_NEVER from <code>getPersistenceType()</code></p>
</li>
<li>
<p>If you have a <code>@ConvertAsProperties</code> annotation and <code>readProperties(Properties)</code> and <code>writeProperties(Properties)</code> methods, delete the annotation and both methods</p>
</li>
<li>
<p>If <em>do want persistence across restarts</em>&#8201;&#8212;&#8201;you are returning <code>PERSISTENCE_ONLY_OPENED</code> from`getPersistenceType()`</p>
</li>
<li>
<p>If you already have the <code>@ConvertAsProperties</code> annotation and <code>readProperties(Properties)</code> and <code>writeProperties(Properties)</code> methods just leave them there</p>
</li>
<li>
<p>If you do not have the annotation and those methods, implement them as described in the previous section</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next we will need to delete the metadata that registers the component:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For version 6.9 of NetBeans:</p>
</li>
<li>
<p>Delete the settings XML file for your component.  If your component class is <code>MyWindow</code> then that file will be in the same folder and will be called <code>MyWindowSettings.xml</code>.</p>
</li>
<li>
<p>Delete the <a href="../DevFaqWindowsWstcrefAndFriends/" class="xref page">wstcrf</a> (&quot;window system TopComponent reference&quot;) XML file in that folder.  If your component class is <code>MyWindow</code> then that file will be named <code>MyWindowWstcrf.xml</code></p>
</li>
<li>
<p>Edit your module&#8217;s [DevFaqModulesLayerFile| layer.xml file] to</p>
</li>
<li>
<p>Remove any references to either of these files (just use Ctrl-F to search for e.g. <code>MyWindowSettings.xml</code> and <code>MyWindowWstcrf.xml</code>).  They will be in <code>&lt;file&gt;</code> tags.</p>
</li>
<li>
<p>If you have removed a <code>&lt;file&gt;</code> entry, and it was the only entry in that folder, you can remove the XML for parent folder (and its parent if it is now empty, and so forth)</p>
</li>
<li>
<p>Find where an Action is registered for to open your (formerly) singleton TopComponent</p>
</li>
<li>
<p><em>NetBeans 6.9 and later:</em></p>
</li>
<li>
<p>Look for an <code>&lt;file&gt;</code> registered in <code>Actions/Window`in the XML file.  It will have an `&lt;attr&gt;</code> element that refers to your TopComponent class, e.g. <code>&lt;attr name=&quot;component&quot; methodvalue=&quot;com.foo.MyWindow.findInstance&quot;/&gt;</code>.  Delete the entire <code>&lt;file&gt;</code> entry.</p>
</li>
<li>
<p>Look for <code>&lt;file&gt;</code> entry for a <code>.shadow</code> file in <code>Actions/Menu</code> in the XML, with its <code>originalFile</code> pointing to the file entry you just deleted.  Delete the <code>.shadow</code> <code>&lt;file&gt;</code> too.</p>
</li>
<li>
<p><em>NetBeans 6.8 and earlier:</em></p>
</li>
<li>
<p>There will be an <code>Action</code> class in your sources which is registered, e.g. <code>MyWindowAction.java</code>.  Delete the java source file.</p>
</li>
<li>
<p>Look for an <code>&lt;file&gt;</code> registered in <code>Actions/Window`in the XML file.  It will be a `&lt;file&gt;</code> whose name is the munged fully-qualified class name of the <code>Action</code> you just deleted, e.g. <code>com-foo-MyWindowAction.instance</code>.  Delete the <code>&lt;file&gt;</code> entry for it</p>
</li>
<li>
<p>Look for <code>&lt;file&gt;</code> entry for a <code>.shadow</code> file in <code>Actions/Menu</code> in the XML, with its <code>originalFile</code> pointing to the file entry you just deleted.  Delete the <code>.shadow</code> <code>&lt;file&gt;</code> too.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_and_opening_your_topcomponents"><a class="anchor" href="#_creating_and_opening_your_topcomponents"></a>Creating And Opening Your TopComponents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have deleted the actions for your TopComponent, presumably they will be created some other way (for example, from a file&#8217;s popup menu).  You can create new instances of your TopComponent, open them and give them focus as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TopComponent win = new MyTopComponent();
win.open();
win.requestActive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wrote your persistence code correctly, your components will magically reopen on restart with no further work.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_about_persistence_always"><a class="anchor" href="#_what_about_persistence_always"></a>What About PERSISTENCE_ALWAYS?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is one other value you can return from <code><a href="https://bits.netbeans.org/dev/javadoc/org-openide-windows/org/openide/windows/TopComponent.html#getPersistenceType()">TopComponent.getPersistenceType()</a></code>.  That value is <code>TopComponent.PERSISTENCE_ALWAYS</code>.</p>
</div>
<div class="paragraph">
<p>While it is <em>legal</em> to return this value from a non-singleton TopComponent, it is almost never what you want to do.  What will happen if you do this is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every instance of your component that is <strong>ever created</strong> will be persisted on shutdown, <em>forever</em></p>
</li>
<li>
<p>Even if it is closed</p>
</li>
<li>
<p>Even if nothing can use it, or it represents a file that was deleted, or is in some other way invalid</p>
</li>
<li>
<p>Even if no code will ever be able to find it and open it again</p>
</li>
<li>
<p>One every restart, <em>forever</em></p>
</li>
<li>
<p>Every instance of your component that has <em>ever existed</em> will be read back from disk</p>
</li>
<li>
<p>Each one will slow down startup a little bit</p>
</li>
<li>
<p>Each one will be wasting disk space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ALWAYS</code> is for singleton components that need to be remembered forever across restarts. Don&#8217;t use it for non-singletons.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_if_you_do_not_have_any_persistence_code_but_your_components_are_reopening_on_restart"><a class="anchor" href="#_if_you_do_not_have_any_persistence_code_but_your_components_are_reopening_on_restart"></a>If you do not have any persistence code, but your components are reopening on restart&#8230;&#8203;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are returning either <code>PERSISTENCE_ONLY_OPENED</code> or <code>PERSISTENCE_ALWAYS</code> from <code>getPersistenceType()</code>.  If there is no persistence code, but you <em>are</em> returning one of these values, NetBeans will use plain old Java serialization to store and reload your component.</p>
</div>
<div class="paragraph">
<p>Either use <code>PERSISTENCE_NEVER</code> or write persistence code as described above.  Serialization is slower and more fragile than proper persistence, and is never a good option for production code.</p>
</div>
</div>
</div>
      <section class='tools'>
    <ul class="menu align-center">
        <li><a title="Facebook" href="https://www.facebook.com/NetBeans"><i class="fa fa-md fa-facebook"></i></a></li>
        <li><a title="Twitter" href="https://twitter.com/netbeans"><i class="fa fa-md fa-twitter"></i></a></li>
        <li><a title="Github" href="https://github.com/apache/netbeans"><i class="fa fa-md fa-github"></i></a></li>
        <li><a title="YouTube" href="https://www.youtube.com/user/netbeansvideos"><i class="fa fa-md fa-youtube"></i></a></li>
        <li><a title="Atom Feed" href="https://netbeans.apache.org/blogs/atom"><i class="fa fa-mf fa-rss"></i></a></li>
        <li><a title="Slack" href="https://tinyurl.com/netbeans-slack-signup/"><i class="fa fa-md fa-slack"></i></a></li>
        <li><a title="Issues" href="https://github.com/apache/netbeans/issues"><i class="fa fa-mf fa-bug"></i></a></li>
    </ul>
    <ul class="menu align-center">
        <li><a href="https://github.com/apache/netbeans-antora-wiki/edit/main/modules/ROOT/pages/wiki/DevFaqNonSingletonTopComponents.adoc" title="See this page in github"><i class="fa fa-md fa-edit"></i> See this page in GitHub.</a></li>
    </ul>
</section>
      </article>
    </div>
        <div class='grid-container incubator-area' style='margin-top: 64px'>
      <div class='grid-x grid-padding-x'>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/">
            <img style="width: 320px" title="Apache Software Foundation" src="../../../../_/images/asf_logo_wide.svg" />
          </a>
        </div>
        <div class='large-auto cell text-center'>
          <a href="https://www.apache.org/events/current-event.html">
            <img style="width:234px; height: 60px;" title="Apache Software Foundation current event" src="https://www.apache.org/events/current-event-234x60.png"/>
          </a>
        </div>
      </div>
    </div>
    <footer>
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/about">About</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/who">Who's Who</a></li>
              <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
              <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              <li><a href="https://www.apache.org/security/">Security</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/community">Community</a></h1>
            <ul>
              <li><a href="../../../../front/main/community/mailing-lists">Mailing lists</a></li>
              <li><a href="../../../../front/main/community/committer">Becoming a committer</a></li>
              <li><a href="../../../../front/main/community/events">NetBeans Events</a></li>
              <li><a href="https://www.apache.org/events/current-event.html">Apache Events</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/participate">Participate</a></h1>
            <ul>
              <li><a href="../../../../front/main/participate/submit-pr">Submitting Pull Requests</a></li>
              <li><a href="../../../../front/main/participate/report-issue">Reporting Issues</a></li>
              <li><a href="../../../../front/main/participate/#documentation">Improving the documentation</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/help">Get Help</a></h1>
            <ul>
              <li><a href="../../../../front/main/help/#documentation">Documentation</a></li>
              <li><a href="../../../../wiki/main/wiki">Wiki</a></li>
              <li><a href="../../../../front/main/help/#support">Community Support</a></li>
              <li><a href="../../../../front/main/help/commercial-support">Commercial Support</a></li>
            </ul>
          </div>
          <div class="large-auto cell">
            <h1><a href="../../../../front/main/download">Download</a></h1>
            <ul>
              <li><a href="../../../../front/main/download">Releases</a></li>                    
              <li><a href="https://plugins.netbeans.apache.org/">Plugins</a></li>
              <li><a href="../../../../front/main/download/#_daily_builds_and_building_from_source">Building from source</a></li>
              <li><a href="../../../../front/main/download/#_older_releases">Previous releases</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class='footer-disclaimer'>
      <div class="footer-disclaimer-content">
        <p>Copyright &copy; 2017-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
        <p>Licensed under the Apache <a href="https://www.apache.org/licenses/">license</a>, version 2.0</p>
        <div style='max-width: 40em; margin: 0 auto'>
          <p>Apache, Apache NetBeans, NetBeans, the Apache feather logo and the Apache NetBeans logo are trademarks of <a href="https://www.apache.org">The Apache Software Foundation</a>.</p>
          <p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.</p>
          <p>The Apache NetBeans website conforms to the <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Apache Software Foundation Privacy Policy</a></p>
        </div>
      </div>
    </div>

    
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
    <script src="../../../../_/js/vendor/jquery-3.7.1.min.js"></script>
    <script src="../../../../_/js/vendor/what-input.js"></script>
    <script src="../../../../_/js/vendor/foundation.min.js"></script>
    <script src="../../../../_/js/vendor/jquery.colorbox-min.js"></script>
    <script src="../../../../_/js/netbeans.js"></script>
    <script>
       $(function(){ $(document).foundation(); });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script>
      $(document).ready(function() { $("pre code").each(function(i, block) { hljs.highlightBlock(block); }); });
    </script>
  </body>
</html>
